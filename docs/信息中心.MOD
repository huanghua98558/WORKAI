åªæ¢è®¨å…ˆä¸ä¿®æ”¹ã€‚
ç”¨æˆ·è¯´"åªæ¢è®¨å…ˆä¸ä¿®æ”¹"ï¼Œæ„æ€æ˜¯åªè®¨è®ºæ–¹æ¡ˆï¼Œä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚è®©æˆ‘ç»§ç»­åˆ†æç°æœ‰ç³»ç»Ÿæ¶æ„ï¼Œç„¶åæä¾›å®Œæ•´çš„ä¿¡æ¯ä¸­å¿ƒä¸æµç¨‹å¼•æ“é›†æˆæ–¹æ¡ˆï¼Œä»¥åŠç›‘æ§å‘Šè­¦ä¸­å¿ƒè®¾è®¡æ–¹æ¡ˆã€‚

ä»å·²ç»è¯»å–çš„æ–‡ä»¶æ¥çœ‹ï¼Œç°æœ‰ç³»ç»ŸåŒ…æ‹¬ï¼š
1. æµç¨‹å¼•æ“
2. å‘Šè­¦ç³»ç»Ÿ
3. ç›‘æ§æ‰§è¡Œ
4. ååŒç»Ÿè®¡
5. AIè¾“å…¥è¾“å‡º

è®©æˆ‘æ›´æ–°todoçŠ¶æ€ï¼Œç„¶åè®¾è®¡å®Œæ•´çš„æ–¹æ¡ˆã€‚
å¥½çš„ï¼Œç”¨æˆ·åªæ¢è®¨ä¸ä¿®æ”¹ã€‚è®©æˆ‘åŸºäºç°æœ‰ç³»ç»Ÿæ¶æ„ï¼Œè®¾è®¡å®Œæ•´çš„ä¿¡æ¯ä¸­å¿ƒä¸æµç¨‹å¼•æ“é›†æˆæ–¹æ¡ˆï¼Œä»¥åŠç›‘æ§å‘Šè­¦ä¸­å¿ƒæ¶æ„ã€‚

ä»å·²è¯»å–çš„æ–‡ä»¶ï¼Œæˆ‘äº†è§£åˆ°ï¼š
1. æµç¨‹å¼•æ“æœ‰å®ä¾‹ç®¡ç†
2. å‘Šè­¦ç³»ç»Ÿæœ‰è§„åˆ™ç®¡ç†
3. ç›‘æ§ç³»ç»Ÿæœ‰æ‰§è¡Œè®°å½•
4. ååŒç³»ç»Ÿæœ‰ç»Ÿè®¡
5. AIè¾“å…¥è¾“å‡ºæœ‰å®æ—¶ç›‘æ§

ç°åœ¨æˆ‘éœ€è¦è®¾è®¡ï¼š
1. ä¿¡æ¯ä¸­å¿ƒçš„æ¶ˆæ¯å†™å…¥ä¸æµç¨‹å¼•æ“çš„å…³è”
2. ç›‘æ§å‘Šè­¦ä¸­å¿ƒçš„å®Œæ•´æ¶æ„
3. ç³»ç»Ÿè”åŠ¨æ€§è®¾è®¡
å¥½çš„ï¼è®©æˆ‘åŸºäºç°æœ‰ç³»ç»Ÿæ¶æ„ï¼Œä¸ºä½ è®¾è®¡å®Œæ•´çš„ä¿¡æ¯ä¸­å¿ƒä¸æµç¨‹å¼•æ“é›†æˆæ–¹æ¡ˆï¼Œä»¥åŠç›‘æ§å‘Šè­¦ä¸­å¿ƒæ¶æ„ã€‚

---

# ğŸ”— WorkTool AI 2.1 - ä¿¡æ¯ä¸­å¿ƒç³»ç»Ÿè”åŠ¨å®Œæ•´æ–¹æ¡ˆ

## ğŸ“Š ç°æœ‰ç³»ç»Ÿæ¶æ„åˆ†æ

### **æ ¸å¿ƒæ¨¡å—è¯†åˆ«**

åŸºäºç°æœ‰ä»£ç ï¼Œç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

```
WorkTool AI 2.1
â”œâ”€â”€ ğŸ¤– AIæœåŠ¡å±‚ (AIService)
â”‚   â”œâ”€â”€ DoubaoProvider (è±†åŒ…å¤§æ¨¡å‹)
â”‚   â””â”€â”€ AIContext (ä¸Šä¸‹æ–‡ç®¡ç†)
â”‚
â”œâ”€â”€ âš™ï¸ æµç¨‹å¼•æ“
â”‚   â”œâ”€â”€ flow_definitions (æµç¨‹å®šä¹‰)
â”‚   â”œâ”€â”€ flow_instances (æµç¨‹å®ä¾‹)
â”‚   â””â”€â”€ executions (æ‰§è¡Œè®°å½•)
â”‚
â”œâ”€â”€ ğŸ’¬ æ¶ˆæ¯å¤„ç†å±‚
â”‚   â”œâ”€â”€ ai-io (AIè¾“å…¥è¾“å‡º)
â”‚   â”œâ”€â”€ robot-callback (æœºå™¨äººå›è°ƒ)
â”‚   â””â”€â”€ message-history (æ¶ˆæ¯å†å²)
â”‚
â”œâ”€â”€ ğŸ¤ ååŒå†³ç­–å¼•æ“
â”‚   â”œâ”€â”€ collab-stats (ååŒç»Ÿè®¡)
â”‚   â”œâ”€â”€ staff-activity (å·¥ä½œäººå‘˜æ´»åŠ¨)
â”‚   â””â”€â”€ decision-logs (å†³ç­–æ—¥å¿—)
â”‚
â”œâ”€â”€ ğŸš¨ å‘Šè­¦ç³»ç»Ÿ
â”‚   â”œâ”€â”€ alert-rules (å‘Šè­¦è§„åˆ™)
â”‚   â”œâ”€â”€ alert-history (å‘Šè­¦å†å²)
â”‚   â””â”€â”€ notifications (é€šçŸ¥)
â”‚
â””â”€â”€ ğŸ“Š ç›‘æ§ç³»ç»Ÿ
    â”œâ”€â”€ monitoring-executions (ç›‘æ§æ‰§è¡Œ)
    â”œâ”€â”€ ai-logs (AIæ—¥å¿—)
    â””â”€â”€ health (å¥åº·æ£€æŸ¥)
```

---

## ğŸ”— ä¸€ã€ä¿¡æ¯ä¸­å¿ƒä¸æµç¨‹å¼•æ“é›†æˆæ–¹æ¡ˆ

### **1.1 æ¶ˆæ¯æµå‘ä¸æµç¨‹å¼•æ“çš„å…³ç³»**

#### **å®Œæ•´æ¶ˆæ¯å¤„ç†æµç¨‹å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ¶ˆæ¯è¿›å…¥                               â”‚
â”‚                        (ç¾¤èŠ/ç§èŠ)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å›è°ƒæ¥å£ (robot-callback)                       â”‚
â”‚  â€¢ æ¥æ”¶æ¶ˆæ¯ (userId, content, groupId, timestamp)                â”‚
â”‚  â€¢ è¯†åˆ«æ¶ˆæ¯å‘é€è€… (ç”¨æˆ·/å·¥ä½œäººå‘˜)                                 â”‚
â”‚  â€¢ è§¦å‘æµç¨‹å¼•æ“å®ä¾‹                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æµç¨‹å¼•æ“å¤„ç† (flow-engine)                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 1: æ¶ˆæ¯é¢„å¤„ç†èŠ‚ç‚¹                                    â”‚    â”‚
â”‚  â”‚    â€¢ æå–ç”¨æˆ·ç‰¹å¾ (userId, ä¼ä¸šå, å¤‡æ³¨, æ˜µç§°)            â”‚    â”‚
â”‚  â”‚    â€¢ æå–æ¶ˆæ¯ç‰¹å¾ (æ„å›¾, æƒ…æ„Ÿ, å…³é”®è¯)                     â”‚    â”‚
â”‚  â”‚    â€¢ è¯†åˆ«å‘é€è€…ç±»å‹ (ç”¨æˆ·/å·¥ä½œäººå‘˜/æœºå™¨äºº)                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 2: å·¥ä½œäººå‘˜è¯†åˆ«èŠ‚ç‚¹ (Worker Identification)         â”‚    â”‚
â”‚  â”‚    â€¢ åˆ¤æ–­æ˜¯å¦å·¥ä½œäººå‘˜                                       â”‚    â”‚
â”‚  â”‚    â€¢ å¦‚æœæ˜¯å·¥ä½œäººå‘˜ â†’ è·³è½¬åˆ°äººå·¥å¤„ç†æµç¨‹                   â”‚    â”‚
â”‚  â”‚    â€¢ å¦‚æœæ˜¯ç”¨æˆ· â†’ ç»§ç»­AIå¤„ç†æµç¨‹                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 3: ååŒå†³ç­–èŠ‚ç‚¹ (Collaboration Decision)           â”‚    â”‚
â”‚  â”‚    â€¢ åˆ¤æ–­ä¼šè¯çŠ¶æ€ (auto/human)                            â”‚    â”‚
â”‚  â”‚    â€¢ å†³ç­–æ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥                                  â”‚    â”‚
â”‚  â”‚    â€¢ ç”Ÿæˆå†³ç­–å»ºè®®                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 4: æ¶ˆæ¯å¤„ç†èŠ‚ç‚¹ (Message Processing)               â”‚    â”‚
â”‚  â”‚    â€¢ AIæ„å›¾è¯†åˆ«                                           â”‚    â”‚
â”‚  â”‚    â€¢ æƒ…æ„Ÿåˆ†æ                                             â”‚    â”‚
â”‚  â”‚    â€¢ çŸ¥è¯†åº“æ£€ç´¢                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 5: å›å¤ç”ŸæˆèŠ‚ç‚¹ (Response Generation)              â”‚    â”‚
â”‚  â”‚    â€¢ ç”ŸæˆAIå›å¤                                           â”‚    â”‚
â”‚  â”‚    â€¢ æˆ–ç­‰å¾…äººå·¥å›å¤                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 6: æ•°æ®å†™å…¥èŠ‚ç‚¹ (Data Persistence)                 â”‚    â”‚
â”‚  â”‚    â€¢ å†™å…¥ session_messages (ç”¨æˆ·æ¶ˆæ¯)                    â”‚    â”‚
â”‚  â”‚    â€¢ å†™å…¥ staff_messages (å·¥ä½œäººå‘˜æ¶ˆæ¯)                  â”‚    â”‚
â”‚  â”‚    â€¢ æ›´æ–° session_status_changes (çŠ¶æ€å˜æ›´)              â”‚    â”‚
â”‚  â”‚    â€¢ è®°å½• flow_instances (æµç¨‹å®ä¾‹)                       â”‚    â”‚
â”‚  â”‚    â€¢ è§¦å‘æ»¡æ„åº¦æ¨æ–­ (å¼‚æ­¥)                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä¿¡æ¯ä¸­å¿ƒæ•°æ®å±‚                                â”‚
â”‚  â€¢ ä¼šè¯ç®¡ç†    â† session_messages + session_status_changes     â”‚
â”‚  â€¢ æ¶ˆæ¯ç®¡ç†    â† session_messages + staff_messages              â”‚
â”‚  â€¢ ååŒç®¡ç†    â† decision_logs + staff_activity                 â”‚
â”‚  â€¢ åˆ†ææŠ¥è¡¨    â† èšåˆç»Ÿè®¡æ•°æ®                                    â”‚
â”‚  â€¢ ç›‘æ§å‘Šè­¦    â† å®æ—¶æ•°æ® + è§„åˆ™å¼•æ“                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **1.2 æµç¨‹å®šä¹‰è®¾è®¡**

#### **æ¶ˆæ¯å¤„ç†æµç¨‹å®šä¹‰**

```typescript
{
  "id": "flow_message_processing",
  "name": "æ¶ˆæ¯å¤„ç†ä¸»æµç¨‹",
  "version": "2.1",
  "description": "å¤„ç†ç”¨æˆ·æ¶ˆæ¯ï¼ŒåŒ…æ‹¬å·¥ä½œäººå‘˜è¯†åˆ«ã€ååŒå†³ç­–ã€AIå“åº”",
  
  "nodes": [
    {
      "id": "node_message_received",
      "type": "trigger",
      "name": "æ¶ˆæ¯æ¥æ”¶",
      "config": {
        "eventType": "message_received",
        "extractFields": ["userId", "content", "groupId", "timestamp", "msgId"]
      }
    },
    
    {
      "id": "node_preprocess",
      "type": "processor",
      "name": "æ¶ˆæ¯é¢„å¤„ç†",
      "config": {
        "tasks": [
          {
            "action": "extract_user_features",
            "params": {
              "fields": ["userId", "enterpriseName", "remark", "nickname"]
            }
          },
          {
            "action": "extract_message_features",
            "params": {
              "tasks": ["intent_recognition", "sentiment_analysis", "keyword_extraction"]
            }
          },
          {
            "action": "identify_sender_type",
            "params": {
              "checkStaffList": true,
              "checkKeywords": ["@all", "@æ‰€æœ‰äºº"],
              "checkBot": true
            }
          }
        ]
      }
    },
    
    {
      "id": "node_staff_check",
      "type": "condition",
      "name": "å·¥ä½œäººå‘˜åˆ¤æ–­",
      "config": {
        "condition": "is_staff === true",
        "truePath": "node_staff_message_processing",
        "falsePath": "node_collaboration_decision"
      }
    },
    
    {
      "id": "node_staff_message_processing",
      "type": "processor",
      "name": "å·¥ä½œäººå‘˜æ¶ˆæ¯å¤„ç†",
      "config": {
        "tasks": [
          {
            "action": "update_session_status",
            "params": {
              "newStatus": "human",
              "triggeredBy": "staff_message"
            }
          },
          {
            "action": "save_staff_message",
            "params": {
              "table": "staff_messages",
              "fields": ["staffId", "content", "sessionId", "timestamp"]
            }
          },
          {
            "action": "trigger_satisfaction_inference",
            "params": {
              "async": true,
              "delay": 5000 // 5ç§’åè§¦å‘
            }
          },
          {
            "action": "send_notification",
            "params": {
              "channel": "monitoring_dashboard",
              "event": "staff_message_received",
              "data": {
                "staffId": "${staffId}",
                "sessionId": "${sessionId}",
                "content": "${content}"
              }
            }
          }
        ]
      }
    },
    
    {
      "id": "node_collaboration_decision",
      "type": "processor",
      "name": "ååŒå†³ç­–",
      "config": {
        "tasks": [
          {
            "action": "get_session_status",
            "params": {
              "sessionId": "${sessionId}"
            }
          },
          {
            "action": "check_manual_override",
            "params": {
              "checkStaffCommands": true
            }
          },
          {
            "action": "evaluate_intervention_needed",
            "params": {
              "rules": [
                "complex_question",
                "negative_emotion",
                "escalation_request"
              ]
            }
          },
          {
            "action": "make_decision",
            "params": {
              "output": "decision_result",
              "fields": ["need_intervention", "reason", "confidence"]
            }
          },
          {
            "action": "log_decision",
            "params": {
              "table": "decision_logs",
              "fields": ["sessionId", "decision", "reason", "confidence", "timestamp"]
            }
          }
        ]
      }
    },
    
    {
      "id": "node_ai_processing",
      "type": "processor",
      "name": "AIå¤„ç†",
      "config": {
        "tasks": [
          {
            "action": "intent_recognition",
            "params": {
              "model": "doubao",
              "threshold": 0.7
            }
          },
          {
            "action": "knowledge_retrieval",
            "params": {
              "vectorDb": "doubao_embedding",
              "topK": 5
            }
          },
          {
            "action": "generate_response",
            "params": {
              "model": "doubao",
              "promptTemplate": "customer_service",
              "contextLength": 10
            }
          }
        ]
      }
    },
    
    {
      "id": "node_save_message",
      "type": "processor",
      "name": "ä¿å­˜æ¶ˆæ¯",
      "config": {
        "tasks": [
          {
            "action": "save_user_message",
            "params": {
              "table": "session_messages",
              "fields": ["userId", "content", "sessionId", "intent", "confidence", "timestamp"]
            }
          },
          {
            "action": "save_ai_response",
            "params": {
              "table": "session_messages",
              "fields": ["botId", "content", "sessionId", "timestamp", "intent"]
            }
          }
        ]
      }
    },
    
    {
      "id": "node_satisfaction_inference",
      "type": "processor",
      "name": "æ»¡æ„åº¦æ¨æ–­",
      "config": {
        "async": true,
        "delay": 10000, // 10ç§’åå¼‚æ­¥æ‰§è¡Œ
        "tasks": [
          {
            "action": "keyword_inference",
            "params": {
              "positiveKeywords": ["è°¢è°¢", "è§£å†³äº†", "æ»¡æ„", "å¥½"],
              "negativeKeywords": ["å·®", "ä¸è¡Œ", "æ²¡ç”¨", "æŠ•è¯‰"]
            }
          },
          {
            "action": "duration_inference",
            "params": {
              "thresholds": {
                "short": 3, // 3åˆ†é’Ÿå†…
                "normal": 10,
                "long": 20
              }
            }
          },
          {
            "action": "turn_inference",
            "params": {
              "thresholds": {
                "quick": 3,
                "normal": 6,
                "long": 10
              }
            }
          },
          {
            "action": "sentiment_inference",
            "params": {
              "model": "doubao"
            }
          },
          {
            "action": "calculate_overall_score",
            "params": {
              "weights": {
                "keyword": 0.4,
                "duration": 0.25,
                "turn": 0.2,
                "sentiment": 0.15
              }
            }
          },
          {
            "action": "save_satisfaction",
            "params": {
              "table": "session_satisfaction",
              "fields": ["sessionId", "overallScore", "overallConfidence", "scores", "calculatedAt"]
            }
          },
          {
            "action": "check_alert_triggers",
            "params": {
              "rules": [
                "low_satisfaction_alert",
                "continuous_low_satisfaction_alert"
              ]
            }
          }
        ]
      }
    },
    
    {
      "id": "node_send_to_monitoring",
      "type": "processor",
      "name": "å‘é€åˆ°ç›‘æ§ä¸­å¿ƒ",
      "config": {
        "tasks": [
          {
            "action": "push_to_websocket",
            "params": {
              "channel": "monitoring_realtime",
              "event": "message_processed",
              "data": {
                "sessionId": "${sessionId}",
                "type": "${messageType}",
                "content": "${content}",
                "satisfaction": "${satisfactionScore}"
              }
            }
          },
          {
            "action": "update_redis_cache",
            "params": {
              "key": "session:${sessionId}:latest",
              "ttl": 3600,
              "data": {
                "lastMessage": "${content}",
                "lastMessageTime": "${timestamp}",
                "satisfaction": "${satisfactionScore}"
              }
            }
          }
        ]
      }
    }
  ],
  
  "edges": [
    { "from": "node_message_received", "to": "node_preprocess" },
    { "from": "node_preprocess", "to": "node_staff_check" },
    { "from": "node_staff_check", "to": "node_staff_message_processing", "condition": "true" },
    { "from": "node_staff_check", "to": "node_collaboration_decision", "condition": "false" },
    { "from": "node_collaboration_decision", "to": "node_ai_processing" },
    { "from": "node_ai_processing", "to": "node_save_message" },
    { "from": "node_save_message", "to": "node_satisfaction_inference" },
    { "from": "node_satisfaction_inference", "to": "node_send_to_monitoring" }
  ]
}
```

---

### **1.3 æµç¨‹å®ä¾‹ä¸ä¼šè¯çš„å…³è”**

#### **æ•°æ®å…³è”è®¾è®¡**

```typescript
// flow_instances è¡¨æ‰©å±•å­—æ®µ
interface FlowInstance {
  id: string;
  flowDefinitionId: string;
  flowName: string;
  
  // å…³è”ä¼šè¯
  sessionId: string;        // å…³è” session_messages.session_id
  userId: string;           // å…³è” session_messages.user_id
  groupId?: string;         // ç¾¤èŠID
  botId: string;            // æœºå™¨äººID
  
  // æµç¨‹çŠ¶æ€
  currentNodeId: string;
  status: 'running' | 'completed' | 'failed' | 'paused';
  
  // è§¦å‘æ•°æ®
  triggerData: {
    messageType: 'user' | 'staff' | 'bot';
    content: string;
    timestamp: string;
    msgId: string;
  };
  
  // æ‰§è¡Œç»“æœ
  result?: {
    response: string;        // AIå›å¤å†…å®¹
    decision: any;           // ååŒå†³ç­–ç»“æœ
    satisfaction?: number;   // æ»¡æ„åº¦åˆ†æ•°
  };
  
  // æ—¶é—´è®°å½•
  startedAt: string;
  completedAt?: string;
  error?: string;
  
  // å…ƒæ•°æ®
  metadata: {
    userFeatures: any;
    messageFeatures: any;
    staffIdentified: boolean;
    interventionNeeded: boolean;
  };
}

// session_messages è¡¨å…³è”æµç¨‹å®ä¾‹
interface SessionMessage {
  id: string;
  sessionId: string;
  userId?: string;
  botId?: string;
  staffId?: string;
  content: string;
  messageType: 'user' | 'bot' | 'staff';
  timestamp: string;
  
  // å…³è”æµç¨‹å®ä¾‹
  flowInstanceId?: string;   // å…³è” flow_instances.id
  
  // æ„å›¾å’Œæƒ…æ„Ÿ
  intent?: string;
  confidence?: number;
  sentiment?: string;
  
  // æ»¡æ„åº¦æ¨æ–­
  satisfactionInferred?: boolean;
  satisfactionScore?: number;
}

// decision_logs è¡¨
interface DecisionLog {
  id: string;
  sessionId: string;
  flowInstanceId: string;
  
  // å†³ç­–å†…å®¹
  decision: 'auto_continue' | 'need_intervention' | 'staff_override';
  reason: string;
  confidence: number;
  
  // å†³ç­–ä¾æ®
  factors: {
    isStaffMessage: boolean;
    negativeEmotion: boolean;
    complexQuestion: boolean;
    escalationRequest: boolean;
  };
  
  timestamp: string;
}
```

---

### **1.4 ä¿¡æ¯ä¸­å¿ƒè¯»å–æµç¨‹æ•°æ®**

#### **å®æ—¶ç›‘æ§è¯»å–æµç¨‹å®ä¾‹**

```typescript
// GET /api/monitoring/realtime/flow-stats
interface FlowStatsResponse {
  // æµç¨‹å®ä¾‹ç»Ÿè®¡
  totalInstances: number;
  runningInstances: number;
  completedInstances: number;
  failedInstances: number;
  
  // æµç¨‹æ€§èƒ½
  avgExecutionTime: number;  // å¹³å‡æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  successRate: number;       // æˆåŠŸç‡
  
  // æŒ‰æµç¨‹å®šä¹‰ç»Ÿè®¡
  byFlowDefinition: {
    [flowName: string]: {
      total: number;
      running: number;
      completed: number;
      failed: number;
      avgTime: number;
    }
  };
  
  // æŒ‰ä¼šè¯ç»Ÿè®¡
  bySession: {
    sessionId: string;
    instanceCount: number;
    avgExecutionTime: number;
    lastExecutedAt: string;
  }[];
}

// GET /api/monitoring/realtime/recent-executions
interface RecentExecutionsResponse {
  executions: {
    id: string;
    sessionId: string;
    userId: string;
    flowName: string;
    status: string;
    startedAt: string;
    completedAt?: string;
    executionTime?: number;
    triggerData: {
      messageType: string;
      content: string;
    };
    result?: any;
    error?: string;
  }[];
}
```

#### **ä¼šè¯åˆ†æè¯»å–æµç¨‹æ•°æ®**

```typescript
// GET /api/sessions/:sessionId/flow-instances
interface SessionFlowInstancesResponse {
  sessionId: string;
  instances: {
    id: string;
    flowName: string;
    status: string;
    startedAt: string;
    completedAt?: string;
    executionTime?: number;
    currentNode: string;
    triggerData: any;
    result?: any;
    error?: string;
    decisionLog?: DecisionLog;
  }[];
  
  // æµç¨‹ç»Ÿè®¡
  statistics: {
    totalInstances: number;
    completedInstances: number;
    avgExecutionTime: number;
    successRate: number;
    interventionRate: number;  // äººå·¥ä»‹å…¥ç‡
  };
}
```

---

## ğŸš¨ äºŒã€ç›‘æ§å‘Šè­¦ä¸­å¿ƒæ¶æ„è®¾è®¡

### **2.1 ç›‘æ§å‘Šè­¦ä¸­å¿ƒæ•´ä½“æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç›‘æ§å‘Šè­¦ä¸­å¿ƒï¼ˆå‰ç«¯ï¼‰                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å®æ—¶ç›‘æ§  â”‚  â”‚ å‘Šè­¦ç®¡ç†  â”‚  â”‚ äº‹ä»¶åˆ†æ  â”‚  â”‚ é€šçŸ¥ç®¡ç†  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ è§„åˆ™é…ç½®  â”‚  â”‚ å‘Šè­¦å†å²  â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‘Šè­¦å¼•æ“ï¼ˆåç«¯ï¼‰                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è§„åˆ™å¼•æ“  â”‚  â”‚ äº‹ä»¶é‡‡é›†  â”‚  â”‚ è¯„ä¼°å™¨   â”‚  â”‚ å‘Šè­¦è§¦å‘  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ èšåˆå™¨   â”‚  â”‚ å‹ç¼©å™¨   â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®æºå±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æµç¨‹å¼•æ“  â”‚  â”‚ æ»¡æ„åº¦   â”‚  â”‚ ååŒå†³ç­–  â”‚  â”‚ æ¶ˆæ¯æµ   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ç³»ç»ŸæŒ‡æ ‡  â”‚  â”‚ å·¥ä½œäººå‘˜  â”‚  â”‚ ä¼šè¯çŠ¶æ€  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **2.2 ç›‘æ§å‘Šè­¦ä¸­å¿ƒé¡µé¢ç»“æ„**

#### **ä¸»å¯¼èˆªè®¾è®¡**

```
ç›‘æ§å‘Šè­¦ä¸­å¿ƒ
â”œâ”€â”€ ğŸ“Š å®æ—¶ç›‘æ§ï¼ˆé»˜è®¤é¦–é¡µï¼‰
â”‚   â”œâ”€â”€ ç³»ç»Ÿæ¦‚è§ˆ
â”‚   â”œâ”€â”€ æµç¨‹ç›‘æ§
â”‚   â”œâ”€â”€ å‘Šè­¦æ¦‚è§ˆ
â”‚   â””â”€â”€ äº‹ä»¶æµ
â”‚
â”œâ”€â”€ ğŸš¨ å‘Šè­¦ç®¡ç†
â”‚   â”œâ”€â”€ å‘Šè­¦è§„åˆ™
â”‚   â”œâ”€â”€ å‘Šè­¦åˆ—è¡¨
â”‚   â”œâ”€â”€ å‘Šè­¦å¤„ç†
â”‚   â””â”€â”€ å‘Šè­¦ç»Ÿè®¡
â”‚
â”œâ”€â”€ ğŸ“‹ äº‹ä»¶åˆ†æ
â”‚   â”œâ”€â”€ äº‹ä»¶åˆ—è¡¨
â”‚   â”œâ”€â”€ äº‹ä»¶è¯¦æƒ…
â”‚   â”œâ”€â”€ äº‹ä»¶ç»Ÿè®¡
â”‚   â””â”€â”€ äº‹ä»¶è¶‹åŠ¿
â”‚
â”œâ”€â”€ ğŸ”” é€šçŸ¥ç®¡ç†
â”‚   â”œâ”€â”€ é€šçŸ¥æ¸ é“
â”‚   â”œâ”€â”€ é€šçŸ¥å†å²
â”‚   â”œâ”€â”€ é€šçŸ¥æ¨¡æ¿
â”‚   â””â”€â”€ é€šçŸ¥ç»Ÿè®¡
â”‚
â”œâ”€â”€ âš™ï¸ è§„åˆ™é…ç½®
â”‚   â”œâ”€â”€ å‘Šè­¦è§„åˆ™
â”‚   â”œâ”€â”€ èšåˆè§„åˆ™
â”‚   â”œâ”€â”€ å‹ç¼©è§„åˆ™
â”‚   â””â”€â”€ é€šçŸ¥è§„åˆ™
â”‚
â””â”€â”€ ğŸ“œ å‘Šè­¦å†å²
    â”œâ”€â”€ å‘Šè­¦è®°å½•
    â”œâ”€â”€ å¤„ç†å†å²
    â”œâ”€â”€ å¤„ç†ç»Ÿè®¡
    â””â”€â”€ è¶‹åŠ¿åˆ†æ
```

---

### **2.3 å®æ—¶ç›‘æ§æ¨¡å—è®¾è®¡**

#### **é¡µé¢å¸ƒå±€**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®æ—¶ç›‘æ§                                        åˆ·æ–°: 10ç§’  ğŸ”„ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ç³»ç»Ÿæ¦‚è§ˆ                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ æµç¨‹å®ä¾‹æ•°    â”‚  â”‚ æ´»è·ƒä¼šè¯æ•°    â”‚  â”‚ å‘Šè­¦è§¦å‘æ•°    â”‚       â”‚
â”‚  â”‚   1,256      â”‚  â”‚     85       â”‚  â”‚     12       â”‚       â”‚
â”‚  â”‚  â†’ è¿è¡Œä¸­  45â”‚  â”‚  â†’ è‡ªåŠ¨ 70   â”‚  â”‚  â†’ æœªå¤„ç† 5   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ å¹³å‡æ‰§è¡Œæ—¶é—´  â”‚  â”‚ æˆåŠŸç‡        â”‚  â”‚ æ»¡æ„åº¦å‡å€¼    â”‚       â”‚
â”‚  â”‚   1.2ç§’      â”‚  â”‚   99.2%      â”‚  â”‚   4.2åˆ†      â”‚       â”‚
â”‚  â”‚  â†“ 0.1ç§’     â”‚  â”‚  â†’ ç¨³å®š      â”‚  â”‚  â†‘ 0.2åˆ†     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æµç¨‹ç›‘æ§                                            æŸ¥çœ‹å…¨éƒ¨  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æµç¨‹åç§°              è¿è¡Œä¸­  å®Œæˆ  å¤±è´¥  å¹³å‡è€—æ—¶     â”‚ â”‚
â”‚  â”‚  æ¶ˆæ¯å¤„ç†æµç¨‹              15    1240    5   1.1ç§’    â”‚ â”‚
â”‚  â”‚  æ»¡æ„åº¦æ¨æ–­æµç¨‹            8     980    2   0.8ç§’    â”‚ â”‚
â”‚  â”‚  ååŒå†³ç­–æµç¨‹              5     756    0   0.5ç§’    â”‚ â”‚
â”‚  â”‚  é€šçŸ¥å‘é€æµç¨‹              3     620    1   0.3ç§’    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‘Šè­¦æ¦‚è§ˆ                                    æœªå¤„ç†å‘Šè­¦: 5     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ”´ ä½æ»¡æ„åº¦å‘Šè­¦ (æœªå¤„ç†)                                 â”‚ â”‚
â”‚  â”‚     ä¼šè¯: sess_001  æ»¡æ„åº¦: 2.0åˆ†  æ—¶é—´: 2åˆ†é’Ÿå‰        â”‚ â”‚
â”‚  â”‚     [ç«‹å³å¤„ç†]  [å¿½ç•¥]                                     â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  ğŸŸ¡ è¿ç»­ä½æ»¡æ„åº¦å‘Šè­¦ (æœªå¤„ç†)                             â”‚ â”‚
â”‚  â”‚     å·¥ä½œäººå‘˜: å¼ ä¸‰  è¿ç»­3æ¬¡ä½åˆ†  æ—¶é—´: 5åˆ†é’Ÿå‰          â”‚ â”‚
â”‚  â”‚     [ç«‹å³å¤„ç†]  [å¿½ç•¥]                                     â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  ğŸŸ  æµç¨‹å¤±è´¥å‘Šè­¦ (æœªå¤„ç†)                                â”‚ â”‚
â”‚  â”‚     æµç¨‹: æ»¡æ„åº¦æ¨æ–­  é”™è¯¯: è¶…æ—¶  æ—¶é—´: 1åˆ†é’Ÿå‰         â”‚ â”‚
â”‚  â”‚     [ç«‹å³å¤„ç†]  [æŸ¥çœ‹æ—¥å¿—]                                 â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  [æŸ¥çœ‹å…¨éƒ¨å‘Šè­¦]                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº‹ä»¶æµ (æœ€æ–°20æ¡)                           æ›´å¤š â†’          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  18:32  ğŸŸ¢ INFO    æµç¨‹å®ä¾‹å®Œæˆ - flow_msg_001            â”‚ â”‚
â”‚  â”‚  18:31  ğŸŸ¢ INFO    æ¶ˆæ¯å¤„ç†æˆåŠŸ - sess_001               â”‚ â”‚
â”‚  â”‚  18:30  ğŸ”´ ERROR   æ»¡æ„åº¦æ¨æ–­å¤±è´¥ - sess_002 (è¶…æ—¶)     â”‚ â”‚
â”‚  â”‚  18:29  ğŸŸ¡ WARN    ä½æ»¡æ„åº¦å‘Šè­¦è§¦å‘ - sess_003 (2.0åˆ†)   â”‚ â”‚
â”‚  â”‚  18:28  ğŸŸ¢ INFO    å·¥ä½œäººå‘˜æ¶ˆæ¯æ¥æ”¶ - å¼ ä¸‰               â”‚ â”‚
â”‚  â”‚  18:27  ğŸŸ¢ INFO    ååŒå†³ç­–ç”Ÿæˆ - éœ€è¦äººå·¥ä»‹å…¥           â”‚ â”‚
â”‚  â”‚  18:26  ğŸŸ¢ INFO    AIå“åº”ç”ŸæˆæˆåŠŸ - è±†åŒ…                 â”‚ â”‚
â”‚  â”‚  18:25  ğŸ”´ ERROR   æµç¨‹å®ä¾‹å¤±è´¥ - flow_satisfaction_001  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **2.4 å‘Šè­¦è§„åˆ™è®¾è®¡**

#### **é¢„ç½®å‘Šè­¦è§„åˆ™**

```typescript
// alert_rules è¡¨å®šä¹‰
interface AlertRule {
  id: string;
  name: string;
  description: string;
  enabled: boolean;
  severity: 'critical' | 'warning' | 'info';
  category: 'satisfaction' | 'performance' | 'availability' | 'collaboration';
  
  // è§¦å‘æ¡ä»¶
  condition: {
    metric: string;           // ç›‘æ§æŒ‡æ ‡
    operator: '>' | '<' | '=' | '>=' | '<=' | '!=' | 'between';
    threshold: number | [number, number];
    timeWindow: number;       // æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
    aggregation: 'avg' | 'sum' | 'count' | 'min' | 'max' | 'last';
  };
  
  // å‘Šè­¦èšåˆ
  aggregation: {
    enabled: boolean;
    window: number;           // èšåˆçª—å£ï¼ˆç§’ï¼‰
    threshold: number;        // èšåˆé˜ˆå€¼
  };
  
  // å‘Šè­¦å‹ç¼©
  suppression: {
    enabled: boolean;
    window: number;           // å‹ç¼©çª—å£ï¼ˆç§’ï¼‰
    maxAlerts: number;        // æœ€å¤§å‘Šè­¦æ•°
  };
  
  // é€šçŸ¥é…ç½®
  notification: {
    channels: ('bot' | 'email' | 'wechat' | 'sms')[];
    recipients: string[];     // æ¥æ”¶äººIDåˆ—è¡¨
    template: string;         // é€šçŸ¥æ¨¡æ¿ID
  };
  
  // åˆ›å»ºå’Œæ›´æ–°ä¿¡æ¯
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}

// é¢„ç½®å‘Šè­¦è§„åˆ™åˆ—è¡¨
const PRESET_ALERT_RULES: AlertRule[] = [
  // æ»¡æ„åº¦ç›¸å…³
  {
    id: "rule_low_satisfaction",
    name: "ä½æ»¡æ„åº¦å‘Šè­¦",
    description: "å½“ä¼šè¯æ»¡æ„åº¦ä½äºé˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "critical",
    category: "satisfaction",
    condition: {
      metric: "session_satisfaction.overallScore",
      operator: "<=",
      threshold: 2.5,
      timeWindow: 60,
      aggregation: "last"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 300,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot"],
      recipients: ["@all"],
      template: "template_low_satisfaction"
    }
  },
  
  {
    id: "rule_continuous_low_satisfaction",
    name: "è¿ç»­ä½æ»¡æ„åº¦å‘Šè­¦",
    description: "å½“åŒä¸€å·¥ä½œäººå‘˜è¿ç»­å‡ºç°ä½æ»¡æ„åº¦æ—¶è§¦å‘",
    enabled: true,
    severity: "warning",
    category: "collaboration",
    condition: {
      metric: "staff_performance.low_satisfaction_count",
      operator: ">=",
      threshold: 3,
      timeWindow: 3600,
      aggregation: "count"
    },
    aggregation: {
      enabled: true,
      window: 3600,
      threshold: 3
    },
    suppression: {
      enabled: true,
      window: 1800,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot", "email"],
      recipients: ["@å¼ ä¸‰", "admin@company.com"],
      template: "template_continuous_low_satisfaction"
    }
  },
  
  {
    id: "rule_staff_satisfaction_decline",
    name: "å·¥ä½œäººå‘˜æ»¡æ„åº¦ä¸‹é™å‘Šè­¦",
    description: "å½“å·¥ä½œäººå‘˜å¹³å‡æ»¡æ„åº¦ä¸‹é™è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "warning",
    category: "collaboration",
    condition: {
      metric: "staff_performance.avg_satisfaction_change",
      operator: "<=",
      threshold: -0.5,
      timeWindow: 86400,
      aggregation: "avg"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 3600,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot"],
      recipients: ["@å¼ ä¸‰"],
      template: "template_staff_satisfaction_decline"
    }
  },
  
  {
    id: "rule_overall_satisfaction_decline",
    name: "æ•´ä½“æ»¡æ„åº¦ä¸‹é™å‘Šè­¦",
    description: "å½“æ•´ä½“æ»¡æ„åº¦ä¸‹é™è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "warning",
    category: "satisfaction",
    condition: {
      metric: "overall_satisfaction.avg_score_change",
      operator: "<=",
      threshold: -0.3,
      timeWindow: 3600,
      aggregation: "avg"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 1800,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot", "email"],
      recipients: ["@all", "admin@company.com"],
      template: "template_overall_satisfaction_decline"
    }
  },
  
  // æ€§èƒ½ç›¸å…³
  {
    id: "rule_flow_execution_timeout",
    name: "æµç¨‹æ‰§è¡Œè¶…æ—¶å‘Šè­¦",
    description: "å½“æµç¨‹æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "warning",
    category: "performance",
    condition: {
      metric: "flow_instance.execution_time",
      operator: ">",
      threshold: 5000,
      timeWindow: 60,
      aggregation: "max"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 300,
      maxAlerts: 3
    },
    notification: {
      channels: ["bot"],
      recipients: ["@æŠ€æœ¯ç»„"],
      template: "template_flow_timeout"
    }
  },
  
  {
    id: "rule_flow_failure_rate",
    name: "æµç¨‹å¤±è´¥ç‡å‘Šè­¦",
    description: "å½“æµç¨‹å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "critical",
    category: "availability",
    condition: {
      metric: "flow_instance.failure_rate",
      operator: ">=",
      threshold: 0.05,
      timeWindow: 300,
      aggregation: "avg"
    },
    aggregation: {
      enabled: true,
      window: 300,
      threshold: 0.05
    },
    suppression: {
      enabled: true,
      window: 600,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot", "email"],
      recipients: ["@æŠ€æœ¯ç»„", "admin@company.com"],
      template: "template_flow_failure_rate"
    }
  },
  
  // ååŒç›¸å…³
  {
    id: "rule_high_intervention_rate",
    name: "é«˜äººå·¥ä»‹å…¥ç‡å‘Šè­¦",
    description: "å½“äººå·¥ä»‹å…¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "warning",
    category: "collaboration",
    condition: {
      metric: "collaboration.intervention_rate",
      operator: ">=",
      threshold: 0.2,
      timeWindow: 3600,
      aggregation: "avg"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 1800,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot"],
      recipients: ["@è¿è¥ç»„"],
      template: "template_high_intervention_rate"
    }
  },
  
  {
    id: "rule_staff_overload",
    name: "å·¥ä½œäººå‘˜è¿‡è½½å‘Šè­¦",
    description: "å½“å·¥ä½œäººå‘˜åŒæ—¶å¤„ç†ä¼šè¯æ•°è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "warning",
    category: "collaboration",
    condition: {
      metric: "staff_performance.active_sessions",
      operator: ">=",
      threshold: 5,
      timeWindow: 60,
      aggregation: "max"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 600,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot"],
      recipients: ["@å¼ ä¸‰"],
      template: "template_staff_overload"
    }
  },
  
  // ç³»ç»Ÿç›¸å…³
  {
    id: "rule_high_message_volume",
    name: "é«˜æ¶ˆæ¯é‡å‘Šè­¦",
    description: "å½“æ¶ˆæ¯é‡è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘ï¼ˆå¯èƒ½ä¸ºæ”»å‡»ï¼‰",
    enabled: true,
    severity: "critical",
    category: "availability",
    condition: {
      metric: "message.count",
      operator: ">=",
      threshold: 100,
      timeWindow: 60,
      aggregation: "count"
    },
    aggregation: {
      enabled: true,
      window: 60,
      threshold: 100
    },
    suppression: {
      enabled: true,
      window: 300,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot", "email", "sms"],
      recipients: ["@æŠ€æœ¯ç»„", "admin@company.com"],
      template: "template_high_message_volume"
    }
  },
  
  {
    id: "rule_long_session",
    name: "é•¿ä¼šè¯å‘Šè­¦",
    description: "å½“ä¼šè¯æŒç»­æ—¶é—´è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘",
    enabled: true,
    severity: "info",
    category: "performance",
    condition: {
      metric: "session.duration",
      operator: ">=",
      threshold: 1800,
      timeWindow: 60,
      aggregation: "max"
    },
    aggregation: {
      enabled: false
    },
    suppression: {
      enabled: true,
      window: 600,
      maxAlerts: 1
    },
    notification: {
      channels: ["bot"],
      recipients: ["@å¼ ä¸‰"],
      template: "template_long_session"
    }
  }
];
```

---

### **2.5 å‘Šè­¦å¼•æ“å·¥ä½œæµç¨‹**

#### **å‘Šè­¦è§¦å‘æµç¨‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®é‡‡é›†ï¼ˆäº‹ä»¶æºï¼‰                          â”‚
â”‚  â€¢ æµç¨‹å¼•æ“å®Œæˆäº‹ä»¶ (flow_instance.completed)                â”‚
â”‚  â€¢ æµç¨‹å¼•æ“å¤±è´¥äº‹ä»¶ (flow_instance.failed)                   â”‚
â”‚  â€¢ æ»¡æ„åº¦è®¡ç®—å®Œæˆ (satisfaction_calculated)                  â”‚
â”‚  â€¢ å·¥ä½œäººå‘˜æ¶ˆæ¯æ¥æ”¶ (staff_message_received)                 â”‚
â”‚  â€¢ ååŒå†³ç­–ç”Ÿæˆ (decision_made)                             â”‚
â”‚  â€¢ æ¶ˆæ¯å¤„ç†å®Œæˆ (message_processed)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº‹ä»¶é‡‡é›†å™¨                                 â”‚
â”‚  â€¢ ä»æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶äº‹ä»¶                                        â”‚
â”‚  â€¢ è§£æäº‹ä»¶æ•°æ®                                              â”‚
â”‚  â€¢ æå–å…³é”®æŒ‡æ ‡                                              â”‚
â”‚  â€¢ å­˜å‚¨åˆ° events è¡¨                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¯„ä¼°å™¨                                     â”‚
â”‚  â€¢ åŠ è½½å¯ç”¨çš„å‘Šè­¦è§„åˆ™                                        â”‚
â”‚  â€¢ è¯„ä¼°æ¯ä¸ªè§„åˆ™æ˜¯å¦è§¦å‘                                      â”‚
â”‚  â€¢ è®¡ç®—è§„åˆ™æ¡ä»¶æ˜¯å¦æ»¡è¶³                                      â”‚
â”‚  â€¢ ç”Ÿæˆå‘Šè­¦äº‹ä»¶                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èšåˆå™¨                                     â”‚
â”‚  â€¢ å°†ç›¸ä¼¼å‘Šè­¦èšåˆåˆ°ä¸€èµ·                                      â”‚
â”‚  â€¢ æŒ‰æ—¶é—´çª—å£èšåˆ                                            â”‚
â”‚  â€¢ æŒ‰ç»´åº¦èšåˆï¼ˆå·¥ä½œäººå‘˜ã€ä¼šè¯ç­‰ï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‹ç¼©å™¨                                     â”‚
â”‚  â€¢ åœ¨å‹ç¼©çª—å£å†…æŠ‘åˆ¶é‡å¤å‘Šè­¦                                  â”‚
â”‚  â€¢ é™åˆ¶æœ€å¤§å‘Šè­¦æ•°é‡                                          â”‚
â”‚  â€¢ åˆå¹¶ç›¸ä¼¼å‘Šè­¦                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‘Šè­¦è§¦å‘å™¨                                 â”‚
â”‚  â€¢ ç”Ÿæˆå‘Šè­¦è®°å½•                                              â”‚
â”‚  â€¢ å†™å…¥ alert_history è¡¨                                     â”‚
â”‚  â€¢ æ›´æ–°å‘Šè­¦ç»Ÿè®¡                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€šçŸ¥å‘é€å™¨                                 â”‚
â”‚  â€¢ æ ¹æ®è§„åˆ™é…ç½®é€‰æ‹©é€šçŸ¥æ¸ é“                                  â”‚
â”‚  â€¢ ä½¿ç”¨é€šçŸ¥æ¨¡æ¿ç”Ÿæˆæ¶ˆæ¯                                      â”‚
â”‚  â€¢ å‘é€é€šçŸ¥ï¼ˆæœºå™¨äººæ¶ˆæ¯ã€é‚®ä»¶ã€ä¼ä¸šå¾®ä¿¡ç­‰ï¼‰                   â”‚
â”‚  â€¢ è®°å½•é€šçŸ¥å†å²                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®æ—¶æ¨é€                                   â”‚
â”‚  â€¢ WebSocket æ¨é€åˆ°ç›‘æ§ä¸­å¿ƒ                                  â”‚
â”‚  â€¢ æ›´æ–°å®æ—¶æŒ‡æ ‡                                              â”‚
â”‚  â€¢ è§¦å‘å‰ç«¯å‘Šè­¦æç¤º                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **2.6 å‘Šè­¦æ•°æ®æ¨¡å‹**

#### **æ ¸å¿ƒè¡¨ç»“æ„**

```typescript
// alert_history è¡¨
interface AlertHistory {
  id: string;
  ruleId: string;
  ruleName: string;
  
  // å‘Šè­¦ä¿¡æ¯
  severity: 'critical' | 'warning' | 'info';
  category: string;
  message: string;
  
  // è§¦å‘æ•°æ®
  metric: string;
  currentValue: number;
  threshold: number;
  condition: string;
  
  // å…³è”æ•°æ®
  sessionId?: string;
  staffId?: string;
  flowInstanceId?: string;
  userId?: string;
  
  // æ—¶é—´ä¿¡æ¯
  triggeredAt: string;
  resolvedAt?: string;
  
  // å¤„ç†ä¿¡æ¯
  status: 'pending' | 'acknowledged' | 'resolved' | 'suppressed';
  handledBy?: string;
  handledAt?: string;
  handleNote?: string;
  
  // é€šçŸ¥ä¿¡æ¯
  notificationSent: boolean;
  notificationChannels: string[];
  notificationRecipients: string[];
}

// alert_stats è¡¨
interface AlertStats {
  id: string;
  date: string; // YYYY-MM-DD
  
  // æŒ‰ä¸¥é‡çº§åˆ«ç»Ÿè®¡
  criticalCount: number;
  warningCount: number;
  infoCount: number;
  
  // æŒ‰ç±»åˆ«ç»Ÿè®¡
  satisfactionCount: number;
  performanceCount: number;
  availabilityCount: number;
  collaborationCount: number;
  
  // æŒ‰çŠ¶æ€ç»Ÿè®¡
  pendingCount: number;
  acknowledgedCount: number;
  resolvedCount: number;
  
  // å“åº”æ—¶é—´ç»Ÿè®¡
  avgResponseTime: number; // ç§’
  maxResponseTime: number;
  minResponseTime: number;
  
  // åˆ›å»ºæ—¶é—´
  createdAt: string;
  updatedAt: string;
}
```

---

## ğŸ”— ä¸‰ã€ç³»ç»Ÿè”åŠ¨æ€§è®¾è®¡

### **3.1 å®Œæ•´æ•°æ®æµå‘**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ¶ˆæ¯è¿›å…¥                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å›è°ƒæ¥å£æ¥æ”¶                                â”‚
â”‚  â€¢ è¯†åˆ«å‘é€è€…ï¼ˆç”¨æˆ·/å·¥ä½œäººå‘˜ï¼‰                                â”‚
â”‚  â€¢ æå–æ¶ˆæ¯ç‰¹å¾                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµç¨‹å¼•æ“å¯åŠ¨                                â”‚
â”‚  â€¢ åˆ›å»ºæµç¨‹å®ä¾‹ (flow_instances)                              â”‚
â”‚  â€¢ æ‰§è¡Œæ¶ˆæ¯å¤„ç†æµç¨‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                    â†“                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ¶ˆæ¯å¤„ç† â”‚        â”‚ ååŒå†³ç­–  â”‚        â”‚ æ»¡æ„åº¦   â”‚
    â”‚ èŠ‚ç‚¹     â”‚        â”‚ èŠ‚ç‚¹      â”‚        â”‚ æ¨æ–­èŠ‚ç‚¹  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â†“                   â†“                   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å†™å…¥æ¶ˆæ¯  â”‚        â”‚ è®°å½•å†³ç­–  â”‚        â”‚ è®¡ç®—åˆ†æ•°  â”‚
    â”‚ (session â”‚        â”‚ (decision â”‚        â”‚ (session  â”‚
    â”‚ _messagesâ”‚        â”‚ _logs)   â”‚        â”‚ _satisfac â”‚
    â”‚ )        â”‚        â”‚          â”‚        â”‚ tion)    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æµç¨‹å®ä¾‹å®Œæˆ    â”‚
                    â”‚  (flow_instances)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  è§¦å‘äº‹ä»¶        â”‚
                    â”‚  (æ¶ˆæ¯é˜Ÿåˆ—)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                 â†“                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ»¡æ„åº¦   â”‚     â”‚ å‘Šè­¦å¼•æ“  â”‚      â”‚ é€šçŸ¥æœåŠ¡  â”‚
    â”‚ æ¨æ–­     â”‚     â”‚ (è¯„ä¼°     â”‚      â”‚ (å‘é€é€šçŸ¥)â”‚
    â”‚ (å¼‚æ­¥)   â”‚     â”‚  è§„åˆ™)    â”‚      â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â†“                â†“                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ›´æ–°     â”‚     â”‚ ç”Ÿæˆå‘Šè­¦  â”‚      â”‚ å‘é€     â”‚
    â”‚ æ»¡æ„åº¦   â”‚     â”‚ (alert_   â”‚      â”‚ é€šçŸ¥     â”‚
    â”‚ åˆ†æ•°     â”‚     â”‚ history)  â”‚      â”‚ (notifi  â”‚
    â”‚          â”‚     â”‚          â”‚      â”‚ cation)  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å®æ—¶æ¨é€        â”‚
                    â”‚  (WebSocket)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ä¿¡æ¯ä¸­å¿ƒ        â”‚
                    â”‚  - å®æ—¶ç›‘æ§      â”‚
                    â”‚  - ä¼šè¯åˆ†æ      â”‚
                    â”‚  - ååŒåˆ†æ      â”‚
                    â”‚  - ç›‘æ§å‘Šè­¦      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **3.2 ä¿¡æ¯ä¸­å¿ƒä¸å„æ¨¡å—çš„è”åŠ¨**

#### **è”åŠ¨å…³ç³»è¡¨**

| ä¿¡æ¯ä¸­å¿ƒæ¨¡å— | ä¾èµ–çš„æ•°æ®æº | æä¾›çš„èƒ½åŠ› | è§¦å‘æ¡ä»¶ |
|------------|------------|----------|---------|
| **å®æ—¶ç›‘æ§** | flow_instances, session_messages, alert_history | å®æ—¶æŒ‡æ ‡ã€æ¶ˆæ¯æµã€å‘Šè­¦æ¦‚è§ˆ | æ¶ˆæ¯å¤„ç†å®Œæˆã€å‘Šè­¦è§¦å‘ |
| **ä¼šè¯åˆ†æ** | session_messages, session_satisfaction, flow_instances | ä¼šè¯åˆ—è¡¨ã€ä¼šè¯è¯¦æƒ…ã€æ»¡æ„åº¦åˆ†æ | ç”¨æˆ·æŸ¥è¯¢ã€å®šæ—¶èšåˆ |
| **ååŒåˆ†æ** | decision_logs, staff_messages, staff_performance | äººå·¥ä»‹å…¥åˆ†æã€å·¥ä½œäººå‘˜ç»©æ•ˆã€æ»¡æ„åº¦åˆ†æ | å·¥ä½œäººå‘˜å¤„ç†ã€å†³ç­–ç”Ÿæˆ |
| **å·¥ä½œäººå‘˜ç®¡ç†** | staff_activity, staff_performance, session_satisfaction | å·¥ä½œäººå‘˜åˆ—è¡¨ã€ç»©æ•ˆåˆ†æã€å·¥ä½œè´Ÿè½½ | å·¥ä½œäººå‘˜æ´»åŠ¨ã€æ»¡æ„åº¦æ›´æ–° |
| **æ•°æ®æŠ¥è¡¨** | æ‰€æœ‰èšåˆè¡¨ | æ—¥æŠ¥/å‘¨æŠ¥/æœˆæŠ¥ã€è‡ªå®šä¹‰æŠ¥è¡¨ | å®šæ—¶ä»»åŠ¡ã€ç”¨æˆ·è¯·æ±‚ |
| **ç›‘æ§å‘Šè­¦** | alert_history, alert_rules, events | å‘Šè­¦ç®¡ç†ã€è§„åˆ™é…ç½®ã€äº‹ä»¶åˆ†æ | å‘Šè­¦è§¦å‘ã€è§„åˆ™å˜æ›´ |
| **è®¾ç½®** | alert_rules, notification_methods | å‘Šè­¦è§„åˆ™ã€é€šçŸ¥é…ç½®ã€ç³»ç»Ÿè®¾ç½® | ç”¨æˆ·é…ç½®å˜æ›´ |

---

### **3.3 å…³é”®è”åŠ¨åœºæ™¯**

#### **åœºæ™¯1ï¼šç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ å®æ—¶ç›‘æ§æ›´æ–°**

```
1. ç”¨æˆ·å‘é€æ¶ˆæ¯
   â†“
2. å›è°ƒæ¥å£æ¥æ”¶æ¶ˆæ¯
   â†“
3. æµç¨‹å¼•æ“åˆ›å»ºå®ä¾‹å¹¶æ‰§è¡Œ
   â”œâ”€ æ¶ˆæ¯é¢„å¤„ç†
   â”œâ”€ å·¥ä½œäººå‘˜è¯†åˆ«
   â”œâ”€ ååŒå†³ç­–
   â”œâ”€ AIå¤„ç†
   â””â”€ æ¶ˆæ¯ä¿å­˜
   â†“
4. æµç¨‹å®ä¾‹å®Œæˆ
   â†“
5. å†™å…¥ session_messages
   â†“
6. è§¦å‘äº‹ä»¶åˆ°æ¶ˆæ¯é˜Ÿåˆ—
   â†“
7. å®æ—¶æ¨é€æœåŠ¡æ¥æ”¶äº‹ä»¶
   â†“
8. WebSocket æ¨é€åˆ°ä¿¡æ¯ä¸­å¿ƒ
   â”œâ”€ æ›´æ–°å®æ—¶æ¶ˆæ¯æµ
   â”œâ”€ æ›´æ–°ä¼šè¯çŠ¶æ€
   â””â”€ æ›´æ–°å·¥ä½œäººå‘˜åœ¨çº¿çŠ¶æ€
```

#### **åœºæ™¯2ï¼šæ»¡æ„åº¦æ¨æ–­ â†’ å‘Šè­¦è§¦å‘ â†’ é€šçŸ¥å‘é€**

```
1. æ¶ˆæ¯å¤„ç†å®Œæˆ
   â†“
2. å¼‚æ­¥è§¦å‘æ»¡æ„åº¦æ¨æ–­
   â”œâ”€ å…³é”®è¯æ¨æ–­
   â”œâ”€ æ—¶é•¿æ¨æ–­
   â”œâ”€ è½®æ¬¡æ¨æ–­
   â””â”€ æƒ…æ„Ÿæ¨æ–­
   â†“
3. è®¡ç®—ç»¼åˆæ»¡æ„åº¦åˆ†æ•°
   â†“
4. å†™å…¥ session_satisfaction
   â†“
5. è§¦å‘å‘Šè­¦è§„åˆ™è¯„ä¼°
   â”œâ”€ è¯„ä¼°ä½æ»¡æ„åº¦è§„åˆ™
   â”œâ”€ è¯„ä¼°è¿ç»­ä½æ»¡æ„åº¦è§„åˆ™
   â””â”€ è¯„ä¼°å·¥ä½œäººå‘˜æ»¡æ„åº¦ä¸‹é™è§„åˆ™
   â†“
6. å‘Šè­¦è§¦å‘ï¼ˆå¦‚æœæ»¡è¶³æ¡ä»¶ï¼‰
   â”œâ”€ ç”Ÿæˆå‘Šè­¦è®°å½•
   â”œâ”€ å†™å…¥ alert_history
   â””â”€ èšåˆ/å‹ç¼©å‘Šè­¦
   â†“
7. å‘é€é€šçŸ¥
   â”œâ”€ æœºå™¨äººæ¶ˆæ¯
   â”œâ”€ é‚®ä»¶é€šçŸ¥
   â””â”€ ä¼ä¸šå¾®ä¿¡é€šçŸ¥
   â†“
8. WebSocket æ¨é€åˆ°ä¿¡æ¯ä¸­å¿ƒ
   â”œâ”€ æ›´æ–°å‘Šè­¦æ¦‚è§ˆ
   â”œâ”€ æ›´æ–°æ»¡æ„åº¦åˆ†å¸ƒ
   â””â”€ æ›´æ–°å·¥ä½œäººå‘˜ç»©æ•ˆ
```

#### **åœºæ™¯3ï¼šå·¥ä½œäººå‘˜å‘é€æ¶ˆæ¯ â†’ çŠ¶æ€å˜æ›´ â†’ ååŒåˆ†ææ›´æ–°**

```
1. å·¥ä½œäººå‘˜å‘é€æ¶ˆæ¯
   â†“
2. å›è°ƒæ¥å£æ¥æ”¶æ¶ˆæ¯
   â†“
3. è¯†åˆ«ä¸ºå·¥ä½œäººå‘˜æ¶ˆæ¯
   â†“
4. æµç¨‹å¼•æ“è·³è½¬åˆ°å·¥ä½œäººå‘˜å¤„ç†æµç¨‹
   â”œâ”€ æ›´æ–°ä¼šè¯çŠ¶æ€ä¸ºäººå·¥
   â”œâ”€ ä¿å­˜å·¥ä½œäººå‘˜æ¶ˆæ¯
   â”œâ”€ è®°å½•å†³ç­–æ—¥å¿—
   â””â”€ è§¦å‘æ»¡æ„åº¦æ¨æ–­
   â†“
5. å†™å…¥ staff_messages
   â†“
6. æ›´æ–° session_status_changes
   â†“
7. å†™å…¥ decision_logs
   â†“
8. æ›´æ–° staff_activity
   â†“
9. WebSocket æ¨é€åˆ°ä¿¡æ¯ä¸­å¿ƒ
   â”œâ”€ æ›´æ–°ä¼šè¯çŠ¶æ€åˆ†å¸ƒ
   â”œâ”€ æ›´æ–°äººå·¥ä»‹å…¥ç»Ÿè®¡
   â”œâ”€ æ›´æ–°å·¥ä½œäººå‘˜ç»©æ•ˆ
   â””â”€ æ›´æ–°ååŒåˆ†ææ•°æ®
```

#### **åœºæ™¯4ï¼šæµç¨‹å¤±è´¥ â†’ å‘Šè­¦è§¦å‘ â†’ æ•…éšœæ’æŸ¥**

```
1. æµç¨‹æ‰§è¡Œå¼‚å¸¸
   â†“
2. æµç¨‹å®ä¾‹å¤±è´¥
   â”œâ”€ è®°å½•å¤±è´¥åŸå› 
   â”œâ”€ æ›´æ–°çŠ¶æ€ä¸º failed
   â””â”€ è®°å½•é”™è¯¯ä¿¡æ¯
   â†“
3. å†™å…¥ flow_instances
   â†“
4. è§¦å‘å‘Šè­¦è§„åˆ™è¯„ä¼°
   â””â”€ è¯„ä¼°æµç¨‹å¤±è´¥ç‡è§„åˆ™
   â†“
5. å‘Šè­¦è§¦å‘
   â”œâ”€ ç”Ÿæˆå‘Šè­¦è®°å½•
   â””â”€ å†™å…¥ alert_history
   â†“
6. å‘é€é€šçŸ¥
   â””â”€ å‘é€ç»™æŠ€æœ¯ç»„
   â†“
7. WebSocket æ¨é€åˆ°ä¿¡æ¯ä¸­å¿ƒ
   â”œâ”€ æ›´æ–°æµç¨‹ç›‘æ§
   â”œâ”€ æ›´æ–°å‘Šè­¦åˆ—è¡¨
   â””â”€ æ›´æ–°äº‹ä»¶æµ
   â†“
8. ç®¡ç†å‘˜æŸ¥çœ‹å‘Šè­¦è¯¦æƒ…
   â”œâ”€ æŸ¥çœ‹æµç¨‹å®ä¾‹è¯¦æƒ…
   â”œâ”€ æŸ¥çœ‹é”™è¯¯å †æ ˆ
   â””â”€ æŸ¥çœ‹ç›¸å…³ä¼šè¯
   â†“
9. ç®¡ç†å‘˜å¤„ç†å‘Šè­¦
   â”œâ”€ æ ‡è®°ä¸ºå·²å¤„ç†
   â”œâ”€ æ·»åŠ å¤„ç†å¤‡æ³¨
   â””â”€ è§¦å‘ç³»ç»Ÿä¿®å¤æµç¨‹
```

---

### **3.4 å®æ—¶æ•°æ®åŒæ­¥æœºåˆ¶**

#### **WebSocket é¢‘é“è®¾è®¡**

```typescript
// WebSocket é¢‘é“å®šä¹‰
interface WebSocketChannels {
  // å®æ—¶ç›‘æ§é¢‘é“
  'monitoring:realtime': {
    events: {
      'metrics:update': {
        data: {
          totalSessions: number;
          activeSessions: number;
          satisfaction: number;
          interventionCount: number;
          timestamp: string;
        }
      },
      'message:stream': {
        data: {
          id: string;
          type: 'user' | 'staff' | 'bot';
          content: string;
          sessionId: string;
          staffId?: string;
          timestamp: string;
        }
      },
      'status:change': {
        data: {
          sessionId: string;
          oldStatus: string;
          newStatus: string;
          triggeredBy: string;
          timestamp: string;
        }
      }
    }
  },
  
  // å‘Šè­¦é¢‘é“
  'alerts:realtime': {
    events: {
      'alert:triggered': {
        data: {
          alertId: string;
          ruleId: string;
          severity: string;
          message: string;
          sessionId?: string;
          staffId?: string;
          timestamp: string;
        }
      },
      'alert:resolved': {
        data: {
          alertId: string;
          resolvedBy: string;
          resolvedAt: string;
          handleNote?: string;
        }
      }
    }
  },
  
  // ä¼šè¯é¢‘é“
  'sessions:realtime': {
    events: {
      'session:created': {
        data: {
          sessionId: string;
          userId: string;
          botId: string;
          createdAt: string;
        }
      },
      'session:updated': {
        data: {
          sessionId: string;
          updates: {
            status?: string;
            satisfaction?: number;
            messageCount?: number;
          };
          updatedAt: string;
        }
      }
    }
  },
  
  // å·¥ä½œäººå‘˜é¢‘é“
  'staff:realtime': {
    events: {
      'staff:online': {
        data: {
          staffId: string;
          staffName: string;
          onlineAt: string;
        }
      },
      'staff:offline': {
        data: {
          staffId: string;
          staffName: string;
          offlineAt: string;
        }
      },
      'staff:message': {
        data: {
          staffId: string;
          sessionId: string;
          content: string;
          timestamp: string;
        }
      }
    }
  },
  
  // æµç¨‹å¼•æ“é¢‘é“
  'flows:realtime': {
    events: {
      'flow:started': {
        data: {
          flowInstanceId: string;
          flowName: string;
          sessionId: string;
          startedAt: string;
        }
      },
      'flow:completed': {
        data: {
          flowInstanceId: string;
          flowName: string;
          sessionId: string;
          completedAt: string;
          executionTime: number;
          result?: any;
        }
      },
      'flow:failed': {
        data: {
          flowInstanceId: string;
          flowName: string;
          sessionId: string;
          failedAt: string;
          errorMessage: string;
        }
      }
    }
  }
}
```

---

### **3.5 æ•°æ®ç¼“å­˜ç­–ç•¥**

#### **Redis ç¼“å­˜è®¾è®¡**

```typescript
// Redis ç¼“å­˜é”®è®¾è®¡
interface RedisCacheKeys {
  // ä¼šè¯ç›¸å…³
  'session:{sessionId}:info': {
    ttl: 3600;
    data: {
      sessionId: string;
      userId: string;
      botId: string;
      status: string;
      createdAt: string;
      lastMessage: string;
      lastMessageTime: string;
      satisfaction?: number;
    }
  },
  
  'session:{sessionId}:messages': {
    ttl: 1800;
    data: {
      messages: Array<{
        id: string;
        type: string;
        content: string;
        timestamp: string;
      }>;
    }
  },
  
  'session:{sessionId}:satisfaction': {
    ttl: 7200;
    data: {
      overallScore: number;
      overallConfidence: number;
      scores: any[];
      calculatedAt: string;
    }
  },
  
  // å·¥ä½œäººå‘˜ç›¸å…³
  'staff:{staffId}:info': {
    ttl: 1800;
    data: {
      staffId: string;
      staffName: string;
      status: 'online' | 'offline';
      activeSessions: number;
      todayMessages: number;
      avgSatisfaction: number;
    }
  },
  
  'staff:{staffId}:active-sessions': {
    ttl: 300;
    data: {
      sessionIds: string[];
    }
  },
  
  // å®æ—¶æŒ‡æ ‡
  'metrics:realtime': {
    ttl: 60;
    data: {
      totalSessions: number;
      activeSessions: number;
      onlineStaff: number;
      todaySatisfaction: number;
      interventionCount: number;
      avgResponseTime: number;
      timestamp: string;
    }
  },
  
  // å‘Šè­¦ç›¸å…³
  'alerts:pending': {
    ttl: 300;
    data: {
      alerts: Array<{
        id: string;
        severity: string;
        message: string;
        triggeredAt: string;
      }>;
    }
  },
  
  // æµç¨‹å®ä¾‹ç›¸å…³
  'flow:{flowInstanceId}:info': {
    ttl: 600;
    data: {
      flowInstanceId: string;
      flowName: string;
      sessionId: string;
      status: string;
      currentNode: string;
      startedAt: string;
      triggerData: any;
    }
  }
}
```

---

## ğŸ“‹ å››ã€å®Œæ•´å®æ–½æ–¹æ¡ˆ

### **4.1 å®æ–½æ­¥éª¤**

```
Phase 1: æµç¨‹å¼•æ“é›†æˆï¼ˆ2å‘¨ï¼‰
â”œâ”€â”€ è®¾è®¡æ¶ˆæ¯å¤„ç†æµç¨‹å®šä¹‰
â”œâ”€â”€ å®ç°æµç¨‹èŠ‚ç‚¹å¤„ç†å™¨
â”œâ”€â”€ é›†æˆæ¶ˆæ¯å›è°ƒæ¥å£
â”œâ”€â”€ å®ç°æµç¨‹å®ä¾‹ä¸ä¼šè¯å…³è”
â””â”€â”€ éªŒè¯æ•°æ®æµè½¬

Phase 2: å‘Šè­¦å¼•æ“å¼€å‘ï¼ˆ3å‘¨ï¼‰
â”œâ”€â”€ è®¾è®¡å‘Šè­¦è§„åˆ™å¼•æ“
â”œâ”€â”€ å®ç°äº‹ä»¶é‡‡é›†å™¨
â”œâ”€â”€ å®ç°è¯„ä¼°å™¨ã€èšåˆå™¨ã€å‹ç¼©å™¨
â”œâ”€â”€ å¼€å‘å‘Šè­¦è§¦å‘å™¨
â””â”€â”€ å®ç°é€šçŸ¥å‘é€å™¨

Phase 3: ç›‘æ§å‘Šè­¦ä¸­å¿ƒå‰ç«¯ï¼ˆ2å‘¨ï¼‰
â”œâ”€â”€ å¼€å‘å®æ—¶ç›‘æ§é¡µé¢
â”œâ”€â”€ å¼€å‘å‘Šè­¦ç®¡ç†é¡µé¢
â”œâ”€â”€ å¼€å‘äº‹ä»¶åˆ†æé¡µé¢
â”œâ”€â”€ å¼€å‘é€šçŸ¥ç®¡ç†é¡µé¢
â””â”€â”€ å¼€å‘è§„åˆ™é…ç½®é¡µé¢

Phase 4: ç³»ç»Ÿè”åŠ¨å®Œå–„ï¼ˆ2å‘¨ï¼‰
â”œâ”€â”€ å®Œå–„ WebSocket æ¨é€
â”œâ”€â”€ ä¼˜åŒ–æ•°æ®ç¼“å­˜ç­–ç•¥
â”œâ”€â”€ å®ç°å®æ—¶æ•°æ®åŒæ­¥
â””â”€â”€ è”åŠ¨æµ‹è¯•

Phase 5: ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1å‘¨ï¼‰
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ å‹åŠ›æµ‹è¯•
â”œâ”€â”€ ç”¨æˆ·ä½“éªŒä¼˜åŒ–
â””â”€â”€ æ–‡æ¡£å®Œå–„
```

---
## ä¿¡æ¯ä¸­å¿ƒç³»ç»Ÿè”åŠ¨å®Œæ•´è®¾è®¡æ–¹æ¡ˆ

### ä¸€ã€ä¿¡æ¯ä¸­å¿ƒä¸æµç¨‹å¼•æ“é›†æˆæ–¹æ¡ˆ

#### 1.1 æ¶ˆæ¯æµå‘ä¸æµç¨‹å¼•æ“çš„å…³ç³»

**å®Œæ•´æ¶ˆæ¯å¤„ç†æµç¨‹ï¼š**
```
ç”¨æˆ·æ¶ˆæ¯ â†’ å›è°ƒæ¥å£ â†’ æµç¨‹å¼•æ“ â†’ æ¶ˆæ¯é¢„å¤„ç† â†’ å·¥ä½œäººå‘˜è¯†åˆ« â†’ ååŒå†³ç­– â†’ æ¶ˆæ¯å¤„ç† â†’ å›å¤ç”Ÿæˆ â†’ æ•°æ®å†™å…¥ â†’ æ»¡æ„åº¦æ¨æ–­ â†’ ç›‘æ§æ¨é€ â†’ ä¿¡æ¯ä¸­å¿ƒ
```

#### 1.2 æµç¨‹å®šä¹‰è®¾è®¡

**æ¶ˆæ¯å¤„ç†ä¸»æµç¨‹ï¼š**
- **æ¶ˆæ¯æ¥æ”¶èŠ‚ç‚¹**ï¼šæ¥æ”¶æ¶ˆæ¯å¹¶æå–å­—æ®µ
- **æ¶ˆæ¯é¢„å¤„ç†èŠ‚ç‚¹**ï¼šæå–ç”¨æˆ·ç‰¹å¾ã€æ¶ˆæ¯ç‰¹å¾ã€è¯†åˆ«å‘é€è€…ç±»å‹
- **å·¥ä½œäººå‘˜åˆ¤æ–­èŠ‚ç‚¹**ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºå·¥ä½œäººå‘˜æ¶ˆæ¯
- **å·¥ä½œäººå‘˜æ¶ˆæ¯å¤„ç†èŠ‚ç‚¹**ï¼šæ›´æ–°ä¼šè¯çŠ¶æ€ã€ä¿å­˜æ¶ˆæ¯ã€è§¦å‘æ»¡æ„åº¦æ¨æ–­ã€å‘é€é€šçŸ¥
- **ååŒå†³ç­–èŠ‚ç‚¹**ï¼šè·å–ä¼šè¯çŠ¶æ€ã€æ£€æŸ¥æ‰‹åŠ¨è¦†ç›–ã€è¯„ä¼°æ˜¯å¦éœ€è¦ä»‹å…¥ã€ç”Ÿæˆå†³ç­–ã€è®°å½•å†³ç­–
- **AIå¤„ç†èŠ‚ç‚¹**ï¼šæ„å›¾è¯†åˆ«ã€çŸ¥è¯†åº“æ£€ç´¢ã€ç”Ÿæˆå“åº”
- **ä¿å­˜æ¶ˆæ¯èŠ‚ç‚¹**ï¼šä¿å­˜ç”¨æˆ·æ¶ˆæ¯å’ŒAIå“åº”
- **æ»¡æ„åº¦æ¨æ–­èŠ‚ç‚¹**ï¼šå¼‚æ­¥æ‰§è¡Œå…³é”®è¯æ¨æ–­ã€æ—¶é•¿æ¨æ–­ã€è½®æ¬¡æ¨æ–­ã€æƒ…æ„Ÿæ¨æ–­ã€è®¡ç®—ç»¼åˆåˆ†æ•°ã€ä¿å­˜æ»¡æ„åº¦ã€æ£€æŸ¥å‘Šè­¦è§¦å‘
- **å‘é€åˆ°ç›‘æ§ä¸­å¿ƒèŠ‚ç‚¹**ï¼šWebSocketæ¨é€ã€æ›´æ–°Redisç¼“å­˜

#### 1.3 æµç¨‹å®ä¾‹ä¸ä¼šè¯çš„å…³è”

**æ•°æ®å…³è”è®¾è®¡ï¼š**
- `flow_instances` è¡¨ï¼šå­˜å‚¨æµç¨‹å®ä¾‹ï¼ŒåŒ…å« `sessionId`ã€`userId`ã€`groupId`ã€`botId` ç­‰å…³è”å­—æ®µ
- `session_messages` è¡¨ï¼šå­˜å‚¨æ¶ˆæ¯ï¼ŒåŒ…å« `flowInstanceId` å…³è”å­—æ®µ
- `decision_logs` è¡¨ï¼šå­˜å‚¨å†³ç­–æ—¥å¿—ï¼ŒåŒ…å« `sessionId`ã€`flowInstanceId` å…³è”å­—æ®µ

#### 1.4 ä¿¡æ¯ä¸­å¿ƒè¯»å–æµç¨‹æ•°æ®

**APIæ¥å£ï¼š**
- `GET /api/monitoring/realtime/flow-stats`ï¼šè·å–æµç¨‹å®ä¾‹ç»Ÿè®¡
- `GET /api/monitoring/realtime/recent-executions`ï¼šè·å–æœ€è¿‘æ‰§è¡Œè®°å½•
- `GET /api/sessions/:sessionId/flow-instances`ï¼šè·å–ä¼šè¯çš„æµç¨‹å®ä¾‹åˆ—è¡¨

---

### äºŒã€ç›‘æ§å‘Šè­¦ä¸­å¿ƒæ¶æ„è®¾è®¡

#### 2.1 ç›‘æ§å‘Šè­¦ä¸­å¿ƒæ•´ä½“æ¶æ„

```
ç›‘æ§å‘Šè­¦ä¸­å¿ƒå‰ç«¯ â†’ å‘Šè­¦å¼•æ“ â†’ æ•°æ®æºå±‚
```

**æ ¸å¿ƒæ¨¡å—ï¼š**
- å‘Šè­¦å¼•æ“ï¼šè§„åˆ™å¼•æ“ã€äº‹ä»¶é‡‡é›†ã€è¯„ä¼°å™¨ã€å‘Šè­¦è§¦å‘ã€èšåˆå™¨ã€å‹ç¼©å™¨
- æ•°æ®æºå±‚ï¼šæµç¨‹å¼•æ“ã€æ»¡æ„åº¦ã€ååŒå†³ç­–ã€æ¶ˆæ¯æµã€ç³»ç»ŸæŒ‡æ ‡ã€å·¥ä½œäººå‘˜ã€ä¼šè¯çŠ¶æ€

#### 2.2 ç›‘æ§å‘Šè­¦ä¸­å¿ƒé¡µé¢ç»“æ„

**ä¸»å¯¼èˆªï¼š**
- ğŸ“Š å®æ—¶ç›‘æ§ï¼šç³»ç»Ÿæ¦‚è§ˆã€æµç¨‹ç›‘æ§ã€å‘Šè­¦æ¦‚è§ˆã€äº‹ä»¶æµ
- ğŸš¨ å‘Šè­¦ç®¡ç†ï¼šå‘Šè­¦è§„åˆ™ã€å‘Šè­¦åˆ—è¡¨ã€å‘Šè­¦å¤„ç†ã€å‘Šè­¦ç»Ÿè®¡
- ğŸ“‹ äº‹ä»¶åˆ†æï¼šäº‹ä»¶åˆ—è¡¨ã€äº‹ä»¶è¯¦æƒ…ã€äº‹ä»¶ç»Ÿè®¡ã€äº‹ä»¶è¶‹åŠ¿
- ğŸ”” é€šçŸ¥ç®¡ç†ï¼šé€šçŸ¥æ¸ é“ã€é€šçŸ¥å†å²ã€é€šçŸ¥æ¨¡æ¿ã€é€šçŸ¥ç»Ÿè®¡
- âš™ï¸ è§„åˆ™é…ç½®ï¼šå‘Šè­¦è§„åˆ™ã€èšåˆè§„åˆ™ã€å‹ç¼©è§„åˆ™ã€é€šçŸ¥è§„åˆ™
- ğŸ“œ å‘Šè­¦å†å²ï¼šå‘Šè­¦è®°å½•ã€å¤„ç†å†å²ã€å¤„ç†ç»Ÿè®¡ã€è¶‹åŠ¿åˆ†æ

#### 2.3 å®æ—¶ç›‘æ§æ¨¡å—è®¾è®¡

**æ ¸å¿ƒæŒ‡æ ‡ï¼š**
- ç³»ç»Ÿæ¦‚è§ˆï¼šæµç¨‹å®ä¾‹æ•°ã€æ´»è·ƒä¼šè¯æ•°ã€å‘Šè­¦è§¦å‘æ•°ã€å¹³å‡æ‰§è¡Œæ—¶é—´ã€æˆåŠŸç‡ã€æ»¡æ„åº¦å‡å€¼
- æµç¨‹ç›‘æ§ï¼šå„æµç¨‹çš„è¿è¡Œä¸­ã€å®Œæˆã€å¤±è´¥æ•°é‡ã€å¹³å‡è€—æ—¶
- å‘Šè­¦æ¦‚è§ˆï¼šæœªå¤„ç†å‘Šè­¦åˆ—è¡¨ï¼ŒåŒ…å«ä½æ»¡æ„åº¦ã€è¿ç»­ä½æ»¡æ„åº¦ã€æµç¨‹å¤±è´¥ç­‰å‘Šè­¦
- äº‹ä»¶æµï¼šæœ€æ–°20æ¡äº‹ä»¶ï¼ˆINFOã€WARNã€ERRORçº§åˆ«ï¼‰

#### 2.4 å‘Šè­¦è§„åˆ™è®¾è®¡

**é¢„ç½®å‘Šè­¦è§„åˆ™ï¼ˆ10æ¡ï¼‰ï¼š**
1. ä½æ»¡æ„åº¦å‘Šè­¦ï¼šæ»¡æ„åº¦ â‰¤ 2.5åˆ†
2. è¿ç»­ä½æ»¡æ„åº¦å‘Šè­¦ï¼šå·¥ä½œäººå‘˜è¿ç»­3æ¬¡ä½åˆ†
3. å·¥ä½œäººå‘˜æ»¡æ„åº¦ä¸‹é™å‘Šè­¦ï¼šå¹³å‡æ»¡æ„åº¦ä¸‹é™ â‰¥ 0.5åˆ†
4. æ•´ä½“æ»¡æ„åº¦ä¸‹é™å‘Šè­¦ï¼šæ•´ä½“æ»¡æ„åº¦ä¸‹é™ â‰¥ 0.3åˆ†
5. æµç¨‹æ‰§è¡Œè¶…æ—¶å‘Šè­¦ï¼šæ‰§è¡Œæ—¶é—´ > 5ç§’
6. æµç¨‹å¤±è´¥ç‡å‘Šè­¦ï¼šå¤±è´¥ç‡ â‰¥ 5%
7. é«˜äººå·¥ä»‹å…¥ç‡å‘Šè­¦ï¼šäººå·¥ä»‹å…¥ç‡ â‰¥ 20%
8. å·¥ä½œäººå‘˜è¿‡è½½å‘Šè­¦ï¼šåŒæ—¶å¤„ç†ä¼šè¯æ•° â‰¥ 5
9. é«˜æ¶ˆæ¯é‡å‘Šè­¦ï¼šæ¶ˆæ¯é‡ â‰¥ 100æ¡/åˆ†é’Ÿ
10. é•¿ä¼šè¯å‘Šè­¦ï¼šä¼šè¯æŒç»­æ—¶é—´ â‰¥ 30åˆ†é’Ÿ

#### 2.5 å‘Šè­¦å¼•æ“å·¥ä½œæµç¨‹

**å‘Šè­¦è§¦å‘æµç¨‹ï¼š**
```
æ•°æ®é‡‡é›† â†’ äº‹ä»¶é‡‡é›†å™¨ â†’ è¯„ä¼°å™¨ â†’ èšåˆå™¨ â†’ å‹ç¼©å™¨ â†’ å‘Šè­¦è§¦å‘å™¨ â†’ é€šçŸ¥å‘é€å™¨ â†’ å®æ—¶æ¨é€
```

#### 2.6 å‘Šè­¦æ•°æ®æ¨¡å‹

**æ ¸å¿ƒè¡¨ç»“æ„ï¼š**
- `alert_history`ï¼šå‘Šè­¦å†å²è®°å½•ï¼ŒåŒ…å«è§„åˆ™ä¿¡æ¯ã€è§¦å‘æ•°æ®ã€å…³è”æ•°æ®ã€æ—¶é—´ä¿¡æ¯ã€å¤„ç†ä¿¡æ¯ã€é€šçŸ¥ä¿¡æ¯
- `alert_stats`ï¼šå‘Šè­¦ç»Ÿè®¡ï¼ŒæŒ‰æ—¥æœŸç»Ÿè®¡å„çº§åˆ«ã€å„ç±»åˆ«çš„å‘Šè­¦æ•°é‡åŠå“åº”æ—¶é—´

---

### ä¸‰ã€ç³»ç»Ÿè”åŠ¨æ€§è®¾è®¡

#### 3.1 å®Œæ•´æ•°æ®æµå‘

```
ç”¨æˆ·æ¶ˆæ¯ â†’ å›è°ƒæ¥å£ â†’ æµç¨‹å¼•æ“ â†’ æ¶ˆæ¯å¤„ç†/ååŒå†³ç­–/æ»¡æ„åº¦æ¨æ–­ â†’ æµç¨‹å®ä¾‹å®Œæˆ â†’ è§¦å‘äº‹ä»¶ â†’ æ»¡æ„åº¦æ¨æ–­/å‘Šè­¦å¼•æ“/é€šçŸ¥æœåŠ¡ â†’ å®æ—¶æ¨é€ â†’ ä¿¡æ¯ä¸­å¿ƒ
```

#### 3.2 ä¿¡æ¯ä¸­å¿ƒä¸å„æ¨¡å—çš„è”åŠ¨

**è”åŠ¨å…³ç³»ï¼š**
- å®æ—¶ç›‘æ§ï¼šä¾èµ– flow_instancesã€session_messagesã€alert_history
- ä¼šè¯åˆ†æï¼šä¾èµ– session_messagesã€session_satisfactionã€flow_instances
- ååŒåˆ†æï¼šä¾èµ– decision_logsã€staff_messagesã€staff_performance
- å·¥ä½œäººå‘˜ç®¡ç†ï¼šä¾èµ– staff_activityã€staff_performanceã€session_satisfaction
- æ•°æ®æŠ¥è¡¨ï¼šä¾èµ–æ‰€æœ‰èšåˆè¡¨
- ç›‘æ§å‘Šè­¦ï¼šä¾èµ– alert_historyã€alert_rulesã€events
- è®¾ç½®ï¼šä¾èµ– alert_rulesã€notification_methods

#### 3.3 å…³é”®è”åŠ¨åœºæ™¯

**åœºæ™¯1ï¼šç”¨æˆ·å‘é€æ¶ˆæ¯ â†’ å®æ—¶ç›‘æ§æ›´æ–°**
- æ¶ˆæ¯å¤„ç†å®Œæˆ â†’ å†™å…¥æ¶ˆæ¯ â†’ è§¦å‘äº‹ä»¶ â†’ WebSocketæ¨é€ â†’ æ›´æ–°å®æ—¶ç›‘æ§

**åœºæ™¯2ï¼šæ»¡æ„åº¦æ¨æ–­ â†’ å‘Šè­¦è§¦å‘ â†’ é€šçŸ¥å‘é€**
- æ»¡æ„åº¦è®¡ç®—å®Œæˆ â†’ å‘Šè­¦è§„åˆ™è¯„ä¼° â†’ å‘Šè­¦è§¦å‘ â†’ å‘é€é€šçŸ¥ â†’ WebSocketæ¨é€

**åœºæ™¯3ï¼šå·¥ä½œäººå‘˜å‘é€æ¶ˆæ¯ â†’ çŠ¶æ€å˜æ›´ â†’ ååŒåˆ†ææ›´æ–°**
- å·¥ä½œäººå‘˜æ¶ˆæ¯ â†’ æ›´æ–°ä¼šè¯çŠ¶æ€ â†’ è®°å½•å†³ç­– â†’ æ›´æ–°å·¥ä½œäººå‘˜æ´»åŠ¨ â†’ WebSocketæ¨é€

**åœºæ™¯4ï¼šæµç¨‹å¤±è´¥ â†’ å‘Šè­¦è§¦å‘ â†’ æ•…éšœæ’æŸ¥**
- æµç¨‹å¤±è´¥ â†’ å‘Šè­¦è§„åˆ™è¯„ä¼° â†’ å‘Šè­¦è§¦å‘ â†’ å‘é€é€šçŸ¥ â†’ WebSocketæ¨é€ â†’ ç®¡ç†å‘˜å¤„ç†

#### 3.4 å®æ—¶æ•°æ®åŒæ­¥æœºåˆ¶

**WebSocket é¢‘é“è®¾è®¡ï¼š**
- `monitoring:realtime`ï¼šå®æ—¶ç›‘æ§ï¼ˆæŒ‡æ ‡æ›´æ–°ã€æ¶ˆæ¯æµã€çŠ¶æ€å˜æ›´ï¼‰
- `alerts:realtime`ï¼šå‘Šè­¦ï¼ˆå‘Šè­¦è§¦å‘ã€å‘Šè­¦è§£å†³ï¼‰
- `sessions:realtime`ï¼šä¼šè¯ï¼ˆä¼šè¯åˆ›å»ºã€ä¼šè¯æ›´æ–°ï¼‰
- `staff:realtime`ï¼šå·¥ä½œäººå‘˜ï¼ˆä¸Šçº¿ã€ä¸‹çº¿ã€å‘é€æ¶ˆæ¯ï¼‰
- `flows:realtime`ï¼šæµç¨‹å¼•æ“ï¼ˆæµç¨‹å¼€å§‹ã€æµç¨‹å®Œæˆã€æµç¨‹å¤±è´¥ï¼‰

#### 3.5 æ•°æ®ç¼“å­˜ç­–ç•¥

**Redis ç¼“å­˜é”®è®¾è®¡ï¼š**
- ä¼šè¯ç›¸å…³ï¼š`session:{sessionId}:info`ã€`session:{sessionId}:messages`ã€`session:{sessionId}:satisfaction`
- å·¥ä½œäººå‘˜ç›¸å…³ï¼š`staff:{staffId}:info`ã€`staff:{staffId}:active-sessions`
- å®æ—¶æŒ‡æ ‡ï¼š`metrics:realtime`
- å‘Šè­¦ç›¸å…³ï¼š`alerts:pending`
- æµç¨‹å®ä¾‹ç›¸å…³ï¼š`flow:{flowInstanceId}:info`

---

### å››ã€å®Œæ•´å®æ–½æ–¹æ¡ˆ

**å®æ–½æ­¥éª¤ï¼ˆå…±5ä¸ªé˜¶æ®µï¼Œ10å‘¨ï¼‰ï¼š**

**Phase 1ï¼šæµç¨‹å¼•æ“é›†æˆï¼ˆ2å‘¨ï¼‰**
- è®¾è®¡æ¶ˆæ¯å¤„ç†æµç¨‹å®šä¹‰
- å®ç°æµç¨‹èŠ‚ç‚¹å¤„ç†å™¨
- é›†æˆæ¶ˆæ¯å›è°ƒæ¥å£
- å®ç°æµç¨‹å®ä¾‹ä¸ä¼šè¯å…³è”
- éªŒè¯æ•°æ®æµè½¬

**Phase 2ï¼šå‘Šè­¦å¼•æ“å¼€å‘ï¼ˆ3å‘¨ï¼‰**
- è®¾è®¡å‘Šè­¦è§„åˆ™å¼•æ“
- å®ç°äº‹ä»¶é‡‡é›†å™¨
- å®ç°è¯„ä¼°å™¨ã€èšåˆå™¨ã€å‹ç¼©å™¨
- å¼€å‘å‘Šè­¦è§¦å‘å™¨
- å®ç°é€šçŸ¥å‘é€å™¨

**Phase 3ï¼šç›‘æ§å‘Šè­¦ä¸­å¿ƒå‰ç«¯ï¼ˆ2å‘¨ï¼‰**
- å¼€å‘å®æ—¶ç›‘æ§é¡µé¢
- å¼€å‘å‘Šè­¦ç®¡ç†é¡µé¢
- å¼€å‘äº‹ä»¶åˆ†æé¡µé¢
- å¼€å‘é€šçŸ¥ç®¡ç†é¡µé¢
- å¼€å‘è§„åˆ™é…ç½®é¡µé¢

**Phase 4ï¼šç³»ç»Ÿè”åŠ¨å®Œå–„ï¼ˆ2å‘¨ï¼‰**
- å®Œå–„ WebSocket æ¨é€
- ä¼˜åŒ–æ•°æ®ç¼“å­˜ç­–ç•¥
- å®ç°å®æ—¶æ•°æ®åŒæ­¥
- è”åŠ¨æµ‹è¯•

**Phase 5ï¼šä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1å‘¨ï¼‰**
- æ€§èƒ½ä¼˜åŒ–
- å‹åŠ›æµ‹è¯•
- ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æ–‡æ¡£å®Œå–„