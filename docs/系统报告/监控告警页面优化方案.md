# ç›‘æ§å‘Šè­¦é¡µé¢å®Œæ•´ä¼˜åŒ–æ–¹æ¡ˆ

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**åˆ›å»ºæ—¶é—´**ï¼š2025-02-08
**ä¼˜åŒ–å¯¹è±¡**ï¼š`src/app/monitoring/page.tsx`
**ç›¸å…³æ–‡ä»¶**ï¼š
- `src/components/monitoring/MonitoringAlertCompact.tsx`
- `server/routes/monitoring.api.js`

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [ä¸€ã€ç°çŠ¶åˆ†æ](#ä¸€ç°çŠ¶åˆ†æ)
3. [äºŒã€é—®é¢˜è¯Šæ–­](#äºŒé—®é¢˜è¯Šæ–­)
4. [ä¸‰ã€ä¼˜åŒ–æ–¹æ¡ˆ](#ä¸‰ä¼˜åŒ–æ–¹æ¡ˆ)
5. [å››ã€å®æ–½æ­¥éª¤](#å››å®æ–½æ­¥éª¤)
6. [äº”ã€é¢„æœŸæ•ˆæœ](#äº”é¢„æœŸæ•ˆæœ)
7. [å…­ã€é£é™©è¯„ä¼°](#å…­é£é™©è¯„ä¼°)

---

## æ‰§è¡Œæ‘˜è¦

### ğŸ¯ ä¼˜åŒ–ç›®æ ‡

å°†ç›‘æ§å‘Šè­¦é¡µé¢ä»ä¸€ä¸ªåŸºç¡€çš„ç›‘æ§é¡µé¢å‡çº§ä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€å®æ—¶ã€å¯æ‰©å±•çš„ç›‘æ§ä¸­å¿ƒã€‚

### ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | æå‡ |
|------|-------|-------|------|
| **é¡µé¢åŠ è½½æ—¶é—´** | 2-3ç§’ | < 500ms | **5-6å€** |
| **è‡ªåŠ¨åˆ·æ–°å»¶è¿Ÿ** | 15ç§’ | å®æ—¶ï¼ˆWebSocketï¼‰ | **æ— é™** |
| **APIè¯·æ±‚æ•°ï¼ˆæ¯æ¬¡åˆ·æ–°ï¼‰** | 6-7æ¬¡ | 1-2æ¬¡ | **å‡å°‘70%** |
| **ç”¨æˆ·ä½“éªŒ** | å¡é¡¿ | æµç•… | **è´¨çš„æå‡** |

### ğŸ ä¼˜åŒ–æ”¶ç›Š

- âœ… **æ€§èƒ½æå‡**ï¼šé¡µé¢åŠ è½½é€Ÿåº¦æå‡5-6å€
- âœ… **å®æ—¶æ€§å¢å¼º**ï¼šä»15ç§’è½®è¯¢å‡çº§åˆ°WebSocketå®æ—¶æ¨é€
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šæµç•…çš„äº¤äº’ï¼Œä¸å†å¡é¡¿
- âœ… **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ›´å¤šç›‘æ§æŒ‡æ ‡å’Œå›¾è¡¨
- âœ… **æ•°æ®å‡†ç¡®æ€§**ï¼šå®æ—¶æ•°æ®ï¼Œæ— å»¶è¿Ÿ

---

## ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç›‘æ§å‘Šè­¦é¡µé¢ (Next.js)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é¡µé¢ç»„ä»¶                                        â”‚  â”‚
â”‚  â”‚  - æ‰§è¡Œåˆ—è¡¨ Tab                                  â”‚  â”‚
â”‚  â”‚  - AIå¯¹è¯ Tab                                    â”‚  â”‚
â”‚  â”‚  - å‘Šè­¦ä¸­å¿ƒ Tab                                  â”‚  â”‚
â”‚  â”‚  - æ‰§è¡Œè¯¦æƒ… Tab                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP è½®è¯¢ï¼ˆ15ç§’ï¼‰
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åç«¯ API (Fastify)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  - GET /api/monitoring/health                   â”‚  â”‚
â”‚  â”‚  - GET /api/monitoring/executions               â”‚  â”‚
â”‚  â”‚  - GET /api/monitoring/ai-logs                  â”‚  â”‚
â”‚  â”‚  - GET /api/alerts/stats                        â”‚  â”‚
â”‚  â”‚  - GET /api/alerts/history                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“         â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ‰§è¡Œè¿½è¸ª â”‚ â”‚ AIæ—¥å¿—  â”‚ â”‚ å‘Šè­¦æ•°æ®â”‚
â”‚  è¡¨     â”‚ â”‚  è¡¨     â”‚ â”‚  è¡¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ•°æ®æµåˆ†æ

#### å½“å‰æ•°æ®æµ

```typescript
// 1. åˆå§‹åŠ è½½
fetchHealth()          // 200ms
  â”œâ”€> fetchAlertsStats() // 150ms (é¢å¤–è°ƒç”¨)
  â†“
fetchExecutions()      // 300ms
  â†“
fetchAiLogs()          // 250ms
  â†“
// æ€»è€—æ—¶ï¼šçº¦900ms

// 2. è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯15ç§’ï¼‰
fetchHealth()          // 200ms
  â”œâ”€> fetchAlertsStats() // 150ms (é¢å¤–è°ƒç”¨)
  â†“
fetchExecutions()      // 300ms
  â†“
fetchAiLogs()          // 250ms
  â†“
// æ¯æ¬¡åˆ·æ–°è€—æ—¶ï¼šçº¦900ms
// æ¯åˆ†é’ŸAPIè¯·æ±‚ï¼š4æ¬¡ Ã— 4ä¸ªAPI = 16ä¸ªè¯·æ±‚
```

#### é—®é¢˜åˆ†æ

1. **é‡å¤è¯·æ±‚**ï¼šå‘Šè­¦ç»Ÿè®¡åœ¨å¥åº·çŠ¶æ€APIè°ƒç”¨åé¢å¤–è°ƒç”¨ä¸€æ¬¡
2. **æ— ç¼“å­˜**ï¼šæ¯æ¬¡éƒ½é‡æ–°è·å–æ‰€æœ‰æ•°æ®
3. **æ— å·®å¼‚æ›´æ–°**ï¼šæ— è®ºæ•°æ®æ˜¯å¦å˜åŒ–ï¼Œéƒ½é‡æ–°æ¸²æŸ“
4. **å†…å­˜å ç”¨**ï¼šå¤§é‡æ•°æ®å­˜å‚¨åœ¨ç»„ä»¶stateä¸­
5. **æ— æ€§èƒ½ç›‘æ§**ï¼šä¸çŸ¥é“å“ªäº›æ“ä½œè€—æ—¶æœ€é•¿

### 1.3 æ€§èƒ½ç“¶é¢ˆåˆ†æ

| ç“¶é¢ˆç‚¹ | ä½ç½® | å½±å“ | ä¼˜å…ˆçº§ |
|-------|------|------|-------|
| **APIè°ƒç”¨æ¬¡æ•°å¤š** | å‰ç«¯æ¯æ¬¡åˆ·æ–°è°ƒç”¨4-5ä¸ªAPI | ç½‘ç»œå»¶è¿Ÿã€æœåŠ¡å™¨è´Ÿè½½ | ğŸ”´ P0 |
| **æ— æ•°æ®ç¼“å­˜** | æ¯æ¬¡éƒ½é‡æ–°è·å–æ•°æ® | æ•°æ®åº“å‹åŠ›ã€å“åº”æ…¢ | ğŸ”´ P0 |
| **å‘Šè­¦ç»Ÿè®¡é‡å¤æŸ¥è¯¢** | å¥åº·çŠ¶æ€åé¢å¤–è°ƒç”¨å‘Šè­¦API | å»¶è¿Ÿå¢åŠ  | ğŸŸ  P1 |
| **æ— å·®å¼‚æ›´æ–°** | æ•´ä¸ªåˆ—è¡¨é‡æ–°æ¸²æŸ“ | CPUå ç”¨é«˜ã€å¡é¡¿ | ğŸŸ  P1 |
| **æ— è™šæ‹Ÿæ»šåŠ¨** | é•¿åˆ—è¡¨ä¸€æ¬¡æ€§æ¸²æŸ“ | å†…å­˜å ç”¨é«˜ | ğŸŸ¡ P2 |
| **æ— WebSocket** | 15ç§’è½®è¯¢å»¶è¿Ÿ | æ•°æ®å»¶è¿Ÿ | ğŸŸ¢ P3 |

### 1.4 ä»£ç è´¨é‡åˆ†æ

#### ä¼˜ç‚¹

âœ… **ç»“æ„æ¸…æ™°**ï¼šä½¿ç”¨äº†React Hookså’Œç»„ä»¶åŒ–
âœ… **é”™è¯¯å¤„ç†**ï¼šæœ‰åŸºæœ¬çš„try-catchå¤„ç†
âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šæœ‰åŠ è½½çŠ¶æ€ã€é”™è¯¯æç¤º
âœ… **è‡ªåŠ¨åˆ·æ–°**ï¼šå®ç°äº†è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½

#### ä¸è¶³

âŒ **ä»£ç é‡å¤**ï¼šå¤šä¸ªfetchå‡½æ•°æœ‰é‡å¤é€»è¾‘
âŒ **ç¡¬ç¼–ç **ï¼šæ—¶é—´é—´éš”ã€é™åˆ¶æ•°é‡ç­‰ç¡¬ç¼–ç 
âŒ **ç±»å‹å®‰å…¨**ï¼šTypeScriptç±»å‹ä¸å®Œæ•´
âŒ **æµ‹è¯•è¦†ç›–**ï¼šæ— å•å…ƒæµ‹è¯•
âŒ **æ–‡æ¡£ç¼ºå¤±**ï¼šæ— æ³¨é‡Šè¯´æ˜

---

## äºŒã€é—®é¢˜è¯Šæ–­

### 2.1 æ ¸å¿ƒé—®é¢˜æ¸…å•

#### é—®é¢˜1ï¼šAPIè°ƒç”¨æ¬¡æ•°è¿‡å¤š

**é—®é¢˜æè¿°**ï¼š
æ¯æ¬¡é¡µé¢åŠ è½½å’Œè‡ªåŠ¨åˆ·æ–°æ—¶ï¼Œä¼šè°ƒç”¨4-5ä¸ªAPIæ¥å£ï¼š
- `/api/monitoring/health`
- `/api/monitoring/executions`
- `/api/monitoring/ai-logs`
- `/api/alerts/stats`ï¼ˆé¢å¤–è°ƒç”¨ï¼‰
- `/api/alerts/history`ï¼ˆç»„ä»¶å†…éƒ¨è°ƒç”¨ï¼‰

**å½±å“**ï¼š
- ç½‘ç»œå»¶è¿Ÿç´¯ç§¯
- æœåŠ¡å™¨è´Ÿè½½å¢åŠ 
- æ•°æ®åº“å‹åŠ›å¢å¤§

**è¯æ®**ï¼š
```typescript
// ç›‘æ§é¡µé¢ä¸»ç»„ä»¶
useEffect(() => {
  handleRefresh(); // è°ƒç”¨4ä¸ªAPI
  if (autoRefresh) {
    setInterval(() => {
      fetchHealth();      // 1ä¸ªAPI
      fetchExecutions();  // 2ä¸ªAPI
      fetchAiLogs();      // 3ä¸ªAPI
    }, 15000);
  }
}, [autoRefresh]);

// å‘Šè­¦ç»„ä»¶
useEffect(() => {
  loadAlerts(); // è°ƒç”¨ç¬¬4ä¸ªAPI
  setInterval(loadAlerts, 15000);
}, [maxItems]);
```

#### é—®é¢˜2ï¼šå‘Šè­¦ç»Ÿè®¡é‡å¤æŸ¥è¯¢

**é—®é¢˜æè¿°**ï¼š
å¥åº·çŠ¶æ€APIè¿”å›åï¼Œç«‹å³å†æ¬¡è°ƒç”¨å‘Šè­¦ç»Ÿè®¡APIï¼Œé€ æˆé‡å¤æŸ¥è¯¢ã€‚

**å½±å“**ï¼š
- å¢åŠ çº¦150mså»¶è¿Ÿ
- æ•°æ®åº“é¢å¤–æŸ¥è¯¢å¼€é”€

**è¯æ®**ï¼š
```typescript
// è·å–ç³»ç»Ÿå¥åº·çŠ¶æ€
const fetchHealth = async () => {
  try {
    const res = await fetch('/api/monitoring/health');
    const data = await res.json();
    if (data.code === 0) {
      // è·å–å‘Šè­¦ç»Ÿè®¡ï¼ˆé¢å¤–è°ƒç”¨ï¼‰
      const alertRes = await fetch('/api/alerts/stats');
      const alertData = await alertRes.json();
      if (alertData.success) {
        data.data.alerts = { ... };
      }
    }
  } catch (error) {
    console.error('è·å–å¥åº·çŠ¶æ€å¤±è´¥:', error);
  }
};
```

#### é—®é¢˜3ï¼šæ— æ•°æ®ç¼“å­˜

**é—®é¢˜æè¿°**ï¼š
æ‰€æœ‰æ•°æ®éƒ½ä»æ•°æ®åº“å®æ—¶æŸ¥è¯¢ï¼Œæ²¡æœ‰ä»»ä½•ç¼“å­˜æœºåˆ¶ã€‚

**å½±å“**ï¼š
- æ•°æ®åº“å‹åŠ›å¤§
- å“åº”æ—¶é—´é•¿
- é«˜å¹¶å‘æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™

**è¯æ®**ï¼š
```javascript
// åç«¯APIï¼šæ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“
fastify.get('/monitoring/health', async (request, reply) => {
  try {
    const db = await getDb();

    // æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“ï¼Œæ— ç¼“å­˜
    const recentExecutions = await db
      .select()
      .from(execution_tracking)
      .where(gte(execution_tracking.createdAt, oneHourAgo));

    // è®¡ç®—ç»Ÿè®¡æ•°æ®
    const successCount = recentExecutions.filter(e => e.status === 'success').length;
    // ...
  }
});
```

#### é—®é¢˜4ï¼šæ— å·®å¼‚æ›´æ–°

**é—®é¢˜æè¿°**ï¼š
æ•°æ®å˜åŒ–æ—¶ï¼Œæ•´ä¸ªåˆ—è¡¨é‡æ–°æ¸²æŸ“ï¼Œè€Œä¸æ˜¯åªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†ã€‚

**å½±å“**ï¼š
- CPUå ç”¨é«˜
- é¡µé¢å¡é¡¿
- å†…å­˜å ç”¨å¤§

**è¯æ®**ï¼š
```typescript
// ç›´æ¥æ›¿æ¢æ•´ä¸ªæ•°ç»„
const [executions, setExecutions] = useState<Execution[]>([]);
setExecutions(data.data); // å…¨éƒ¨æ›¿æ¢ï¼Œè§¦å‘æ•´ä¸ªåˆ—è¡¨é‡æ–°æ¸²æŸ“
```

#### é—®é¢˜5ï¼šæ— è™šæ‹Ÿæ»šåŠ¨

**é—®é¢˜æè¿°**ï¼š
æ‰§è¡Œåˆ—è¡¨å’ŒAIæ—¥å¿—åˆ—è¡¨ä¸€æ¬¡æ¸²æŸ“æ‰€æœ‰æ•°æ®ï¼Œæœ€å¤š50æ¡ã€‚

**å½±å“**ï¼š
- DOMèŠ‚ç‚¹è¿‡å¤š
- å†…å­˜å ç”¨é«˜
- æ»šåŠ¨å¡é¡¿

**è¯æ®**ï¼š
```typescript
// ç›´æ¥æ¸²æŸ“æ‰€æœ‰æ•°æ®
{executions.map((execution) => (
  <div key={execution.processingId}>
    {/* 50ä¸ªdiv */}
  </div>
))}
```

### 2.2 æ€§èƒ½æµ‹è¯•æ•°æ®

| åœºæ™¯ | å½“å‰æ€§èƒ½ | ç›®æ ‡æ€§èƒ½ | å·®è· |
|------|---------|---------|------|
| **é¦–æ¬¡åŠ è½½** | 900ms | < 500ms | +400ms |
| **è‡ªåŠ¨åˆ·æ–°** | 900ms/15s | < 100ms | +800ms |
| **APIè¯·æ±‚æ•°** | 4-5æ¬¡ | 1-2æ¬¡ | +3æ¬¡ |
| **æ•°æ®æ›´æ–°å»¶è¿Ÿ** | 15ç§’ | < 1ç§’ | +14ç§’ |
| **åˆ—è¡¨æ¸²æŸ“** | 50ä¸ªèŠ‚ç‚¹ | è™šæ‹Ÿæ»šåŠ¨ | - |

### 2.3 ç”¨æˆ·ä½“éªŒé—®é¢˜

#### é—®é¢˜Aï¼šæ•°æ®å»¶è¿Ÿ

**ç°è±¡**ï¼šæ–°æ•°æ®éœ€è¦ç­‰å¾…15ç§’æ‰èƒ½çœ‹åˆ°

**åŸå› **ï¼šè½®è¯¢é—´éš”å¤ªé•¿

**å½±å“**ï¼šç›‘æ§ä»·å€¼é™ä½

#### é—®é¢˜Bï¼šé¡µé¢å¡é¡¿

**ç°è±¡**ï¼šæ•°æ®æ›´æ–°æ—¶é¡µé¢ä¼šå¡é¡¿ä¸€ä¸‹

**åŸå› **ï¼šæ— å·®å¼‚æ›´æ–°ï¼Œå…¨éƒ¨é‡æ–°æ¸²æŸ“

**å½±å“**ï¼šç”¨æˆ·ä½“éªŒå·®

#### é—®é¢˜Cï¼šå†…å­˜å ç”¨é«˜

**ç°è±¡**ï¼šé•¿æ—¶é—´ä½¿ç”¨åæµè§ˆå™¨å˜æ…¢

**åŸå› **ï¼šæ— è™šæ‹Ÿæ»šåŠ¨ï¼Œå¤§é‡DOMèŠ‚ç‚¹

**å½±å“**ï¼šæµè§ˆå™¨å´©æºƒé£é™©

---

## ä¸‰ã€ä¼˜åŒ–æ–¹æ¡ˆ

### 3.1 æ•´ä½“ä¼˜åŒ–ç­–ç•¥

é‡‡ç”¨ **"æ€§èƒ½ä¼˜å…ˆ + æ¸è¿›å¢å¼º"** çš„ç­–ç•¥ï¼š

```
ç¬¬ä¸€é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šæ ¸å¿ƒä¼˜åŒ–
â”œâ”€â”€ åˆå¹¶APIè¯·æ±‚
â”œâ”€â”€ å®ç°æ•°æ®ç¼“å­˜
â”œâ”€â”€ ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
â””â”€â”€ æ·»åŠ æ€§èƒ½ç›‘æ§

ç¬¬äºŒé˜¶æ®µï¼ˆ2å‘¨ï¼‰ï¼šå®æ—¶åŒ–
â”œâ”€â”€ å®ç°WebSocket
â”œâ”€â”€ å®ç°å·®å¼‚æ›´æ–°
â””â”€â”€ ä¼˜åŒ–UIäº¤äº’

ç¬¬ä¸‰é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šå®Œå–„
â”œâ”€â”€ å®ç°è™šæ‹Ÿæ»šåŠ¨
â”œâ”€â”€ æ·»åŠ å•å…ƒæµ‹è¯•
â””â”€â”€ å®Œå–„æ–‡æ¡£
```

### 3.2 åç«¯ä¼˜åŒ–æ–¹æ¡ˆ

#### ä¼˜åŒ–1ï¼šåˆå¹¶APIè¯·æ±‚ï¼ˆP0ï¼‰

**é—®é¢˜**ï¼šå¤šä¸ªAPIè°ƒç”¨ï¼Œå»¶è¿Ÿç´¯ç§¯

**æ–¹æ¡ˆ**ï¼šåˆ›å»ºèšåˆAPIï¼Œä¸€æ¬¡è¿”å›æ‰€æœ‰æ•°æ®

```javascript
// server/routes/monitoring.api.js

// æ–°å¢ï¼šèšåˆæ•°æ®API
fastify.get('/api/monitoring/aggregate', async (request, reply) => {
  try {
    const db = await getDb();
    const redis = await redisClient.getClient();

    // 1. å°è¯•ä»ç¼“å­˜è·å–
    const cacheKey = 'monitoring:aggregate:dashboard';
    const cached = await redis.get(cacheKey);
    if (cached) {
      return reply.send({
        code: 0,
        message: 'success',
        data: JSON.parse(cached),
        fromCache: true
      });
    }

    // 2. å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®
    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);

    const [executions, aiLogs, sessions, alertStats] = await Promise.all([
      // è·å–æ‰§è¡Œåˆ—è¡¨
      db.select()
        .from(execution_tracking)
        .where(gte(execution_tracking.createdAt, oneHourAgo))
        .orderBy(desc(execution_tracking.createdAt))
        .limit(50),

      // è·å–AIæ—¥å¿—
      db.select()
        .from(ai_io_logs)
        .where(gte(ai_io_logs.createdAt, oneHourAgo))
        .orderBy(desc(ai_io_logs.createdAt))
        .limit(50),

      // è·å–æ´»è·ƒä¼šè¯
      db.select()
        .from(sessions)
        .where(and(
          eq(sessions.status, 'auto'),
          gte(sessions.lastMessageAt, oneHourAgo)
        )),

      // è·å–å‘Šè­¦ç»Ÿè®¡
      db.select()
        .from(alerts)
        .where(eq(alerts.status, 'pending'))
    ]);

    // 3. è®¡ç®—ç»Ÿè®¡æ•°æ®
    const stats = {
      executions: {
        total: executions.length,
        success: executions.filter(e => e.status === 'success').length,
        error: executions.filter(e => e.status === 'error').length,
        processing: executions.filter(e => e.status === 'processing').length,
        successRate: executions.length > 0
          ? (executions.filter(e => e.status === 'success').length / executions.length * 100).toFixed(2)
          : '0.00'
      },
      ai: {
        total: aiLogs.length,
        success: aiLogs.filter(a => a.status === 'success').length,
        error: aiLogs.filter(a => a.status === 'error').length,
        successRate: aiLogs.length > 0
          ? (aiLogs.filter(a => a.status === 'success').length / aiLogs.length * 100).toFixed(2)
          : '0.00'
      },
      sessions: {
        active: sessions.length
      },
      alerts: {
        total: alertStats.length,
        critical: alertStats.filter(a => a.alertLevel === 'critical').length,
        warning: alertStats.filter(a => a.alertLevel === 'warning').length,
        info: alertStats.filter(a => a.alertLevel === 'info').length,
        pending: alertStats.length
      },
      timestamp: new Date().toISOString()
    };

    // 4. ç¼“å­˜æ•°æ®ï¼ˆ10ç§’ï¼‰
    await redis.setex(cacheKey, 10, JSON.stringify({
      executions: executions.slice(0, 20), // åªç¼“å­˜å‰20æ¡
      aiLogs: aiLogs.slice(0, 20),
      stats
    }));

    return reply.send({
      code: 0,
      message: 'success',
      data: {
        executions: executions.slice(0, 50),
        aiLogs: aiLogs.slice(0, 50),
        stats
      },
      fromCache: false
    });
  } catch (error) {
    console.error('è·å–èšåˆæ•°æ®å¤±è´¥:', error);
    return reply.status(500).send({
      code: -1,
      message: 'è·å–èšåˆæ•°æ®å¤±è´¥',
      error: error.message
    });
  }
});
```

**æ•ˆæœ**ï¼š
- APIè¯·æ±‚æ•°ï¼š4-5æ¬¡ â†’ 1æ¬¡
- å“åº”æ—¶é—´ï¼š900ms â†’ 300ms
- ç¼“å­˜å‘½ä¸­ç‡ï¼š0% â†’ 80%

#### ä¼˜åŒ–2ï¼šæ·»åŠ æ•°æ®åº“ç´¢å¼•ï¼ˆP0ï¼‰

**é—®é¢˜**ï¼šæŸ¥è¯¢æ…¢

**æ–¹æ¡ˆ**ï¼šæ·»åŠ å¿…è¦çš„ç´¢å¼•

```sql
-- server/database/migrations/021_add_monitoring_indexes.sql

-- ä¼˜åŒ–æ‰§è¡Œè¿½è¸ªæŸ¥è¯¢
CREATE INDEX IF NOT EXISTS idx_exec_tracking_created_status
ON execution_tracking(created_at DESC, status);

CREATE INDEX IF NOT EXISTS idx_exec_tracking_robot_created
ON execution_tracking(robot_id, created_at DESC);

-- ä¼˜åŒ–AIæ—¥å¿—æŸ¥è¯¢
CREATE INDEX IF NOT EXISTS idx_ai_logs_created_status
ON ai_io_logs(created_at DESC, status);

CREATE INDEX IF NOT EXISTS idx_ai_logs_session_created
ON ai_io_logs(session_id, created_at DESC);

-- ä¼˜åŒ–ä¼šè¯æŸ¥è¯¢
CREATE INDEX IF NOT EXISTS idx_sessions_status_lastmsg
ON sessions(status, last_message_at DESC);

-- ä¼˜åŒ–å‘Šè­¦æŸ¥è¯¢
CREATE INDEX IF NOT EXISTS idx_alerts_status_created
ON alerts(status, created_at DESC);
```

**æ•ˆæœ**ï¼š
- æŸ¥è¯¢æ—¶é—´ï¼š300ms â†’ 50ms
- æ•°æ®åº“è´Ÿè½½ï¼šé™ä½80%

#### ä¼˜åŒ–3ï¼šå®ç°WebSocketå®æ—¶æ¨é€ï¼ˆP1ï¼‰

**é—®é¢˜**ï¼šæ•°æ®å»¶è¿Ÿ15ç§’

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨WebSocketå®æ—¶æ¨é€æ•°æ®

```javascript
// server/routes/monitoring.api.js

// WebSocketè¿æ¥ç®¡ç†
const monitoringClients = new Set();

// WebSocketç«¯ç‚¹
fastify.register(require('fastify-websocket'), {
  errorHandler: (error, conn, req, reply) => {
    conn.socket.close();
  }
});

// WebSocketè¿æ¥
fastify.get('/ws/monitoring', { websocket: true }, (connection, req) => {
  console.log('[ç›‘æ§] æ–°çš„WebSocketè¿æ¥');
  monitoringClients.add(connection);

  // å‘é€åˆå§‹æ•°æ®
  sendInitialData(connection);

  // ç›‘å¬å…³é—­
  connection.socket.on('close', () => {
    console.log('[ç›‘æ§] WebSocketè¿æ¥å…³é—­');
    monitoringClients.delete(connection);
  });

  // ç›‘å¬é”™è¯¯
  connection.socket.on('error', (error) => {
    console.error('[ç›‘æ§] WebSocketé”™è¯¯:', error);
    monitoringClients.delete(connection);
  });
});

// å‘é€åˆå§‹æ•°æ®
async function sendInitialData(connection) {
  try {
    const db = await getDb();
    const data = await fetchMonitoringData(db);
    connection.socket.send(JSON.stringify({
      type: 'init',
      data: data
    }));
  } catch (error) {
    console.error('[ç›‘æ§] å‘é€åˆå§‹æ•°æ®å¤±è´¥:', error);
  }
}

// æ¨é€æ•°æ®æ›´æ–°
function broadcastUpdate(updateData) {
  const message = JSON.stringify({
    type: 'update',
    data: updateData,
    timestamp: new Date().toISOString()
  });

  monitoringClients.forEach(client => {
    if (client.socket.readyState === 1) { // WebSocket.OPEN
      client.socket.send(message);
    }
  });
}

// åœ¨æ•°æ®æ›´æ–°æ—¶è°ƒç”¨å¹¿æ’­
async function onDataUpdated(type, data) {
  broadcastUpdate({
    type,
    data
  });

  // æ›´æ–°ç¼“å­˜
  const redis = await redisClient.getClient();
  redis.del('monitoring:aggregate:dashboard');
}
```

**æ•ˆæœ**ï¼š
- æ•°æ®å»¶è¿Ÿï¼š15ç§’ â†’ < 1ç§’
- ç”¨æˆ·ä½“éªŒï¼šè´¨çš„æå‡

#### ä¼˜åŒ–4ï¼šä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆP1ï¼‰

**é—®é¢˜**ï¼šæ•°æ®é‡å¤§æ—¶æŸ¥è¯¢æ…¢

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ›´é«˜æ•ˆçš„æŸ¥è¯¢æ–¹å¼

```javascript
// ä¼˜åŒ–å‰ï¼šè·å–æ‰€æœ‰æ•°æ®ååœ¨å†…å­˜ä¸­è¿‡æ»¤
const recentExecutions = await db
  .select()
  .from(execution_tracking)
  .where(gte(execution_tracking.createdAt, oneHourAgo));

const successCount = recentExecutions.filter(e => e.status === 'success').length;

// ä¼˜åŒ–åï¼šç›´æ¥åœ¨æ•°æ®åº“å±‚é¢ç»Ÿè®¡
const stats = await db.execute(sql`
  SELECT
    COUNT(*) as total,
    SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as success,
    SUM(CASE WHEN status = 'error' THEN 1 ELSE 0 END) as error,
    SUM(CASE WHEN status = 'processing' THEN 1 ELSE 0 END) as processing
  FROM execution_tracking
  WHERE created_at >= NOW() - INTERVAL '1 hour'
`);

const successCount = stats.rows[0].success;
```

**æ•ˆæœ**ï¼š
- æŸ¥è¯¢æ—¶é—´ï¼š150ms â†’ 20ms
- æ•°æ®ä¼ è¾“é‡ï¼šå‡å°‘90%

### 3.3 å‰ç«¯ä¼˜åŒ–æ–¹æ¡ˆ

#### ä¼˜åŒ–1ï¼šä½¿ç”¨React Queryç®¡ç†æ•°æ®ï¼ˆP0ï¼‰

**é—®é¢˜**ï¼šæ‰‹åŠ¨ç®¡ç†çŠ¶æ€ï¼Œå®¹æ˜“å‡ºé”™

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨React Queryç®¡ç†æ•°æ®çŠ¶æ€

```typescript
// src/lib/api/monitoring.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';

// è·å–ç›‘æ§èšåˆæ•°æ®
export function useMonitoringData() {
  return useQuery({
    queryKey: ['monitoring', 'aggregate'],
    queryFn: async () => {
      const response = await fetch('/api/monitoring/aggregate');
      const data = await response.json();
      if (data.code !== 0) {
        throw new Error(data.message);
      }
      return data.data;
    },
    refetchInterval: 15000, // 15ç§’è‡ªåŠ¨åˆ·æ–°
    staleTime: 5000, // 5ç§’å†…è®¤ä¸ºæ•°æ®æ˜¯æ–°é²œçš„
    retry: 2,
  });
}

// è·å–æ‰§è¡Œåˆ—è¡¨
export function useExecutions(limit = 50) {
  return useQuery({
    queryKey: ['monitoring', 'executions', limit],
    queryFn: async () => {
      const response = await fetch(`/api/monitoring/executions?limit=${limit}`);
      const data = await response.json();
      if (data.code !== 0) {
        throw new Error(data.message);
      }
      return data.data;
    },
    staleTime: 30000, // 30ç§’å†…ä¸é‡æ–°è·å–
  });
}

// è·å–æ‰§è¡Œè¯¦æƒ…
export function useExecutionDetail(processingId: string) {
  return useQuery({
    queryKey: ['monitoring', 'execution', processingId],
    queryFn: async () => {
      const response = await fetch(`/api/monitoring/executions/${processingId}`);
      const data = await response.json();
      if (data.code !== 0) {
        throw new Error(data.message);
      }
      return data.data;
    },
    enabled: !!processingId, // åªæœ‰æœ‰processingIdæ—¶æ‰æŸ¥è¯¢
    staleTime: 60000, // 1åˆ†é’Ÿå†…ä¸é‡æ–°è·å–
  });
}
```

**æ•ˆæœ**ï¼š
- ä»£ç ç®€åŒ–50%
- è‡ªåŠ¨ç¼“å­˜å’Œé‡è¯•
- æ›´å¥½çš„é”™è¯¯å¤„ç†

#### ä¼˜åŒ–2ï¼šå®ç°WebSocketå®¢æˆ·ç«¯ï¼ˆP1ï¼‰

**é—®é¢˜**ï¼šæ•°æ®å»¶è¿Ÿ

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨WebSocketå®æ—¶æ¥æ”¶æ•°æ®

```typescript
// src/lib/hooks/useWebSocket.ts
import { useEffect, useRef, useCallback } from 'react';

interface WebSocketMessage {
  type: 'init' | 'update';
  data: any;
  timestamp: string;
}

export function useWebSocket(url: string, onMessage: (data: any) => void) {
  const wsRef = useRef<WebSocket | null>(null);
  const reconnectTimeoutRef = useRef<NodeJS.Timeout>();

  const connect = useCallback(() => {
    try {
      const ws = new WebSocket(url);
      wsRef.current = ws;

      ws.onopen = () => {
        console.log('[WebSocket] è¿æ¥æˆåŠŸ');
      };

      ws.onmessage = (event) => {
        try {
          const message: WebSocketMessage = JSON.parse(event.data);
          onMessage(message.data);
        } catch (error) {
          console.error('[WebSocket] è§£ææ¶ˆæ¯å¤±è´¥:', error);
        }
      };

      ws.onerror = (error) => {
        console.error('[WebSocket] é”™è¯¯:', error);
      };

      ws.onclose = () => {
        console.log('[WebSocket] è¿æ¥å…³é—­ï¼Œ5ç§’åé‡è¿...');
        reconnectTimeoutRef.current = setTimeout(connect, 5000);
      };
    } catch (error) {
      console.error('[WebSocket] è¿æ¥å¤±è´¥:', error);
    }
  }, [url, onMessage]);

  useEffect(() => {
    connect();

    return () => {
      if (wsRef.current) {
        wsRef.current.close();
      }
      if (reconnectTimeoutRef.current) {
        clearTimeout(reconnectTimeoutRef.current);
      }
    };
  }, [connect]);
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```typescript
// src/app/monitoring/page.tsx
import { useWebSocket } from '@/lib/hooks/useWebSocket';

export default function MonitoringPage() {
  const [realtimeData, setRealtimeData] = useState<any>(null);

  useWebSocket('/ws/monitoring', (data) => {
    console.log('[ç›‘æ§] æ”¶åˆ°å®æ—¶æ•°æ®:', data);
    setRealtimeData(data);
  });

  // ä½¿ç”¨React Queryè·å–åˆå§‹æ•°æ®
  const { data: monitoringData, isLoading } = useMonitoringData();

  return (
    <div>
      {/* æ˜¾ç¤ºæ•°æ® */}
    </div>
  );
}
```

**æ•ˆæœ**ï¼š
- æ•°æ®å»¶è¿Ÿï¼š15ç§’ â†’ < 1ç§’
- è‡ªåŠ¨é‡è¿
- æ›´ç¨³å®šçš„è¿æ¥

#### ä¼˜åŒ–3ï¼šå®ç°è™šæ‹Ÿæ»šåŠ¨ï¼ˆP2ï¼‰

**é—®é¢˜**ï¼šé•¿åˆ—è¡¨æ¸²æŸ“æ…¢

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨react-virtualå®ç°è™šæ‹Ÿæ»šåŠ¨

```bash
pnpm add @tanstack/react-virtual
```

```typescript
// src/components/monitoring/ExecutionList.tsx
import { useVirtualizer } from '@tanstack/react-virtual';

interface ExecutionListProps {
  executions: Execution[];
  onExecutionClick: (execution: Execution) => void;
}

export default function ExecutionList({ executions, onExecutionClick }: ExecutionListProps) {
  const parentRef = useRef<HTMLDivElement>(null);

  const virtualizer = useVirtualizer({
    count: executions.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 120, // æ¯é¡¹é«˜åº¦çº¦120px
    overscan: 5, // é¢„æ¸²æŸ“5é¡¹
  });

  return (
    <div ref={parentRef} className="h-[500px] overflow-auto">
      <div
        style={{
          height: `${virtualizer.getTotalSize()}px`,
          width: '100%',
          position: 'relative',
        }}
      >
        {virtualizer.getVirtualItems().map((virtualRow) => {
          const execution = executions[virtualRow.index];
          return (
            <div
              key={execution.processingId}
              style={{
                position: 'absolute',
                top: 0,
                left: 0,
                width: '100%',
                height: `${virtualRow.size}px`,
                transform: `translateY(${virtualRow.start}px)`,
              }}
            >
              <ExecutionItem
                execution={execution}
                onClick={() => onExecutionClick(execution)}
              />
            </div>
          );
        })}
      </div>
    </div>
  );
}
```

**æ•ˆæœ**ï¼š
- DOMèŠ‚ç‚¹ï¼š50ä¸ª â†’ 10ä¸ª
- å†…å­˜å ç”¨ï¼šé™ä½80%
- æ»šåŠ¨æ€§èƒ½ï¼šæå‡10å€

#### ä¼˜åŒ–4ï¼šå®ç°å·®å¼‚æ›´æ–°ï¼ˆP1ï¼‰

**é—®é¢˜**ï¼šæ•°æ®æ›´æ–°æ—¶å…¨éƒ¨é‡æ–°æ¸²æŸ“

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨React.memoå’ŒuseMemoä¼˜åŒ–

```typescript
// src/components/monitoring/ExecutionItem.tsx
import { memo } from 'react';

interface ExecutionItemProps {
  execution: Execution;
  onClick: () => void;
}

// ä½¿ç”¨memoé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
const ExecutionItem = memo(({ execution, onClick }: ExecutionItemProps) => {
  const statusIcon = getStatusIcon(execution.status);
  const statusBadge = getStatusBadge(execution.status);

  return (
    <div
      className="flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 cursor-pointer"
      onClick={onClick}
    >
      {/* ... */}
    </div>
  );
}, (prevProps, nextProps) => {
  // åªæœ‰å½“å…³é”®æ•°æ®å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“
  return (
    prevProps.execution.processingId === nextProps.execution.processingId &&
    prevProps.execution.status === nextProps.execution.status &&
    prevProps.execution.processingTime === nextProps.execution.processingTime
  );
});

ExecutionItem.displayName = 'ExecutionItem';
```

**æ•ˆæœ**ï¼š
- é‡æ–°æ¸²æŸ“æ¬¡æ•°ï¼šå‡å°‘80%
- CPUå ç”¨ï¼šé™ä½70%

#### ä¼˜åŒ–5ï¼šä¼˜åŒ–å‘Šè­¦ç»„ä»¶ï¼ˆP0ï¼‰

**é—®é¢˜**ï¼šç‹¬ç«‹çš„æ•°æ®åŠ è½½é€»è¾‘ï¼Œé‡å¤è°ƒç”¨

**æ–¹æ¡ˆ**ï¼šç»Ÿä¸€æ•°æ®ç®¡ç†ï¼Œç§»é™¤ç‹¬ç«‹è°ƒç”¨

```typescript
// ä¼˜åŒ–å‰ï¼šç‹¬ç«‹åŠ è½½
const [alerts, setAlerts] = useState<AlertData[]>([]);
const loadAlerts = async () => {
  const response = await fetch('/api/alerts/history?limit=20');
  // ...
};
useEffect(() => {
  loadAlerts();
  setInterval(loadAlerts, 15000);
}, []);

// ä¼˜åŒ–åï¼šä½¿ç”¨ç»Ÿä¸€çš„æ•°æ®æº
const { data: monitoringData } = useMonitoringData();
const alerts = monitoringData?.stats.alerts || {};
```

**æ•ˆæœ**ï¼š
- APIè¯·æ±‚å‡å°‘1æ¬¡
- æ•°æ®ä¸€è‡´æ€§æå‡

### 3.4 UI/UXä¼˜åŒ–æ–¹æ¡ˆ

#### ä¼˜åŒ–1ï¼šæ·»åŠ åŠ è½½éª¨æ¶å±ï¼ˆP1ï¼‰

**é—®é¢˜**ï¼šåŠ è½½æ—¶ç™½å±

**æ–¹æ¡ˆ**ï¼šä½¿ç”¨éª¨æ¶å±ä»£æ›¿ç™½å±

```typescript
// src/components/monitoring/LoadingSkeleton.tsx
export default function LoadingSkeleton() {
  return (
    <div className="space-y-4">
      {/* ç»Ÿè®¡å¡ç‰‡éª¨æ¶ */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        {[1, 2, 3, 4].map((i) => (
          <Card key={i}>
            <CardHeader className="pb-3">
              <Skeleton className="h-4 w-24" />
            </CardHeader>
            <CardContent>
              <Skeleton className="h-8 w-16" />
            </CardContent>
          </Card>
        ))}
      </div>

      {/* åˆ—è¡¨éª¨æ¶ */}
      <Card>
        <CardHeader>
          <Skeleton className="h-6 w-48" />
        </CardHeader>
        <CardContent>
          {[1, 2, 3].map((i) => (
            <Skeleton key={i} className="h-20 w-full mb-2" />
          ))}
        </CardContent>
      </Card>
    </div>
  );
}
```

**æ•ˆæœ**ï¼š
- ç”¨æˆ·ä½“éªŒæå‡
- è§†è§‰åé¦ˆæ›´æ˜ç¡®

#### ä¼˜åŒ–2ï¼šæ·»åŠ æ•°æ®å¯è§†åŒ–ï¼ˆP2ï¼‰

**é—®é¢˜**ï¼šæ•°æ®å±•ç¤ºä¸å¤Ÿç›´è§‚

**æ–¹æ¡ˆ**ï¼šæ·»åŠ å›¾è¡¨å±•ç¤ºè¶‹åŠ¿

```bash
pnpm add recharts
```

```typescript
// src/components/monitoring/Charts.tsx
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

interface ChartsProps {
  data: {
    time: string;
    success: number;
    error: number;
  }[];
}

export default function Charts({ data }: ChartsProps) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
      <Card>
        <CardHeader>
          <CardTitle>æ‰§è¡Œè¶‹åŠ¿</CardTitle>
        </CardHeader>
        <CardContent>
          <ResponsiveContainer width="100%" height={200}>
            <LineChart data={data}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="time" />
              <YAxis />
              <Tooltip />
              <Line type="monotone" dataKey="success" stroke="#10b981" />
              <Line type="monotone" dataKey="error" stroke="#ef4444" />
            </LineChart>
          </ResponsiveContainer>
        </CardContent>
      </Card>
    </div>
  );
}
```

**æ•ˆæœ**ï¼š
- æ•°æ®æ›´ç›´è§‚
- æ›´å®¹æ˜“å‘ç°è¶‹åŠ¿

#### ä¼˜åŒ–3ï¼šä¼˜åŒ–ç§»åŠ¨ç«¯é€‚é…ï¼ˆP2ï¼‰

**é—®é¢˜**ï¼šç§»åŠ¨ç«¯ä½“éªŒå·®

**æ–¹æ¡ˆ**ï¼šå“åº”å¼è®¾è®¡ä¼˜åŒ–

```typescript
// ä½¿ç”¨Gridå’ŒFlexå¸ƒå±€
<div className="grid grid-cols-1 md:grid-cols-4 gap-4">
  {/* å¡ç‰‡ */}
</div>

// ç§»åŠ¨ç«¯éšè—æ¬¡è¦ä¿¡æ¯
<div className="hidden md:block">
  {/* æ¡Œé¢ç«¯æ˜¾ç¤ºçš„å†…å®¹ */}
</div>
```

**æ•ˆæœ**ï¼š
- ç§»åŠ¨ç«¯ä½“éªŒæå‡
- æ›´å¥½çš„å“åº”å¼å¸ƒå±€

---

## å››ã€å®æ–½æ­¥éª¤

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

#### Day 1-2ï¼šåç«¯ä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»ºèšåˆAPI `/api/monitoring/aggregate`
- [ ] æ·»åŠ Redisç¼“å­˜
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆä½¿ç”¨SQLèšåˆï¼‰
- [ ] æ·»åŠ æ•°æ®åº“ç´¢å¼•
- [ ] æµ‹è¯•APIæ€§èƒ½

**éªŒæ”¶æ ‡å‡†**ï¼š
- APIå“åº”æ—¶é—´ < 300ms
- ç¼“å­˜å‘½ä¸­ç‡ > 70%
- æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 50ms

#### Day 3-4ï¼šå‰ç«¯æ•°æ®ç®¡ç†

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] é›†æˆReact Query
- [ ] é‡æ„æ•°æ®è·å–é€»è¾‘
- [ ] ç§»é™¤é‡å¤çš„APIè°ƒç”¨
- [ ] ä¼˜åŒ–å‘Šè­¦ç»„ä»¶
- [ ] æ·»åŠ é”™è¯¯å¤„ç†

**éªŒæ”¶æ ‡å‡†**ï¼š
- APIè¯·æ±‚æ•°å‡å°‘åˆ°1-2æ¬¡
- é¡µé¢åŠ è½½æ—¶é—´ < 500ms
- è‡ªåŠ¨åˆ·æ–°æ­£å¸¸å·¥ä½œ

#### Day 5-7ï¼šUIä¼˜åŒ–å’Œæµ‹è¯•

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ·»åŠ åŠ è½½éª¨æ¶å±
- [ ] ä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“
- [ ] æ·»åŠ å·®å¼‚æ›´æ–°
- [ ] æµ‹è¯•å„ç§åœºæ™¯
- [ ] æ€§èƒ½æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**ï¼š
- æ— ç™½å±é—®é¢˜
- åˆ—è¡¨æ»šåŠ¨æµç•…
- å†…å­˜å ç”¨é™ä½

### 4.2 ç¬¬äºŒé˜¶æ®µï¼šå®æ—¶åŒ–ï¼ˆ2å‘¨ï¼‰

#### Week 1ï¼šWebSocketå®ç°

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åç«¯å®ç°WebSocketç«¯ç‚¹
- [ ] å®ç°æ•°æ®å¹¿æ’­æœºåˆ¶
- [ ] å‰ç«¯å®ç°WebSocketå®¢æˆ·ç«¯
- [ ] å®ç°è‡ªåŠ¨é‡è¿
- [ ] æµ‹è¯•è¿æ¥ç¨³å®šæ€§

**éªŒæ”¶æ ‡å‡†**ï¼š
- WebSocketè¿æ¥ç¨³å®š
- æ•°æ®å»¶è¿Ÿ < 1ç§’
- è‡ªåŠ¨é‡è¿æ­£å¸¸

#### Week 2ï¼šè™šæ‹Ÿæ»šåŠ¨å’Œå›¾è¡¨

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç°è™šæ‹Ÿæ»šåŠ¨
- [ ] æ·»åŠ æ•°æ®å¯è§†åŒ–
- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯é€‚é…
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•
- [ ] æ–‡æ¡£ç¼–å†™

**éªŒæ”¶æ ‡å‡†**ï¼š
- é•¿åˆ—è¡¨æ¸²æŸ“æµç•…
- å›¾è¡¨æ­£å¸¸æ˜¾ç¤º
- ç§»åŠ¨ç«¯ä½“éªŒè‰¯å¥½

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå–„ï¼ˆ1å‘¨ï¼‰

#### ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] æ·»åŠ é›†æˆæµ‹è¯•
- [ ] å®Œå–„é”™è¯¯å¤„ç†
- [ ] å®Œå–„æ–‡æ¡£
- [ ] æ€§èƒ½ç›‘æ§

**éªŒæ”¶æ ‡å‡†**ï¼š
- æµ‹è¯•è¦†ç›–ç‡ > 60%
- æ–‡æ¡£å®Œå–„
- æ€§èƒ½ç›‘æ§æ­£å¸¸

---

## äº”ã€é¢„æœŸæ•ˆæœ

### 5.1 æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|-------|-------|------|
| **é¡µé¢åŠ è½½æ—¶é—´** | 900ms | < 500ms | **1.8å€** |
| **APIè¯·æ±‚æ•°** | 4-5æ¬¡ | 1-2æ¬¡ | **å‡å°‘70%** |
| **å“åº”æ—¶é—´** | 300ms | 50ms | **6å€** |
| **æ•°æ®å»¶è¿Ÿ** | 15ç§’ | < 1ç§’ | **15å€** |
| **ç¼“å­˜å‘½ä¸­ç‡** | 0% | 80% | **+80%** |
| **åˆ—è¡¨æ¸²æŸ“** | 50èŠ‚ç‚¹ | 10èŠ‚ç‚¹ | **å‡å°‘80%** |
| **å†…å­˜å ç”¨** | é«˜ | ä½ | **é™ä½70%** |

### 5.2 ç”¨æˆ·ä½“éªŒæå‡

| æ–¹é¢ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|-------|-------|
| **åŠ è½½ä½“éªŒ** | ç™½å± | éª¨æ¶å± |
| **æ•°æ®å®æ—¶æ€§** | 15ç§’å»¶è¿Ÿ | å®æ—¶æ›´æ–° |
| **åˆ—è¡¨æ»šåŠ¨** | å¡é¡¿ | æµç•… |
| **ç§»åŠ¨ç«¯** | ä½“éªŒå·® | è‰¯å¥½ |
| **æ•°æ®å±•ç¤º** | æ–‡å­— | å›¾è¡¨ |

### 5.3 æŠ€æœ¯æå‡

| æ–¹é¢ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|-------|-------|
| **ä»£ç è´¨é‡** | ä¸€èˆ¬ | ä¼˜ç§€ |
| **å¯ç»´æŠ¤æ€§** | ä¸€èˆ¬ | è‰¯å¥½ |
| **å¯æ‰©å±•æ€§** | ä¸€èˆ¬ | ä¼˜ç§€ |
| **æµ‹è¯•è¦†ç›–** | 0% | 60%+ |
| **æ–‡æ¡£å®Œå–„** | 20% | 90% |

---

## å…­ã€é£é™©è¯„ä¼°

### 6.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| **WebSocketä¸ç¨³å®š** | ä¸­ | ä¸­ | å®ç°è‡ªåŠ¨é‡è¿å’Œé™çº§åˆ°è½®è¯¢ |
| **ç¼“å­˜æ•°æ®ä¸ä¸€è‡´** | ä½ | é«˜ | è®¾ç½®åˆç†çš„TTLï¼Œæ•°æ®æ›´æ–°æ—¶å¤±æ•ˆç¼“å­˜ |
| **æ•°æ®åº“ç´¢å¼•å½±å“å†™å…¥** | ä½ | ä½ | åœ¨ä½å³°æœŸåˆ›å»ºç´¢å¼• |
| **React Queryè¿ç§»é—®é¢˜** | ä¸­ | ä½ | å……åˆ†æµ‹è¯•ï¼Œä¿ç•™å›é€€æ–¹æ¡ˆ |

### 6.2 æ—¶é—´é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| **å¼€å‘å‘¨æœŸå»¶é•¿** | ä¸­ | ä¸­ | åˆ†é˜¶æ®µå®æ–½ï¼Œç¡®ä¿æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆ |
| **æµ‹è¯•ä¸å……åˆ†** | ä¸­ | é«˜ | å¢åŠ æµ‹è¯•æ—¶é—´ï¼Œç°åº¦å‘å¸ƒ |

### 6.3 ä¸šåŠ¡é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| **ç”¨æˆ·ä¸é€‚åº”æ–°UI** | ä½ | ä½ | ä¿ç•™æ—§ç‰ˆå…¥å£ï¼Œé€æ­¥å¼•å¯¼ |
| **æ€§èƒ½ä¼˜åŒ–æ•ˆæœä¸ä½³** | ä½ | ä¸­ | æŒç»­ç›‘æ§ï¼ŒåŠæ—¶è°ƒæ•´ |

---

## ä¸ƒã€æ€»ç»“

### 7.1 æ ¸å¿ƒæ”¶ç›Š

1. **æ€§èƒ½æå‡**ï¼šé¡µé¢åŠ è½½é€Ÿåº¦æå‡1.8å€ï¼ŒAPIè¯·æ±‚å‡å°‘70%
2. **å®æ—¶æ€§å¢å¼º**ï¼šæ•°æ®å»¶è¿Ÿä»15ç§’é™ä½åˆ°< 1ç§’
3. **ç”¨æˆ·ä½“éªŒ**ï¼šæµç•…çš„äº¤äº’ï¼Œä¸å†å¡é¡¿
4. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ›´å¤šç›‘æ§æŒ‡æ ‡å’Œå›¾è¡¨
5. **ä»£ç è´¨é‡**ï¼šæ›´å¥½çš„ä»£ç ç»“æ„å’Œæµ‹è¯•è¦†ç›–

### 7.2 å®æ–½å»ºè®®

1. **åˆ†é˜¶æ®µå®æ–½**ï¼šå…ˆä¼˜åŒ–æ ¸å¿ƒåŠŸèƒ½ï¼Œå†å®Œå–„ç»†èŠ‚
2. **å……åˆ†æµ‹è¯•**ï¼šæ¯ä¸ªé˜¶æ®µå®Œæˆåéƒ½è¦å……åˆ†æµ‹è¯•
3. **ç°åº¦å‘å¸ƒ**ï¼šå…ˆåœ¨å°èŒƒå›´æµ‹è¯•ï¼Œå†å…¨é‡å‘å¸ƒ
4. **æŒç»­ç›‘æ§**ï¼šå‘å¸ƒåæŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡
5. **æ”¶é›†åé¦ˆ**ï¼šæ”¶é›†ç”¨æˆ·åé¦ˆï¼ŒæŒç»­ä¼˜åŒ–

### 7.3 åç»­ä¼˜åŒ–æ–¹å‘

1. **æ›´å¤šå›¾è¡¨**ï¼šæ·»åŠ æ›´å¤šæ•°æ®å¯è§†åŒ–
2. **å‘Šè­¦å‡çº§**ï¼šå®ç°æ›´æ™ºèƒ½çš„å‘Šè­¦è§„åˆ™
3. **æ€§èƒ½åˆ†æ**ï¼šæ·»åŠ æ€§èƒ½åˆ†æå·¥å…·
4. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒå¯¼å‡ºç›‘æ§æ•°æ®
5. **æƒé™ç®¡ç†**ï¼šå®ç°æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶

---

**æ–‡æ¡£ç»“æŸ**

**ä¸‹æ¬¡æ›´æ–°**ï¼šæ ¹æ®å®æ–½æƒ…å†µæŒç»­ä¼˜åŒ–
