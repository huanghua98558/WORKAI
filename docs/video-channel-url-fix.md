# 视频号小店自动化系统说明

## 重要信息

### 正确的网址
- **带货助手页面**: `https://store.weixin.qq.com/talent/` （二维码生成页面）
- **视频号助手页面**: `https://channels.weixin.qq.com/assistant` （通过带货助手联动访问）
- **关系**: 带货助手和视频号助手是联动的，扫码登录后Cookie共享

### 核心特性
1. **单二维码登录**: 用户只需扫描一个二维码（带货助手），即可同时访问带货助手和视频号助手
2. **Cookie联动**: 扫码登录后的Cookie可以同时用于两个页面
3. **联动性检测**: 系统会自动检测Cookie在带货助手和视频号助手之间的联动性

## 功能说明

### 1. 二维码获取
- 访问带货助手页面 `https://store.weixin.qq.com/talent/`
- 识别页面中的二维码元素
- 截取二维码并保存
- **注意**: 只生成一个二维码（带货助手的），这个二维码可以同时用于两个页面

### 2. 登录检测
- 使用保存的Cookie访问带货助手页面
- 检查页面是否有登录后的元素（如用户头像、店铺名称等）
- 判断用户是否已登录

### 3. Cookie提取
- 提取所有Cookie（不过滤，保留完整权限信息）
- 保存到文件和数据库
- Cookie包含domain、path、expires等完整属性
- **关键**: 这个Cookie可以同时用于带货助手和视频号助手

### 4. 页面可访问性检测（联动性检测）
由于带货助手和视频号助手共享Cookie，检测逻辑为：

1. **创建两个独立的页面实例**，避免互相干扰
2. **同时为两个页面设置同一个Cookie**
3. **并发访问两个页面**：
   - 带货助手: `https://store.weixin.qq.com/talent/`
   - 视频号助手: `https://channels.weixin.qq.com/assistant`
4. **并行检查页面状态**：
   - HTTP状态码是否为200
   - 页面是否有登录按钮（未登录状态）
   - 页面是否有用户信息（已登录状态）
5. **判断Cookie联动性**：
   - 两个页面都能访问 → Cookie联动正常，权限完整
   - 只有带货助手能访问 → Cookie不完整
   - 只有视频号助手能访问 → Cookie不完整
   - 都不能访问 → Cookie无效

### 5. 人工审核
- 使用同一个Cookie分别访问带货助手和视频号助手页面
- 创建两个独立的页面实例
- 并发截图两个页面
- 验证Cookie权限和联动性
- 判断是否能正常访问带货助手和视频号助手
- 输出权限检测结果和页面截图

## 联动性检测逻辑

### 完整权限
```
带货助手 → 可访问 (HTTP 200, 有用户信息)
视频号助手 → 可访问 (HTTP 200, 有用户信息)
结果: Cookie权限完整，联动性正常
```

### 部分权限
```
带货助手 → 可访问 (HTTP 200, 有用户信息)
视频号助手 → 不可访问 (需要登录)
结果: Cookie权限不完整，只能访问带货助手
```

### 无效Cookie
```
带货助手 → 不可访问 (需要登录)
视频号助手 → 不可访问 (需要登录)
结果: Cookie无效，无法访问任何页面
```

## 注意事项

1. **单二维码**: 用户只需扫描一个二维码（带货助手的），不需要分别扫码
2. **页面独立性**: 带货助手和视频号助手有独立的页面URL，但共享登录状态和Cookie
3. **并发检测**: 使用两个独立的页面实例并发检测，避免页面状态互相覆盖
4. **权限同步**: 登录带货助手后，视频号助手也会自动登录
5. **Cookie共享**: 两个页面使用完全相同的Cookie，域名、路径等属性一致

## 待优化项

1. 根据实际的页面DOM结构，精确识别两个页面的元素
2. 分别截取带货助手和视频号助手的不同功能区域
3. 根据页面元素判断具体的权限范围（如商品管理、订单管理、直播管理等）
4. 添加Cookie过期检测和自动刷新机制
