# æµç¨‹å¼•æ“èŠ‚ç‚¹é…ç½®åˆ†ææŠ¥å‘Š

## æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šå¯¹ WorkTool AI æµç¨‹å¼•æ“çš„èŠ‚ç‚¹é…ç½®è¿›è¡Œäº†å…¨é¢åˆ†æï¼Œå‘ç°å­˜åœ¨**èŠ‚ç‚¹ç±»å‹è¿‡å¤šã€åŠŸèƒ½é‡å ã€å‰åç«¯ä¸ä¸€è‡´**ç­‰é—®é¢˜ã€‚ç‰¹åˆ«åœ°ï¼Œç”¨æˆ·æå‡ºäº†ä¸€ä¸ªé‡è¦çš„æ¶æ„ä¼˜åŒ–å»ºè®®ï¼š**é€šè¿‡è®©å•ä¸ªèŠ‚ç‚¹æ”¯æŒå¤šä¸ªä»»åŠ¡/æ“ä½œæ¥ç®€åŒ–èŠ‚ç‚¹ç±»å‹**ï¼Œè¿™å¯ä»¥å¤§å¹…é™ä½ç³»ç»Ÿå¤æ‚åº¦ã€‚

---

## ä¸€ã€å½“å‰èŠ‚ç‚¹ç±»å‹åˆ†æ

### 1.1 åç«¯å®šä¹‰çš„èŠ‚ç‚¹ç±»å‹ï¼ˆ32ç§ï¼‰

```javascript
const NodeType = {
  // åŸºç¡€èŠ‚ç‚¹ï¼ˆ8ç§ï¼‰
  START: 'start',
  END: 'end',
  CONDITION: 'condition',
  MESSAGE_RECEIVE: 'message_receive',
  DECISION: 'decision',
  SERVICE: 'service',
  NOTIFICATION: 'notification',
  MONITOR: 'monitor',

  // AIç›¸å…³èŠ‚ç‚¹ï¼ˆ3ç§ï¼‰
  AI_CHAT: 'ai_chat',
  AI_REPLY: 'ai_reply',
  INTENT: 'intent',

  // é£é™©ç›¸å…³èŠ‚ç‚¹ï¼ˆ5ç§ï¼‰
  RISK_HANDLER: 'risk_handler',
  RISK_DETECT: 'risk_detect',
  EMOTION_ANALYZE: 'emotion_analyze',
  ALERT_SAVE: 'alert_save',
  ALERT_NOTIFY: 'alert_notify',

  // å‘Šè­¦ç›¸å…³èŠ‚ç‚¹ï¼ˆ2ç§ï¼‰
  ALERT_RULE: 'alert_rule',
  ALERT_ESCALATE: 'alert_escalate',

  // æµç¨‹æ§åˆ¶èŠ‚ç‚¹ï¼ˆ4ç§ï¼‰
  SESSION_CREATE: 'session_create',
  HUMAN_HANDOVER: 'human_handover',
  STAFF_INTERVENTION: 'staff_intervention',
  COMMAND_STATUS: 'command_status',

  // æ¶ˆæ¯æ“ä½œèŠ‚ç‚¹ï¼ˆ3ç§ï¼‰
  MESSAGE_DISPATCH: 'message_dispatch',
  MESSAGE_SYNC: 'message_sync',
  SEND_COMMAND: 'send_command',

  // æ•°æ®å¤„ç†èŠ‚ç‚¹ï¼ˆ3ç§ï¼‰
  DATA_QUERY: 'data_query',
  DATA_TRANSFORM: 'data_transform',
  VARIABLE_SET: 'variable_set',

  // ä»»åŠ¡èŠ‚ç‚¹ï¼ˆ2ç§ï¼‰
  HTTP_REQUEST: 'http_request',
  TASK_ASSIGN: 'task_assign',

  // åˆ†æèŠ‚ç‚¹ï¼ˆ1ç§ï¼‰
  SATISFACTION_INFER: 'satisfaction_infer',
};
```

### 1.2 å‰ç«¯æ”¯æŒçš„èŠ‚ç‚¹ç±»å‹ï¼ˆ12ç§ï¼‰

```typescript
export const NODE_TYPES = {
  MESSAGE_RECEIVE: 'message_receive',  // âœ… æœ‰é…ç½®
  INTENT: 'intent',                   // âœ… æœ‰é…ç½®
  DECISION: 'decision',               // âœ… æœ‰é…ç½®
  AI_REPLY: 'ai_reply',               // âœ… æœ‰é…ç½®
  MESSAGE_DISPATCH: 'message_dispatch', // âœ… æœ‰é…ç½®
  SEND_COMMAND: 'send_command',       // âœ… æœ‰é…ç½®
  COMMAND_STATUS: 'command_status',   // âœ… æœ‰é…ç½®
  END: 'end',                         // âœ… æœ‰é…ç½®
  ALERT_SAVE: 'alert_save',           // âœ… æœ‰é…ç½®
  ALERT_RULE: 'alert_rule',           // âœ… æœ‰é…ç½®
  RISK_HANDLER: 'risk_handler',       // âœ… æœ‰é…ç½®
  MONITOR: 'monitor',                 // âœ… æœ‰é…ç½®
};
```

### 1.3 å…³é”®å‘ç°

| é—®é¢˜ | è¯¦ç»†è¯´æ˜ |
|------|----------|
| **å‰åç«¯ä¸ä¸€è‡´** | åç«¯32ç§ï¼Œå‰ç«¯ä»…12ç§ï¼Œç¼ºå°‘20ç§ |
| **åŠŸèƒ½é‡å ä¸¥é‡** | AIèŠ‚ç‚¹æœ‰3ç§ï¼Œé£é™©èŠ‚ç‚¹æœ‰5ç§ï¼Œæ¶ˆæ¯èŠ‚ç‚¹æœ‰3ç§ |
| **å¤„ç†å™¨ç¼ºå¤±** | `COMMAND_STATUS` å¤„ç†å™¨è¢«æ³¨é‡Šï¼Œæ— æ³•å®é™…æ‰§è¡Œ |
| **é…ç½®ä¸å®Œæ•´** | å¾ˆå¤šåç«¯èŠ‚ç‚¹å‰ç«¯æ— é…ç½®ç•Œé¢ |

---

## äºŒã€èŠ‚ç‚¹é…ç½®é€‰é¡¹åŒ¹é…åº¦åˆ†æ

### 2.1 AIç›¸å…³èŠ‚ç‚¹

#### âœ… Intent èŠ‚ç‚¹ï¼ˆæ„å›¾è¯†åˆ«ï¼‰
- **åç«¯é…ç½®**: `supportedIntents`, `modelId`
- **å‰ç«¯é…ç½®**: `supportedIntents`, `modelId`
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

#### âš ï¸ AI_REPLY èŠ‚ç‚¹ï¼ˆAIå›å¤ï¼‰
- **åç«¯é…ç½®**:
  ```javascript
  {
    modelId, prompt, personaId, temperature, maxTokens,
    useContextHistory, systemPrompt
  }
  ```
- **å‰ç«¯é…ç½®**: ç¼ºå°‘è¯¦ç»†é…ç½®
- **çŠ¶æ€**: âš ï¸ ä¸å®Œæ•´ï¼Œéœ€è¦è¡¥å…… `personaId`ã€`temperature`ã€`maxTokens` ç­‰é…ç½®

#### âŒ AI_CHAT èŠ‚ç‚¹ï¼ˆAIå¯¹è¯ï¼‰
- **åç«¯é…ç½®**: `prompt`, `modelId`, `roleId`, `temperature`, `maxTokens`, `useRolePrompt`, `useTemplate`, `templateId`, `variables`
- **å‰ç«¯é…ç½®**: æ— æ­¤èŠ‚ç‚¹
- **çŠ¶æ€**: âŒ å‰ç«¯ä¸æ”¯æŒ

### 2.2 ä¸šåŠ¡æ“ä½œèŠ‚ç‚¹

#### âš ï¸ ROBOT_DISPATCH èŠ‚ç‚¹ï¼ˆæœºå™¨äººåˆ†å‘ï¼‰
- **åç«¯é…ç½®**:
  ```javascript
  {
    robotId, priority = 'normal'
  }
  ```
- **å‰ç«¯é…ç½®**: æ— æ­¤èŠ‚ç‚¹
- **çŠ¶æ€**: âŒ å‰ç«¯ä¸æ”¯æŒï¼Œä½†åç«¯å·²å®ç°

#### âš ï¸ SEND_COMMAND èŠ‚ç‚¹ï¼ˆå‘é€æŒ‡ä»¤ï¼‰
- **åç«¯é…ç½®**:
  ```javascript
  {
    commandType = 'message',
    messageContent, recipients, robotId, saveLog = true
  }
  ```
- **å‰ç«¯é…ç½®**: éœ€è¦éªŒè¯
- **çŠ¶æ€**: âš ï¸ éœ€è¦è¡¥å…… `recipients` é…ç½®

### 2.3 æ•°æ®å¤„ç†èŠ‚ç‚¹

#### âŒ DATA_QUERY èŠ‚ç‚¹ï¼ˆæ•°æ®æŸ¥è¯¢ï¼‰
- **åç«¯é…ç½®**:
  ```javascript
  {
    source, endpoint, queryParams, saveToContext
  }
  ```
- **å‰ç«¯é…ç½®**: æ— æ­¤èŠ‚ç‚¹
- **çŠ¶æ€**: âŒ å‰ç«¯ä¸æ”¯æŒ

#### âŒ DATA_TRANSFORM èŠ‚ç‚¹ï¼ˆæ•°æ®è½¬æ¢ï¼‰
- **åç«¯é…ç½®**:
  ```javascript
  {
    transformRules, targetField, preserveOriginal
  }
  ```
- **å‰ç«¯é…ç½®**: æ— æ­¤èŠ‚ç‚¹
- **çŠ¶æ€**: âŒ å‰ç«¯ä¸æ”¯æŒ

---

## ä¸‰ã€ä¸»è¦é—®é¢˜æ±‡æ€»

### 3.1 èŠ‚ç‚¹ç±»å‹è¿‡å¤šå¯¼è‡´çš„å¤æ‚åº¦é—®é¢˜

**é—®é¢˜1: åŠŸèƒ½é‡å ä¸¥é‡**
```
AIèŠ‚ç‚¹é‡å :
- ai_chat vs ai_reply â†’ éƒ½æ˜¯ç”ŸæˆAIå›å¤
- intent â†’ å®é™…ä¸Šå¯ä»¥åˆå¹¶åˆ° ai_chat ä¸­

æ¶ˆæ¯èŠ‚ç‚¹é‡å :
- message_receive vs monitor â†’ éƒ½æ˜¯æ¥æ”¶æ¶ˆæ¯
- message_dispatch vs message_sync â†’ éƒ½æ˜¯å¤„ç†å¤šç›®æ ‡

é£é™©èŠ‚ç‚¹é‡å :
- risk_detect vs risk_handler â†’ éƒ½æ˜¯å¤„ç†é£é™©
- alert_save vs alert_notify vs alert_escalate â†’ éƒ½æ˜¯å‘Šè­¦ç›¸å…³
```

**é—®é¢˜2: èŠ‚ç‚¹ç±»å‹éš¾ä»¥ç»´æŠ¤**
- 32ç§èŠ‚ç‚¹ç±»å‹éœ€è¦ç»´æŠ¤32ä¸ªå¤„ç†å™¨
- å‰ç«¯éœ€è¦ä¸ºæ¯ç§èŠ‚ç‚¹å¼€å‘é…ç½®ç•Œé¢
- ç”¨æˆ·å­¦ä¹ æˆæœ¬é«˜ï¼Œæ–‡æ¡£å¤æ‚

**é—®é¢˜3: é…ç½®é€‰é¡¹æ··ä¹±**
- ç›¸ä¼¼åŠŸèƒ½çš„ä¸åŒèŠ‚ç‚¹é…ç½®ä¸ä¸€è‡´
- æŸäº›é…ç½®é€‰é¡¹åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸­é‡å¤å‡ºç°
- ç¼ºå°‘ç»Ÿä¸€çš„é…ç½®è§„èŒƒ

### 3.2 å‰åç«¯ä¸ä¸€è‡´é—®é¢˜

| ç±»åˆ« | åç«¯æ•°é‡ | å‰ç«¯æ•°é‡ | ç¼ºå¤± |
|------|---------|---------|------|
| AIèŠ‚ç‚¹ | 3 | 1 | 2 |
| é£é™©èŠ‚ç‚¹ | 5 | 1 | 4 |
| æ•°æ®èŠ‚ç‚¹ | 3 | 0 | 3 |
| ä»»åŠ¡èŠ‚ç‚¹ | 2 | 0 | 2 |
| **åˆè®¡** | **32** | **12** | **20** |

---

## å››ã€ä¼˜åŒ–å»ºè®®

### ğŸ¯ æ ¸å¿ƒä¼˜åŒ–æ–¹å‘ï¼šèŠ‚ç‚¹åˆå¹¶é‡æ„

ç”¨æˆ·çš„å»ºè®®éå¸¸æ­£ç¡®ï¼é€šè¿‡è®©å•ä¸ªèŠ‚ç‚¹æ”¯æŒ**å¤šä¸ªä»»åŠ¡/æ“ä½œ**ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ–èŠ‚ç‚¹ç±»å‹ã€‚

#### æ–¹æ¡ˆA: ä»»åŠ¡å¯¼å‘çš„èŠ‚ç‚¹è®¾è®¡

**è®¾è®¡ç†å¿µ**: æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª"æ‰§è¡Œå™¨"ï¼Œæ”¯æŒæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡ã€‚

**æ–°çš„èŠ‚ç‚¹æ¶æ„**:
```typescript
// æ ¸å¿ƒèŠ‚ç‚¹ç±»å‹ï¼ˆä»…6ç§ï¼‰
export const CORE_NODE_TYPES = {
  START: 'start',              // å¼€å§‹èŠ‚ç‚¹
  END: 'end',                  // ç»“æŸèŠ‚ç‚¹
  TASK: 'task',                // ä»»åŠ¡èŠ‚ç‚¹ï¼ˆæ”¯æŒå¤šä»»åŠ¡ï¼‰
  DECISION: 'decision',        // å†³ç­–èŠ‚ç‚¹
  PARALLEL: 'parallel',        // å¹¶è¡Œæ‰§è¡ŒèŠ‚ç‚¹
  SUBFLOW: 'subflow',          // å­æµç¨‹èŠ‚ç‚¹
};
```

**TaskèŠ‚ç‚¹çš„ä»»åŠ¡ç±»å‹å®šä¹‰**:
```typescript
export const TASK_TYPES = {
  // AIç›¸å…³ä»»åŠ¡
  AI_GENERATE: 'ai_generate',     // AIç”Ÿæˆå›å¤
  AI_INTENT: 'ai_intent',         // AIæ„å›¾è¯†åˆ«
  AI_ANALYZE: 'ai_analyze',       // AIæƒ…æ„Ÿ/é£é™©åˆ†æ

  // æ¶ˆæ¯ç›¸å…³ä»»åŠ¡
  MESSAGE_RECEIVE: 'msg_receive',  // æ¥æ”¶æ¶ˆæ¯
  MESSAGE_SEND: 'msg_send',        // å‘é€æ¶ˆæ¯
  MESSAGE_BROADCAST: 'msg_broadcast', // ç¾¤å‘æ¶ˆæ¯

  // æ•°æ®ç›¸å…³ä»»åŠ¡
  DATA_QUERY: 'data_query',        // æ•°æ®åº“æŸ¥è¯¢
  DATA_SAVE: 'data_save',          // æ•°æ®ä¿å­˜
  DATA_TRANSFORM: 'data_transform', // æ•°æ®è½¬æ¢

  // å‘Šè­¦ç›¸å…³ä»»åŠ¡
  ALERT_CREATE: 'alert_create',    // åˆ›å»ºå‘Šè­¦
  ALERT_SEND: 'alert_send',        // å‘é€å‘Šè­¦é€šçŸ¥
  ALERT_ESCALATE: 'alert_escalate', // å‘Šè­¦å‡çº§

  // ä»»åŠ¡ç›¸å…³
  HTTP_REQUEST: 'http_request',    // HTTPè¯·æ±‚
  TASK_ASSIGN: 'task_assign',      // ä»»åŠ¡åˆ†é…
  HUMAN_HANDOVER: 'human_handover', // äººå·¥è½¬æ¥
};
```

**TaskèŠ‚ç‚¹ç¤ºä¾‹**:
```javascript
{
  id: 'node_001',
  type: 'task',
  data: {
    name: 'æ¶ˆæ¯å¤„ç†ä¸AIå›å¤',
    description: 'æ¥æ”¶æ¶ˆæ¯â†’æ„å›¾è¯†åˆ«â†’AIå›å¤â†’å‘é€',
    tasks: [
      {
        type: 'message_receive',
        config: { saveToDatabase: true }
      },
      {
        type: 'ai_intent',
        config: { modelId: 'doubao-pro-4k' },
        dependsOn: 'message_receive' // ä¾èµ–ä¸Šä¸€ä¸ªä»»åŠ¡
      },
      {
        type: 'ai_generate',
        config: { modelId: 'doubao-pro-4k', temperature: 0.7 },
        dependsOn: 'ai_intent'
      },
      {
        type: 'message_send',
        config: { robotId: 'robot_001' },
        dependsOn: 'ai_generate'
      }
    ],
    executionMode: 'sequential' // é¡ºåºæ‰§è¡Œ
  }
}
```

#### æ–¹æ¡ˆB: æ’ä»¶åŒ–èŠ‚ç‚¹è®¾è®¡

**è®¾è®¡ç†å¿µ**: æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª"å®¹å™¨"ï¼Œå¯ä»¥æŒ‚è½½å¤šä¸ªæ’ä»¶ã€‚

```javascript
{
  id: 'node_001',
  type: 'processor',
  data: {
    name: 'æ™ºèƒ½å®¢æœå¤„ç†èŠ‚ç‚¹',
    plugins: [
      {
        type: 'message-receiver',
        priority: 1
      },
      {
        type: 'ai-analyzer',
        config: {
          analysisTypes: ['intent', 'emotion', 'risk']
        }
      },
      {
        type: 'response-generator',
        config: {
          model: 'doubao-pro-4k'
        }
      },
      {
        type: 'message-sender',
        priority: 100
      }
    ]
  }
}
```

### 4.2 çŸ­æœŸä¼˜åŒ–æ–¹æ¡ˆï¼ˆæ¸è¿›å¼ï¼‰

å¦‚æœä¸è¿›è¡Œå¤§è§„æ¨¡é‡æ„ï¼Œå¯ä»¥é‡‡ç”¨æ¸è¿›å¼ä¼˜åŒ–ï¼š

#### é˜¶æ®µ1: åˆå¹¶ç›¸ä¼¼èŠ‚ç‚¹ï¼ˆå‡å°‘èŠ‚ç‚¹æ•°é‡ï¼‰

```javascript
// åˆå¹¶å‰: 32ç§
const OLD_NODE_TYPES = {
  AI_CHAT, AI_REPLY, INTENT,
  MESSAGE_RECEIVE, MESSAGE_DISPATCH, MESSAGE_SYNC,
  RISK_DETECT, RISK_HANDLER,
  ALERT_SAVE, ALERT_NOTIFY, ALERT_ESCALATE,
  // ... å…¶ä»–22ç§
};

// åˆå¹¶å: 12ç§
const NEW_NODE_TYPES = {
  START: 'start',
  END: 'end',
  PROCESSOR: 'processor',  // åˆå¹¶æ‰€æœ‰å¤„ç†èŠ‚ç‚¹
  DECISION: 'decision',    // åˆå¹¶ condition å’Œ decision
  ROUTER: 'router',       // åˆå¹¶ dispatch å’Œ sync
  ALERTER: 'alerter',     // åˆå¹¶æ‰€æœ‰å‘Šè­¦èŠ‚ç‚¹
  NOTIFIER: 'notifier',   // åˆå¹¶ notification å’Œ send_command
  COLLECTOR: 'collector', // åˆå¹¶ query å’Œ receive
  TRANSFORMER: 'transformer', // åˆå¹¶ transform å’Œ analyze
  ASSIGNER: 'assigner',   // åˆå¹¶ assign å’Œ handover
  MONITOR: 'monitor',
  GATEWAY: 'gateway'      // åˆå¹¶ httpã€subflowç­‰
};
```

#### é˜¶æ®µ2: ç»Ÿä¸€é…ç½®é€‰é¡¹

```javascript
// ç»Ÿä¸€çš„å¤„ç†å™¨é…ç½®
const PROCESSOR_CONFIG_SCHEMA = {
  tasks: [
    {
      type: 'ai_generate',
      config: {
        modelId: 'required',
        temperature: { default: 0.7, min: 0, max: 1 },
        maxTokens: { default: 1000, min: 1, max: 8000 },
        systemPrompt: 'optional',
        useContextHistory: { default: true }
      }
    },
    {
      type: 'message_send',
      config: {
        robotId: 'required',
        targets: 'required',
        saveLog: { default: true }
      }
    }
  ],
  executionMode: 'sequential | parallel',
  errorHandling: 'stop | continue | retry'
};
```

#### é˜¶æ®µ3: è¡¥å……ç¼ºå¤±çš„é…ç½®

1. **AI_REPLYèŠ‚ç‚¹**è¡¥å……:
   - `temperature` (0-1æ»‘å—)
   - `maxTokens` (è¾“å…¥æ¡†)
   - `personaId` (ä¸‹æ‹‰é€‰æ‹©)
   - `useContextHistory` (å¼€å…³)

2. **SEND_COMMANDèŠ‚ç‚¹**è¡¥å……:
   - `recipients` (å¤šé€‰)
   - `saveLog` (å¼€å…³)

3. **æ–°å¢èŠ‚ç‚¹é…ç½®**:
   - DATA_QUERYèŠ‚ç‚¹
   - DATA_TRANSFORMèŠ‚ç‚¹
   - ROBOT_DISPATCHèŠ‚ç‚¹

### 4.3 é•¿æœŸä¼˜åŒ–æ–¹æ¡ˆï¼šé‡æ„ä¸ºä»»åŠ¡æµå¼•æ“

**æ ¸å¿ƒæ€æƒ³**: å°†æµç¨‹å¼•æ“ä»"èŠ‚ç‚¹æµ"é‡æ„ä¸º"ä»»åŠ¡æµ"ã€‚

```javascript
// æ–°çš„æµç¨‹å®šä¹‰ç»“æ„
{
  id: 'flow_001',
  name: 'æ™ºèƒ½å®¢æœæµç¨‹',
  tasks: [
    {
      id: 'task_001',
      name: 'æ¶ˆæ¯æ¥æ”¶ä¸åˆ†æ',
      type: 'composite',  // å¤åˆä»»åŠ¡
      subtasks: [
        { type: 'message_receive', config: {...} },
        { type: 'ai_analyze', config: {...} }
      ],
      onError: 'fallback'
    },
    {
      id: 'task_002',
      name: 'æ„å›¾è¯†åˆ«',
      type: 'ai_intent',
      config: {...},
      dependsOn: ['task_001']
    },
    {
      id: 'task_003',
      name: 'æ™ºèƒ½å›å¤',
      type: 'parallel',  // å¹¶è¡Œä»»åŠ¡
      branches: [
        { type: 'ai_generate', config: {...} },
        { type: 'alert_check', config: {...} }
      ],
      dependsOn: ['task_002']
    }
  ]
}
```

---

## äº”ã€ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. **è¡¥å…¨AI_REPLYèŠ‚ç‚¹é…ç½®**
   - ä½ç½®: `src/app/flow-engine/components/NodeConfigPanel.tsx`
   - å½±å“: å½±å“æ‰€æœ‰AIå›å¤èŠ‚ç‚¹çš„ä½¿ç”¨
   - å·¥ä½œé‡: 2å°æ—¶

2. **æ·»åŠ ROBOT_DISPATCHèŠ‚ç‚¹æ”¯æŒ**
   - ä½ç½®: `src/app/flow-engine/types.ts` + `NodeConfigPanel.tsx`
   - å½±å“: æ”¯æŒæœºå™¨äººåˆ†å‘åŠŸèƒ½
   - å·¥ä½œé‡: 3å°æ—¶

3. **ç»Ÿä¸€èŠ‚ç‚¹é…ç½®éªŒè¯**
   - ä½ç½®: `src/app/flow-engine/types.ts`
   - å½±å“: é˜²æ­¢é…ç½®é”™è¯¯
   - å·¥ä½œé‡: 4å°æ—¶

### ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸæ‰§è¡Œï¼‰

1. **åˆå¹¶ç›¸ä¼¼èŠ‚ç‚¹ç±»å‹**
   - å‡å°‘32ç§â†’12ç§
   - å½±å“åç«¯ `flow-engine.service.js`
   - å·¥ä½œé‡: 2å¤©

2. **è¡¥å……ç¼ºå¤±èŠ‚ç‚¹çš„å‰ç«¯æ”¯æŒ**
   - DATA_QUERYã€DATA_TRANSFORMç­‰
   - å·¥ä½œé‡: 3å¤©

3. **å®ç°é…ç½®é€‰é¡¹çš„è‡ªåŠ¨éªŒè¯**
   - åŸºäºSchemaçš„æ ¡éªŒ
   - å·¥ä½œé‡: 2å¤©

### ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸè§„åˆ’ï¼‰

1. **é‡æ„ä¸ºä»»åŠ¡æµå¼•æ“**
   - å½»åº•æ”¹å˜æ¶æ„
   - å·¥ä½œé‡: 2å‘¨

2. **æ’ä»¶åŒ–èŠ‚ç‚¹ç³»ç»Ÿ**
   - æ”¯æŒè‡ªå®šä¹‰æ’ä»¶
   - å·¥ä½œé‡: 1å‘¨

---

## å…­ã€é£é™©è¯„ä¼°

| ä¼˜åŒ–æ–¹æ¡ˆ | é£é™©ç­‰çº§ | é£é™©æè¿° | ç¼“è§£æªæ–½ |
|---------|---------|---------|---------|
| è¡¥å…¨é…ç½® | ä½ | å¯èƒ½å¼•å…¥æ–°çš„é…ç½®é”™è¯¯ | å¢åŠ å•å…ƒæµ‹è¯• |
| åˆå¹¶èŠ‚ç‚¹ | ä¸­ | å¯èƒ½ç ´åç°æœ‰æµç¨‹ | æä¾›è¿ç§»è„šæœ¬ |
| é‡æ„æ¶æ„ | é«˜ | å¯èƒ½å½±å“æ‰€æœ‰ç”¨æˆ· | å……åˆ†æµ‹è¯•ï¼Œç°åº¦å‘å¸ƒ |

---

## ä¸ƒã€æ€»ç»“ä¸å»ºè®®

### 7.1 å½“å‰çŠ¶æ€æ€»ç»“

- âœ… åç«¯å®ç°äº†32ç§èŠ‚ç‚¹ç±»å‹
- âŒ å‰ç«¯ä»…æ”¯æŒ12ç§ï¼Œç¼ºå¤±20ç§
- âš ï¸ èŠ‚ç‚¹é…ç½®é€‰é¡¹ä¸å®Œæ•´
- âš ï¸ å­˜åœ¨å¤§é‡åŠŸèƒ½é‡å 

### 7.2 æ ¸å¿ƒå»ºè®®

**é‡‡ç”¨æ–¹æ¡ˆAï¼ˆä»»åŠ¡å¯¼å‘çš„èŠ‚ç‚¹è®¾è®¡ï¼‰**ä½œä¸ºé•¿æœŸç›®æ ‡ï¼Œå…·ä½“æ­¥éª¤ï¼š

1. **çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰**: è¡¥å…¨ç°æœ‰èŠ‚ç‚¹çš„é…ç½®é€‰é¡¹
2. **ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰**: åˆå¹¶ç›¸ä¼¼èŠ‚ç‚¹ï¼Œå‡å°‘åˆ°12ç§
3. **é•¿æœŸï¼ˆ2-3ä¸ªæœˆï¼‰**: é‡æ„ä¸ºä»»åŠ¡æµå¼•æ“ï¼Œæ”¯æŒå¤šä»»åŠ¡èŠ‚ç‚¹

### 7.3 ç”¨æˆ·ä½“éªŒæ”¹è¿›

é€šè¿‡èŠ‚ç‚¹åˆå¹¶å’Œä¼˜åŒ–ï¼Œé¢„æœŸæ”¹è¿›ï¼š
- ğŸ“‰ èŠ‚ç‚¹ç±»å‹: 32ç§ â†’ 12ç§ â†’ 6ç§
- ğŸ“ˆ å­¦ä¹ æˆæœ¬: é™ä½60%
- ğŸ“ˆ é…ç½®å¤æ‚åº¦: é™ä½50%
- ğŸ“ˆ æµç¨‹å¯è¯»æ€§: æå‡40%

---

## é™„å½•

### A. åç«¯èŠ‚ç‚¹å¤„ç†å™¨æ˜ å°„è¡¨

| èŠ‚ç‚¹ç±»å‹ | å¤„ç†å™¨å‡½æ•° | å‰ç«¯æ”¯æŒ | çŠ¶æ€ |
|---------|----------|---------|------|
| start | handleStartNode | âŒ | âœ… |
| end | handleEndNode | âœ… | âœ… |
| ai_chat | handleAIChatNode | âŒ | âœ… |
| ai_reply | handleAIReplyNode | âœ… | âœ… |
| intent | handleIntentNode | âœ… | âœ… |
| message_receive | handleMessageReceiveNode | âœ… | âœ… |
| decision | handleDecisionNode | âœ… | âœ… |
| robot_dispatch | handleRobotDispatchNode | âŒ | âœ… |
| send_command | handleSendCommandNode | âœ… | âš ï¸ |
| alert_save | handleAlertSaveNode | âœ… | âœ… |
| data_query | handleDataQueryNode | âŒ | âœ… |
| data_transform | handleDataTransformNode | âŒ | âœ… |

### B. é…ç½®é€‰é¡¹å¯¹æ¯”è¡¨

| èŠ‚ç‚¹ç±»å‹ | åç«¯é…ç½® | å‰ç«¯é…ç½® | åŒ¹é…åº¦ |
|---------|---------|---------|--------|
| intent | supportedIntents, modelId | supportedIntents, modelId | âœ… 100% |
| ai_reply | modelId, temperature, maxTokens, personaId | modelId | âš ï¸ 40% |
| send_command | commandType, recipients, robotId | commandType, robotId | âš ï¸ 67% |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-02-06  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0  
**åˆ†æå·¥å…·**: äººå·¥ä»£ç å®¡æŸ¥
