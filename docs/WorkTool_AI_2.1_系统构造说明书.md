# WorkTool AI 2.0 ä¸­æ¢ç³»ç»Ÿ - æ„é€ è¯´æ˜ä¹¦ï¼ˆå®Œæ•´ç‰ˆï¼‰

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.1
- **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-04
- **æœ€åæ›´æ–°**ï¼š2025-01-04
- **æ–‡æ¡£çŠ¶æ€**ï¼šæ­£å¼ç‰ˆ
- **åŸºäºç‰ˆæœ¬**ï¼šv1.0 â†’ v2.1ï¼ˆé‡å¤§å‡çº§ï¼‰
- **æ ¸å¿ƒç‰¹æ€§**ï¼šAIä¸ºæ ¸å¿ƒï¼Œæ”¯æŒå¤šå…¥å£å¯¹æ¥ã€å¯è§†åŒ–ç¼–æ’ã€é«˜å¯æ‰©å±•

---

## ğŸ“– ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
2. [2.1ç‰ˆæœ¬æ ¸å¿ƒå‡çº§](#2-21ç‰ˆæœ¬æ ¸å¿ƒå‡çº§)
3. [ç³»ç»Ÿæ¶æ„](#3-ç³»ç»Ÿæ¶æ„)
4. [AIç³»ç»Ÿæ¶æ„ï¼ˆæ ¸å¿ƒï¼‰](#4-aiç³»ç»Ÿæ¶æ„æ ¸å¿ƒ)
5. [èŠ‚ç‚¹æµç¨‹å¼•æ“](#5-èŠ‚ç‚¹æµç¨‹å¼•æ“)
6. [æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
7. [åŒç›‘æ§é¢æ¿ç³»ç»Ÿ](#7-åŒç›‘æ§é¢æ¿ç³»ç»Ÿ)
8. [å®‰å…¨ä½“ç³»](#8-å®‰å…¨ä½“ç³»)
9. [æ€§èƒ½ä¼˜åŒ–](#9-æ€§èƒ½ä¼˜åŒ–)
10. [APIæ¥å£è®¾è®¡](#10-apiæ¥å£è®¾è®¡)
11. [éƒ¨ç½²æ¶æ„](#11-éƒ¨ç½²æ¶æ„)
12. [å¼€å‘è§„èŒƒ](#12-å¼€å‘è§„èŒƒ)
13. [è¿ç»´ç›‘æ§](#13-è¿ç»´ç›‘æ§)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½

WorkTool AI 2.0 ä¸­æ¢ç³»ç»Ÿæ˜¯ä¸€ä¸ª**ä»¥AIä¸ºæ ¸å¿ƒ**çš„ä¼ä¸šçº§æœºå™¨äººè¿è¥å¹³å°ï¼Œé€šè¿‡**å¤šAIæœåŠ¡å…¥å£**ã€**å¯è§†åŒ–æµç¨‹ç¼–æ’**ã€**å…¨é“¾è·¯æ•°æ®è¿½è¸ª**ã€**åŒç›‘æ§é¢æ¿**ç­‰æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ç°æ™ºèƒ½åŒ–ã€å¯è§†åŒ–ã€å¯è¿½æº¯ã€é«˜å¹¶å‘çš„æ¶ˆæ¯å¤„ç†å’Œå®¢æœç®¡ç†ã€‚

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ¤– **AIä¸ºæ ¸å¿ƒ**ï¼šæ”¯æŒå¤šç§AIæä¾›å•†ï¼Œçµæ´»é…ç½®æ¨¡å‹å’Œè§’è‰²
- ğŸ¯ **å¤šåœºæ™¯è¦†ç›–**ï¼šç¤¾ç¾¤è¿è¥ã€å”®åå¤„ç†ã€è½¬åŒ–å®¢æœç­‰å…¨åœºæ™¯æ”¯æŒ
- ğŸ”„ **å¯è§†åŒ–ç¼–æ’**ï¼šèŠ‚ç‚¹æµç¨‹å¼•æ“ï¼Œæ”¯æŒæ‹–æ‹½é…ç½®ï¼Œæ— éœ€å†™ä»£ç 
- ğŸ“Š **å…¨é“¾è·¯è¿½è¸ª**ï¼šä»æ¶ˆæ¯æ¥æ”¶åˆ°å›å¤å®Œæˆçš„å®Œæ•´æ•°æ®è¿½è¸ª
- âš¡ **é«˜å¹¶å‘æ”¯æŒ**ï¼šæ¶ˆæ¯é˜Ÿåˆ— + é™æµæœºåˆ¶ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯
- ğŸ›¡ï¸ **é«˜ç¨³å®šæ€§**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†ã€é™çº§ç­–ç•¥ã€å¥åº·æ£€æŸ¥

### 1.2 æ ¸å¿ƒèƒ½åŠ›ï¼ˆv2.1ï¼‰

#### 1.2.1 AIæ™ºèƒ½å›å¤ç³»ç»Ÿï¼ˆæ ¸å¿ƒèƒ½åŠ›ï¼‰
- âœ… **å¤šAIæœåŠ¡å…¥å£**ï¼šæ”¯æŒé˜¿é‡Œäº‘åƒé—®ã€åƒé—®PROè‡ªå®šä¹‰ã€OpenAIã€Claudeã€è‡ªå®šä¹‰æ¨¡å‹
- âœ… **7ä¸ªé¢„è®¾è§’è‰²**ï¼šç¤¾ç¾¤è¿è¥ã€å”®åå¤„ç†ã€è½¬åŒ–å®¢æœã€ä¸“ä¸šå®¢æœã€å‹å¥½åŠ©æ‰‹ã€æŠ€æœ¯é¡¾é—®ã€åƒé—®PROè‡ªå®šä¹‰
- âœ… **è§’è‰²ç‰ˆæœ¬ç®¡ç†**ï¼šæ”¯æŒè§’è‰²é…ç½®ç‰ˆæœ¬ç®¡ç†ã€å†å²æŸ¥è¯¢ã€å›æ»š
- âœ… **100+è¯æœ¯æ¨¡æ¿**ï¼š24ç±»åœºæ™¯ï¼Œ100+æ¡è¯æœ¯æ¨¡æ¿ï¼Œæ”¯æŒå˜é‡æ›¿æ¢
- âœ… **AIè°ƒè¯•å·¥å…·**ï¼šæ”¯æŒæ„å›¾è¯†åˆ«æµ‹è¯•ã€å›å¤ç”Ÿæˆæµ‹è¯•ã€æ‰¹é‡æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
- âœ… **åƒäººå›å¤**ï¼šåŸºäºåƒé—®PROå¾®è°ƒï¼Œå…·å¤‡è§’è‰²äººè®¾ã€ä¸Šä¸‹æ–‡ç†è§£ã€æƒ…æ„Ÿåˆ†æèƒ½åŠ›

#### 1.2.2 èŠ‚ç‚¹æµç¨‹å¼•æ“
- âœ… **8èŠ‚ç‚¹æµç¨‹å¼•æ“**ï¼šå¯è§†åŒ–ç¼–æ’æ¶ˆæ¯å¤„ç†æµç¨‹
- âœ… **3å¤§ä¸šåŠ¡æµç¨‹**ï¼šå‘Šè­¦æµç¨‹ã€å®¢æœå›å¤æµç¨‹ã€æŒ‡ä»¤æ‰§è¡Œæµç¨‹
- âœ… **æ¡ä»¶åˆ†æ”¯**ï¼šå†³ç­–èŠ‚ç‚¹æ”¯æŒæ¡ä»¶è¡¨è¾¾å¼ã€å¹¶è¡Œåˆ†æ”¯
- âœ… **æµç¨‹æ¨¡æ¿**ï¼šæ”¯æŒå®¢æœ/å‘Šè­¦/è½¬å‘ç­‰æµç¨‹æ¨¡æ¿
- âœ… **çƒ­æ›´æ–°**ï¼šæµç¨‹é…ç½®å˜æ›´ä¸å½±å“æ­£åœ¨æ‰§è¡Œçš„å®ä¾‹

#### 1.2.3 å…¨é“¾è·¯æ•°æ®è¿½è¸ª
- âœ… **ç»Ÿä¸€messageIdè¿½è¸ª**ï¼šè´¯ç©¿æ•´ä¸ªæµç¨‹çš„å”¯ä¸€æ ‡è¯†
- âœ… **å®Œæ•´AIäº¤äº’è®°å½•**ï¼šæ‰€æœ‰AIè¾“å…¥è¾“å‡ºå…¥åº“ï¼ŒåŒ…å«request_idã€å“åº”æ—¶é—´ã€tokenä½¿ç”¨é‡
- âœ… **æŒ‡ä»¤çŠ¶æ€è¿½è¸ª**ï¼šæœºå™¨äººæŒ‡ä»¤å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… **æ‰§è¡Œç»“æœå›è°ƒ**ï¼šå¼‚æ­¥å›è°ƒæœºåˆ¶ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- âœ… **æµç¨‹æ‰§è¡Œè¿½è¸ª**ï¼šæ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œæ—¶é—´ã€çŠ¶æ€ã€é”™è¯¯ä¿¡æ¯å®Œæ•´è®°å½•

#### 1.2.4 åŒç›‘æ§é¢æ¿
- âœ… **ä¸šåŠ¡æ¶ˆæ¯ç›‘æ§**ï¼šé¢å‘ä¸šåŠ¡äººå‘˜ï¼Œå±•ç¤ºç”¨æˆ·æ¶ˆæ¯å’Œæœºå™¨äººå›å¤
- âœ… **AIäº¤äº’ç›‘æ§**ï¼šé¢å‘æŠ€æœ¯äººå‘˜ï¼Œå±•ç¤ºå®Œæ•´çš„8èŠ‚ç‚¹æ‰§è¡Œé“¾è·¯
- âœ… **å®æ—¶æ¨é€**ï¼šWebSocketå®æ—¶æ›´æ–°ï¼Œæ— éœ€åˆ·æ–°
- âœ… **æ€§èƒ½åˆ†æ**ï¼šå„é˜¶æ®µè€—æ—¶ç»Ÿè®¡ã€ç“¶é¢ˆè¯†åˆ«
- âœ… **AIè°ƒç”¨ç›‘æ§**ï¼šAIè°ƒç”¨æ¬¡æ•°ã€æˆåŠŸç‡ã€å¹³å‡å“åº”æ—¶é—´ã€æˆæœ¬ç»Ÿè®¡

#### 1.2.5 é«˜å¹¶å‘æ”¯æŒ
- âœ… **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRedis Streamå®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†
- âœ… **é™æµæœºåˆ¶**ï¼šåŸºäºRedisçš„ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œæ”¯æŒå¤šç»´åº¦é™æµ
- âœ… **å¼‚æ­¥å¤„ç†**ï¼šæ‰€æœ‰æ‰§è¡ŒåŠ¨ä½œå¼‚æ­¥ï¼Œä¸é˜»å¡ä¸»æµç¨‹
- âœ… **Webhookç«‹å³è¿”å›**ï¼šWebhookæ¥æ”¶æ¶ˆæ¯åç«‹å³è¿”å›200

### 1.3 æŠ€æœ¯æ ˆï¼ˆv2.1ï¼‰

#### å‰ç«¯æŠ€æœ¯æ ˆ
| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| æ¡†æ¶ | Next.js 16.1.1 | App Router |
| UIåº“ | React 19.2.3 | UIæ¡†æ¶ |
| UIç»„ä»¶ | shadcn/ui | åŸºäºRadix UI |
| æ ·å¼ | Tailwind CSS 4 | æ ·å¼æ¡†æ¶ |
| çŠ¶æ€ç®¡ç† | Zustand | å…¨å±€çŠ¶æ€ç®¡ç† |
| è¡¨å• | react-hook-form + zod | è¡¨å•éªŒè¯ |
| å›¾è¡¨ | recharts | æ•°æ®å¯è§†åŒ– |
| æµç¨‹ç¼–æ’ | React Flow / X6 | å¯è§†åŒ–æµç¨‹ç¼–æ’ |
| ç¼–è¾‘å™¨ | Monaco Editor | ä»£ç ç¼–è¾‘ |
| HTTPå®¢æˆ·ç«¯ | axios | HTTPè¯·æ±‚ |

#### åç«¯æŠ€æœ¯æ ˆ
| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| æ¡†æ¶ | Fastify 5.7.2 | Webæ¡†æ¶ |
| ORM | Drizzle ORM 0.45.1 | æ•°æ®åº“ORM |
| æ•°æ®åº“ | PostgreSQL 8.16.3 | ä¸»æ•°æ®åº“ |
| ç¼“å­˜ | Redis (ioredis 5.9.2) | ç¼“å­˜+æ¶ˆæ¯é˜Ÿåˆ—+é™æµ |
| AIé›†æˆ | OpenAI SDK 6.17.0 | AIæœåŠ¡é›†æˆ |
| é˜¿é‡Œäº‘é›†æˆ | @alicloud/pop-core | é˜¿é‡Œäº‘åƒé—®é›†æˆ |
| è®¤è¯ | JWT + bcrypt | è®¤è¯æˆæƒ |
| æ•°æ®éªŒè¯ | zod | æ•°æ®éªŒè¯ |
| å¯¹è±¡å­˜å‚¨ | AWS S3 SDK | æ–‡ä»¶å­˜å‚¨ |

#### å¼€å‘å·¥å…·
| å·¥å…· | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| åŒ…ç®¡ç†å™¨ | pnpm 9.0.0 | åŒ…ç®¡ç† |
| TypeScript | 5.x | ç±»å‹ç³»ç»Ÿ |
| è¿è¡Œç¯å¢ƒ | Node.js 24 | è¿è¡Œç¯å¢ƒ |

---

## 2. 2.1ç‰ˆæœ¬æ ¸å¿ƒå‡çº§

### 2.1 AIç³»ç»Ÿæ¶æ„å‡çº§

**v2.0é—®é¢˜**ï¼š
- AIè®¾è®¡è¿‡äºç®€å•ï¼Œåªæ˜¯è¾…åŠ©åŠŸèƒ½
- ä¸æ”¯æŒå¤šAIæä¾›å•†
- ä¸æ”¯æŒè§’è‰²é…ç½®å’Œç‰ˆæœ¬ç®¡ç†
- è¯æœ¯æ¨¡æ¿ä¸å®Œå–„

**v2.1æ”¹è¿›**ï¼š
```
AIç³»ç»Ÿæ¶æ„ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ AIæœåŠ¡æŠ½è±¡å±‚
â”‚   â”œâ”€â”€ AIService æ¥å£
â”‚   â”œâ”€â”€ AliyunQwenProviderï¼ˆé˜¿é‡Œäº‘åƒé—®ï¼‰
â”‚   â”œâ”€â”€ QwenProProviderï¼ˆåƒé—®PROè‡ªå®šä¹‰ï¼‰
â”‚   â”œâ”€â”€ OpenAIProviderï¼ˆOpenAIï¼‰
â”‚   â”œâ”€â”€ ClaudeProviderï¼ˆAnthropic Claudeï¼‰
â”‚   â””â”€â”€ CustomProviderï¼ˆè‡ªå®šä¹‰æ¨¡å‹ï¼‰
â”‚
â”œâ”€â”€ AIé…ç½®ä¸­å¿ƒ
â”‚   â”œâ”€â”€ æ¨¡å‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ æ¨¡å‹CRUDï¼ˆæ‰‹åŠ¨æ·»åŠ /åˆ é™¤ï¼‰
â”‚   â”‚   â”œâ”€â”€ æ¨¡å‹å¥åº·æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ æ¨¡å‹ç‰ˆæœ¬ç®¡ç†
â”‚   â”‚   â””â”€â”€ æ¨¡å‹ç»Ÿè®¡ï¼ˆä½¿ç”¨é‡ã€æˆæœ¬ï¼‰
â”‚   â”œâ”€â”€ è§’è‰²ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ 7ä¸ªé¢„è®¾è§’è‰²
â”‚   â”‚   â”œâ”€â”€ è§’è‰²CRUD
â”‚   â”‚   â”œâ”€â”€ è§’è‰²ç‰ˆæœ¬ç®¡ç†
â”‚   â”‚   â””â”€â”€ è§’è‰²ç»Ÿè®¡ï¼ˆä½¿ç”¨é‡ã€æ»¡æ„åº¦ï¼‰
â”‚   â”œâ”€â”€ è¯æœ¯æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ 24ç±»è¯æœ¯åœºæ™¯
â”‚   â”‚   â”œâ”€â”€ 100+è¯æœ¯æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ å˜é‡æ›¿æ¢å¼•æ“
â”‚   â”‚   â””â”€â”€ è¯æœ¯æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ æ¨¡å‹-è§’è‰²ç»‘å®š
â”‚       â””â”€â”€ çµæ´»çš„ç»„åˆé…ç½®
â”‚
â””â”€â”€ AIè°ƒè¯•å·¥å…·
    â”œâ”€â”€ æ¨¡å‹é€‰æ‹©å™¨
    â”œâ”€â”€ è§’è‰²é€‰æ‹©å™¨
    â”œâ”€â”€ æ„å›¾è¯†åˆ«æµ‹è¯•
    â”œâ”€â”€ å›å¤ç”Ÿæˆæµ‹è¯•
    â”œâ”€â”€ æ‰¹é‡æµ‹è¯•
    â”œâ”€â”€ æ€§èƒ½æµ‹è¯•
    â””â”€â”€ å›å¤ä¼˜åŒ–å»ºè®®
```

**æ”¶ç›Š**ï¼š
- âœ… æ”¯æŒå¤šAIæä¾›å•†ï¼Œçµæ´»åˆ‡æ¢
- âœ… æ”¯æŒæ‰‹åŠ¨æ·»åŠ /åˆ é™¤AIæ¨¡å‹
- âœ… 7ä¸ªé¢„è®¾è§’è‰²ï¼Œè¦†ç›–å…¨åœºæ™¯
- âœ… è§’è‰²ç‰ˆæœ¬ç®¡ç†ï¼Œæ”¯æŒå›æ»š
- âœ… 100+è¯æœ¯æ¨¡æ¿ï¼Œåœºæ™¯å…¨è¦†ç›–
- âœ… AIåƒäººå›å¤ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- âœ… å®Œæ•´çš„è°ƒè¯•å·¥å…·ï¼Œå¿«é€Ÿè¿­ä»£

---

### 2.2 æ•°æ®åº“å‡çº§

**æ–°å¢è¡¨ï¼ˆv2.1ï¼‰**ï¼š
- `ai_models` - AIæ¨¡å‹é…ç½®è¡¨
- `ai_model_versions` - AIæ¨¡å‹ç‰ˆæœ¬å†å²è¡¨
- `ai_model_health_checks` - AIæ¨¡å‹å¥åº·æ£€æŸ¥è®°å½•è¡¨
- `ai_personas` - AIè§’è‰²é…ç½®è¡¨ï¼ˆ7ä¸ªé¢„è®¾è§’è‰²ï¼‰
- `ai_persona_versions` - AIè§’è‰²ç‰ˆæœ¬å†å²è¡¨
- `ai_message_templates` - AIè¯æœ¯æ¨¡æ¿è¡¨ï¼ˆ100+æ¨¡æ¿ï¼‰
- `ai_model_persona_bindings` - AIæ¨¡å‹-è§’è‰²ç»‘å®šè¡¨

**ä¼˜åŒ–è¡¨ï¼ˆv2.1ï¼‰**ï¼š
- `robots` - æ–°å¢persona_idå­—æ®µï¼Œç»‘å®šAIè§’è‰²

---

### 2.3 æ¶æ„å‡çº§

**v2.1æ¶æ„é‡ç‚¹**ï¼š

1. **AIä¸ºæ ¸å¿ƒ**ï¼š
   - AIæœåŠ¡æŠ½è±¡å±‚ï¼Œæ”¯æŒå¤šæä¾›å•†
   - AIé…ç½®ä¸­å¿ƒï¼Œç»Ÿä¸€ç®¡ç†æ¨¡å‹ã€è§’è‰²ã€è¯æœ¯
   - AIåƒäººå›å¤ï¼ŒåŸºäºåƒé—®PROå¾®è°ƒ

2. **æµç•…æ€§ä¿éšœ**ï¼š
   - Webhookç«‹å³è¿”å›200ï¼Œä¸é˜»å¡
   - æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å¤„ç†
   - æµç¨‹å¼•æ“æ”¯æŒå¹¶è¡Œåˆ†æ”¯
   - WebSocketå®æ—¶æ¨é€

3. **ç¨³å®šæ€§ä¿éšœ**ï¼š
   - Rediså¼ºåˆ¶ä½¿ç”¨ï¼Œæ— é™çº§
   - å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
   - æ¨¡å‹å¥åº·æ£€æŸ¥
   - è‡ªåŠ¨é‡è¿å’Œé‡è¯•
   - é™æµæœºåˆ¶ï¼Œé˜²æ­¢è¿‡è½½

4. **ä¸€è‡´æ€§ä¿éšœ**ï¼š
   - ç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼
   - ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰
   - ç»Ÿä¸€çš„APIè®¾è®¡
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
   - ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼

---

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾ï¼ˆv2.1ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WorkTool å¹³å°ï¼ˆå¤šæœºå™¨äººï¼‰                      â”‚
â”‚                  æœºå™¨äººæœåŠ¡ï¼ˆrobot_001, robot_002, ...ï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å›è°ƒä¸æŒ‡ä»¤é€šè®¯            â”‚
                    â”‚   (HTTP POST)              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åç«¯æœåŠ¡ (5001ç«¯å£)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è®¤è¯æˆæƒå±‚                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ JWTè®¤è¯ä¸­é—´ä»¶                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ RBACæƒé™ä¸­é—´ä»¶                                       â”‚  â”‚
â”‚  â”‚  â””â”€ å®¡è®¡æ—¥å¿—ä¸­é—´ä»¶                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Webhookæ¥æ”¶å±‚ï¼ˆç«‹å³è¿”å›200ï¼‰                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/worktool/callback/message    (æ¶ˆæ¯å›è°ƒ)          â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/worktool/callback/result    (æ‰§è¡Œç»“æœå›è°ƒ)       â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/worktool/callback/status    (ä¸Šä¸‹çº¿å›è°ƒ)         â”‚  â”‚
â”‚  â”‚  â””â”€ /api/worktool/callback/qrcode    (äºŒç»´ç å›è°ƒ)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ¶ˆæ¯é˜Ÿåˆ—å±‚ï¼ˆRedis Streamï¼‰                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ Webhooké˜Ÿåˆ—                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ æ„å›¾è¯†åˆ«é˜Ÿåˆ—                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ AIå›å¤é˜Ÿåˆ—                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ å‘Šè­¦é€šçŸ¥é˜Ÿåˆ—                                         â”‚  â”‚
â”‚  â”‚  â””â”€ æœºå™¨äººæŒ‡ä»¤é˜Ÿåˆ—                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é™æµå±‚ï¼ˆRedisä»¤ç‰Œæ¡¶ï¼‰                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ Webhooké™æµ                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ AIè°ƒç”¨é™æµ                                           â”‚  â”‚
â”‚  â”‚  â””â”€ æœºå™¨äººæŒ‡ä»¤é™æµ                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  èŠ‚ç‚¹æµç¨‹å¼•æ“å±‚                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ èŠ‚ç‚¹1: Webhookæ¥æ”¶ & æ¶ˆæ¯æ ‡å‡†åŒ–                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ èŠ‚ç‚¹2: æ„å›¾è¯†åˆ«AIï¼ˆçº¯ç†è§£ï¼‰                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ èŠ‚ç‚¹3: æ„å›¾å†³ç­–èŠ‚ç‚¹ï¼ˆæµç¨‹åˆ†å‘ï¼‰                      â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ å‘Šè­¦æµç¨‹ (4A-7A)                                 â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€ å®¢æœå›å¤æµç¨‹ (4B-7B)                             â”‚  â”‚
â”‚  â”‚  â””â”€ æ‰§è¡Œè¿½è¸ª                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AIæœåŠ¡æŠ½è±¡å±‚ï¼ˆå¤šå…¥å£æ”¯æŒï¼‰                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ AIService æ¥å£                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ AliyunQwenProvider (åƒé—®)                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ QwenProProvider (åƒé—®PROè‡ªå®šä¹‰)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ OpenAIProvider                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ ClaudeProvider                                       â”‚  â”‚
â”‚  â”‚  â””â”€ CustomProvider (è‡ªå®šä¹‰)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AIé…ç½®ä¸­å¿ƒ                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ æ¨¡å‹ç®¡ç†ï¼ˆæ‰‹åŠ¨æ·»åŠ /åˆ é™¤ï¼‰                             â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ æ¨¡å‹CRUD                                          â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ æ¨¡å‹å¥åº·æ£€æŸ¥                                       â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ æ¨¡å‹ç‰ˆæœ¬ç®¡ç†                                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€ æ¨¡å‹ç»Ÿè®¡ï¼ˆä½¿ç”¨é‡ã€æˆæœ¬ï¼‰                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ è§’è‰²ç®¡ç†ï¼ˆ7ä¸ªé¢„è®¾è§’è‰²ï¼‰                               â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ è§’è‰²CRUD                                          â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ è§’è‰²ç‰ˆæœ¬ç®¡ç†                                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€ è§’è‰²ç»Ÿè®¡ï¼ˆä½¿ç”¨é‡ã€æ»¡æ„åº¦ï¼‰                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ è¯æœ¯æ¨¡æ¿ç®¡ç†ï¼ˆ100+æ¨¡æ¿ï¼‰                              â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ è¯æœ¯CRUD                                          â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ å˜é‡æ›¿æ¢å¼•æ“                                       â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€ è¯æœ¯æµ‹è¯•å·¥å…·                                       â”‚  â”‚
â”‚  â”‚  â””â”€ æ¨¡å‹-è§’è‰²ç»‘å®š                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  APIè·¯ç”±å±‚ (RESTful)                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/robots/*          (æœºå™¨äººç®¡ç†)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/ai/models/*       (AIæ¨¡å‹ç®¡ç†)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/ai/personas/*     (AIè§’è‰²ç®¡ç†)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/ai/templates/*    (è¯æœ¯æ¨¡æ¿ç®¡ç†)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/ai/debugger/*     (AIè°ƒè¯•å·¥å…·)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/flows/*           (æµç¨‹ç®¡ç†)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/monitor/*         (ç›‘æ§æ•°æ®)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/auth/*            (è®¤è¯æˆæƒ)                     â”‚  â”‚
â”‚  â”‚  â””â”€ /api/admin/*           (ç®¡ç†åå°)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æœåŠ¡å±‚                                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ worktool.service.js      (WorkTool APIè°ƒç”¨)           â”‚  â”‚
â”‚  â”‚  â”œâ”€ robot.service.js         (æœºå™¨äººç®¡ç†)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ robot-command.service.js (æŒ‡ä»¤é˜Ÿåˆ—ç®¡ç†)               â”‚  â”‚
â”‚  â”‚  â”œâ”€ ai-service.js            (AIæœåŠ¡è°ƒç”¨)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ ai-model.service.js      (AIæ¨¡å‹ç®¡ç†)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ ai-persona.service.js    (AIè§’è‰²ç®¡ç†)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ ai-template.service.js   (è¯æœ¯æ¨¡æ¿ç®¡ç†)               â”‚  â”‚
â”‚  â”‚  â”œâ”€ flow-engine.service.js   (æµç¨‹å¼•æ“)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ notification.service.js  (é€šçŸ¥æœåŠ¡)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ websocket.service.js     (å®æ—¶æ¨é€)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ message-queue.service.js (æ¶ˆæ¯é˜Ÿåˆ—)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ rate-limiter.service.js  (é™æµæœåŠ¡)                   â”‚  â”‚
â”‚  â”‚  â””â”€ audit-log.service.js     (å®¡è®¡æ—¥å¿—)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ•°æ®å±‚                                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ PostgreSQL (ä¸»æ•°æ®åº“)                                â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ robots (æœºå™¨äºº)                                   â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ ai_models (AIæ¨¡å‹)                               â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ ai_personas (AIè§’è‰²)                             â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ ai_message_templates (è¯æœ¯æ¨¡æ¿)                   â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ flow_configs (æµç¨‹é…ç½®)                         â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ flow_executions (æµç¨‹æ‰§è¡Œè®°å½•)                  â”‚  â”‚
â”‚  â”‚  â”‚   â”œâ”€ ai_call_logs (AIè°ƒç”¨è®°å½•)                        â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€ ... (å…¶ä»–è¡¨)                                     â”‚  â”‚
â”‚  â”‚  â””â”€ Redis (å¼ºåˆ¶ä½¿ç”¨)                                     â”‚  â”‚
â”‚  â”‚       â”œâ”€ æ¶ˆæ¯é˜Ÿåˆ—                                         â”‚  â”‚
â”‚  â”‚       â”œâ”€ ç¼“å­˜                                             â”‚  â”‚
â”‚  â”‚       â”œâ”€ é™æµ                                             â”‚  â”‚
â”‚  â”‚       â””â”€â”€ ä¼šè¯                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   WebSocketæ¨é€            â”‚
                    â”‚   (å®æ—¶æ›´æ–°ç›‘æ§é¢æ¿)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯æœåŠ¡ (5000ç«¯å£)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è®¤è¯æˆæƒæ¨¡å—                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ ç™»å½•/ç™»å‡º                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ Tokenç®¡ç†                                             â”‚  â”‚
â”‚  â”‚  â””â”€ æƒé™æ§åˆ¶                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  çŠ¶æ€ç®¡ç†æ¨¡å—ï¼ˆZustandï¼‰                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ userStore                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ robotStore                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ aiModelStore                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ aiPersonaStore                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ aiTemplateStore                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ flowStore                                             â”‚  â”‚
â”‚  â”‚  â””â”€ wsStore                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AIç®¡ç†é¡µé¢                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ AIæ¨¡å‹ç®¡ç†ï¼ˆæ‰‹åŠ¨æ·»åŠ /åˆ é™¤ï¼‰                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ AIè§’è‰²ç®¡ç†ï¼ˆ7ä¸ªé¢„è®¾è§’è‰²ï¼‰                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ è¯æœ¯æ¨¡æ¿ç®¡ç†ï¼ˆ100+æ¨¡æ¿ï¼‰                              â”‚  â”‚
â”‚  â”‚  â””â”€ AIè°ƒè¯•å·¥å…·                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æµç¨‹ç¼–æ’é¡µé¢                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ å¯è§†åŒ–ç”»å¸ƒï¼ˆReact Flow / X6ï¼‰                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ èŠ‚ç‚¹é…ç½®é¢æ¿                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ æµç¨‹æ¨¡æ¿                                              â”‚  â”‚
â”‚  â”‚  â””â”€ æµç¨‹æµ‹è¯•                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç›‘æ§é¢æ¿                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ ä¸šåŠ¡æ¶ˆæ¯ç›‘æ§                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ AIäº¤äº’ç›‘æ§                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ æµç¨‹æ‰§è¡Œç›‘æ§                                          â”‚  â”‚
â”‚  â”‚  â””â”€ æ€§èƒ½ç»Ÿè®¡                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. AIç³»ç»Ÿæ¶æ„ï¼ˆæ ¸å¿ƒï¼‰

### 4.1 AIæœåŠ¡æŠ½è±¡å±‚

#### 4.1.1 AIService æ¥å£

```typescript
// AIæœåŠ¡æ¥å£ï¼ˆæ”¯æŒå¤šå…¥å£ï¼‰
interface AIService {
  // æ„å›¾è¯†åˆ«
  recognizeIntent(context: MessageContext): Promise<IntentResult>;
  
  // å®¢æœå›å¤
  generateReply(context: MessageContext, intent: string): Promise<ReplyResult>;
  
  // å‘½ä»¤è§£æï¼ˆå¯é€‰ï¼‰
  parseCommand(context: MessageContext): Promise<CommandResult>;
  
  // æµå¼å›å¤ï¼ˆå¯é€‰ï¼‰
  streamReply(context: MessageContext, intent: string): AsyncGenerator<string>;
  
  // å¥åº·æ£€æŸ¥
  healthCheck(): Promise<HealthCheckResult>;
}
```

#### 4.1.2 æ”¯æŒçš„AIæä¾›å•†

| æä¾›å•† | Provider ID | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|--------|-------------|------|----------|
| é˜¿é‡Œäº‘åƒé—® | aliyun | é€šç”¨å¤§æ¨¡å‹ | é€šç”¨åœºæ™¯ |
| åƒé—®PROè‡ªå®šä¹‰ | qwen_pro | åŸºäºåƒé—®PROå¾®è°ƒ | æ ¸å¿ƒä¸šåŠ¡åœºæ™¯ |
| OpenAI | openai | GPT-4, GPT-3.5 | å›½é™…åŒ–åœºæ™¯ |
| Claude | claude | Anthropic Claude | é«˜è´¨é‡å›å¤ |
| è‡ªå®šä¹‰ | custom | è‡ªå®šä¹‰è®­ç»ƒæ¨¡å‹ | ç‰¹æ®Šéœ€æ±‚ |

#### 4.1.3 AIæä¾›å•†å®ç°ç¤ºä¾‹

```typescript
// é˜¿é‡Œäº‘åƒé—®å®ç°
class AliyunQwenProvider implements AIService {
  async recognizeIntent(context: MessageContext): Promise<IntentResult> {
    const response = await this.callQwenAPI({
      model: 'qwen-plus',
      messages: [
        { role: 'system', content: this.getIntentSystemPrompt() },
        { role: 'user', content: context.messageContent }
      ]
    });
    
    return {
      intent: this.parseIntent(response.choices[0].message.content),
      confidence: 0.95,
      riskLevel: 'none'
    };
  }
  
  async generateReply(context: MessageContext, intent: string): Promise<ReplyResult> {
    const persona = await this.getPersona(context.robotId);
    const template = await this.getTemplate(persona.id, intent);
    
    const response = await this.callQwenAPI({
      model: 'qwen-plus',
      messages: [
        { role: 'system', content: persona.systemPrompt },
        { role: 'user', content: context.messageContent }
      ]
    });
    
    return {
      replyText: this.formatReply(response.choices[0].message.content, template),
      tokensUsed: response.usage.total_tokens
    };
  }
}

// åƒé—®PROè‡ªå®šä¹‰å®ç°
class QwenProProvider implements AIService {
  async recognizeIntent(context: MessageContext): Promise<IntentResult> {
    // ä½¿ç”¨åƒé—®PROè‡ªå®šä¹‰æ¨¡å‹è¿›è¡Œæ„å›¾è¯†åˆ«
    const response = await this.callQwenProAPI({
      model: 'qwen-pro-custom',
      messages: [
        { role: 'system', content: this.getIntentSystemPrompt() },
        { role: 'user', content: context.messageContent }
      ]
    });
    
    return {
      intent: this.parseIntent(response.choices[0].message.content),
      confidence: 0.98,  // åƒé—®PROè‡ªå®šä¹‰æ¨¡å‹ç½®ä¿¡åº¦æ›´é«˜
      riskLevel: 'none'
    };
  }
  
  async generateReply(context: MessageContext, intent: string): Promise<ReplyResult> {
    const persona = await this.getPersona(context.robotId);
    const template = await this.getTemplate(persona.id, intent);
    
    const response = await this.callQwenProAPI({
      model: 'qwen-pro-custom',
      messages: [
        { role: 'system', content: persona.systemPrompt },
        { role: 'user', content: context.messageContent }
      ]
    });
    
    return {
      replyText: this.formatReply(response.choices[0].message.content, template),
      tokensUsed: response.usage.total_tokens
    };
  }
}
```

---

### 4.2 AIæ¨¡å‹ç®¡ç†

#### 4.2.1 AIæ¨¡å‹é…ç½®æ¥å£

```typescript
interface AIModelConfig {
  // åŸºç¡€ä¿¡æ¯
  id: string;
  name: string;
  provider: AIProvider;
  displayName: string;
  description: string;
  
  // æ¨¡å‹ä¿¡æ¯
  modelName: string;
  modelType: ModelType;
  version: string;
  
  // è¿æ¥é…ç½®
  apiKey: string;
  apiSecret?: string;
  baseUrl: string;
  endpoint?: string;
  
  // èƒ½åŠ›é…ç½®
  capabilities: {
    intentRecognition: boolean;
    replyGeneration: boolean;
    commandParsing: boolean;
    streaming: boolean;
    multiModal: boolean;
    tools: boolean;
  };
  
  // æ€§èƒ½é…ç½®
  performance: {
    maxTokens: number;
    temperature: number;
    topP: number;
    frequencyPenalty: number;
    presencePenalty: number;
    timeout: number;
    retryTimes: number;
  };
  
  // ç¼“å­˜é…ç½®
  cache: {
    enabled: boolean;
    ttl: number;
    maxSize: number;
  };
  
  // é™æµé…ç½®
  rateLimit: {
    enabled: boolean;
    limit: number;
    window: number;
  };
  
  // çŠ¶æ€ç®¡ç†
  status: AIModelStatus;
  healthStatus: 'healthy' | 'degraded' | 'unhealthy';
  
  // ä½¿ç”¨ç»Ÿè®¡
  usage: {
    totalCalls: number;
    successCalls: number;
    failedCalls: number;
    avgResponseTime: number;
    totalTokens: number;
    lastUsedAt: Date;
  };
  
  // æˆæœ¬ç»Ÿè®¡
  cost: {
    totalCost: number;
    avgCostPerCall: number;
    currency: string;
  };
  
  // å…³è”é…ç½®
  linkedPersonas: string[];
  applicableRobots: string[];
  
  // ç‰ˆæœ¬ç®¡ç†
  version: number;
  isLatest: boolean;
  parentVersionId?: string;
  
  // å®¡è®¡
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}

enum AIProvider {
  ALIYUN = 'aliyun',
  QWEN_PRO = 'qwen_pro',
  OPENAI = 'openai',
  CLAUDE = 'claude',
  CUSTOM = 'custom'
}

enum ModelType {
  INTENT = 'intent',
  REPLY = 'reply',
  MULTI = 'multi'
}

enum AIModelStatus {
  ACTIVE = 'active',
  INACTIVE = 'inactive',
  TESTING = 'testing',
  DEPRECATED = 'deprecated'
}
```

#### 4.2.2 AIæ¨¡å‹ç®¡ç†API

**æ‰‹åŠ¨æ·»åŠ AIæ¨¡å‹**ï¼š
```typescript
POST /api/ai/models
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "name": "qwen-pro-custom",
  "provider": "qwen_pro",
  "displayName": "åƒé—®PROè‡ªå®šä¹‰æ¨¡å‹",
  "description": "åŸºäºåƒé—®PROå¾®è°ƒçš„å®¢æœæ¨¡å‹",
  "modelName": "qwen-pro-v1",
  "modelType": "multi",
  "version": "1.0.0",
  "apiKey": "sk-xxxxxxxx",
  "baseUrl": "https://dashscope.aliyuncs.com/api/v1",
  "capabilities": {
    "intentRecognition": true,
    "replyGeneration": true,
    "commandParsing": true,
    "streaming": true
  }
}
```

**åˆ é™¤AIæ¨¡å‹**ï¼š
```typescript
DELETE /api/ai/models/:modelId
```

**AIæ¨¡å‹å¥åº·æ£€æŸ¥**ï¼š
```typescript
POST /api/ai/models/:modelId/health-check
```

---

### 4.3 AIè§’è‰²ç®¡ç†

#### 4.3.1 7ä¸ªé¢„è®¾è§’è‰²

| ID | åç§° | åˆ†ç±» | æ ¸å¿ƒèƒ½åŠ› | æ¨èåœºæ™¯ |
|----|------|------|----------|----------|
| persona_community | ç¤¾ç¾¤è¿è¥ | community | ç¤¾ç¾¤ç»´æŠ¤ã€ç”¨æˆ·äº’åŠ¨ã€æ´»åŠ¨æ¨å¹¿ | ç¤¾ç¾¤äº’åŠ¨ã€æ°›å›´è¥é€  |
| persona_after_sales | å”®åå¤„ç† | after_sales | å”®åå’¨è¯¢ã€æŠ•è¯‰å¤„ç†ã€é€€æ¢è´§ | å”®åæ”¯æŒã€é—®é¢˜è§£å†³ |
| persona_conversion | è½¬åŒ–å®¢æœ | conversion | äº§å“å’¨è¯¢ã€éœ€æ±‚åˆ†æã€è½¬åŒ–å¼•å¯¼ | é”€å”®å’¨è¯¢ã€ä¿ƒæˆæˆäº¤ |
| persona_professional_cs | ä¸“ä¸šå®¢æœ | customer_service | äº§å“å’¨è¯¢ã€å”®åæ”¯æŒ | é€šç”¨å®¢æœåœºæ™¯ |
| persona_friendly_assistant | å‹å¥½åŠ©æ‰‹ | assistant | æ—¥å¸¸é—®ç­”ã€ç”Ÿæ´»å»ºè®® | æ—¥å¸¸å¯¹è¯ã€å¨±ä¹äº’åŠ¨ |
| persona_technical_consultant | æŠ€æœ¯é¡¾é—® | technical | æŠ€æœ¯æ”¯æŒã€æ•…éšœæ’æŸ¥ | æŠ€æœ¯é—®é¢˜è§£ç­” |
| persona_qwen_pro_custom | åƒé—®PROè‡ªå®šä¹‰ | custom | è‡ªå®šä¹‰èƒ½åŠ› | ç‰¹æ®Šåœºæ™¯ |

#### 4.3.2 è§’è‰²é…ç½®æ¥å£

```typescript
interface AIPersonaConfig {
  // åŸºç¡€ä¿¡æ¯
  id: string;
  name: string;
  displayName: string;
  description: string;
  category: PersonaCategory;
  isPreset: boolean;
  
  // è§’è‰²è®¾å®š
  persona: {
    role: string;
    personality: string;
    expertise: string[];
    background: string;
  };
  
  // è¯­æ°”è®¾å®š
  tone: {
    style: string;
    formality: 'formal' | 'casual' | 'mixed';
    useEmojis: boolean;
    emojiSet?: string;
  };
  
  // å›å¤åå¥½
  preferences: {
    length: 'concise' | 'moderate' | 'detailed';
    useExamples: boolean;
    useQuestions: boolean;
    useFormatting: boolean;
    includeGreeting: boolean;
    includeClosing: boolean;
  };
  
  // System Prompt
  systemPrompt: string;
  systemPromptTemplate?: string;
  
  // ç¤ºä¾‹å¯¹è¯ï¼ˆFew-shotï¼‰
  examples: {
    user: string;
    assistant: string;
    context?: string;
  }[];
  
  // å›å¤ç­–ç•¥
  replyStrategy: {
    mode: ReplyMode;
    maxLength: number;
    minLines?: number;
    maxLines?: number;
  };
  
  // å…³è”é…ç½®
  linkedModels: string[];
  applicableScenarios: string[];
  applicableRobots: string[];
  
  // çŠ¶æ€ç®¡ç†
  status: PersonaStatus;
  version: number;
  isLatest: boolean;
  
  // ç»Ÿè®¡
  stats: {
    totalUsages: number;
    avgUserSatisfaction: number;
    avgResponseTime: number;
  };
  
  // å®¡è®¡
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}
```

---

### 4.4 AIè¯æœ¯æ¨¡æ¿ç³»ç»Ÿ

#### 4.4.1 è¯æœ¯æ¨¡æ¿åˆ†ç±»

**ç¤¾ç¾¤è¿è¥ï¼ˆ8ç±»ï¼Œçº¦30æ¡ï¼‰**ï¼š
1. å…¥ç¾¤æ¬¢è¿è¯­
2. æ´»è·ƒç¤¾ç¾¤æ°›å›´
3. æ´»åŠ¨æ¨å¹¿
4. è¯é¢˜å‘èµ·
5. ç”¨æˆ·å¼•å¯¼
6. ç¾¤è§„æé†’
7. å¸¸è§é—®é¢˜è§£ç­”
8. æˆç»©åˆ†äº«

**å”®åå¤„ç†ï¼ˆ6ç±»ï¼Œçº¦25æ¡ï¼‰**ï¼š
1. ä½£é‡‘ç»“ç®—
2. è´¦å·é—®é¢˜å¤„ç†
3. äº§å“é—®é¢˜å¤„ç†
4. è§£çº¦æµç¨‹
5. æŠ•è¯‰å¤„ç†
6. å®¢æˆ·å®‰æŠš

**è½¬åŒ–å®¢æœï¼ˆ8ç±»ï¼Œçº¦40æ¡ï¼‰**ï¼š
1. é¡¹ç›®ä»‹ç»
2. æ‰“æ‹›å‘¼ä¸ç ´å†°
3. éœ€æ±‚æŒ–æ˜
4. äº§å“æ¨è
5. å¼‚è®®å¤„ç†
6. ä¿ƒæˆæˆäº¤
7. ç´§è¿«æ„Ÿè¥é€ 
8. è½¬åŒ–å¼•å¯¼

**å…±ç”¨è¯æœ¯ï¼ˆ2ç±»ï¼Œçº¦5æ¡ï¼‰**ï¼š
1. ç´§æ€¥é€šçŸ¥
2. é‡è¦å…¬å‘Š

#### 4.4.2 è¯æœ¯æ¨¡æ¿æ¥å£

```typescript
interface MessageTemplate {
  id: string;
  personaId: string;
  name: string;
  category: string;
  description: string;
  
  // æ¨¡æ¿å†…å®¹
  template: string;
  variables: string[];
  
  // æ¨¡æ¿é…ç½®
  tone: string;
  useEmojis: boolean;
  urgencyLevel: string;
  conversionFocus: boolean;
  callToAction: boolean;
  empathyLevel: string;
  
  // é€‚ç”¨åœºæ™¯
  scenarios: string[];
  
  // çŠ¶æ€ç®¡ç†
  status: string;
  version: number;
  isLatest: boolean;
  
  // ç»Ÿè®¡
  usageCount: number;
  successRate: number;
  
  // å®¡è®¡
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
  updatedBy: string;
}
```

#### 4.4.3 è¯æœ¯æ¨¡æ¿ç¤ºä¾‹

**ç¤¾ç¾¤è¿è¥ - å…¥ç¾¤æ¬¢è¿è¯­**ï¼š
```
ğŸ‰ æ¬¢è¿åŠ å…¥{group_name}ï¼æˆ‘æ˜¯è¿è¥å°åŠ©æ‰‹~

ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æ›´å¥½åœ°æœåŠ¡æ‚¨ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼ä¿®æ”¹ç¾¤æ˜µç§°ï¼š
ğŸ“ æ ¼å¼ï¼šè§†é¢‘å·åç§°+è”ç³»æ–¹å¼

âœ¨ ç¾¤è§„é€Ÿè§ˆï¼š
1ï¸âƒ£ ç¦æ­¢å‘å¸ƒå¹¿å‘Šã€å¤–é“¾åŠæ— å…³è¯é¢˜
2ï¸âƒ£ æ–‡æ˜å‘è¨€ï¼Œå°Šé‡ä»–äºº
3ï¸âƒ£ æœ‰é—®é¢˜ç›´æ¥@è¿è¥æˆ–ç§ä¿¡
4ï¸âƒ£ å·¥ä½œæ—¶é—´ï¼šå·¥ä½œæ—¥9:30-20:00ï¼Œå‘¨æ—¥ä¼‘æ¯

æœ‰ä»»ä½•é—®é¢˜éšæ—¶æ‰¾æˆ‘å“¦ï¼ğŸ’ª
```

**å”®åå¤„ç† - ä½£é‡‘ç»“ç®—**ï¼š
```
æ‚¨å¥½ï¼å…³äºä½£é‡‘ç»“ç®—ï¼Œæˆ‘ä¸ºæ‚¨è¯¦ç»†è¯´æ˜ä¸€ä¸‹ ğŸ“‹

ğŸ’° ä½£é‡‘è®¡ç®—å…¬å¼ï¼š
ä½£é‡‘ = ï¼ˆæˆäº¤é‡‘é¢ - é€€æ¬¾é‡‘é¢ï¼‰Ã— 2%

ğŸ“Š ç»“ç®—è§„åˆ™ï¼š
â€¢ ç»“ç®—å‘¨æœŸï¼š7æ—¥
â€¢ ç»“ç®—æ–¹å¼ï¼šæ‰“æ¬¾åˆ°å¾®ä¿¡æ”¶æ¬¾ç 
â€¢ æäº¤æ–¹å¼ï¼šå¯æ—¥ç»“ï¼Œä¹Ÿå¯ç´¯ç§¯å‡ å¤©ä¸€èµ·æäº¤

âœ… ä»Šå¤©æäº¤çš„è®¢å•å·²ç»“ç®—å®Œæˆï¼Œè¯·æŸ¥æ”¶ï¼

å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·éšæ—¶ç§ä¿¡æˆ‘ï¼Œæˆ‘ä¼šç¬¬ä¸€æ—¶é—´ä¸ºæ‚¨è§£å†³ ğŸ˜Š
```

**è½¬åŒ–å®¢æœ - é¡¹ç›®ä»‹ç»**ï¼š
```
æ‚¨å¥½ï¼å¾ˆé«˜å…´ä¸ºæ‚¨ä»‹ç»æˆ‘ä»¬çš„é¡¹ç›® ğŸ¯

ğŸ“± é¡¹ç›®åç§°ï¼šå¿«æ‰‹æ©±çª—ä»£è¿è¥å˜ç°é¡¹ç›®

âœ¨ æ ¸å¿ƒä¼˜åŠ¿ï¼š
ğŸ¯ æ— éœ€ç²‰ä¸ï¼Œæ–°æ‰‹ä¹Ÿèƒ½åš
ğŸ’° 0è´¹ç”¨ 0ä¿è¯é‡‘ 0æŠ¼é‡‘ 0è¿çº¦é‡‘
ğŸ“¦ æ— éœ€å›¤è´§å«ä»˜ï¼Œå‘è´§å”®åæˆ‘ä»¬å…¨åŒ…
ğŸš€ æ¯å¤©ä¸Šä¼ 5-10ä¸ªçˆ†æ¬¾ç´ æ+æŒ‚å•†å“é“¾æ¥

ğŸ’ æ”¶ç›Šæ¨¡å¼ï¼š
â€¢ ä½£é‡‘10%ï¼Œåœ¨å¹³å°è‡ªæ
â€¢ ç²‰ä¸è¾¾åˆ°1ä¸‡ï¼Œå¯é€‰æ‹©ç­¾çº¦ç»™å…¬å¸
â€¢ ç­¾çº¦ä»·æ ¼ï¼š1K-1W

ç°åœ¨åŠ å…¥ï¼Œç«‹å³å¼€å§‹èµšé’±ä¹‹æ—…ï¼ğŸ’°

æƒ³äº†è§£æ›´å¤šè¯¦æƒ…ï¼Œè¯·å›å¤"è¯¦æƒ…" ğŸ‘‡
```

---

### 4.5 AIè°ƒè¯•å·¥å…·

#### 4.5.1 åŠŸèƒ½æ¨¡å—

1. **æ¨¡å‹é€‰æ‹©å™¨**ï¼šé€‰æ‹©è¦æµ‹è¯•çš„AIæ¨¡å‹
2. **è§’è‰²é€‰æ‹©å™¨**ï¼šé€‰æ‹©è¦ä½¿ç”¨çš„è§’è‰²
3. **æµ‹è¯•æ¶ˆæ¯è¾“å…¥**ï¼šè¾“å…¥æµ‹è¯•æ¶ˆæ¯
4. **æ„å›¾è¯†åˆ«æµ‹è¯•**ï¼šæµ‹è¯•æ„å›¾è¯†åˆ«åŠŸèƒ½
5. **å›å¤ç”Ÿæˆæµ‹è¯•**ï¼šæµ‹è¯•å›å¤ç”ŸæˆåŠŸèƒ½
6. **æ‰¹é‡æµ‹è¯•**ï¼šæ‰¹é‡æµ‹è¯•å¤šæ¡æ¶ˆæ¯
7. **æ€§èƒ½æµ‹è¯•**ï¼šæµ‹è¯•æ¨¡å‹æ€§èƒ½
8. **å›å¤ä¼˜åŒ–å»ºè®®**ï¼šæä¾›å›å¤ä¼˜åŒ–å»ºè®®

#### 4.5.2 è°ƒè¯•å·¥å…·API

```typescript
// æµ‹è¯•æ„å›¾è¯†åˆ«
POST /api/ai/debugger/test-intent
{
  "modelId": "model_001",
  "personaId": "persona_community",
  "message": "ä»Šå¤©ç¾¤é‡Œå¥½å®‰é™"
}

// æµ‹è¯•å›å¤ç”Ÿæˆ
POST /api/ai/debugger/test-reply
{
  "modelId": "model_001",
  "personaId": "persona_community",
  "message": "ä»Šå¤©ç¾¤é‡Œå¥½å®‰é™",
  "intent": "community_engagement"
}

// æ‰¹é‡æµ‹è¯•
POST /api/ai/debugger/batch-test
{
  "modelId": "model_001",
  "personaId": "persona_community",
  "messages": ["æ¶ˆæ¯1", "æ¶ˆæ¯2", "æ¶ˆæ¯3"]
}

// æ€§èƒ½æµ‹è¯•
POST /api/ai/debugger/performance-test
{
  "modelId": "model_001",
  "requestCount": 100
}
```

---

## 5. èŠ‚ç‚¹æµç¨‹å¼•æ“

### 5.1 èŠ‚ç‚¹æµç¨‹æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WorkTool Webhookï¼ˆæ¶ˆæ¯å›è°ƒï¼‰                  â”‚
â”‚                  /api/worktool/callback/message?robotId={id}     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹1: æ¶ˆæ¯æ¥æ”¶     â”‚
                    â”‚  + æ•°æ®åº“å®Œæ•´ä¿å­˜    â”‚
                    â”‚  + ç«‹å³è¿”å›200       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  èŠ‚ç‚¹2: æ„å›¾AIåˆ†æ   â”‚
                    â”‚  ï¼ˆçº¯ç†è§£èŠ‚ç‚¹ï¼‰      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   èŠ‚ç‚¹3: æ„å›¾å†³ç­–    â”‚
                    â”‚   ï¼ˆæµç¨‹åˆ†å‘å™¨ï¼‰     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â†“               â†“               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è·¯å¾„Aï¼šå‘Šè­¦   â”‚ â”‚ è·¯å¾„Bï¼šå®¢æœ   â”‚ â”‚ è·¯å¾„Cï¼šæŒ‡ä»¤   â”‚
   â”‚   æµç¨‹       â”‚ â”‚   å›å¤æµç¨‹    â”‚ â”‚   æ‰§è¡Œæµç¨‹   â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“                â†“                â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ èŠ‚ç‚¹4A: å‘Šè­¦  â”‚ â”‚ èŠ‚ç‚¹4B: AI    â”‚ â”‚ èŠ‚ç‚¹8: æŒ‡ä»¤  â”‚
   â”‚   ç”Ÿæˆ       â”‚ â”‚  å®¢æœå›å¤     â”‚ â”‚   ç”Ÿæˆ       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“                â†“                â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ èŠ‚ç‚¹5A: å‘Šè­¦  â”‚ â”‚ èŠ‚ç‚¹5B: å‘é€  â”‚ â”‚ èŠ‚ç‚¹9: æŒ‡ä»¤  â”‚
   â”‚ è§„åˆ™åˆ¤æ–­     â”‚ â”‚  æ–¹å¼åˆ¤æ–­    â”‚ â”‚   å‘é€       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“                â†“                â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ èŠ‚ç‚¹6A: å‘Šè­¦  â”‚ â”‚ èŠ‚ç‚¹6B: æœºå™¨äººâ”‚ â”‚ èŠ‚ç‚¹10:ç»“æœ â”‚
   â”‚   æ‰§è¡Œ       â”‚ â”‚ æ¶ˆæ¯å‘é€     â”‚ â”‚   ç›‘å¬       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“                â†“                â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ èŠ‚ç‚¹7A: å‘Šè­¦  â”‚ â”‚ èŠ‚ç‚¹7B: å‘é€  â”‚ â”‚ èŠ‚ç‚¹11: ç»“æŸ â”‚
   â”‚ ç»“æœç›‘å¬     â”‚ â”‚  ç»“æœç›‘å¬     â”‚ â”‚              â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“                â†“                â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ èŠ‚ç‚¹8A: ç»“æŸ  â”‚ â”‚ èŠ‚ç‚¹8B: ç»“æŸ  â”‚ â”‚              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼

```typescript
interface MessageContext {
  // ===== æ¶ˆæ¯è¿½è¸ª =====
  messageId: string;
  sessionId: string;
  currentNodeId: string;
  previousNodeId: string;
  
  // ===== æ¶ˆæ¯æ¥æºä¿¡æ¯ =====
  robotId: string;
  groupName: string | null;
  userName: string;
  
  // ===== æ¶ˆæ¯å†…å®¹ =====
  messageType: 'text' | 'image' | 'file';
  messageContent: string;
  messageRaw: string;
  
  // ===== æ—¶é—´ä¿¡æ¯ =====
  timestamp: number;
  
  // ===== AIç›¸å…³ =====
  intent?: string;
  intentConfidence?: number;
  aiReply?: string;
  
  // ===== æ‰§è¡Œç»“æœ =====
  commandResult?: {
    status: 'pending' | 'success' | 'failed' | 'timeout';
    commandId: string;
    sentAt: number;
    completedAt?: number;
    errorReason?: string;
  };
  
  // ===== æœºå™¨äººé…ç½®ä¿¡æ¯ =====
  robotConfig: {
    apiBaseUrl: string;
    apiToken: string;
    webhookUrl: string;
    robotName: string;
    isActive: boolean;
    status: string;
    personaId?: string;  // ç»‘å®šçš„AIè§’è‰²ID
    aiModelId?: string;  // ç»‘å®šçš„AIæ¨¡å‹ID
  };
}
```

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 æ ¸å¿ƒæ•°æ®è¡¨ï¼ˆv2.1ï¼‰

#### 6.1.1 ai_models - AIæ¨¡å‹é…ç½®è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨AIæ¨¡å‹é…ç½®ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | varchar(36) | ä¸»é”® | PK |
| name | varchar(255) | æ¨¡å‹åç§° | UNIQUE |
| provider | varchar(50) | æä¾›å•† | INDEX |
| display_name | varchar(255) | æ˜¾ç¤ºåç§° | - |
| description | text | æè¿° | - |
| model_name | varchar(255) | æ¨¡å‹åç§° | - |
| model_type | varchar(50) | æ¨¡å‹ç±»å‹ | INDEX |
| version | varchar(50) | ç‰ˆæœ¬ | - |
| api_key | text | APIå¯†é’¥ï¼ˆåŠ å¯†ï¼‰ | - |
| base_url | varchar(500) | APIåŸºç¡€URL | - |
| capabilities | jsonb | èƒ½åŠ›é…ç½® | - |
| performance | jsonb | æ€§èƒ½é…ç½® | - |
| cache | jsonb | ç¼“å­˜é…ç½® | - |
| rate_limit | jsonb | é™æµé…ç½® | - |
| status | varchar(20) | çŠ¶æ€ | INDEX |
| health_status | varchar(20) | å¥åº·çŠ¶æ€ | - |
| usage | jsonb | ä½¿ç”¨ç»Ÿè®¡ | - |
| cost | jsonb | æˆæœ¬ç»Ÿè®¡ | - |
| linked_personas | text[] | å…³è”çš„è§’è‰²IDåˆ—è¡¨ | - |
| version | integer | ç‰ˆæœ¬å· | - |
| is_latest | boolean | æ˜¯å¦æœ€æ–° | - |
| parent_version_id | varchar(36) | çˆ¶ç‰ˆæœ¬ID | FK |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ | - |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ | - |
| created_by | varchar(36) | åˆ›å»ºäºº | FK |
| updated_by | varchar(36) | æ›´æ–°äºº | FK |

---

#### 6.1.2 ai_personas - AIè§’è‰²é…ç½®è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨AIè§’è‰²é…ç½®ä¿¡æ¯ï¼ˆ7ä¸ªé¢„è®¾è§’è‰²ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | varchar(36) | ä¸»é”® | PK |
| name | varchar(255) | è§’è‰²åç§° | UNIQUE |
| display_name | varchar(255) | æ˜¾ç¤ºåç§° | - |
| description | text | æè¿° | - |
| category | varchar(50) | åˆ†ç±» | INDEX |
| is_preset | boolean | æ˜¯å¦é¢„è®¾è§’è‰² | INDEX |
| persona | jsonb | è§’è‰²è®¾å®š | - |
| tone | jsonb | è¯­æ°”è®¾å®š | - |
| preferences | jsonb | å›å¤åå¥½ | - |
| system_prompt | text | System Prompt | - |
| examples | jsonb | ç¤ºä¾‹å¯¹è¯ | - |
| reply_strategy | jsonb | å›å¤ç­–ç•¥ | - |
| linked_models | text[] | å…³è”çš„æ¨¡å‹IDåˆ—è¡¨ | - |
| applicable_scenarios | text[] | é€‚ç”¨åœºæ™¯ | - |
| applicable_robots | text[] | é€‚ç”¨çš„æœºå™¨äººIDåˆ—è¡¨ | - |
| status | varchar(20) | çŠ¶æ€ | INDEX |
| version | integer | ç‰ˆæœ¬å· | - |
| is_latest | boolean | æ˜¯å¦æœ€æ–° | - |
| stats | jsonb | ç»Ÿè®¡ä¿¡æ¯ | - |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ | - |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ | - |
| created_by | varchar(36) | åˆ›å»ºäºº | FK |
| updated_by | varchar(36) | æ›´æ–°äºº | FK |

---

#### 6.1.3 ai_message_templates - AIè¯æœ¯æ¨¡æ¿è¡¨

**ç”¨é€”**ï¼šå­˜å‚¨AIè¯æœ¯æ¨¡æ¿ï¼ˆ100+æ¨¡æ¿ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | varchar(36) | ä¸»é”® | PK |
| persona_id | varchar(36) | è§’è‰²ID | FK, INDEX |
| name | varchar(255) | æ¨¡æ¿åç§° | - |
| category | varchar(50) | åˆ†ç±» | INDEX |
| description | text | æè¿° | - |
| template | text | æ¨¡æ¿å†…å®¹ | - |
| variables | text[] | å˜é‡åˆ—è¡¨ | - |
| tone | varchar(50) | è¯­æ°” | - |
| useEmojis | boolean | ä½¿ç”¨è¡¨æƒ… | - |
| urgencyLevel | varchar(20) | ç´§è¿«åº¦ | - |
| conversionFocus | boolean | è½¬åŒ–å¯¼å‘ | - |
| callToAction | boolean | è¡ŒåŠ¨å·å¬ | - |
| empathyLevel | varchar(20) | åŒç†å¿ƒç­‰çº§ | - |
| scenarios | text[] | é€‚ç”¨åœºæ™¯ | - |
| status | varchar(20) | çŠ¶æ€ | INDEX |
| version | integer | ç‰ˆæœ¬å· | - |
| isLatest | boolean | æ˜¯å¦æœ€æ–° | - |
| usage_count | integer | ä½¿ç”¨æ¬¡æ•° | - |
| success_rate | numeric(5,2) | æˆåŠŸç‡ | - |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ | - |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ | - |
| created_by | varchar(36) | åˆ›å»ºäºº | FK |
| updated_by | varchar(36) | æ›´æ–°äºº | FK |

---

#### 6.1.4 robots - æœºå™¨äººè¡¨ï¼ˆæ›´æ–°ï¼‰

**æ–°å¢å­—æ®µ**ï¼š
- `persona_id` - ç»‘å®šçš„AIè§’è‰²ID
- `ai_model_id` - ç»‘å®šçš„AIæ¨¡å‹ID

---

#### 6.1.5 å…¶ä»–æ ¸å¿ƒè¡¨

- `ai_model_versions` - AIæ¨¡å‹ç‰ˆæœ¬å†å²è¡¨
- `ai_persona_versions` - AIè§’è‰²ç‰ˆæœ¬å†å²è¡¨
- `ai_model_health_checks` - AIæ¨¡å‹å¥åº·æ£€æŸ¥è®°å½•è¡¨
- `ai_model_persona_bindings` - AIæ¨¡å‹-è§’è‰²ç»‘å®šè¡¨
- `flow_configs` - æµç¨‹é…ç½®è¡¨
- `flow_executions` - æµç¨‹æ‰§è¡Œè®°å½•è¡¨
- `ai_call_logs` - AIè°ƒç”¨è®°å½•è¡¨
- `session_messages` - ä¼šè¯æ¶ˆæ¯è®°å½•è¡¨
- `robotCommands` - æœºå™¨äººæŒ‡ä»¤è¡¨
- `callbackHistory` - å›è°ƒå†å²è®°å½•è¡¨
- `alertHistory` - å‘Šè­¦å†å²è¡¨

---

## 7. åŒç›‘æ§é¢æ¿ç³»ç»Ÿ

### 7.1 é¢æ¿1ï¼šä¸šåŠ¡æ¶ˆæ¯ç›‘æ§

**åŠŸèƒ½**ï¼š
- å±•ç¤ºç”¨æˆ·çš„åŸå§‹æ¶ˆæ¯
- å±•ç¤ºæœºå™¨äººçš„å›å¤æ¶ˆæ¯
- å±•ç¤ºæ¶ˆæ¯çš„æ‰§è¡ŒçŠ¶æ€
- æ”¯æŒæŒ‰æœºå™¨äººã€ç”¨æˆ·ã€ç¾¤ç»„ç­›é€‰
- æ”¯æŒå®æ—¶æ›´æ–°

### 7.2 é¢æ¿2ï¼šAIäº¤äº’ç›‘æ§

**åŠŸèƒ½**ï¼š
- å±•ç¤ºå®Œæ•´çš„AIäº¤äº’é“¾è·¯ï¼ˆ8ä¸ªé˜¶æ®µï¼‰
- å±•ç¤ºæ„å›¾è¯†åˆ«è¿‡ç¨‹
- å±•ç¤ºå®¢æœå›å¤è¿‡ç¨‹
- å±•ç¤ºæ‰€æœ‰AIè¾“å…¥è¾“å‡º
- æ”¯æŒè°ƒè¯•å’Œæ€§èƒ½åˆ†æ

---

## 8. å®‰å…¨ä½“ç³»

### 8.1 è®¤è¯æˆæƒ

- JWTè®¤è¯ä½“ç³»
- RBACæƒé™æ¨¡å‹
- å®¡è®¡æ—¥å¿—ç³»ç»Ÿ

### 8.2 æ•°æ®å®‰å…¨

- å¯†ç bcryptåŠ å¯†
- APIå¯†é’¥åŠ å¯†å­˜å‚¨
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡é…ç½®

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 ç¼“å­˜ç­–ç•¥

- Rediså¼ºåˆ¶ä½¿ç”¨
- ç»Ÿä¸€ç¼“å­˜ç­–ç•¥
- ç¼“å­˜é¢„çƒ­

### 9.2 æ•°æ®åº“ä¼˜åŒ–

- å®Œæ•´çš„ç´¢å¼•
- åˆ†é¡µæŸ¥è¯¢
- é¿å…N+1æŸ¥è¯¢

### 9.3 AIè¯·æ±‚ä¼˜åŒ–

- ç»“æœç¼“å­˜
- æ‰¹é‡å¤„ç†
- é™çº§ç­–ç•¥

---

## 10. APIæ¥å£è®¾è®¡

### 10.1 AIç®¡ç†API

- `/api/ai/models/*` - AIæ¨¡å‹ç®¡ç†
- `/api/ai/personas/*` - AIè§’è‰²ç®¡ç†
- `/api/ai/templates/*` - è¯æœ¯æ¨¡æ¿ç®¡ç†
- `/api/ai/debugger/*` - AIè°ƒè¯•å·¥å…·

### 10.2 æµç¨‹ç®¡ç†API

- `/api/flows/*` - æµç¨‹ç®¡ç†

### 10.3 ç›‘æ§API

- `/api/monitor/*` - ç›‘æ§æ•°æ®

---

## 11. éƒ¨ç½²æ¶æ„

### 11.1 ç«¯å£åˆ†é…

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯ | 5000 | Next.jså¼€å‘æœåŠ¡å™¨ |
| åç«¯ | 5001 | Fastify APIæœåŠ¡å™¨ |
| ç³»ç»ŸæœåŠ¡ | 9000 | å†…ç½®æœåŠ¡ï¼ˆç¦æ­¢ä½¿ç”¨ï¼‰ |

---

## 12. å¼€å‘è§„èŒƒ

### 12.1 ä»£ç è§„èŒƒ

- TypeScriptä¸¥æ ¼æ¨¡å¼
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- å®Œæ•´çš„ç±»å‹å®šä¹‰

### 12.2 æµ‹è¯•è§„èŒƒ

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%
- é›†æˆæµ‹è¯•
- E2Eæµ‹è¯•

---

## 13. è¿ç»´ç›‘æ§

### 13.1 å¥åº·æ£€æŸ¥

- `/health` - å¥åº·æ£€æŸ¥æ¥å£

### 13.2 ç›‘æ§æŒ‡æ ‡

- ä¸šåŠ¡æŒ‡æ ‡
- æ€§èƒ½æŒ‡æ ‡
- ç³»ç»ŸæŒ‡æ ‡

### 13.3 æ—¥å¿—è§„èŒƒ

- ç»“æ„åŒ–æ—¥å¿—
- ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼

---

## é™„å½•

### A. 7ä¸ªé¢„è®¾è§’è‰²è¯¦ç»†é…ç½®

è¯¦è§ï¼š`docs/AIè§’è‰²è¯¦ç»†é…ç½®.md`

### B. 100+è¯æœ¯æ¨¡æ¿åˆ—è¡¨

è¯¦è§ï¼š`docs/AIè¯æœ¯æ¨¡æ¿åˆ—è¡¨.md`

### C. æ•°æ®åº“è¿ç§»è„šæœ¬

è¯¦è§ï¼š`server/db/migrations/`

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.1  
**æœ€åæ›´æ–°**ï¼š2025-01-04  
**ç»´æŠ¤è€…**ï¼šWorkTool AI å¼€å‘å›¢é˜Ÿ
