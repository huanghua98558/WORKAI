# 登录超时问题排查指南

## 重要提示
**请先刷新浏览器页面！**（按 `F5` 或 `Ctrl+R`）

因为我们刚刚修改了代码并重启了服务，浏览器可能缓存了旧代码。

## 测试步骤

### 1. 刷新浏览器页面
在视频号转化页面按 `F5` 刷新页面。

### 2. 重新生成二维码
点击"生成二维码"按钮。

### 3. 扫码登录
使用微信扫描二维码，完成登录。

### 4. 观察结果

#### 预期结果
- 如果登录成功，应该显示"登录成功"
- 如果显示"登录超时"，请继续下面的步骤

### 5. 如果仍然显示"登录超时"

#### 方法1：检查后端日志
```bash
tail -n 50 /app/work/logs/bypass/app.log | grep -E "检测登录|页面内容|登录超时"
```

**预期日志**：
```
[检测登录] 页面内容: '登录超时，请重新 登录'
[检测登录] 页面显示登录超时: true
[检测登录] 最终登录状态: false
```

#### 方法2：检查前端控制台
1. 按 `F12` 打开开发者工具
2. 点击 "Console" 标签
3. 查看是否有错误信息

#### 方法3：完全清除缓存
1. 按 `Ctrl+Shift+Delete`（清除浏览器缓存）
2. 选择"缓存的图片和文件"
3. 点击"清除数据"
4. 刷新页面

## 可能的原因

### 原因1：浏览器缓存
**现象**：刷新页面后仍然显示旧的内容
**解决**：完全清除浏览器缓存

### 原因2：Service Worker缓存
**现象**：清除浏览器缓存后仍然显示旧内容
**解决**：
1. 打开开发者工具（F12）
2. 点击 "Application" 标签
3. 左侧选择 "Service Workers"
4. 点击 "Unregister"（如果有注册的Service Worker）
5. 刷新页面

### 原因3：代码未生效
**现象**：后端日志中没有"页面显示登录超时"的日志
**解决**：
1. 确认服务已重启
2. 检查代码是否正确修改

## 快速验证

### 验证1：检查代码是否修改
在浏览器中访问：
```
http://localhost:5000/api/video-channel/qrcode
```

如果返回二维码数据，说明服务正常运行。

### 验证2：检查后端日志
```bash
tail -n 10 /app/work/logs/bypass/app.log
```

应该看到最新的日志，时间戳应该是当前时间。

### 验证3：手动测试登录检测
```bash
curl -X POST http://localhost:5000/api/video-channel/check-login | python3 -m json.tool
```

查看返回的 `isLoggedIn` 和 `qrcodeExpired` 字段。

## 如果问题仍然存在

请提供以下信息：

### 1. 浏览器控制台日志
按 `F12` → Console 标签，截图并复制所有日志。

### 2. 后端日志
```bash
tail -n 100 /app/work/logs/bypass/app.log
```

### 3. 网络请求
按 `F12` → Network 标签，查找 `/api/video-channel/check-login` 请求，查看响应内容。

### 4. 页面截图
截图显示"登录超时"的页面。

## 临时解决方案

如果问题持续存在，可以尝试：

### 方案1：清除所有数据并重新开始
1. 点击"重新开始"按钮
2. 刷新浏览器页面
3. 重新生成二维码
4. 重新扫码登录

### 方案2：使用无痕模式
1. 打开无痕/隐私浏览模式
2. 访问视频号转化页面
3. 生成二维码并扫码登录

## 联系支持

如果以上方法都无法解决问题，请提供：
1. 完整的浏览器控制台日志
2. 完整的后端日志（最近100行）
3. 页面截图
4. 网络请求响应内容

以便我们进一步排查问题。
