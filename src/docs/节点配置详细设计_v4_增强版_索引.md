# 流程引擎节点配置详细设计 v4.0（增强版）- 文档索引

## 📚 文档结构

本增强版文档分为三个部分，共涵盖10个节点、65个动作的完整配置。

---

## 📖 第一部分：基础节点（节点1-3）

**文件路径**: `src/docs/节点配置详细设计_v4_增强版_第一部分.md`

### 包含内容：
- ✅ 文档说明与新增特性
- ✅ 节点体系架构
- ✅ **节点1: MESSAGE_ENTRY（消息入口）** - 6个动作
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点2: SMART_ANALYZE（智能分析）** - 6个动作
  - 意图识别、情绪分析、敏感信息检测、实体识别、工作人员识别、信息中心整合
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点3: FLOW_DECISION（流程决策）** - 6个动作
  - 意图路由、情绪路由、风险路由、工作人员路由、规则路由、决策结果输出
  - 自动模式配置
  - 前端UI配置表单（中文）

### 关键特性：
- 🎯 完整的自动模式配置（默认JSON代码）
- 🇨🇳 全中文UI配置表单，带有详细注释
- 📦 完整的输入/输出数据结构定义

---

## 📖 第二部分：业务与消息节点（节点4-7）

**文件路径**: `src/docs/节点配置详细设计_v4_增强版_第二部分.md`

### 包含内容：
- ✅ **节点4: AI_AGENT（AI代理）** - 8个动作
  - AI回复生成、工作人员联动回复、角色配置加载、话术模板加载、AI调用优化、AI调用记录、回复质量评估、多模型支持
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点5: RISK_HANDLER（风险处理）** - 7个动作
  - 风险检测、风险等级评估、风险安抚回复、风险告警触发、工作人员通知、风险记录、风险处理决策
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点6: MESSAGE_EXIT（消息出口）** - 8个动作 ⭐增强
  - 消息分发决策、企业微信官方机器人发送、自定义机器人发送、消息发送重试、消息优先级与负载均衡、消息状态记录、会话更新、WebSocket实时推送
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点7: SMART_MONITOR（智能监控）** - 6个动作 ⭐增强
  - 实时消息监控、员工回复监测、异常检测、性能监控、统计数据记录、监控告警
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构

### 关键特性：
- 🤖 **企业微信官方机器人**完整配置（Webhook、@人、Markdown、限流）
- 🤖 **自定义机器人**完整配置（API、认证、负载均衡）
- 🔄 **消息重试**机制（支持不同HTTP状态码的重试策略）
- ⚖️ **优先级与负载均衡**（加权、轮询、最少负载）
- ⭐ **员工回复监测**（检测回复、频率调整、不回复记录）
- ⭐ **员工异常行为检测**（回复率低于阈值触发告警）

---

## 📖 第三部分：告警与结束节点（节点8-10）+ 实施指南

**文件路径**: `src/docs/节点配置详细设计_v4_增强版_第三部分.md`

### 包含内容：
- ✅ **节点8: ALERT_ESCALATION（告警升级）** - 7个动作 ⭐增强
  - 告警级别检测、用户不满意检测、升级规则评估、升级通知发送、升级记录、升级工作流、升级决策
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点9: HUMAN_HANDOVER（人工接管）** - 6个动作
  - 工作人员分配、交接通知发送、会话转移、交接记录、AI暂停、交接决策
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **节点10: FLOW_END（流程结束）** - 5个动作
  - 会话关闭、资源清理、流程记录、统计汇总、最终输出
  - 自动模式配置
  - 前端UI配置表单（中文）
  - 输出数据结构
- ✅ **完整UI配置表单**（剩余节点）
- ✅ **实施指南**（自动模式、机器人联动、员工监测、用户不满意介入）
- ✅ **配置总结与完成检查**

### 关键特性：
- ⭐ **用户不满意检测**（愤怒、负面、投诉、负面关键词）
- ⭐ **立即介入机制**（通知经理、升级告警、接管会话）
- ⭐ **告警级别提升**（根据不满意程度提升1-2级）
- 📊 **告警升级规则**（时间自动升级、严重自动升级、用户不满意升级）
- 👥 **工作人员分配**（轮询、最少负载、技能匹配、工作时间检查）
- ✅ **完整的实施指南**和测试清单

---

## 🎯 增强功能总览

### 1. 自动模式（Auto Mode）
- ✅ 所有10个节点支持自动模式
- ✅ 提供生产级别的默认JSON配置
- ✅ 一键切换自动/自定义模式

### 2. 前端UI中文化
- ✅ 所有配置选项中文标签
- ✅ 每个字段详细注释说明
- ✅ 默认值和可选范围说明

### 3. 机器人联动增强 ⭐
**MESSAGE_EXIT节点**：
- ✅ 企业微信官方机器人（Webhook、Markdown、限流）
- ✅ 自定义机器人（API认证、负载均衡）
- ✅ @人功能（@特定人员/@所有人）
- ✅ 消息重试（不同HTTP状态码不同策略）
- ✅ 优先级管理（严重/高/普通/低）
- ✅ 负载均衡（轮询/最少负载/加权）

### 4. 员工回复监测增强 ⭐
**SMART_MONITOR节点**：
- ✅ 检测员工是否回复用户消息
- ✅ 回复后降低监控频率（5秒 → 30秒，持续10分钟）
- ✅ 无回复时提高监控频率（5秒 → 2秒，持续3分钟）
- ✅ 记录不回复行为（5分钟未回复触发记录）
- ✅ 不回复告警（连续3次触发告警）
- ✅ 员工回复统计（回复次数、平均时间、回复率）

### 5. 用户不满意介入增强 ⭐
**ALERT_ESCALATION节点**：
- ✅ 愤怒情绪检测 → 立即介入
- ✅ 负面情绪检测 → 提升告警1级
- ✅ 投诉意图检测 → 立即介入
- ✅ 负面关键词检测 → 提升告警2级
- ✅ 立即介入机制（通知经理、升级到严重级别）
- ✅ 通知工作人员本人
- ✅ 告警升级层级（level_1 → level_5）

---

## 📊 配置统计

| 节点ID | 节点名称 | 动作数量 | 自动模式 | 特殊增强 |
|--------|---------|---------|---------|---------|
| 1 | MESSAGE_ENTRY | 6 | ✅ | - |
| 2 | SMART_ANALYZE | 6 | ✅ | - |
| 3 | FLOW_DECISION | 6 | ✅ | - |
| 4 | AI_AGENT | 8 | ✅ | - |
| 5 | RISK_HANDLER | 7 | ✅ | - |
| 6 | MESSAGE_EXIT | 8 | ✅ | ⭐ 机器人联动 |
| 7 | SMART_MONITOR | 6 | ✅ | ⭐ 员工回复监测 |
| 8 | ALERT_ESCALATION | 7 | ✅ | ⭐ 告警升级逻辑 |
| 9 | HUMAN_HANDOVER | 6 | ✅ | - |
| 10 | FLOW_END | 5 | ✅ | - |
| **总计** | **10个节点** | **65个动作** | **全部支持** | **3个节点增强** |

---

## 🚀 快速开始

### 1. 查看文档
- 第一部分：`src/docs/节点配置详细设计_v4_增强版_第一部分.md`
- 第二部分：`src/docs/节点配置详细设计_v4_增强版_第二部分.md`
- 第三部分：`src/docs/节点配置详细设计_v4_增强版_第三部分.md`

### 2. 使用自动模式
```javascript
{
  autoMode: true,  // 启用自动模式
  // 系统自动加载默认配置
}
```

### 3. 自定义配置
```javascript
{
  autoMode: false, // 关闭自动模式
  // 手动修改配置
  actions: [
    {
      actionId: "xxx",
      // 自定义配置...
    }
  ]
}
```

### 4. 前端UI集成
参考第三部分的实施指南章节。

---

## ✅ 验收标准检查

- ✅ 节点数量：10个（符合10-12个要求）
- ✅ 动作总数：65个（覆盖所有系统联动）
- ✅ 覆盖系统：消息处理、上下文管理、AI分析、信息中心、工作人员联动、告警管理、机器人管理、协同系统、监控中心、决策、消息发送、风险处理、流程控制
- ✅ 配置要求：每个节点的动作指令全方位完善，包含企业微信API调用细节
- ✅ **自动模式**：所有节点支持自动模式，提供默认JSON代码 ✅
- ✅ **前端UI中文化**：所有表单选项中文化并带详细注释 ✅
- ✅ **机器人联动**：企业微信官方机器人、自定义机器人、@人、限流、重试、优先级、负载均衡 ✅
- ✅ **员工回复监测**：检测回复、频率调整、不回复记录、员工异常行为检测 ✅
- ✅ **用户不满意介入**：检测不满意、立即介入、提升告警级别 ✅

---

## 📝 文档版本信息

**版本**: v4.0（增强版）
**创建日期**: 2025-01-04
**最后更新**: 2025-01-04
**状态**: ✅ 完成
**作者**: WorkTool AI 团队

---

## 🔗 相关文档

- 节点配置详细设计 v3.0（基于内部文档）：`src/docs/节点配置详细设计_v3_基于内部文档.md`
- 流程引擎优化文档：`src/docs/流程引擎优化_从18节点到10节点.md`
- API接口文档：`src/docs/API接口文档.md`
- 机器人系统文档：`src/docs/机器人系统文档.md`
- 告警系统文档：`src/docs/告警系统文档.md`
- AI模块文档：`src/docs/AI模块文档.md`

---

## 💡 使用建议

1. **初次使用**：建议从第一部分开始阅读，逐步了解各个节点的功能
2. **快速参考**：使用本索引文档快速定位需要的内容
3. **实施部署**：参考第三部分的实施指南进行系统集成
4. **自定义配置**：关闭自动模式后，根据业务需求调整配置

---

**如有任何问题或建议，请联系开发团队。** 🚀
