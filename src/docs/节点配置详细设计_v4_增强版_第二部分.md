# æµç¨‹å¼•æ“èŠ‚ç‚¹é…ç½®è¯¦ç»†è®¾è®¡ v4.0ï¼ˆå¢å¼ºç‰ˆï¼‰

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

**åŸºäºç‰ˆæœ¬**: v3.0ï¼ˆèŠ‚ç‚¹é…ç½®è¯¦ç»†è®¾è®¡_v3_åŸºäºå†…éƒ¨æ–‡æ¡£.mdï¼‰
**å¢å¼ºå†…å®¹**:
- âœ… ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ **è‡ªåŠ¨æ¨¡å¼**é…ç½®ï¼ˆé»˜è®¤JSONä»£ç ï¼‰
- âœ… æ‰€æœ‰å‰ç«¯UIé€‰é¡¹**ä¸­æ–‡åŒ–**å¹¶å¸¦æœ‰è¯¦ç»†æ³¨é‡Š
- âœ… ç‰¹åˆ«å®Œå–„**æœºå™¨äººè”åŠ¨é€»è¾‘**ï¼ˆå‘˜å·¥å›å¤ç›‘æµ‹ã€ç”¨æˆ·ä¸æ»¡æ„ä»‹å…¥ï¼‰
- âœ… æ·»åŠ å®Œæ•´çš„**é…ç½®è¯´æ˜**å’Œ**ä½¿ç”¨ç¤ºä¾‹**

---

## ğŸ¯ æ–°å¢ç‰¹æ€§

### 1. è‡ªåŠ¨æ¨¡å¼ï¼ˆAuto Modeï¼‰
æ¯ä¸ªèŠ‚ç‚¹æ–°å¢è‡ªåŠ¨æ¨¡å¼å¼€å…³ï¼š
- **å¼€å¯è‡ªåŠ¨æ¨¡å¼**: ä½¿ç”¨é¢„é…ç½®çš„é»˜è®¤JSONï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- **å…³é—­è‡ªåŠ¨æ¨¡å¼**: å¯ä»¥è‡ªç”±ä¿®æ”¹æ¯ä¸ªåŠ¨ä½œçš„è¯¦ç»†é…ç½®
- **é»˜è®¤JSON**: æä¾›ç”Ÿäº§çº§åˆ«çš„é…ç½®æ¨¡æ¿

### 2. å‰ç«¯UIä¸­æ–‡åŒ–
æ‰€æœ‰é…ç½®é€‰é¡¹å‡æä¾›ï¼š
- **ä¸­æ–‡æ ‡ç­¾**: æ¸…æ™°æ˜“æ‡‚çš„é€‰é¡¹åç§°
- **è¯¦ç»†æ³¨é‡Š**: æ¯ä¸ªå­—æ®µçš„ç”¨é€”è¯´æ˜
- **é»˜è®¤å€¼**: æ¨èçš„é»˜è®¤é…ç½®
- **å¯é€‰èŒƒå›´**: å¯é€‰å€¼çš„è¯´æ˜

### 3. æœºå™¨äººè”åŠ¨å¢å¼º
ç‰¹åˆ«ä¼˜åŒ–ä»¥ä¸‹é€»è¾‘ï¼š
- **å‘˜å·¥å›å¤ç›‘æµ‹**: æ£€æµ‹å‘˜å·¥å›å¤åè‡ªåŠ¨é™ä½ç›‘æµ‹é¢‘ç‡
- **ä¸å›å¤è®°å½•**: è®°å½•å‘˜å·¥æœªå›å¤æˆ–å›å¤å‡å°‘çš„æƒ…å†µ
- **ç”¨æˆ·ä¸æ»¡æ„ä»‹å…¥**: æ£€æµ‹åˆ°ç”¨æˆ·ä¸æ»¡æ„æ—¶è‡ªåŠ¨ä»‹å…¥å¹¶æå‡å‘Šè­¦çº§åˆ«
- **å‘Šè­¦å‡çº§**: è‡ªåŠ¨å°†å‘Šè­¦å‘é€ç»™æ›´é«˜å±‚çº§çš„è´Ÿè´£äºº

---

## ğŸ—ï¸ èŠ‚ç‚¹ä½“ç³»æ¶æ„

```
æµç¨‹å¼•æ“ (10ä¸ªèŠ‚ç‚¹ï¼Œ71ä¸ªåŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼)
â”‚
â”œâ”€â”€ å…¥å£èŠ‚ç‚¹ (1ä¸ª) - 6åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ MESSAGE_ENTRY (æ¶ˆæ¯å…¥å£)
â”‚
â”œâ”€â”€ AIåˆ†æèŠ‚ç‚¹ (1ä¸ª) - 6åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ SMART_ANALYZE (æ™ºèƒ½åˆ†æ)
â”‚
â”œâ”€â”€ å†³ç­–èŠ‚ç‚¹ (1ä¸ª) - 6åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ FLOW_DECISION (æµç¨‹å†³ç­–)
â”‚
â”œâ”€â”€ ä¸šåŠ¡å¤„ç†èŠ‚ç‚¹ (3ä¸ª) - 21åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â”œâ”€â”€ AI_AGENT (AIä»£ç†) - 8åŠ¨ä½œ
â”‚   â”œâ”€â”€ RISK_HANDLER (é£é™©å¤„ç†) - 7åŠ¨ä½œ
â”‚   â””â”€â”€ STAFF_COOPERATE (å·¥ä½œäººå‘˜ååŒ) - 6åŠ¨ä½œ â­ å¢å¼ºæœºå™¨äººè”åŠ¨
â”‚
â”œâ”€â”€ æ¶ˆæ¯æ“ä½œèŠ‚ç‚¹ (1ä¸ª) - 8åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ MESSAGE_EXIT (æ¶ˆæ¯å‡ºå£) â­ å¢å¼ºæœºå™¨äººè”åŠ¨
â”‚
â”œâ”€â”€ ç›‘æ§æ£€æµ‹èŠ‚ç‚¹ (1ä¸ª) - 6åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ SMART_MONITOR (æ™ºèƒ½ç›‘æ§) â­ å¢å¼ºå‘˜å·¥å›å¤ç›‘æµ‹
â”‚
â”œâ”€â”€ å‘Šè­¦å‡çº§èŠ‚ç‚¹ (1ä¸ª) - 7åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ ALERT_ESCALATION (å‘Šè­¦å‡çº§) â­ å¢å¼ºå‘Šè­¦å‡çº§é€»è¾‘
â”‚
â”œâ”€â”€ äººå·¥æ¥ç®¡èŠ‚ç‚¹ (1ä¸ª) - 6åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
â”‚   â””â”€â”€ HUMAN_HANDOVER (äººå·¥æ¥ç®¡)
â”‚
â””â”€â”€ ç»“æŸèŠ‚ç‚¹ (1ä¸ª) - 5åŠ¨ä½œ + è‡ªåŠ¨æ¨¡å¼
    â””â”€â”€ FLOW_END (æµç¨‹ç»“æŸ)
```

---

## ğŸ“ èŠ‚ç‚¹1: MESSAGE_ENTRYï¼ˆæ¶ˆæ¯å…¥å£ï¼‰

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: ğŸ“¥
- **é¢œè‰²**: #10b981ï¼ˆç»¿è‰²ï¼‰
- **åˆ†ç±»**: å…¥å£èŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 6ä¸ª

### ğŸ“– èŠ‚ç‚¹æè¿°
æ¥æ”¶WorkToolæ¶ˆæ¯ï¼Œæ‰§è¡Œæ¶ˆæ¯æ¥æ”¶ã€ä¿å­˜ã€è§£æã€ä¼šè¯åˆ›å»ºã€ä¸Šä¸‹æ–‡åŠ è½½ç­‰åˆå§‹åŒ–æ“ä½œã€‚è¿™æ˜¯æµç¨‹çš„èµ·ç‚¹ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… æ¶ˆæ¯ä¸­å¿ƒï¼ˆæ¶ˆæ¯æ¥æ”¶ã€ä¼šè¯ç®¡ç†ï¼‰
- âœ… æœºå™¨äººç®¡ç†ï¼ˆæœºå™¨äººçŠ¶æ€æ£€æŸ¥ï¼‰
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆå†å²æ¶ˆæ¯åŠ è½½ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®

```javascript
// MESSAGE_ENTRY è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®
{
  nodeType: "MESSAGE_ENTRY",
  nodeId: "msg_entry_auto",
  nodeName: "æ¶ˆæ¯å…¥å£ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,  // è‡ªåŠ¨æ¨¡å¼å¼€å…³
  description: "è‡ªåŠ¨å¤„ç†æ¶ˆæ¯æ¥æ”¶ã€ä¿å­˜ã€è§£æã€ä¼šè¯åˆ›å»ºã€ä¸Šä¸‹æ–‡åŠ è½½",
  
  // åŠ¨ä½œé…ç½®ï¼ˆ6ä¸ªåŠ¨ä½œï¼‰
  actions: [
    {
      actionId: "message_receive",
      actionName: "æ¶ˆæ¯æ¥æ”¶",
      enabled: true,
      priority: 1,
      config: {
        // æ¥æ”¶é…ç½®
        validateMessage: true,           // æ˜¯å¦éªŒè¯æ¶ˆæ¯æ ¼å¼ï¼ˆtrue: éªŒè¯, false: ä¸éªŒè¯ï¼‰
        skipEmptyMessages: true,         // æ˜¯å¦è·³è¿‡ç©ºæ¶ˆæ¯ï¼ˆtrue: è·³è¿‡, false: å¤„ç†ï¼‰
        skipSelfMessages: true,          // æ˜¯å¦è·³è¿‡æœºå™¨äººè‡ªå·±çš„æ¶ˆæ¯ï¼ˆtrue: è·³è¿‡, false: å¤„ç†ï¼‰
        acceptTypes: [                   // æ¥å—çš„æ¶ˆæ¯ç±»å‹åˆ—è¡¨
          "text",                        // æ–‡æœ¬æ¶ˆæ¯
          "image",                       // å›¾ç‰‡æ¶ˆæ¯
          "file",                        // æ–‡ä»¶æ¶ˆæ¯
          "audio",                       // è¯­éŸ³æ¶ˆæ¯
          "video"                        // è§†é¢‘æ¶ˆæ¯
        ],
        maxMessageLength: 10000,         // æœ€å¤§æ¶ˆæ¯é•¿åº¦é™åˆ¶ï¼ˆå­—ç¬¦æ•°ï¼‰
        // APIåœ°å€
        webhookUrl: "POST /api/worktool/callback/message",
        // å“åº”
        immediateResponse: true          // æ˜¯å¦ç«‹å³è¿”å›200ï¼ˆtrue: ç«‹å³è¿”å›, false: å¤„ç†åè¿”å›ï¼‰
      }
    },
    {
      actionId: "message_save",
      actionName: "æ¶ˆæ¯ä¿å­˜",
      enabled: true,
      priority: 2,
      config: {
        // ä¿å­˜é…ç½®
        saveToDatabase: true,            // æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆtrue: ä¿å­˜, false: ä¸ä¿å­˜ï¼‰
        saveToContext: true,             // æ˜¯å¦ä¿å­˜åˆ°æµç¨‹ä¸Šä¸‹æ–‡ï¼ˆtrue: ä¿å­˜, false: ä¸ä¿å­˜ï¼‰
        tableName: "messages",           // ç›®æ ‡è¡¨åï¼ˆmessages: æ¶ˆæ¯è¡¨ï¼‰
        // å­—æ®µæ˜ å°„
        fieldMapping: {
          messageId: "messageId",        // æ¶ˆæ¯IDï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          sessionId: "sessionId",        // ä¼šè¯IDï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          robotId: "robotId",            // æœºå™¨äººIDï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          robotType: "robotType",        // æœºå™¨äººç±»å‹ï¼ˆofficial: ä¼ä¸šå¾®ä¿¡å®˜æ–¹, custom: è‡ªå®šä¹‰ï¼‰
          senderId: "senderId",          // å‘é€è€…IDï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          senderName: "senderName",      // å‘é€è€…åç§°ï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          senderType: "senderType",      // å‘é€è€…ç±»å‹ï¼ˆuser: ç”¨æˆ·, system: ç³»ç»Ÿï¼‰
          groupName: "groupName",        // ç¾¤ç»„åç§°ï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          groupChatId: "groupChatId",    // ç¾¤ç»„IDï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          roomType: "roomType",          // æˆ¿é—´ç±»å‹ï¼ˆgroup: ç¾¤èŠ, private: ç§èŠï¼‰
          messageType: "messageType",    // æ¶ˆæ¯ç±»å‹ï¼ˆtext/image/file/audio/videoï¼‰
          content: "content",            // æ¶ˆæ¯å†…å®¹ï¼ˆä»å›è°ƒæ•°æ®ä¸­æå–ï¼‰
          atMe: "atMe",                  // æ˜¯å¦@æˆ‘ï¼ˆtrue: @æˆ‘, false: æœª@æˆ‘ï¼‰
          atList: "atList",              // @äººåˆ—è¡¨ï¼ˆæ•°ç»„æ ¼å¼ï¼ŒåŒ…å«è¢«@çš„ç”¨æˆ·IDï¼‰
          timestamp: "timestamp",        // æ—¶é—´æˆ³ï¼ˆISO 8601æ ¼å¼ï¼‰
          metadata: "metadata"           // å…ƒæ•°æ®ï¼ˆJSONå¯¹è±¡ï¼ŒåŒ…å«å…¶ä»–é™„åŠ ä¿¡æ¯ï¼‰
        },
        // å»é‡é…ç½®
        enableDeduplication: true,       // æ˜¯å¦å¯ç”¨å»é‡ï¼ˆtrue: å¯ç”¨, false: ç¦ç”¨ï¼‰
        dedupWindow: 5000                // å»é‡æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼Œç›¸åŒæ¶ˆæ¯åœ¨æ­¤çª—å£å†…åªå¤„ç†ä¸€æ¬¡ï¼‰
      }
    },
    {
      actionId: "message_parse",
      actionName: "æ¶ˆæ¯è§£æ",
      enabled: true,
      priority: 3,
      config: {
        // æå–å­—æ®µåˆ—è¡¨
        extractFields: [
          "messageId",                   // æ¶ˆæ¯ID
          "sessionId",                   // ä¼šè¯ID
          "robotId",                     // æœºå™¨äººID
          "robotType",                   // æœºå™¨äººç±»å‹
          "senderId",                    // å‘é€è€…ID
          "senderName",                  // å‘é€è€…åç§°
          "groupName",                    // ç¾¤ç»„åç§°
          "groupChatId",                  // ç¾¤ç»„ID
          "roomType",                    // æˆ¿é—´ç±»å‹
          "messageType",                 // æ¶ˆæ¯ç±»å‹
          "content",                     // æ¶ˆæ¯å†…å®¹
          "atMe",                        // æ˜¯å¦@æˆ‘
          "atList"                       // @äººåˆ—è¡¨
        ],
        // @äººè§£æé…ç½®
        parseAtList: true,               // æ˜¯å¦è§£æ@äººåˆ—è¡¨ï¼ˆtrue: è§£æ, false: ä¸è§£æï¼‰
        atListFormat: "array",           // @äººåˆ—è¡¨æ ¼å¼ï¼ˆarray: æ•°ç»„, string: é€—å·åˆ†éš”å­—ç¬¦ä¸²ï¼‰
        // ä¼ä¸šå¾®ä¿¡æœºå™¨äººç‰¹å®šé…ç½®
        parseWebhookData: true,          // æ˜¯å¦è§£æä¼ä¸šå¾®ä¿¡Webhookæ•°æ®
        webhookFieldMapping: {
          robotType: "official",         // ä¼ä¸šå¾®ä¿¡æœºå™¨äººç±»å‹æ ‡è¯†
          webhookKey: "webhook_key"      // Webhook keyï¼ˆä»å›è°ƒURLä¸­æå–ï¼‰
        },
        // è‡ªå®šä¹‰æœºå™¨äººç‰¹å®šé…ç½®
        parseCustomRobotData: true,      // æ˜¯å¦è§£æè‡ªå®šä¹‰æœºå™¨äººæ•°æ®
        customFieldMapping: {
          robotType: "custom",           // è‡ªå®šä¹‰æœºå™¨äººç±»å‹æ ‡è¯†
          robotSecret: "robot_secret"    // æœºå™¨äººå¯†é’¥ï¼ˆç”¨äºAPIè®¤è¯ï¼‰
        }
      }
    },
    {
      actionId: "session_create",
      actionName: "ä¼šè¯åˆ›å»º",
      enabled: true,
      priority: 4,
      config: {
        // ä¼šè¯è¯†åˆ«é…ç½®
        sessionIdSource: "generate",     // ä¼šè¯IDæ¥æºï¼ˆgenerate: ç”Ÿæˆæ–°ID, existing: ä½¿ç”¨ç°æœ‰ID, robot: ä»æœºå™¨äººè·å–ï¼‰
        sessionKeyFields: [             // ä¼šè¯æ ‡è¯†å­—æ®µåˆ—è¡¨ï¼ˆç”¨äºè¯†åˆ«åŒä¸€ä¼šè¯ï¼‰
          "senderId",                   // å‘é€è€…ID
          "robotId",                     // æœºå™¨äººID
          "roomType"                    // æˆ¿é—´ç±»å‹
        ],
        // ä¼šè¯åˆ›å»ºé…ç½®
        createNewSession: true,          // æ˜¯å¦åˆ›å»ºæ–°ä¼šè¯ï¼ˆtrue: åˆ›å»º, false: ä¸åˆ›å»ºï¼‰
        updateExistingSession: true,     // æ˜¯å¦æ›´æ–°ç°æœ‰ä¼šè¯ï¼ˆtrue: æ›´æ–°, false: ä¸æ›´æ–°ï¼‰
        tableName: "sessions",           // ç›®æ ‡è¡¨åï¼ˆsessions: ä¼šè¯è¡¨ï¼‰
        // ä¼šè¯å­—æ®µæ˜ å°„
        sessionFields: {
          sessionId: "sessionId",        // ä¼šè¯IDï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–ä»ç°æœ‰æ•°æ®è·å–ï¼‰
          robotId: "robotId",            // æœºå™¨äººID
          userId: "senderId",           // ç”¨æˆ·IDï¼ˆä»å‘é€è€…IDè·å–ï¼‰
          userName: "senderName",       // ç”¨æˆ·åç§°ï¼ˆä»å‘é€è€…åç§°è·å–ï¼‰
          groupName: "groupName",        // ç¾¤ç»„åç§°
          groupChatId: "groupChatId",    // ç¾¤ç»„ID
          roomType: "roomType",          // æˆ¿é—´ç±»å‹
          status: "active",              // ä¼šè¯çŠ¶æ€ï¼ˆactive: æ´»è·ƒ, closed: å·²å…³é—­, archived: å·²å½’æ¡£ï¼‰
          messageCount: 0,               // æ¶ˆæ¯è®¡æ•°ï¼ˆåˆå§‹ä¸º0ï¼‰
          lastMessageTime: "timestamp",  // æœ€åæ¶ˆæ¯æ—¶é—´
          metadata: "metadata"           // å…ƒæ•°æ®ï¼ˆJSONå¯¹è±¡ï¼‰
        },
        // ä¼šè¯ç»Ÿè®¡é…ç½®
        incrementMessageCount: true,     // æ˜¯å¦é€’å¢æ¶ˆæ¯è®¡æ•°ï¼ˆtrue: é€’å¢, false: ä¸é€’å¢ï¼‰
        updateLastMessageTime: true      // æ˜¯å¦æ›´æ–°æœ€åæ¶ˆæ¯æ—¶é—´ï¼ˆtrue: æ›´æ–°, false: ä¸æ›´æ–°ï¼‰
      }
    },
    {
      actionId: "context_load",
      actionName: "ä¸Šä¸‹æ–‡åŠ è½½",
      enabled: true,
      priority: 5,
      config: {
        // ä¸Šä¸‹æ–‡æ¨¡å¼é…ç½®
        contextMode: "sliding_window",  // ä¸Šä¸‹æ–‡æ¨¡å¼ï¼ˆfull_history: å…¨éƒ¨å†å², sliding_window: æ»‘åŠ¨çª—å£, summary: æ‘˜è¦ï¼‰
        windowSize: 10,                 // ä¸Šä¸‹æ–‡çª—å£å¤§å°ï¼ˆè½®æ•°ï¼Œä»…æ»‘åŠ¨çª—å£æ¨¡å¼æœ‰æ•ˆï¼‰
        maxTokens: 4000,                // æœ€å¤§Tokenæ•°ï¼ˆé™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ï¼‰
        // å†å²æ¶ˆæ¯åŠ è½½é…ç½®
        loadHistoryMessages: true,      // æ˜¯å¦åŠ è½½å†å²æ¶ˆæ¯ï¼ˆtrue: åŠ è½½, false: ä¸åŠ è½½ï¼‰
        historyFields: [                // åŠ è½½çš„å†å²æ¶ˆæ¯å­—æ®µåˆ—è¡¨
          "messageId",                  // æ¶ˆæ¯ID
          "senderId",                   // å‘é€è€…ID
          "senderName",                 // å‘é€è€…åç§°
          "messageType",                // æ¶ˆæ¯ç±»å‹
          "content",                    // æ¶ˆæ¯å†…å®¹
          "timestamp"                   // æ—¶é—´æˆ³
        ],
        // æ’åºé…ç½®
        sortOrder: "asc",               // æ’åºæ–¹å‘ï¼ˆasc: å‡åº, desc: é™åºï¼‰
        sortBy: "timestamp",            // æ’åºå­—æ®µï¼ˆtimestamp: æ—¶é—´æˆ³ï¼‰
        // ä¸Šä¸‹æ–‡è¾“å‡ºé…ç½®
        saveToContext: true,            // æ˜¯å¦ä¿å­˜åˆ°æµç¨‹ä¸Šä¸‹æ–‡ï¼ˆtrue: ä¿å­˜, false: ä¸ä¿å­˜ï¼‰
        contextKey: "conversationContext" // ä¸Šä¸‹æ–‡å˜é‡åï¼ˆåœ¨åç»­èŠ‚ç‚¹ä¸­é€šè¿‡æ­¤å˜é‡åè®¿é—®ï¼‰
      }
    },
    {
      actionId: "output_variables",
      actionName: "è¾“å‡ºæµç¨‹å˜é‡",
      enabled: true,
      priority: 6,
      config: {
        // è¾“å‡ºå˜é‡æ˜ å°„ï¼ˆä»ä¸Šä¸‹æ–‡ä¸­æå–å¹¶è¾“å‡ºåˆ°æµç¨‹å˜é‡ï¼‰
        outputVariables: {
          messageId: "message.messageId",
          sessionId: "message.sessionId",
          robotId: "message.robotId",
          robotType: "message.robotType",
          senderId: "message.senderId",
          senderName: "message.senderName",
          senderType: "message.senderType",
          groupName: "message.groupName",
          groupChatId: "message.groupChatId",
          roomType: "message.roomType",
          messageType: "message.messageType",
          content: "message.content",
          atMe: "message.atMe",
          atList: "message.atList",
          timestamp: "message.timestamp",
          conversationContext: "context.conversationContext"
        }
      }
    }
  ],
  
  // èŠ‚ç‚¹çº§åˆ«é…ç½®
  nodeConfig: {
    enableLogging: true,               // æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•
    enableMetrics: true,               // æ˜¯å¦å¯ç”¨æŒ‡æ ‡ç»Ÿè®¡
    timeout: 30000,                    // èŠ‚ç‚¹æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    retryCount: 0                      // å¤±è´¥é‡è¯•æ¬¡æ•°
  }
}
```

---

### ğŸ›ï¸ å‰ç«¯UIé…ç½®è¡¨å•ï¼ˆä¸­æ–‡ï¼‰

#### ğŸ“Œ èŠ‚ç‚¹åŸºç¡€é…ç½®

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|---------|------|--------|------|
| `nodeId` | èŠ‚ç‚¹ID | æ–‡æœ¬ | `msg_entry_auto` | èŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿ |
| `nodeName` | èŠ‚ç‚¹åç§° | æ–‡æœ¬ | `æ¶ˆæ¯å…¥å£ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰` | èŠ‚ç‚¹çš„æ˜¾ç¤ºåç§°ï¼Œæ”¯æŒä¸­æ–‡ |
| `description` | èŠ‚ç‚¹æè¿° | å¤šè¡Œæ–‡æœ¬ | `è‡ªåŠ¨å¤„ç†æ¶ˆæ¯æ¥æ”¶...` | èŠ‚ç‚¹åŠŸèƒ½è¯´æ˜ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£ |
| `autoMode` | è‡ªåŠ¨æ¨¡å¼ | å¼€å…³ | `å¼€å¯` | å¼€å¯åä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå…³é—­åå¯æ‰‹åŠ¨ä¿®æ”¹ |

#### âš™ï¸ åŠ¨ä½œé…ç½®ï¼ˆè‡ªåŠ¨æ¨¡å¼ä¸‹å±•ç¤ºï¼Œå¯å¤åˆ¶ä¿®æ”¹ï¼‰

**åŠ¨ä½œ1ï¼šæ¶ˆæ¯æ¥æ”¶**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `1` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `validateMessage` | éªŒè¯æ¶ˆæ¯æ ¼å¼ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | éªŒè¯æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡® |
| `skipEmptyMessages` | è·³è¿‡ç©ºæ¶ˆæ¯ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è·³è¿‡ç©ºå†…å®¹æ¶ˆæ¯ |
| `skipSelfMessages` | è·³è¿‡æœºå™¨äººæ¶ˆæ¯ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è·³è¿‡æœºå™¨äººè‡ªå·±å‘é€çš„æ¶ˆæ¯ |
| `acceptTypes` | æ¥å—çš„æ¶ˆæ¯ç±»å‹ | å¤šé€‰ | `[æ–‡æœ¬,å›¾ç‰‡,æ–‡ä»¶]` | æ–‡æœ¬/å›¾ç‰‡/æ–‡ä»¶/è¯­éŸ³/è§†é¢‘ | å…è®¸å¤„ç†çš„æ¶ˆæ¯ç±»å‹ |
| `maxMessageLength` | æœ€å¤§æ¶ˆæ¯é•¿åº¦ | æ•°å­— | `10000` | 1000-100000 | å•æ¡æ¶ˆæ¯çš„æœ€å¤§å­—ç¬¦æ•° |
| `immediateResponse` | ç«‹å³è¿”å›å“åº” | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ”¶åˆ°æ¶ˆæ¯åæ˜¯å¦ç«‹å³è¿”å›200 |

**åŠ¨ä½œ2ï¼šæ¶ˆæ¯ä¿å­˜**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `2` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `saveToDatabase` | ä¿å­˜åˆ°æ•°æ®åº“ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦å°†æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“ |
| `saveToContext` | ä¿å­˜åˆ°ä¸Šä¸‹æ–‡ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦ä¿å­˜åˆ°æµç¨‹ä¸Šä¸‹æ–‡ä¾›åç»­èŠ‚ç‚¹ä½¿ç”¨ |
| `enableDeduplication` | å¯ç”¨æ¶ˆæ¯å»é‡ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦å¯¹é‡å¤æ¶ˆæ¯è¿›è¡Œå»é‡ |
| `dedupWindow` | å»é‡æ—¶é—´çª—å£ | æ•°å­— | `5000` | 1000-30000 | å»é‡æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰ |

**åŠ¨ä½œ3ï¼šæ¶ˆæ¯è§£æ**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `3` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `parseAtList` | è§£æ@äººåˆ—è¡¨ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è§£ææ¶ˆæ¯ä¸­è¢«@çš„ç”¨æˆ· |
| `atListFormat` | @äººåˆ—è¡¨æ ¼å¼ | å•é€‰ | `æ•°ç»„` | æ•°ç»„/å­—ç¬¦ä¸² | @äººåˆ—è¡¨çš„è¾“å‡ºæ ¼å¼ |
| `parseWebhookData` | è§£æä¼ä¸šå¾®ä¿¡æ•°æ® | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è§£æä¼ä¸šå¾®ä¿¡Webhookç‰¹å®šæ•°æ® |
| `parseCustomRobotData` | è§£æè‡ªå®šä¹‰æœºå™¨äººæ•°æ® | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è§£æè‡ªå®šä¹‰æœºå™¨äººç‰¹å®šæ•°æ® |

**åŠ¨ä½œ4ï¼šä¼šè¯åˆ›å»º**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `4` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `sessionIdSource` | ä¼šè¯IDæ¥æº | å•é€‰ | `è‡ªåŠ¨ç”Ÿæˆ` | è‡ªåŠ¨ç”Ÿæˆ/ä½¿ç”¨ç°æœ‰/ä»æœºå™¨äººè·å– | ä¼šè¯IDçš„ç”Ÿæˆæ–¹å¼ |
| `createNewSession` | åˆ›å»ºæ–°ä¼šè¯ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦ä¸ºæ–°æ¶ˆæ¯åˆ›å»ºä¼šè¯ |
| `updateExistingSession` | æ›´æ–°ç°æœ‰ä¼šè¯ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ›´æ–°ç°æœ‰ä¼šè¯ä¿¡æ¯ |
| `incrementMessageCount` | é€’å¢æ¶ˆæ¯è®¡æ•° | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦å¢åŠ ä¼šè¯çš„æ¶ˆæ¯è®¡æ•° |
| `updateLastMessageTime` | æ›´æ–°æœ€åæ¶ˆæ¯æ—¶é—´ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ›´æ–°ä¼šè¯çš„æœ€åæ¶ˆæ¯æ—¶é—´ |

**åŠ¨ä½œ5ï¼šä¸Šä¸‹æ–‡åŠ è½½**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `5` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `contextMode` | ä¸Šä¸‹æ–‡æ¨¡å¼ | å•é€‰ | `æ»‘åŠ¨çª—å£` | å…¨éƒ¨å†å²/æ»‘åŠ¨çª—å£/æ‘˜è¦ | å†å²æ¶ˆæ¯çš„åŠ è½½æ–¹å¼ |
| `windowSize` | çª—å£å¤§å° | æ•°å­— | `10` | 1-50 | æ»‘åŠ¨çª—å£çš„å¤§å°ï¼ˆè½®æ•°ï¼‰ |
| `maxTokens` | æœ€å¤§Tokenæ•° | æ•°å­— | `4000` | 1000-32000 | ä¸Šä¸‹æ–‡çš„æœ€å¤§Tokenæ•° |
| `loadHistoryMessages` | åŠ è½½å†å²æ¶ˆæ¯ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦ä»æ•°æ®åº“åŠ è½½å†å²æ¶ˆæ¯ |
| `sortOrder` | æ’åºæ–¹å‘ | å•é€‰ | `å‡åº` | å‡åº/é™åº | å†å²æ¶ˆæ¯çš„æ’åºæ–¹å‘ |

**åŠ¨ä½œ6ï¼šè¾“å‡ºæµç¨‹å˜é‡**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `6` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |

#### ğŸ›ï¸ èŠ‚ç‚¹çº§åˆ«é…ç½®

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enableLogging` | å¯ç”¨æ—¥å¿—è®°å½• | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è®°å½•èŠ‚ç‚¹æ‰§è¡Œæ—¥å¿— |
| `enableMetrics` | å¯ç”¨æŒ‡æ ‡ç»Ÿè®¡ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦ç»Ÿè®¡èŠ‚ç‚¹æ‰§è¡ŒæŒ‡æ ‡ |
| `timeout` | æ‰§è¡Œè¶…æ—¶æ—¶é—´ | æ•°å­— | `30000` | 5000-300000 | èŠ‚ç‚¹æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| `retryCount` | å¤±è´¥é‡è¯•æ¬¡æ•° | æ•°å­— | `0` | 0-5 | å¤±è´¥åçš„è‡ªåŠ¨é‡è¯•æ¬¡æ•° |

---

### ğŸ“¤ è¾“å‡ºæ•°æ®ç»“æ„

```javascript
{
  success: true,
  nodeId: "msg_entry_auto",
  nodeName: "æ¶ˆæ¯å…¥å£ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  
  // æ¶ˆæ¯æ•°æ®
  message: {
    messageId: "msg_123456",            // æ¶ˆæ¯ID
    sessionId: "sess_789012",            // ä¼šè¯ID
    robotId: "robot_001",                // æœºå™¨äººID
    robotType: "official",               // æœºå™¨äººç±»å‹ï¼ˆofficial/customï¼‰
    senderId: "user_001",                // å‘é€è€…ID
    senderName: "å¼ ä¸‰",                  // å‘é€è€…åç§°
    senderType: "user",                  // å‘é€è€…ç±»å‹ï¼ˆuser/systemï¼‰
    groupName: "å®¢æˆ·ç¾¤",                  // ç¾¤ç»„åç§°
    groupChatId: "group_001",            // ç¾¤ç»„ID
    roomType: "group",                   // æˆ¿é—´ç±»å‹ï¼ˆgroup/privateï¼‰
    messageType: "text",                 // æ¶ˆæ¯ç±»å‹
    content: "æˆ‘è¦é€€è´§",                  // æ¶ˆæ¯å†…å®¹
    atMe: true,                          // æ˜¯å¦@æˆ‘
    atList: ["robot_001"],               // @äººåˆ—è¡¨
    timestamp: "2025-01-04T10:00:00Z",   // æ—¶é—´æˆ³
    metadata: {}                         // å…ƒæ•°æ®
  },
  
  // ä¼šè¯æ•°æ®
  session: {
    sessionId: "sess_789012",            // ä¼šè¯ID
    status: "active",                    // ä¼šè¯çŠ¶æ€
    messageCount: 1                      // æ¶ˆæ¯è®¡æ•°
  },
  
  // ä¸Šä¸‹æ–‡æ•°æ®
  conversationContext: [
    {
      role: "user",                      // è§’è‰²ï¼ˆuser/assistant/systemï¼‰
      content: "æˆ‘è¦é€€è´§",                // æ¶ˆæ¯å†…å®¹
      timestamp: "2025-01-04T10:00:00Z"  // æ—¶é—´æˆ³
    }
  ],
  
  // æ‰§è¡Œä¿¡æ¯
  execution: {
    executedAt: "2025-01-04T10:00:01Z",  // æ‰§è¡Œæ—¶é—´
    duration: 150,                       // æ‰§è¡Œè€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
    actionsExecuted: 6                   // æ‰§è¡Œçš„åŠ¨ä½œæ•°é‡
  }
}
```

---

## ğŸ“ èŠ‚ç‚¹2: SMART_ANALYZEï¼ˆæ™ºèƒ½åˆ†æï¼‰

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: ğŸ§ 
- **é¢œè‰²**: #8b5cf6ï¼ˆç´«è‰²ï¼‰
- **åˆ†ç±»**: AIåˆ†æèŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 6ä¸ª

### ğŸ“– èŠ‚ç‚¹æè¿°
ä½¿ç”¨AIè¿›è¡Œæ„å›¾è¯†åˆ«ã€æƒ…ç»ªåˆ†æã€ä¿¡æ¯æ£€æµ‹ã€å®ä½“è¯†åˆ«ç­‰æ™ºèƒ½åˆ†æï¼Œä¸ºåç»­å†³ç­–æä¾›ä¾æ®ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… AIæ¨¡å—ï¼ˆæ„å›¾è¯†åˆ«ã€æƒ…ç»ªåˆ†æï¼‰
- âœ… ä¿¡æ¯ä¸­å¿ƒï¼ˆä¿¡æ¯æ£€æµ‹ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®

```javascript
// SMART_ANALYZE è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®
{
  nodeType: "SMART_ANALYZE",
  nodeId: "smart_analyze_auto",
  nodeName: "æ™ºèƒ½åˆ†æï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,
  description: "è‡ªåŠ¨è¿›è¡Œæ„å›¾è¯†åˆ«ã€æƒ…ç»ªåˆ†æã€æ•æ„Ÿä¿¡æ¯æ£€æµ‹ã€å®ä½“è¯†åˆ«ã€å·¥ä½œäººå‘˜è¯†åˆ«",
  
  actions: [
    {
      actionId: "intent_recognition",
      actionName: "æ„å›¾è¯†åˆ«",
      enabled: true,
      priority: 1,
      config: {
        // æ¨¡å‹é…ç½®
        modelId: "doubao-pro-4k-intent", // æ¨¡å‹IDï¼ˆdoubao-pro-4k-intent: è±†åŒ…æ„å›¾è¯†åˆ«æ¨¡å‹ï¼‰
        fallbackModelId: "doubao-pro-32k-service", // å¤‡ç”¨æ¨¡å‹IDï¼ˆä¸»æ¨¡å‹å¤±è´¥æ—¶ä½¿ç”¨ï¼‰
        // æ„å›¾åˆ—è¡¨
        supportedIntents: [
          {
            intentId: "service",
            intentName: "æœåŠ¡å’¨è¯¢",
            description: "ç”¨æˆ·å’¨è¯¢äº§å“æˆ–æœåŠ¡ç›¸å…³é—®é¢˜",
            keywords: ["å’¨è¯¢", "è¯¢é—®", "äº†è§£"]
          },
          {
            intentId: "complaint",
            intentName: "æŠ•è¯‰",
            description: "ç”¨æˆ·å¯¹äº§å“æˆ–æœåŠ¡è¡¨ç¤ºä¸æ»¡",
            keywords: ["æŠ•è¯‰", "ä¸æ»¡", "å·®è¯„", "åƒåœ¾"]
          },
          {
            intentId: "after_sales",
            intentName: "å”®å",
            description: "ç”¨æˆ·ç”³è¯·é€€æ¢è´§ã€ç»´ä¿®ç­‰å”®åé—®é¢˜",
            keywords: ["é€€è´§", "é€€æ¬¾", "æ¢è´§", "ç»´ä¿®", "å”®å"]
          },
          {
            intentId: "conversion",
            intentName: "è½¬åŒ–",
            description: "ç”¨æˆ·æœ‰è´­ä¹°æ„å‘",
            keywords: ["è´­ä¹°", "ä¸‹å•", "ä»·æ ¼", "ä¼˜æƒ "]
          },
          {
            intentId: "risk",
            intentName: "é£é™©",
            description: "ç”¨æˆ·å‘é€æ•æ„Ÿæˆ–æ”»å‡»æ€§å†…å®¹",
            keywords: ["å¨èƒ", "æ”»å‡»", "ä¸¾æŠ¥"]
          },
          {
            intentId: "spam",
            intentName: "åƒåœ¾ä¿¡æ¯",
            description: "ç”¨æˆ·å‘é€å¹¿å‘Šã€éªšæ‰°ç­‰ä¿¡æ¯",
            keywords: ["å¹¿å‘Š", "æ¨å¹¿", "åŠ å¾®ä¿¡", "QQ"]
          },
          {
            intentId: "chat",
            intentName: "é—²èŠ",
            description: "ç”¨æˆ·è¿›è¡Œæ—¥å¸¸é—²èŠ",
            keywords: ["ä½ å¥½", "åœ¨å—", "å“ˆå“ˆ"]
          }
        ],
        // é˜ˆå€¼é…ç½®
        confidenceThreshold: 0.7,       // ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆ0-1ï¼Œä½äºæ­¤å€¼ä½¿ç”¨é»˜è®¤æ„å›¾ï¼‰
        fallbackIntent: "chat",          // é»˜è®¤æ„å›¾ï¼ˆæœªè¯†åˆ«æ—¶ä½¿ç”¨ï¼‰
        // ä¸Šä¸‹æ–‡é…ç½®
        useContext: true,                // æ˜¯å¦ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼ˆtrue: ä½¿ç”¨, false: ä¸ä½¿ç”¨ï¼‰
        contextLength: 3,                // ä¸Šä¸‹æ–‡è½®æ•°ï¼ˆä½¿ç”¨æœ€è¿‘Nè½®å¯¹è¯ï¼‰
        // æç¤ºè¯é…ç½®
        systemPrompt: "ä½ æ˜¯ä¸€ä¸ªæ„å›¾è¯†åˆ«ä¸“å®¶ã€‚è¯·åˆ†æç”¨æˆ·çš„è¾“å…¥ï¼Œè¯†åˆ«å…¶æ„å›¾ã€‚",
        customPrompt: "",                // è‡ªå®šä¹‰æç¤ºè¯ï¼ˆç•™ç©ºä½¿ç”¨é»˜è®¤ï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,             // æ˜¯å¦ä¿å­˜åˆ°æµç¨‹ä¸Šä¸‹æ–‡
        contextKey: "intentResult"       // ä¸Šä¸‹æ–‡å˜é‡å
      }
    },
    {
      actionId: "emotion_analysis",
      actionName: "æƒ…ç»ªåˆ†æ",
      enabled: true,
      priority: 2,
      config: {
        // æ¨¡å‹é…ç½®
        modelId: "doubao-pro-4k-intent", // æ¨¡å‹ID
        // æƒ…ç»ªåˆ—è¡¨
        supportedEmotions: [
          {
            emotionId: "positive",
            emotionName: "æ­£é¢",
            description: "ç”¨æˆ·æƒ…ç»ªç§¯æã€æ»¡æ„",
            keywords: ["å¥½", "æ»¡æ„", "å–œæ¬¢", "è°¢è°¢"]
          },
          {
            emotionId: "neutral",
            emotionName: "ä¸­æ€§",
            description: "ç”¨æˆ·æƒ…ç»ªå¹³ç¨³",
            keywords: ["å—¯", "å“¦", "çŸ¥é“"]
          },
          {
            emotionId: "negative",
            emotionName: "è´Ÿé¢",
            description: "ç”¨æˆ·æƒ…ç»ªæ¶ˆæã€ä¸æ»¡",
            keywords: ["ä¸æ»¡", "ä¸å¥½", "å·®"]
          },
          {
            emotionId: "angry",
            emotionName: "æ„¤æ€’",
            description: "ç”¨æˆ·æƒ…ç»ªæ„¤æ€’ã€æ¿€åŠ¨",
            keywords: ["ç”Ÿæ°”", "æ„¤æ€’", "æŠ•è¯‰"]
          },
          {
            emotionId: "sad",
            emotionName: "æ‚²ä¼¤",
            description: "ç”¨æˆ·æƒ…ç»ªæ‚²ä¼¤",
            keywords: ["éš¾è¿‡", "ä¼¤å¿ƒ", "å¤±æœ›"]
          },
          {
            emotionId: "anxious",
            emotionName: "ç„¦è™‘",
            description: "ç”¨æˆ·æƒ…ç»ªç„¦è™‘ã€ä¸å®‰",
            keywords: ["ç€æ€¥", "æ‹…å¿ƒ", "ä¸å®‰"]
          }
        ],
        // é˜ˆå€¼é…ç½®
        scoreThreshold: 0.6,             // æƒ…ç»ªå¾—åˆ†é˜ˆå€¼ï¼ˆ0-1ï¼‰
        // ä¸Šä¸‹æ–‡é…ç½®
        useContext: true,                // æ˜¯å¦ä½¿ç”¨ä¸Šä¸‹æ–‡
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "emotionResult"
      }
    },
    {
      actionId: "sensitive_info_detection",
      actionName: "æ•æ„Ÿä¿¡æ¯æ£€æµ‹",
      enabled: true,
      priority: 3,
      config: {
        // æ£€æµ‹ç±»å‹åˆ—è¡¨
        detectionTypes: [
          "phone",                       // æ‰‹æœºå·
          "email",                       // é‚®ç®±
          "id_card",                     // èº«ä»½è¯
          "bank_card",                   // é“¶è¡Œå¡
          "address",                     // åœ°å€
          "company"                      // å…¬å¸åç§°
        ],
        // æ•æ„Ÿè¯æ£€æµ‹é…ç½®
        enableSensitiveWordDetection: true, // æ˜¯å¦å¯ç”¨æ•æ„Ÿè¯æ£€æµ‹
        sensitiveWordList: [            // æ•æ„Ÿè¯åˆ—è¡¨
          "æš´åŠ›",
          "è‰²æƒ…",
          "èµŒåš",
          "è‡ªæ€",
          "ç‚¸å¼¹"
        ],
        // æ¨¡ç³ŠåŒ¹é…é…ç½®
        enableFuzzyMatch: true,         // æ˜¯å¦å¯ç”¨æ¨¡ç³ŠåŒ¹é…
        fuzzyMatchThreshold: 0.8,       // æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼ï¼ˆ0-1ï¼‰
        // æ¨¡å‹é…ç½®
        modelId: "doubao-pro-4k-intent", // æ¨¡å‹ID
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "sensitiveInfoResult"
      }
    },
    {
      actionId: "entity_recognition",
      actionName: "å®ä½“è¯†åˆ«",
      enabled: true,
      priority: 4,
      config: {
        // å®ä½“ç±»å‹åˆ—è¡¨
        entityTypes: [
          "person",                      // äººå
          "company",                     // å…¬å¸åç§°
          "product",                     // äº§å“å
          "price",                       // ä»·æ ¼
          "date",                        // æ—¥æœŸ
          "time",                        // æ—¶é—´
          "location",                    // åœ°ç‚¹
          "phone",                       // ç”µè¯
          "email"                        // é‚®ç®±
        ],
        // æ¨¡å‹é…ç½®
        modelId: "doubao-pro-4k-intent", // æ¨¡å‹ID
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "entityResult"
      }
    },
    {
      actionId: "staff_identification",
      actionName: "å·¥ä½œäººå‘˜è¯†åˆ«",
      enabled: true,
      priority: 5,
      config: {
        // è¯†åˆ«ç­–ç•¥ï¼ˆåŸºäºç‰¹å¾åŒ¹é…ï¼Œä¸ä¾èµ–ç”¨æˆ·IDï¼‰
        identificationStrategies: [
          "company_name",                // å…¬å¸åç§°åŒ¹é…
          "remark_name",                 // å¤‡æ³¨ååŒ¹é…
          "nickname",                    // æ˜µç§°åŒ¹é…
          "special_keyword"              // ç‰¹æ®Šå…³é”®è¯åŒ¹é…
        ],
        // ä¼ä¸šåç§°ç‰¹å¾åˆ—è¡¨
        companyFeatures: [
          "å…¬å¸",
          "æœ‰é™",
          "ç§‘æŠ€",
          "é›†å›¢"
        ],
        // å¤‡æ³¨åç‰¹å¾åˆ—è¡¨
        remarkFeatures: [
          "å®¢æœ",
          "æŠ€æœ¯",
          "å”®å",
          "è¿è¥",
          "ç»ç†"
        ],
        // ç‰¹æ®Šå…³é”®è¯åˆ—è¡¨
        specialKeywords: [
          "æˆ‘æ–¹äººå‘˜",
          "æœ¬å¸",
          "å†…éƒ¨"
        ],
        // æ•°æ®åº“æŸ¥è¯¢é…ç½®
        queryStaffTable: true,           // æ˜¯å¦æŸ¥è¯¢å·¥ä½œäººå‘˜è¡¨
        staffTableName: "staff",         // å·¥ä½œäººå‘˜è¡¨å
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "staffResult"
      }
    },
    {
      actionId: "info_center_integration",
      actionName: "ä¿¡æ¯ä¸­å¿ƒæ•´åˆ",
      enabled: true,
      priority: 6,
      config: {
        // è°ƒç”¨ä¿¡æ¯ä¸­å¿ƒAPIé…ç½®
        callInfoCenterAPI: true,        // æ˜¯å¦è°ƒç”¨ä¿¡æ¯ä¸­å¿ƒAPI
        infoCenterEndpoint: "/api/info-center/analyze", // APIç«¯ç‚¹
        // æ•´åˆå­—æ®µåˆ—è¡¨
        integrateFields: [
          "intent",                      // æ„å›¾
          "emotion",                     // æƒ…ç»ª
          "entities",                    // å®ä½“
          "sensitiveInfo",               // æ•æ„Ÿä¿¡æ¯
          "staffIdentified"              // å·¥ä½œäººå‘˜è¯†åˆ«
        ],
        // ä¿å­˜åˆ†æç»“æœé…ç½®
        saveToInfoCenter: true,         // æ˜¯å¦ä¿å­˜åˆ°ä¿¡æ¯ä¸­å¿ƒ
        infoCenterTable: "message_analytics", // ç›®æ ‡è¡¨å
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "infoCenterResult"
      }
    }
  ],
  
  nodeConfig: {
    enableLogging: true,
    enableMetrics: true,
    timeout: 60000,                    // AIè°ƒç”¨å¯èƒ½è¾ƒæ…¢ï¼Œè®¾ç½®æ›´é•¿è¶…æ—¶
    retryCount: 2                      // AIè°ƒç”¨å¤±è´¥åé‡è¯•2æ¬¡
  }
}
```

---

### ğŸ›ï¸ å‰ç«¯UIé…ç½®è¡¨å•ï¼ˆä¸­æ–‡ï¼‰

**åŠ¨ä½œ1ï¼šæ„å›¾è¯†åˆ«**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `1` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `modelId` | AIæ¨¡å‹ | ä¸‹æ‹‰ | `è±†åŒ…æ„å›¾è¯†åˆ«æ¨¡å‹` | æ„å›¾è¯†åˆ«/æœåŠ¡å›å¤/è½¬åŒ–æ¨¡å‹ | ç”¨äºè¯†åˆ«æ„å›¾çš„AIæ¨¡å‹ |
| `fallbackModelId` | å¤‡ç”¨æ¨¡å‹ | ä¸‹æ‹‰ | `è±†åŒ…æœåŠ¡å›å¤æ¨¡å‹` | åŒä¸Š | ä¸»æ¨¡å‹å¤±è´¥æ—¶ä½¿ç”¨çš„æ¨¡å‹ |
| `confidenceThreshold` | ç½®ä¿¡åº¦é˜ˆå€¼ | æ»‘å— | `0.7` | 0-1 | ä½äºæ­¤å€¼æ—¶ä½¿ç”¨é»˜è®¤æ„å›¾ |
| `fallbackIntent` | é»˜è®¤æ„å›¾ | ä¸‹æ‹‰ | `é—²èŠ` | æœåŠ¡å’¨è¯¢/æŠ•è¯‰/å”®å/è½¬åŒ–/é£é™©/åƒåœ¾ä¿¡æ¯/é—²èŠ | æœªè¯†åˆ«æ—¶ä½¿ç”¨çš„æ„å›¾ |
| `useContext` | ä½¿ç”¨ä¸Šä¸‹æ–‡ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦ä½¿ç”¨å†å²å¯¹è¯ä¸Šä¸‹æ–‡ |
| `contextLength` | ä¸Šä¸‹æ–‡è½®æ•° | æ•°å­— | `3` | 1-10 | ä½¿ç”¨æœ€è¿‘Nè½®å¯¹è¯ |

**åŠ¨ä½œ2ï¼šæƒ…ç»ªåˆ†æ**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `2` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `modelId` | AIæ¨¡å‹ | ä¸‹æ‹‰ | `è±†åŒ…æ„å›¾è¯†åˆ«æ¨¡å‹` | åŒä¸Š | ç”¨äºåˆ†ææƒ…ç»ªçš„AIæ¨¡å‹ |
| `scoreThreshold` | æƒ…ç»ªå¾—åˆ†é˜ˆå€¼ | æ»‘å— | `0.6` | 0-1 | ä½äºæ­¤å€¼æ—¶ä¸è¯†åˆ«æƒ…ç»ª |
| `useContext` | ä½¿ç”¨ä¸Šä¸‹æ–‡ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦ä½¿ç”¨å†å²å¯¹è¯ä¸Šä¸‹æ–‡ |

**åŠ¨ä½œ3ï¼šæ•æ„Ÿä¿¡æ¯æ£€æµ‹**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `3` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `detectionTypes` | æ£€æµ‹ç±»å‹ | å¤šé€‰ | `[æ‰‹æœºå·,é‚®ç®±]` | æ‰‹æœºå·/é‚®ç®±/èº«ä»½è¯/é“¶è¡Œå¡/åœ°å€/å…¬å¸åç§° | æ£€æµ‹çš„æ•æ„Ÿä¿¡æ¯ç±»å‹ |
| `enableSensitiveWordDetection` | å¯ç”¨æ•æ„Ÿè¯æ£€æµ‹ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ£€æµ‹æ•æ„Ÿè¯ |
| `enableFuzzyMatch` | å¯ç”¨æ¨¡ç³ŠåŒ¹é… | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦å¯ç”¨æ¨¡ç³ŠåŒ¹é… |
| `fuzzyMatchThreshold` | æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼ | æ»‘å— | `0.8` | 0-1 | æ¨¡ç³ŠåŒ¹é…çš„ç›¸ä¼¼åº¦é˜ˆå€¼ |

**åŠ¨ä½œ4ï¼šå®ä½“è¯†åˆ«**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `4` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `entityTypes` | å®ä½“ç±»å‹ | å¤šé€‰ | `[äººå,å…¬å¸åç§°,äº§å“å]` | äººå/å…¬å¸åç§°/äº§å“å/ä»·æ ¼/æ—¥æœŸ/æ—¶é—´/åœ°ç‚¹/ç”µè¯/é‚®ç®± | è¯†åˆ«çš„å®ä½“ç±»å‹ |

**åŠ¨ä½œ5ï¼šå·¥ä½œäººå‘˜è¯†åˆ«**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `5` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `identificationStrategies` | è¯†åˆ«ç­–ç•¥ | å¤šé€‰ | `[å…¬å¸åç§°,å¤‡æ³¨å,æ˜µç§°]` | å…¬å¸åç§°/å¤‡æ³¨å/æ˜µç§°/ç‰¹æ®Šå…³é”®è¯ | ä½¿ç”¨çš„è¯†åˆ«ç­–ç•¥ |
| `queryStaffTable` | æŸ¥è¯¢å·¥ä½œäººå‘˜è¡¨ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æŸ¥è¯¢æ•°æ®åº“å·¥ä½œäººå‘˜è¡¨ |

**åŠ¨ä½œ6ï¼šä¿¡æ¯ä¸­å¿ƒæ•´åˆ**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `6` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `callInfoCenterAPI` | è°ƒç”¨ä¿¡æ¯ä¸­å¿ƒAPI | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦è°ƒç”¨ä¿¡æ¯ä¸­å¿ƒåˆ†æAPI |
| `saveToInfoCenter` | ä¿å­˜åˆ°ä¿¡æ¯ä¸­å¿ƒ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦å°†åˆ†æç»“æœä¿å­˜åˆ°ä¿¡æ¯ä¸­å¿ƒ |

---

### ğŸ“¤ è¾“å‡ºæ•°æ®ç»“æ„

```javascript
{
  success: true,
  nodeId: "smart_analyze_auto",
  nodeName: "æ™ºèƒ½åˆ†æï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  
  // æ„å›¾è¯†åˆ«ç»“æœ
  intentResult: {
    intent: "complaint",               // è¯†åˆ«çš„æ„å›¾
    intentName: "æŠ•è¯‰",                // æ„å›¾åç§°
    confidence: 0.95,                  // ç½®ä¿¡åº¦ï¼ˆ0-1ï¼‰
    needReply: true,                   // æ˜¯å¦éœ€è¦å›å¤
    needHuman: true                    // æ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥
  },
  
  // æƒ…ç»ªåˆ†æç»“æœ
  emotionResult: {
    emotion: "angry",                  // è¯†åˆ«çš„æƒ…ç»ª
    emotionName: "æ„¤æ€’",                // æƒ…ç»ªåç§°
    score: 0.88                        // æƒ…ç»ªå¾—åˆ†ï¼ˆ0-1ï¼‰
  },
  
  // æ•æ„Ÿä¿¡æ¯æ£€æµ‹ç»“æœ
  sensitiveInfoResult: {
    hasSensitiveInfo: false,           // æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯
    detectedTypes: []                  // æ£€æµ‹åˆ°çš„æ•æ„Ÿä¿¡æ¯ç±»å‹åˆ—è¡¨
  },
  
  // å®ä½“è¯†åˆ«ç»“æœ
  entityResult: {
    entities: [                        // è¯†åˆ«çš„å®ä½“åˆ—è¡¨
      {
        type: "product",               // å®ä½“ç±»å‹
        text: "iPhone 15",             // å®ä½“æ–‡æœ¬
        confidence: 0.92,              // ç½®ä¿¡åº¦
        startPos: 5,                   // èµ·å§‹ä½ç½®
        endPos: 13                     // ç»“æŸä½ç½®
      }
    ]
  },
  
  // å·¥ä½œäººå‘˜è¯†åˆ«ç»“æœ
  staffResult: {
    isStaff: false,                    // æ˜¯å¦ä¸ºå·¥ä½œäººå‘˜
    staffId: null,                     // å·¥ä½œäººå‘˜ID
    matchedStrategies: []              // åŒ¹é…çš„ç­–ç•¥åˆ—è¡¨
  },
  
  // ä¿¡æ¯ä¸­å¿ƒæ•´åˆç»“æœ
  infoCenterResult: {
    analysisId: "analysis_123",        // åˆ†æID
    saved: true                        // æ˜¯å¦ä¿å­˜æˆåŠŸ
  },
  
  execution: {
    executedAt: "2025-01-04T10:00:02Z",
    duration: 850,
    actionsExecuted: 6
  }
}
```

---

## ğŸ“ èŠ‚ç‚¹3: FLOW_DECISIONï¼ˆæµç¨‹å†³ç­–ï¼‰

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: ğŸ”€
- **é¢œè‰²**: #f59e0bï¼ˆæ©™è‰²ï¼‰
- **åˆ†ç±»**: å†³ç­–èŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 6ä¸ª

### ğŸ“– èŠ‚ç‚¹æè¿°
æ ¹æ®æ„å›¾ã€æƒ…ç»ªã€è§„åˆ™ç­‰è¿›è¡Œå†³ç­–ï¼Œç¡®å®šåç»­æµç¨‹åˆ†æ”¯ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… æµç¨‹æ§åˆ¶ï¼ˆæ¡ä»¶åˆ¤æ–­ã€åˆ†æ”¯é€‰æ‹©ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®

```javascript
// FLOW_DECISION è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®
{
  nodeType: "FLOW_DECISION",
  nodeId: "flow_decision_auto",
  nodeName: "æµç¨‹å†³ç­–ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,
  description: "æ ¹æ®æ„å›¾ã€æƒ…ç»ªã€é£é™©ã€å·¥ä½œäººå‘˜ã€è§„åˆ™è¿›è¡Œå†³ç­–è·¯ç”±",
  
  actions: [
    {
      actionId: "intent_routing",
      actionName: "æ„å›¾è·¯ç”±",
      enabled: true,
      priority: 1,
      config: {
        // å†³ç­–æ¨¡å¼
        decisionMode: "priority",        // å†³ç­–æ¨¡å¼ï¼ˆpriority: ä¼˜å…ˆåŒ¹é…, all: å…¨éƒ¨åŒ¹é…, any: ä»»æ„åŒ¹é…ï¼‰
        // è·¯ç”±è§„åˆ™åˆ—è¡¨
        routes: [
          {
            routeId: "route_001",
            routeName: "æŠ•è¯‰è½¬äººå·¥",
            condition: "intentResult.intent === 'complaint'", // æ¡ä»¶è¡¨è¾¾å¼
            targetNode: "HUMAN_HANDOVER", // ç›®æ ‡èŠ‚ç‚¹ID
            priority: 1,                 // ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
            label: "æŠ•è¯‰è½¬äººå·¥",         // è·¯ç”±æ ‡ç­¾ï¼ˆæ˜¾ç¤ºåç§°ï¼‰
            description: "ç”¨æˆ·æŠ•è¯‰æ—¶è½¬äººå·¥å¤„ç†",
            enabled: true                // æ˜¯å¦å¯ç”¨æ­¤è·¯ç”±
          },
          {
            routeId: "route_002",
            routeName: "é£é™©å¤„ç†",
            condition: "intentResult.intent === 'risk'",
            targetNode: "RISK_HANDLER",
            priority: 2,
            label: "é£é™©å¤„ç†",
            description: "æ£€æµ‹åˆ°é£é™©å†…å®¹æ—¶è¿›è¡Œé£é™©å¤„ç†",
            enabled: true
          },
          {
            routeId: "route_003",
            routeName: "åƒåœ¾ä¿¡æ¯ç»“æŸ",
            condition: "intentResult.intent === 'spam'",
            targetNode: "FLOW_END",
            priority: 3,
            label: "åƒåœ¾ä¿¡æ¯ç»“æŸ",
            description: "åƒåœ¾ä¿¡æ¯ç›´æ¥ç»“æŸæµç¨‹",
            enabled: true
          },
          {
            routeId: "route_004",
            routeName: "è½¬åŒ–AIå›å¤",
            condition: "intentResult.intent === 'conversion'",
            targetNode: "AI_AGENT",
            priority: 4,
            label: "è½¬åŒ–AIå›å¤",
            description: "æœ‰è´­ä¹°æ„å‘æ—¶ä½¿ç”¨è½¬åŒ–æ¨¡å‹å›å¤",
            enabled: true
          },
          {
            routeId: "route_005",
            routeName: "æœåŠ¡å’¨è¯¢AIå›å¤",
            condition: "intentResult.intent === 'service' || intentResult.intent === 'chat'",
            targetNode: "AI_AGENT",
            priority: 5,
            label: "æœåŠ¡å’¨è¯¢AIå›å¤",
            description: "æœåŠ¡å’¨è¯¢æˆ–é—²èŠæ—¶ä½¿ç”¨AIå›å¤",
            enabled: true
          }
        ],
        // é»˜è®¤åˆ†æ”¯ï¼ˆæ‰€æœ‰è·¯ç”±éƒ½ä¸åŒ¹é…æ—¶ä½¿ç”¨ï¼‰
        defaultRoute: {
          targetNode: "AI_AGENT",        // é»˜è®¤ç›®æ ‡èŠ‚ç‚¹
          label: "é»˜è®¤AIå›å¤",           // é»˜è®¤è·¯ç”±æ ‡ç­¾
          description: "æœªåŒ¹é…åˆ°ä»»ä½•è·¯ç”±æ—¶çš„é»˜è®¤è¡Œä¸º"
        }
      }
    },
    {
      actionId: "emotion_routing",
      actionName: "æƒ…ç»ªè·¯ç”±",
      enabled: true,
      priority: 2,
      config: {
        // æƒ…ç»ªé˜ˆå€¼é…ç½®
        emotionThreshold: {
          angry: 0.7,                    // æ„¤æ€’æƒ…ç»ªé˜ˆå€¼ï¼ˆ>= æ­¤å€¼æ—¶è§¦å‘ï¼‰
          negative: 0.6,                 // è´Ÿé¢æƒ…ç»ªé˜ˆå€¼
          positive: 0.7                  // æ­£é¢æƒ…ç»ªé˜ˆå€¼
        },
        // æƒ…ç»ªè·¯ç”±è§„åˆ™
        routes: [
          {
            routeId: "emotion_001",
            routeName: "æ„¤æ€’è½¬äººå·¥",
            condition: "emotionResult.emotion === 'angry' && emotionResult.score >= 0.7",
            targetNode: "HUMAN_HANDOVER",
            priority: 1,
            label: "æ„¤æ€’è½¬äººå·¥",
            description: "ç”¨æˆ·æƒ…ç»ªæ„¤æ€’æ—¶è½¬äººå·¥",
            enabled: true
          },
          {
            routeId: "emotion_002",
            routeName: "è´Ÿé¢æƒ…ç»ªååŒ",
            condition: "emotionResult.emotion === 'negative' && emotionResult.score >= 0.6",
            targetNode: "STAFF_COOPERATE",
            priority: 2,
            label: "è´Ÿé¢æƒ…ç»ªååŒ",
            description: "ç”¨æˆ·æƒ…ç»ªè´Ÿé¢æ—¶å¯åŠ¨å·¥ä½œäººå‘˜ååŒ",
            enabled: true
          }
        ]
      }
    },
    {
      actionId: "risk_routing",
      actionName: "é£é™©è·¯ç”±",
      enabled: true,
      priority: 3,
      config: {
        // é£é™©è§„åˆ™
        riskRules: [
          {
            ruleId: "risk_001",
            ruleName: "æ•æ„Ÿä¿¡æ¯é£é™©",
            condition: "sensitiveInfoResult.hasSensitiveInfo === true",
            riskLevel: "critical",       // é£é™©çº§åˆ«ï¼ˆcritical: ä¸¥é‡, high: é«˜, medium: ä¸­, low: ä½ï¼‰
            targetNode: "RISK_HANDLER",
            label: "æ•æ„Ÿä¿¡æ¯é£é™©",
            description: "æ£€æµ‹åˆ°æ•æ„Ÿä¿¡æ¯æ—¶çš„é£é™©å¤„ç†",
            enabled: true
          },
          {
            ruleId: "risk_002",
            ruleName: "åƒåœ¾ä¿¡æ¯",
            condition: "intentResult.intent === 'spam'",
            riskLevel: "high",
            targetNode: "FLOW_END",
            label: "åƒåœ¾ä¿¡æ¯",
            description: "åƒåœ¾ä¿¡æ¯ç›´æ¥ç»“æŸ",
            enabled: true
          },
          {
            ruleId: "risk_003",
            ruleName: "é£é™©å†…å®¹",
            condition: "intentResult.intent === 'risk'",
            riskLevel: "high",
            targetNode: "RISK_HANDLER",
            label: "é£é™©å†…å®¹",
            description: "æ£€æµ‹åˆ°é£é™©å†…å®¹æ—¶å¤„ç†",
            enabled: true
          }
        ]
      }
    },
    {
      actionId: "staff_routing",
      actionName: "å·¥ä½œäººå‘˜è·¯ç”±",
      enabled: true,
      priority: 4,
      config: {
        // å·¥ä½œäººå‘˜è¯†åˆ«è·¯ç”±
        staffRoutes: [
          {
            routeId: "staff_001",
            routeName: "å·¥ä½œäººå‘˜æ¶ˆæ¯",
            condition: "staffResult.isStaff === true",
            targetNode: "STAFF_COOPERATE",
            label: "å·¥ä½œäººå‘˜æ¶ˆæ¯",
            description: "æ£€æµ‹åˆ°å·¥ä½œäººå‘˜æ¶ˆæ¯æ—¶å¯åŠ¨ååŒ",
            enabled: true
          }
        ]
      }
    },
    {
      actionId: "rule_routing",
      actionName: "è§„åˆ™è·¯ç”±",
      enabled: true,
      priority: 5,
      config: {
        // è‡ªå®šä¹‰è§„åˆ™åˆ—è¡¨
        customRules: [
          {
            ruleId: "rule_001",
            ruleName: "VIPå®¢æˆ·ä¼˜å…ˆ",
            condition: "message.senderType === 'vip'",
            targetNode: "AI_AGENT",
            priority: 10,                // é«˜ä¼˜å…ˆçº§
            label: "VIPå®¢æˆ·ä¼˜å…ˆ",
            description: "VIPå®¢æˆ·ä¼˜å…ˆå¤„ç†",
            enabled: true
          },
          {
            ruleId: "rule_002",
            ruleName: "å·¥ä½œæ—¶é—´",
            condition: "isWorkingHours() === true",
            targetNode: "AI_AGENT",
            priority: 5,
            label: "å·¥ä½œæ—¶é—´",
            description: "å·¥ä½œæ—¶é—´å†…AIå¤„ç†",
            enabled: true
          },
          {
            ruleId: "rule_003",
            ruleName: "éå·¥ä½œæ—¶é—´",
            condition: "isWorkingHours() === false",
            targetNode: "FLOW_END",
            priority: 5,
            label: "éå·¥ä½œæ—¶é—´",
            description: "éå·¥ä½œæ—¶é—´ç»“æŸæµç¨‹",
            enabled: true
          }
        ]
      }
    },
    {
      actionId: "decision_output",
      actionName: "å†³ç­–ç»“æœè¾“å‡º",
      enabled: true,
      priority: 6,
      config: {
        // è¾“å‡ºå˜é‡æ˜ å°„
        outputVariables: {
          selectedRoute: "route.label",  // é€‰ä¸­çš„è·¯ç”±åç§°
          targetNode: "route.targetNode", // ç›®æ ‡èŠ‚ç‚¹ID
          decisionReason: "route.reason", // å†³ç­–åŸå› 
          confidence: "route.confidence", // å†³ç­–ç½®ä¿¡åº¦
          matchedConditions: "route.conditions" // åŒ¹é…çš„æ¡ä»¶åˆ—è¡¨
        },
        // ä¿å­˜åˆ°ä¸Šä¸‹æ–‡
        saveToContext: true,
        contextKey: "decisionResult"
      }
    }
  ],
  
  nodeConfig: {
    enableLogging: true,
    enableMetrics: true,
    timeout: 10000,                    // å†³ç­–é€»è¾‘åº”å¿«é€Ÿæ‰§è¡Œ
    retryCount: 0                      // å†³ç­–å¤±è´¥ä¸é‡è¯•
  }
}
```

---

### ğŸ›ï¸ å‰ç«¯UIé…ç½®è¡¨å•ï¼ˆä¸­æ–‡ï¼‰

**åŠ¨ä½œ1ï¼šæ„å›¾è·¯ç”±**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | å¯é€‰å€¼ | è¯´æ˜ |
|--------|---------|------|--------|--------|------|
| `enabled` | å¯ç”¨æ­¤åŠ¨ä½œ | å¼€å…³ | `å¼€å¯` | å¼€å¯/å…³é—­ | æ˜¯å¦æ‰§è¡Œæ­¤åŠ¨ä½œ |
| `priority` | æ‰§è¡Œä¼˜å…ˆçº§ | æ•°å­— | `1` | 1-100 | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `decisionMode` | å†³ç­–æ¨¡å¼ | å•é€‰ | `ä¼˜å…ˆåŒ¹é…` | ä¼˜å…ˆåŒ¹é…/å…¨éƒ¨åŒ¹é…/ä»»æ„åŒ¹é… | è·¯ç”±åŒ¹é…æ–¹å¼ |

**è·¯ç”±è§„åˆ™é…ç½®ï¼ˆå¯æ·»åŠ /åˆ é™¤å¤šä¸ªè·¯ç”±ï¼‰**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|---------|------|--------|------|
| `routeName` | è·¯ç”±åç§° | æ–‡æœ¬ | - | è·¯ç”±çš„æ˜¾ç¤ºåç§° |
| `condition` | æ¡ä»¶è¡¨è¾¾å¼ | ä»£ç ç¼–è¾‘å™¨ | - | æ”¯æŒJSè¡¨è¾¾å¼ï¼Œå¦‚`intentResult.intent === 'complaint'` |
| `targetNode` | ç›®æ ‡èŠ‚ç‚¹ | ä¸‹æ‹‰ | - | é€‰æ‹©è¦è·³è½¬çš„ç›®æ ‡èŠ‚ç‚¹ |
| `priority` | ä¼˜å…ˆçº§ | æ•°å­— | `1` | æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ |
| `enabled` | å¯ç”¨æ­¤è·¯ç”± | å¼€å…³ | `å¼€å¯` | æ˜¯å¦å¯ç”¨æ­¤è·¯ç”± |

**é»˜è®¤åˆ†æ”¯é…ç½®**

| é…ç½®é¡¹ | ä¸­æ–‡æ ‡ç­¾ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|---------|------|--------|------|
| `targetNode` | é»˜è®¤ç›®æ ‡èŠ‚ç‚¹ | ä¸‹æ‹‰ | `AI_AGENT` | æ‰€æœ‰è·¯ç”±éƒ½ä¸åŒ¹é…æ—¶è·³è½¬çš„èŠ‚ç‚¹ |
| `label` | é»˜è®¤æ ‡ç­¾ | æ–‡æœ¬ | `é»˜è®¤AIå›å¤` | é»˜è®¤è·¯ç”±çš„æ˜¾ç¤ºåç§° |

---

## ğŸ“ èŠ‚ç‚¹4: AI_AGENTï¼ˆAIä»£ç†ï¼‰

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: ğŸ¤–
- **é¢œè‰²**: #3b82f6ï¼ˆè“è‰²ï¼‰
- **åˆ†ç±»**: ä¸šåŠ¡å¤„ç†èŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 8ä¸ª

### ğŸ“– èŠ‚ç‚¹æè¿°
ä½¿ç”¨AIç”Ÿæˆæ™ºèƒ½å›å¤ï¼Œæ”¯æŒè§’è‰²äººè®¾ã€è¯æœ¯æ¨¡æ¿ã€ä¸Šä¸‹æ–‡å†å²ã€å·¥ä½œäººå‘˜è”åŠ¨ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… AIæ¨¡å—ï¼ˆAIå›å¤ã€è§’è‰²é…ç½®ã€è¯æœ¯æ¨¡æ¿ï¼‰
- âœ… æœºå™¨äººç®¡ç†ï¼ˆæœºå™¨äººçŠ¶æ€ï¼‰
- âœ… å·¥ä½œäººå‘˜è”åŠ¨ï¼ˆå·¥ä½œäººå‘˜è¯†åˆ«ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®

```javascript
// AI_AGENT è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®
{
  nodeType: "AI_AGENT",
  nodeId: "ai_agent_auto",
  nodeName: "AIä»£ç†ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,
  description: "ä½¿ç”¨AIç”Ÿæˆæ™ºèƒ½å›å¤ï¼Œæ”¯æŒè§’è‰²äººè®¾ã€è¯æœ¯æ¨¡æ¿ã€å·¥ä½œäººå‘˜è”åŠ¨",
  
  actions: [
    {
      actionId: "ai_reply_generation",
      actionName: "AIå›å¤ç”Ÿæˆ",
      enabled: true,
      priority: 1,
      config: {
        // æ¨¡å‹é…ç½®
        modelId: "doubao-pro-32k-service", // æ¨¡å‹IDï¼ˆè±†åŒ…æœåŠ¡å›å¤æ¨¡å‹ï¼‰
        fallbackModelId: "deepseek-v3-conversion", // å¤‡ç”¨æ¨¡å‹ï¼ˆDeepSeekè½¬åŒ–æ¨¡å‹ï¼‰
        // è§’è‰²é…ç½®
        personaId: "service_agent",      // è§’è‰²IDï¼ˆservice_agent: å®¢æœåŠ©æ‰‹ï¼‰
        usePersona: true,                // æ˜¯å¦ä½¿ç”¨è§’è‰²é…ç½®
        // è¯æœ¯æ¨¡æ¿é…ç½®
        templateId: null,                // è¯æœ¯æ¨¡æ¿IDï¼ˆå¯é€‰ï¼Œç•™ç©ºä¸ä½¿ç”¨ï¼‰
        useTemplate: false,              // æ˜¯å¦ä½¿ç”¨è¯æœ¯æ¨¡æ¿
        // æ¸©åº¦å‚æ•°
        temperature: 0.7,                // æ¸©åº¦ï¼ˆ0-2ï¼Œ0: ä¸¥è°¨ï¼Œ2: éšæœºï¼‰
        // Tokené™åˆ¶
        maxTokens: 1000,                 // æœ€å¤§Tokenæ•°
        // ä¸Šä¸‹æ–‡é…ç½®
        useContextHistory: true,         // æ˜¯å¦ä½¿ç”¨ä¸Šä¸‹æ–‡å†å²
        contextWindowSize: 10,           // ä¸Šä¸‹æ–‡çª—å£å¤§å°ï¼ˆè½®æ•°ï¼‰
        // æç¤ºè¯é…ç½®
        systemPrompt: "",                // è‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼ˆç•™ç©ºä½¿ç”¨è§’è‰²æç¤ºè¯ï¼‰
        useRolePrompt: true,             // æ˜¯å¦ä½¿ç”¨è§’è‰²æç¤ºè¯
        // æ€è€ƒæ¨¡å¼
        enableThinking: false,           // æ˜¯å¦å¯ç”¨æ€è€ƒæ¨¡å¼ï¼ˆChain of Thoughtï¼‰
        // æµå¼è¾“å‡º
        enableStreaming: true,           // æ˜¯å¦å¯ç”¨æµå¼è¾“å‡ºï¼ˆSSEï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "aiResponse"
      }
    },
    {
      actionId: "staff_reply",
      actionName: "å·¥ä½œäººå‘˜è”åŠ¨å›å¤",
      enabled: true,
      priority: 2,
      config: {
        // å·¥ä½œäººå‘˜è¯†åˆ«é…ç½®
        checkStaffIdentified: true,      // æ˜¯å¦æ£€æŸ¥å·¥ä½œäººå‘˜è¯†åˆ«ç»“æœ
        staffIdSource: "context.staffResult.staffId", // å·¥ä½œäººå‘˜IDæ¥æº
        // å·¥ä½œäººå‘˜å›å¤æ¨¡å¼
        staffReplyMode: "notify",        // æ¨¡å¼ï¼ˆnotify: é€šçŸ¥, proxy: ä»£ç†, assist: è¾…åŠ©ï¼‰
        // é€šçŸ¥é…ç½®
        notifyChannels: ["email", "wechat"], // é€šçŸ¥æ¸ é“ï¼ˆemail: é‚®ä»¶, wechat: å¾®ä¿¡, dingtalk: é’‰é’‰ï¼‰
        notifyTemplateId: "staff_notify_template_001", // é€šçŸ¥æ¨¡æ¿ID
        // ä»£ç†æ¨¡å¼é…ç½®
        proxyReply: true,                // æ˜¯å¦ä»£ç†å›å¤
        proxyMessage: "ã€å·¥ä½œäººå‘˜ã€‘${senderName}: ${content}", // ä»£ç†æ¶ˆæ¯æ ¼å¼
        // è¾…åŠ©æ¨¡å¼é…ç½®
        assistMode: "suggestion",        // è¾…åŠ©æ¨¡å¼ï¼ˆsuggestion: å»ºè®®, draft: è‰ç¨¿ï¼‰
        generateSuggestion: true,        // æ˜¯å¦ç”Ÿæˆå›å¤å»ºè®®
        suggestionCount: 3               // å»ºè®®æ•°é‡
      }
    },
    {
      actionId: "persona_load",
      actionName: "è§’è‰²é…ç½®åŠ è½½",
      enabled: true,
      priority: 3,
      config: {
        // è§’è‰²é…ç½®
        personaId: "service_agent",      // è§’è‰²ID
        personaFields: [                 // åŠ è½½çš„è§’è‰²å­—æ®µåˆ—è¡¨
          "personaName",                 // è§’è‰²åç§°
          "systemPrompt",                // ç³»ç»Ÿæç¤ºè¯
          "temperature",                 // æ¸©åº¦å‚æ•°
          "maxTokens",                   // æœ€å¤§Tokenæ•°
          "style",                       // å›å¤é£æ ¼
          "behaviorRules"                // è¡Œä¸ºè§„åˆ™
        ],
        // æ•°æ®åº“è¡¨é…ç½®
        tableName: "ai_personas",        // è§’è‰²è¡¨å
        // ç‰ˆæœ¬ç®¡ç†é…ç½®
        useVersion: true,                // æ˜¯å¦ä½¿ç”¨ç‰ˆæœ¬
        versionId: "latest",             // ç‰ˆæœ¬IDï¼ˆlatest: æœ€æ–°ç‰ˆæœ¬ï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "personaConfig"
      }
    },
    {
      actionId: "template_load",
      actionName: "è¯æœ¯æ¨¡æ¿åŠ è½½",
      enabled: true,
      priority: 4,
      config: {
        // æ¨¡æ¿é…ç½®
        templateId: null,                // æ¨¡æ¿IDï¼ˆå¯é€‰ï¼‰
        templateCategoryId: "service",   // æ¨¡æ¿åˆ†ç±»IDï¼ˆservice: æœåŠ¡, conversion: è½¬åŒ–, complaint: æŠ•è¯‰ï¼‰
        // æ¨¡æ¿å­—æ®µ
        templateFields: [                // åŠ è½½çš„æ¨¡æ¿å­—æ®µåˆ—è¡¨
          "templateName",                // æ¨¡æ¿åç§°
          "templateContent",             // æ¨¡æ¿å†…å®¹
          "variables",                   // å˜é‡åˆ—è¡¨
          "exampleInput",                // ç¤ºä¾‹è¾“å…¥
          "exampleOutput"                // ç¤ºä¾‹è¾“å‡º
        ],
        // æ•°æ®åº“è¡¨é…ç½®
        tableName: "ai_message_templates", // æ¨¡æ¿è¡¨å
        // å˜é‡æ›¿æ¢é…ç½®
        enableVariableReplacement: true, // æ˜¯å¦å¯ç”¨å˜é‡æ›¿æ¢
        variableMapping: {               // å˜é‡æ˜ å°„ï¼ˆæ¨¡æ¿å˜é‡ -> ä¸Šä¸‹æ–‡å˜é‡ï¼‰
          "{userName}": "message.senderName",
          "{productName}": "entityResult.entities[0].text",
          "{time}": "currentTime()"
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "templateConfig"
      }
    },
    {
      actionId: "ai_optimization",
      actionName: "AIè°ƒç”¨ä¼˜åŒ–",
      enabled: true,
      priority: 5,
      config: {
        // ç¼“å­˜é…ç½®
        enableCache: true,               // æ˜¯å¦å¯ç”¨ç¼“å­˜
        cacheTTL: 3600,                  // ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
        cacheKey: "ai:${modelId}:${contentHash}", // ç¼“å­˜key
        // é‡è¯•é…ç½®
        enableRetry: true,               // æ˜¯å¦å¯ç”¨é‡è¯•
        retryCount: 3,                   // é‡è¯•æ¬¡æ•°
        retryDelay: 2000,                // é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
        retryStrategy: "exponential",    // é‡è¯•ç­–ç•¥ï¼ˆfixed: å›ºå®šå»¶è¿Ÿ, exponential: æŒ‡æ•°é€€é¿ï¼‰
        // è¶…æ—¶é…ç½®
        timeout: 30000,                  // è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        // è´Ÿè½½å‡è¡¡é…ç½®
        enableLoadBalancing: true,       // æ˜¯å¦å¯ç”¨è´Ÿè½½å‡è¡¡
        loadBalancingStrategy: "round_robin", // è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆround_robin: è½®è¯¢, least_loaded: æœ€å°‘è´Ÿè½½, weighted: åŠ æƒï¼‰
        // æˆæœ¬ä¼˜åŒ–é…ç½®
        enableCostOptimization: true,    // æ˜¯å¦å¯ç”¨æˆæœ¬ä¼˜åŒ–
        preferCheaperModel: false,       // æ˜¯å¦ä¼˜å…ˆä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹
        // ç›‘æ§é…ç½®
        enableMetrics: true,             // æ˜¯å¦å¯ç”¨æŒ‡æ ‡ç›‘æ§
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "aiOptimization"
      }
    },
    {
      actionId: "ai_logging",
      actionName: "AIè°ƒç”¨è®°å½•",
      enabled: true,
      priority: 6,
      config: {
        // è®°å½•é…ç½®
        saveToDatabase: true,            // æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“
        tableName: "ai_interactions",    // ç›®æ ‡è¡¨å
        // è®°å½•å­—æ®µåˆ—è¡¨
        logFields: [
          "interactionId",               // äº¤äº’ID
          "modelId",                     // æ¨¡å‹ID
          "personaId",                   // è§’è‰²ID
          "templateId",                  // æ¨¡æ¿ID
          "input",                       // è¾“å…¥
          "output",                      // è¾“å‡º
          "tokens",                      // Tokenä½¿ç”¨é‡
          "responseTime",                // å“åº”æ—¶é—´
          "cost",                        // æˆæœ¬
          "status",                      // çŠ¶æ€
          "errorMessage",                // é”™è¯¯ä¿¡æ¯
          "timestamp"                    // æ—¶é—´æˆ³
        ],
        // æ€§èƒ½ç›‘æ§é…ç½®
        trackResponseTime: true,         // æ˜¯å¦è¿½è¸ªå“åº”æ—¶é—´
        trackTokenUsage: true,           // æ˜¯å¦è¿½è¸ªTokenä½¿ç”¨é‡
        trackCost: true,                 // æ˜¯å¦è¿½è¸ªæˆæœ¬
        // é”™è¯¯è¿½è¸ªé…ç½®
        trackErrors: true,               // æ˜¯å¦è¿½è¸ªé”™è¯¯
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "aiLogging"
      }
    },
    {
      actionId: "reply_quality_evaluation",
      actionName: "å›å¤è´¨é‡è¯„ä¼°",
      enabled: true,
      priority: 7,
      config: {
        // è¯„ä¼°ç»´åº¦åˆ—è¡¨
        evaluationDimensions: [
          {
            dimension: "relevance",       // ç»´åº¦ID
            description: "ç›¸å…³æ€§",         // ç»´åº¦æè¿°
            weight: 0.4                   // æƒé‡ï¼ˆ0-1ï¼‰
          },
          {
            dimension: "accuracy",
            description: "å‡†ç¡®æ€§",
            weight: 0.3
          },
          {
            dimension: "politeness",
            description: "ç¤¼è²Œæ€§",
            weight: 0.2
          },
          {
            dimension: "helpfulness",
            description: "æœ‰ç”¨æ€§",
            weight: 0.1
          }
        ],
        // è‡ªåŠ¨è¯„ä¼°é…ç½®
        enableAutoEvaluation: true,      // æ˜¯å¦å¯ç”¨è‡ªåŠ¨è¯„ä¼°
        evaluationModelId: "doubao-pro-4k-intent", // è¯„ä¼°æ¨¡å‹ID
        // äººå·¥è¯„ä¼°é…ç½®
        enableHumanEvaluation: false,    // æ˜¯å¦å¯ç”¨äººå·¥è¯„ä¼°
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "replyQuality"
      }
    },
    {
      actionId: "multi_model_support",
      actionName: "å¤šæ¨¡å‹æ”¯æŒ",
      enabled: true,
      priority: 8,
      config: {
        // æ”¯æŒçš„AIæä¾›å•†åˆ—è¡¨
        supportedProviders: [
          "aliyun_qwen",                 // é˜¿é‡Œäº‘åƒé—®
          "aliyun_qwen_pro",             // é˜¿é‡Œäº‘åƒé—®PRO
          "openai",                      // OpenAI
          "claude",                      // Anthropic Claude
          "deepseek",                    // DeepSeek
          "kimi",                        // Kimi
          "doubao"                       // è±†åŒ…
        ],
        // æ¨¡å‹æ˜ å°„ï¼ˆä»»åŠ¡ -> æ¨¡å‹ï¼‰
        modelMapping: {
          "intent_recognition": "doubao-pro-4k-intent",
          "service_reply": "doubao-pro-32k-service",
          "conversion": "deepseek-v3-conversion",
          "tech_support": "deepseek-r1-tech",
          "evaluation": "doubao-pro-4k-intent"
        },
        // æ¨¡å‹åˆ‡æ¢ç­–ç•¥
        switchStrategy: "fallback",      // åˆ‡æ¢ç­–ç•¥ï¼ˆfallback: å¤±è´¥åˆ‡æ¢, round_robin: è½®è¯¢, least_loaded: æœ€å°‘è´Ÿè½½ï¼‰
        // æ¨¡å‹å¥åº·æ£€æŸ¥é…ç½®
        enableHealthCheck: true,         // æ˜¯å¦å¯ç”¨å¥åº·æ£€æŸ¥
        healthCheckInterval: 60000,      // å¥åº·æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "multiModel"
      }
    }
  ],
  
  nodeConfig: {
    enableLogging: true,
    enableMetrics: true,
    timeout: 60000,                    // AIè°ƒç”¨å¯èƒ½è¾ƒæ…¢
    retryCount: 2
  }
}
```

---

ç”±äºæ–‡æ¡£å†…å®¹è¾ƒé•¿ï¼Œæˆ‘å°†ç»§ç»­åˆ›å»ºå…¶ä»–èŠ‚ç‚¹çš„é…ç½®ã€‚è®©æˆ‘å…ˆä¿å­˜å½“å‰è¿›åº¦ï¼Œç„¶åç»§ç»­å®Œå–„å‰©ä½™èŠ‚ç‚¹...<tool_call>write_file<arg_key>content</arg_key><arg_value># æµç¨‹å¼•æ“èŠ‚ç‚¹é…ç½®è¯¦ç»†è®¾è®¡ v4.0ï¼ˆå¢å¼ºç‰ˆï¼‰- ç¬¬äºŒéƒ¨åˆ†

## ğŸ“ èŠ‚ç‚¹5: RISK_HANDLERï¼ˆé£é™©å¤„ç†ï¼‰

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: âš ï¸
- **é¢œè‰²**: #ef4444ï¼ˆçº¢è‰²ï¼‰
- **åˆ†ç±»**: ä¸šåŠ¡å¤„ç†èŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 7ä¸ª

### ğŸ“– èŠ‚ç‚¹æè¿°
æ£€æµ‹å’Œå¤„ç†é£é™©æ¶ˆæ¯ï¼ŒåŒ…æ‹¬æ•æ„Ÿå†…å®¹ã€åƒåœ¾ä¿¡æ¯ã€æ”»å‡»æ€§è¨€è®ºç­‰ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… é£é™©ç®¡ç†ï¼ˆé£é™©æ£€æµ‹ã€é£é™©å¤„ç†ï¼‰
- âœ… å‘Šè­¦ç³»ç»Ÿï¼ˆå‘Šè­¦è§¦å‘ï¼‰
- âœ… å·¥ä½œäººå‘˜è”åŠ¨ï¼ˆé€šçŸ¥å·¥ä½œäººå‘˜ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®

```javascript
// RISK_HANDLER è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®
{
  nodeType: "RISK_HANDLER",
  nodeId: "risk_handler_auto",
  nodeName: "é£é™©å¤„ç†ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,
  description: "æ£€æµ‹å’Œå¤„ç†é£é™©æ¶ˆæ¯ï¼ŒåŒ…æ‹¬æ•æ„Ÿå†…å®¹ã€åƒåœ¾ä¿¡æ¯ã€æ”»å‡»æ€§è¨€è®º",
  
  actions: [
    {
      actionId: "risk_detection",
      actionName: "é£é™©æ£€æµ‹",
      enabled: true,
      priority: 1,
      config: {
        // é£é™©ç±»å‹åˆ—è¡¨
        riskTypes: [
          "sensitive_content",           // æ•æ„Ÿå†…å®¹
          "spam",                        // åƒåœ¾ä¿¡æ¯
          "harassment",                  // éªšæ‰°
          "attack",                      // æ”»å‡»
          "fraud"                        // æ¬ºè¯ˆ
        ],
        // æ£€æµ‹è§„åˆ™åˆ—è¡¨
        detectionRules: [
          {
            ruleId: "sensitive_word",
            ruleName: "æ•æ„Ÿè¯æ£€æµ‹",
            detectionMethod: "keyword",  // æ£€æµ‹æ–¹æ³•ï¼ˆkeyword: å…³é”®è¯, model: æ¨¡å‹, hybrid: æ··åˆï¼‰
            keywords: [                  // æ•æ„Ÿè¯åˆ—è¡¨
              "æš´åŠ›",
              "è‰²æƒ…",
              "èµŒåš",
              "è‡ªæ€",
              "ç‚¸å¼¹"
            ],
            threshold: 1,                // åŒ¹é…é˜ˆå€¼ï¼ˆåŒ¹é…åˆ°æ­¤æ•°é‡æ—¶è§¦å‘ï¼‰
            enabled: true
          },
          {
            ruleId: "spam_pattern",
            ruleName: "åƒåœ¾ä¿¡æ¯æ¨¡å¼",
            detectionMethod: "regex",    // æ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹
            pattern: "(å¾®ä¿¡|QQ|ç”µè¯|è”ç³»æ–¹å¼)", // æ­£åˆ™è¡¨è¾¾å¼
            threshold: 2,                // åŒ¹é…æ¬¡æ•°é˜ˆå€¼
            enabled: true
          },
          {
            ruleId: "harassment_language",
            ruleName: "éªšæ‰°è¯­è¨€",
            detectionMethod: "model",    // AIæ¨¡å‹æ£€æµ‹
            modelId: "doubao-pro-4k-intent",
            threshold: 0.8,              // æ¨¡å‹ç½®ä¿¡åº¦é˜ˆå€¼
            enabled: true
          }
        ],
        // æ¨¡å‹é…ç½®
        modelId: "doubao-pro-4k-intent", // æ£€æµ‹æ¨¡å‹ID
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "riskDetection"
      }
    },
    {
      actionId: "risk_level_assessment",
      actionName: "é£é™©ç­‰çº§è¯„ä¼°",
      enabled: true,
      priority: 2,
      config: {
        // é£é™©ç­‰çº§å®šä¹‰
        riskLevels: [
          {
            level: "critical",           // ç­‰çº§ID
            levelName: "ä¸¥é‡",           // ç­‰çº§åç§°
            scoreRange: [0.8, 1.0],      // å¾—åˆ†èŒƒå›´
            actions: [                   // é‡‡å–çš„è¡ŒåŠ¨
              "block",                  // é˜»æ­¢æ¶ˆæ¯
              "alert_critical",         // å‘é€ä¸¥é‡å‘Šè­¦
              "notify_admin"            // é€šçŸ¥ç®¡ç†å‘˜
            ],
            escalationLevel: 3           // å‘Šè­¦å‡çº§çº§åˆ«
          },
          {
            level: "high",
            levelName: "é«˜",
            scoreRange: [0.6, 0.8],
            actions: [
              "warn",                   // å‘é€è­¦å‘Š
              "alert_high",             // å‘é€é«˜çº§å‘Šè­¦
              "notify_staff"            // é€šçŸ¥å·¥ä½œäººå‘˜
            ],
            escalationLevel: 2
          },
          {
            level: "medium",
            levelName: "ä¸­",
            scoreRange: [0.4, 0.6],
            actions: [
              "warn",                   // å‘é€è­¦å‘Š
              "alert_medium"            // å‘é€ä¸­çº§å‘Šè­¦
            ],
            escalationLevel: 1
          },
          {
            level: "low",
            levelName: "ä½",
            scoreRange: [0.0, 0.4],
            actions: [
              "log"                     // ä»…è®°å½•æ—¥å¿—
            ],
            escalationLevel: 0
          }
        ],
        // è¯„ä¼°æ–¹æ³•
        assessmentMethod: "weighted",    // è¯„ä¼°æ–¹æ³•ï¼ˆweighted: åŠ æƒ, max: æœ€å¤§å€¼, min: æœ€å°å€¼ï¼‰
        weights: {                      // å„é£é™©ç±»å‹çš„æƒé‡
          sensitive_content: 0.4,
          spam: 0.3,
          harassment: 0.2,
          attack: 0.1
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "riskLevel"
      }
    },
    {
      actionId: "risk_soothing",
      actionName: "é£é™©å®‰æŠšå›å¤",
      enabled: true,
      priority: 3,
      config: {
        // å®‰æŠšç­–ç•¥åˆ—è¡¨
        soothingStrategies: [
          {
            strategyId: "empathy",
            strategyName: "å…±æƒ…å®‰æŠš",
            template: "éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥ä¸å¥½çš„ä½“éªŒï¼Œæˆ‘ä»¬éå¸¸é‡è§†æ‚¨çš„åé¦ˆï¼Œä¼šå°½å¿«å¤„ç†ã€‚",
            trigger: "negative_emotion", // è§¦å‘æ¡ä»¶
            enabled: true
          },
          {
            strategyId: "redirect",
            strategyName: "è¯é¢˜è½¬ç§»",
            template: "æ‚¨çš„è¯‰æ±‚æˆ‘ä»¬å·²ç»è®°å½•ï¼Œè¯·é—®è¿˜æœ‰ä»€ä¹ˆå…¶ä»–éœ€è¦å¸®åŠ©çš„å—ï¼Ÿ",
            trigger: "ambiguous_topic",
            enabled: true
          },
          {
            strategyId: "escalate",
            strategyName: "å‡çº§å¤„ç†",
            template: "æ‚¨çš„é—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å·²ç»å®‰æ’ä¸“äººè·Ÿè¿›ï¼Œç¨åä¼šä¸æ‚¨è”ç³»ã€‚",
            trigger: "high_risk",
            enabled: true
          }
        ],
        // æ¨¡å‹ç”Ÿæˆé…ç½®
        enableAIReply: true,             // æ˜¯å¦å¯ç”¨AIå®‰æŠšå›å¤
        modelId: "doubao-pro-32k-service",
        personaId: "service_agent",
        // å›å¤å†…å®¹é…ç½®
        replyContent: "",                // è‡ªå®šä¹‰å›å¤å†…å®¹ï¼ˆç•™ç©ºä½¿ç”¨AIç”Ÿæˆæˆ–æ¨¡æ¿ï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "soothingReply"
      }
    },
    {
      actionId: "risk_alert",
      actionName: "é£é™©å‘Šè­¦è§¦å‘",
      enabled: true,
      priority: 4,
      config: {
        // å‘Šè­¦é…ç½®
        alertLevels: ["critical", "high", "medium"], // è§¦å‘å‘Šè­¦çš„é£é™©çº§åˆ«
        // å‘Šè­¦è§„åˆ™åˆ—è¡¨
        alertRules: [
          {
            ruleId: "risk_alert_001",
            ruleName: "ä¸¥é‡é£é™©å‘Šè­¦",
            condition: "riskLevel.level === 'critical'",
            alertLevel: "critical",       // å‘Šè­¦çº§åˆ«
            alertChannels: ["robot", "email", "sms"], // é€šçŸ¥æ¸ é“
            enabled: true
          },
          {
            ruleId: "risk_alert_002",
            ruleName: "é«˜é£é™©å‘Šè­¦",
            condition: "riskLevel.level === 'high'",
            alertLevel: "warning",
            alertChannels: ["robot", "email"],
            enabled: true
          }
        ],
        // å‘Šè­¦å†…å®¹æ¨¡æ¿
        alertTemplate: "ã€é£é™©å‘Šè­¦ã€‘æ£€æµ‹åˆ°${riskType}ï¼Œé£é™©ç­‰çº§ï¼š${riskLevel}ï¼Œç”¨æˆ·ï¼š${senderName}",
        // å‘Šè­¦æ¥æ”¶äººåˆ—è¡¨
        alertRecipients: [
          "admin@company.com",
          "ops@company.com"
        ],
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "riskAlert"
      }
    },
    {
      actionId: "staff_notification",
      actionName: "å·¥ä½œäººå‘˜é€šçŸ¥",
      enabled: true,
      priority: 5,
      config: {
        // é€šçŸ¥é…ç½®
        notifyOnRisk: true,              // æ˜¯å¦åœ¨é£é™©æ—¶é€šçŸ¥å·¥ä½œäººå‘˜
        notifyRiskLevels: ["critical", "high"], // é€šçŸ¥çš„é£é™©çº§åˆ«
        // é€šçŸ¥æ¸ é“é…ç½®
        notificationChannels: ["email", "wechat", "dingtalk"], // é€šçŸ¥æ¸ é“
        // é€šçŸ¥æ¨¡æ¿é…ç½®
        notificationTemplate: {
          email: {
            subject: "ã€é£é™©é€šçŸ¥ã€‘ç”¨æˆ·${senderName}å‘é€äº†é£é™©å†…å®¹",
            body: "é£é™©ç±»å‹ï¼š${riskType}\né£é™©ç­‰çº§ï¼š${riskLevel}\næ¶ˆæ¯å†…å®¹ï¼š${content}\næ—¶é—´ï¼š${timestamp}"
          },
          wechat: {
            templateId: "template_risk_notify",
            data: {
              riskType: "${riskType}",
              riskLevel: "${riskLevel}",
              senderName: "${senderName}"
            }
          },
          dingtalk: {
            webhookUrl: "https://oapi.dingtalk.com/robot/send?access_token=xxx",
            message: {
              msgtype: "text",
              text: {
                content: "ã€é£é™©é€šçŸ¥ã€‘${senderName}å‘é€äº†${riskType}ï¼Œç­‰çº§ï¼š${riskLevel}"
              }
            }
          }
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "staffNotification"
      }
    },
    {
      actionId: "risk_logging",
      actionName: "é£é™©è®°å½•",
      enabled: true,
      priority: 6,
      config: {
        // ä¿å­˜é…ç½®
        saveToDatabase: true,            // æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“
        tableName: "risk_records",       // ç›®æ ‡è¡¨å
        // è®°å½•å­—æ®µåˆ—è¡¨
        logFields: [
          "riskId",                     // é£é™©ID
          "messageId",                  // æ¶ˆæ¯ID
          "sessionId",                  // ä¼šè¯ID
          "senderId",                   // å‘é€è€…ID
          "senderName",                 // å‘é€è€…åç§°
          "riskType",                   // é£é™©ç±»å‹
          "riskLevel",                  // é£é™©ç­‰çº§
          "riskScore",                  // é£é™©å¾—åˆ†
          "content",                    // å†…å®¹
          "detectionMethod",            // æ£€æµ‹æ–¹æ³•
          "detectionTime",              // æ£€æµ‹æ—¶é—´
          "actionsTaken",               // é‡‡å–çš„è¡ŒåŠ¨
          "status",                     // çŠ¶æ€
          "timestamp"                   // æ—¶é—´æˆ³
        ],
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "riskLogging"
      }
    },
    {
      actionId: "risk_decision",
      actionName: "é£é™©å¤„ç†å†³ç­–",
      enabled: true,
      priority: 7,
      config: {
        // å¤„ç†ç­–ç•¥åˆ—è¡¨
        handlingStrategies: [
          {
            strategyId: "block",
            strategyName: "é˜»æ­¢",
            condition: "riskLevel.level === 'critical'",
            actions: [
              "blockMessage",            // é˜»æ­¢æ¶ˆæ¯
              "alertCritical",          // å‘é€ä¸¥é‡å‘Šè­¦
              "notifyAdmin"             // é€šçŸ¥ç®¡ç†å‘˜
            ],
            nextNode: "FLOW_END",        // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
            enabled: true
          },
          {
            strategyId: "warn_and_reply",
            strategyName: "è­¦å‘Šå¹¶å›å¤",
            condition: "riskLevel.level === 'high'",
            actions: [
              "sendWarning",            // å‘é€è­¦å‘Š
              "generateSoothingReply",  // ç”Ÿæˆå®‰æŠšå›å¤
              "notifyStaff"             // é€šçŸ¥å·¥ä½œäººå‘˜
            ],
            nextNode: "MESSAGE_EXIT",   // ç»§ç»­å‘é€æ¶ˆæ¯
            enabled: true
          },
          {
            strategyId: "log_only",
            strategyName: "ä»…è®°å½•",
            condition: "riskLevel.level === 'low' || riskLevel.level === 'medium'",
            actions: [
              "logRisk"                 // ä»…è®°å½•é£é™©
            ],
            nextNode: "FLOW_DECISION",  // ç»§ç»­æµç¨‹
            enabled: true
          }
        ],
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "riskDecision"
      }
    }
  ],
  
  nodeConfig: {
    enableLogging: true,
    enableMetrics: true,
    timeout: 30000,
    retryCount: 1
  }
}
```

---

## ğŸ“ èŠ‚ç‚¹6: MESSAGE_EXITï¼ˆæ¶ˆæ¯å‡ºå£ï¼‰

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: ğŸ“¤
- **é¢œè‰²**: #22c55eï¼ˆé’ç»¿è‰²ï¼‰
- **åˆ†ç±»**: æ¶ˆæ¯æ“ä½œèŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 8ä¸ª
- **â­ç‰¹æ®Šå¢å¼º**: å®Œå–„æœºå™¨äººè”åŠ¨é€»è¾‘

### ğŸ“– èŠ‚ç‚¹æè¿°
å‘é€æ¶ˆæ¯ç»™ç”¨æˆ·ï¼ŒåŒ…æ‹¬æ¶ˆæ¯åˆ†å‘ã€å‘é€ã€çŠ¶æ€è®°å½•ã€ä¼šè¯æ›´æ–°ç­‰ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… æœºå™¨äººç®¡ç†ï¼ˆæ¶ˆæ¯å‘é€ï¼‰
- âœ… æœºå™¨äººç®¡ç†ï¼ˆä¼ä¸šå¾®ä¿¡å®˜æ–¹æœºå™¨äººã€è‡ªå®šä¹‰æœºå™¨äººï¼‰
- âœ… æ¶ˆæ¯ä¸­å¿ƒï¼ˆæ¶ˆæ¯çŠ¶æ€æ›´æ–°ï¼‰
- âœ… ä¼šè¯ç®¡ç†ï¼ˆä¼šè¯æ›´æ–°ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®

```javascript
// MESSAGE_EXIT è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®ï¼ˆå¢å¼ºæœºå™¨äººè”åŠ¨ï¼‰
{
  nodeType: "MESSAGE_EXIT",
  nodeId: "message_exit_auto",
  nodeName: "æ¶ˆæ¯å‡ºå£ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,
  description: "å‘é€æ¶ˆæ¯ç»™ç”¨æˆ·ï¼Œæ”¯æŒä¼ä¸šå¾®ä¿¡å®˜æ–¹æœºå™¨äººå’Œè‡ªå®šä¹‰æœºå™¨äººï¼Œå®Œå–„æœºå™¨äººè”åŠ¨é€»è¾‘",
  
  actions: [
    {
      actionId: "message_dispatch",
      actionName: "æ¶ˆæ¯åˆ†å‘å†³ç­–",
      enabled: true,
      priority: 1,
      config: {
        // åˆ†å‘æ¨¡å¼
        dispatchMode: "auto",            // åˆ†å‘æ¨¡å¼ï¼ˆauto: è‡ªåŠ¨, single: å•äºº, broadcast: ç¾¤å‘ï¼‰
        // åˆ†å‘å†³ç­–è§„åˆ™
        dispatchRules: [
          {
            ruleId: "dispatch_001",
            ruleName: "ç¾¤èŠåˆ†å‘",
            condition: "message.roomType === 'group'",
            dispatchType: "group",        // åˆ†å‘ç±»å‹ï¼ˆgroup: ç¾¤ç»„, private: ç§èŠï¼‰
            targetSource: "message.groupChatId", // ç›®æ ‡æ¥æº
            enabled: true
          },
          {
            ruleId: "dispatch_002",
            ruleName: "ç§èŠåˆ†å‘",
            condition: "message.roomType === 'private'",
            dispatchType: "private",
            targetSource: "message.senderName",
            enabled: true
          }
        ],
        // ç¾¤å‘é…ç½®
        broadcastConfig: {
          enabled: false,                 // æ˜¯å¦å¯ç”¨ç¾¤å‘
          targets: [],                   // ç›®æ ‡åˆ—è¡¨ï¼ˆæ•°ç»„æ ¼å¼ï¼‰
          batchSize: 10,                 // æ‰¹é‡å¤§å°ï¼ˆæ¯æ¬¡å‘é€çš„æ¶ˆæ¯æ•°ï¼‰
          delayBetweenBatches: 1000      // æ‰¹æ¬¡é—´å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "dispatchResult"
      }
    },
    {
      actionId: "official_robot_send",
      actionName: "ä¼ä¸šå¾®ä¿¡å®˜æ–¹æœºå™¨äººå‘é€",
      enabled: true,
      priority: 2,
      config: {
        // æœºå™¨äººé…ç½®
        robotType: "official",           // æœºå™¨äººç±»å‹ï¼ˆofficial: ä¼ä¸šå¾®ä¿¡å®˜æ–¹, custom: è‡ªå®šä¹‰ï¼‰
        // Webhookåœ°å€é…ç½®
        webhookUrlTemplate: "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key={webhookKey}",
        webhookKeySource: "robot.webhookKey", // Webhook keyæ¥æºï¼ˆä»æœºå™¨äººé…ç½®ä¸­è·å–ï¼‰
        // æ¶ˆæ¯ç±»å‹é…ç½®
        messageType: "text",             // æ¶ˆæ¯ç±»å‹ï¼ˆtext: æ–‡æœ¬, markdown: Markdown, image: å›¾ç‰‡, file: æ–‡ä»¶, news: å›¾æ–‡ï¼‰
        // æ¶ˆæ¯å†…å®¹é…ç½®
        messageContentSource: "aiResponse.content", // æ¶ˆæ¯å†…å®¹æ¥æº
        // @äººé…ç½®
        enableAtList: true,              // æ˜¯å¦å¯ç”¨@äººåŠŸèƒ½
        atListSource: "message.atList",  // @äººåˆ—è¡¨æ¥æº
        atAll: false,                    // æ˜¯å¦@æ‰€æœ‰äºº
        mentionedList: [],               // @äººåˆ—è¡¨ï¼ˆä¼ä¸šå¾®ä¿¡ç”¨æˆ·IDåˆ—è¡¨ï¼‰
        mentionedMobileList: [],         // @äººåˆ—è¡¨ï¼ˆæ‰‹æœºå·åˆ—è¡¨ï¼‰
        // Markdowné…ç½®ï¼ˆå¦‚æœmessageTypeæ˜¯markdownï¼‰
        markdownConfig: {
          enableMarkdown: false,         // æ˜¯å¦å¯ç”¨Markdown
          markdownContent: "",           // Markdownå†…å®¹
          // æ”¯æŒçš„Markdownè¯­æ³•
          supportedSyntax: [
            "**åŠ ç²—**",                  // åŠ ç²—
            "*æ–œä½“*",                    // æ–œä½“
            "~~åˆ é™¤çº¿~~",                // åˆ é™¤çº¿
            "<font color=\"info\">è“è‰²æ–‡æœ¬</font>", // è“è‰²æ–‡æœ¬
            "<font color=\"warning\">é»„è‰²æ–‡æœ¬</font>", // é»„è‰²æ–‡æœ¬
            "<font color=\"comment\">ç°è‰²æ–‡æœ¬</font>"  // ç°è‰²æ–‡æœ¬
          ]
        },
        // å›¾ç‰‡é…ç½®ï¼ˆå¦‚æœmessageTypeæ˜¯imageï¼‰
        imageConfig: {
          imageUrl: "",                  // å›¾ç‰‡URL
          base64: "",                    // Base64ç¼–ç ï¼ˆå¦‚æœä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼‰
          md5: ""                        // MD5å€¼ï¼ˆBase64å›¾ç‰‡å¿…å¡«ï¼‰
        },
        // æ–‡ä»¶é…ç½®ï¼ˆå¦‚æœmessageTypeæ˜¯fileï¼‰
        fileConfig: {
          fileUrl: "",                   // æ–‡ä»¶URL
          fileName: "",                  // æ–‡ä»¶å
          fileSize: 0                    // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
        },
        // å›¾æ–‡é…ç½®ï¼ˆå¦‚æœmessageTypeæ˜¯newsï¼‰
        newsConfig: {
          articles: [                    // å›¾æ–‡åˆ—è¡¨
            {
              title: "",                 // æ ‡é¢˜
              description: "",           // æè¿°
              url: "",                   // ç‚¹å‡»è·³è½¬é“¾æ¥
              picurl: ""                 // å›¾ç‰‡é“¾æ¥
            }
          ]
        },
        // é™æµé…ç½®
        rateLimit: {
          enabled: true,                 // æ˜¯å¦å¯ç”¨é™æµ
          maxMessagesPerMinute: 20,      // æ¯åˆ†é’Ÿæœ€å¤§æ¶ˆæ¯æ•°ï¼ˆä¼ä¸šå¾®ä¿¡é™åˆ¶ï¼‰
          queueEnabled: true             // æ˜¯å¦å¯ç”¨é˜Ÿåˆ—ï¼ˆè¶…è¿‡é™æµæ—¶æ’é˜Ÿï¼‰
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "officialRobotSendResult"
      }
    },
    {
      actionId: "custom_robot_send",
      actionName: "è‡ªå®šä¹‰æœºå™¨äººå‘é€",
      enabled: true,
      priority: 3,
      config: {
        // æœºå™¨äººé…ç½®
        robotType: "custom",             // æœºå™¨äººç±»å‹
        // APIåœ°å€é…ç½®
        apiEndpointTemplate: "https://api.worktool.com/robot/{robotId}/send",
        robotIdSource: "message.robotId", // æœºå™¨äººIDæ¥æº
        // è®¤è¯é…ç½®
        authMethod: "api_key",           // è®¤è¯æ–¹æ³•ï¼ˆapi_key: APIå¯†é’¥, token: Token, oauth: OAuthï¼‰
        authKeySource: "robot.robotSecret", // è®¤è¯keyæ¥æº
        // æ¶ˆæ¯ç±»å‹é…ç½®
        messageType: "text",             // æ¶ˆæ¯ç±»å‹
        // æ¶ˆæ¯å†…å®¹é…ç½®
        messageContentSource: "aiResponse.content",
        // æ¥æ”¶è€…é…ç½®
        recipients: [],                  // æ¥æ”¶è€…åˆ—è¡¨ï¼ˆæ•°ç»„æ ¼å¼ï¼‰
        recipientsSource: "message.senderName", // æ¥æ”¶è€…æ¥æº
        // @äººé…ç½®
        enableAtList: true,
        atListSource: "message.atList",
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "customRobotSendResult"
      }
    },
    {
      actionId: "send_retry",
      actionName: "æ¶ˆæ¯å‘é€é‡è¯•",
      enabled: true,
      priority: 4,
      config: {
        // é‡è¯•é…ç½®
        enableRetry: true,               // æ˜¯å¦å¯ç”¨é‡è¯•
        retryCount: 3,                   // é‡è¯•æ¬¡æ•°
        retryDelay: 2000,                // é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
        retryStrategy: "exponential",    // é‡è¯•ç­–ç•¥ï¼ˆfixed: å›ºå®šå»¶è¿Ÿ, exponential: æŒ‡æ•°é€€é¿, backoff: è‡ªé€‚åº”é€€é¿ï¼‰
        // é‡è¯•æ¡ä»¶åˆ—è¡¨
        retryConditions: [
          {
            conditionId: "retry_001",
            condition: "response.statusCode === 500", // æ¡ä»¶è¡¨è¾¾å¼
            action: "retry",             // åŠ¨ä½œï¼ˆretry: é‡è¯•, no_retry: ä¸é‡è¯•ï¼‰
            description: "æœåŠ¡å™¨é”™è¯¯ï¼Œé‡è¯•",
            enabled: true
          },
          {
            conditionId: "retry_002",
            condition: "response.statusCode === 429",
            action: "retry_with_backoff", // é€€é¿é‡è¯•
            description: "è¯·æ±‚è¿‡å¤šï¼Œé€€é¿åé‡è¯•",
            enabled: true
          },
          {
            conditionId: "retry_003",
            condition: "response.statusCode === 403",
            action: "no_retry",          // ä¸é‡è¯•
            description: "æƒé™é”™è¯¯ï¼Œä¸é‡è¯•",
            enabled: true
          },
          {
            conditionId: "retry_004",
            condition: "response.statusCode === 404",
            action: "no_retry",
            description: "èµ„æºä¸å­˜åœ¨ï¼Œä¸é‡è¯•",
            enabled: true
          },
          {
            conditionId: "retry_005",
            condition: "response.statusCode === 400",
            action: "no_retry",
            description: "è¯·æ±‚é”™è¯¯ï¼Œä¸é‡è¯•",
            enabled: true
          }
        ],
        // é€€é¿ç­–ç•¥é…ç½®
        backoffConfig: {
          initialDelay: 2000,            // åˆå§‹å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
          maxDelay: 30000,               // æœ€å¤§å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
          backoffFactor: 2               // é€€é¿å› å­ï¼ˆæ¯æ¬¡é‡è¯•å»¶è¿Ÿä¹˜ä»¥æ­¤å› å­ï¼‰
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "retryResult"
      }
    },
    {
      actionId: "priority_and_load_balancing",
      actionName: "æ¶ˆæ¯ä¼˜å…ˆçº§ä¸è´Ÿè½½å‡è¡¡",
      enabled: true,
      priority: 5,
      config: {
        // ä¼˜å…ˆçº§é…ç½®
        enablePriority: true,            // æ˜¯å¦å¯ç”¨ä¼˜å…ˆçº§
        priorityLevels: {                // ä¼˜å…ˆçº§å®šä¹‰
          critical: 1,                   // ä¸¥é‡ä¼˜å…ˆçº§
          high: 2,                       // é«˜ä¼˜å…ˆçº§
          normal: 3,                     // æ™®é€šä¼˜å…ˆçº§
          low: 4                         // ä½ä¼˜å…ˆçº§
        },
        // ä¼˜å…ˆçº§è§„åˆ™åˆ—è¡¨
        priorityRules: [
          {
            ruleId: "priority_001",
            ruleName: "é£é™©æ¶ˆæ¯é«˜ä¼˜å…ˆçº§",
            condition: "riskLevel.level === 'critical'",
            priority: "critical",
            description: "é£é™©æ¶ˆæ¯ä¼˜å…ˆçº§æœ€é«˜",
            enabled: true
          },
          {
            ruleId: "priority_002",
            ruleName: "æ„¤æ€’æƒ…ç»ªé«˜ä¼˜å…ˆçº§",
            condition: "emotionResult.emotion === 'angry'",
            priority: "high",
            description: "æ„¤æ€’æƒ…ç»ªæ¶ˆæ¯é«˜ä¼˜å…ˆçº§",
            enabled: true
          },
          {
            ruleId: "priority_003",
            ruleName: "æ™®é€šæ¶ˆæ¯æ™®é€šä¼˜å…ˆçº§",
            condition: "intentResult.intent === 'service'",
            priority: "normal",
            description: "æ™®é€šæ¶ˆæ¯æ™®é€šä¼˜å…ˆçº§",
            enabled: true
          },
          {
            ruleId: "priority_004",
            ruleName: "é—²èŠä½ä¼˜å…ˆçº§",
            condition: "intentResult.intent === 'chat'",
            priority: "low",
            description: "é—²èŠæ¶ˆæ¯ä½ä¼˜å…ˆçº§",
            enabled: true
          }
        ],
        // è´Ÿè½½å‡è¡¡é…ç½®
        enableLoadBalancing: true,       // æ˜¯å¦å¯ç”¨è´Ÿè½½å‡è¡¡
        loadBalancingStrategy: "round_robin", // è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆround_robin: è½®è¯¢, least_loaded: æœ€å°‘è´Ÿè½½, weighted: åŠ æƒéšæœºï¼‰
        // åŠ æƒæœºå™¨äººé…ç½®
        weightedRobots: [
          {
            robotId: "robot_001",
            robotName: "å®¢æœæœºå™¨äºº1",
            weight: 3,                   // æƒé‡ï¼ˆæƒé‡è¶Šé«˜ï¼Œè¢«é€‰ä¸­æ¦‚ç‡è¶Šå¤§ï¼‰
            enabled: true,
            healthy: true,               // å¥åº·çŠ¶æ€ï¼ˆtrue: å¥åº·, false: ä¸å¥åº·ï¼‰
            workload: 5                  // å½“å‰è´Ÿè½½ï¼ˆæ¶ˆæ¯æ•°ï¼‰
          },
          {
            robotId: "robot_002",
            robotName: "å®¢æœæœºå™¨äºº2",
            weight: 2,
            enabled: true,
            healthy: true,
            workload: 3
          }
        ],
        // é˜Ÿåˆ—é…ç½®
        queueConfig: {
          enabled: true,                 // æ˜¯å¦å¯ç”¨é˜Ÿåˆ—
          maxQueueSize: 100,             // æœ€å¤§é˜Ÿåˆ—é•¿åº¦
          queueTimeout: 30000            // é˜Ÿåˆ—è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "priorityAndLoadBalancing"
      }
    },
    {
      actionId: "message_status_record",
      actionName: "æ¶ˆæ¯çŠ¶æ€è®°å½•",
      enabled: true,
      priority: 6,
      config: {
        // ä¿å­˜é…ç½®
        saveToDatabase: true,            // æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“
        tableName: "message_status",     // ç›®æ ‡è¡¨å
        // è®°å½•å­—æ®µåˆ—è¡¨
        logFields: [
          "statusId",                   // çŠ¶æ€ID
          "messageId",                  // æ¶ˆæ¯ID
          "sessionId",                  // ä¼šè¯ID
          "robotId",                    // æœºå™¨äººID
          "robotType",                  // æœºå™¨äººç±»å‹
          "status",                     // çŠ¶æ€ï¼ˆsending: å‘é€ä¸­, sent: å·²å‘é€, failed: å¤±è´¥ï¼‰
          "recipient",                  // æ¥æ”¶è€…
          "messageType",                // æ¶ˆæ¯ç±»å‹
          "content",                    // å†…å®¹
          "sentAt",                     // å‘é€æ—¶é—´
          "responseCode",               // å“åº”ç 
          "responseMessage",            // å“åº”æ¶ˆæ¯
          "retryCount",                 // é‡è¯•æ¬¡æ•°
          "errorMessage",               // é”™è¯¯ä¿¡æ¯
          "timestamp"                   // æ—¶é—´æˆ³
        ],
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "messageStatusRecord"
      }
    },
    {
      actionId: "session_update",
      actionName: "ä¼šè¯æ›´æ–°",
      enabled: true,
      priority: 7,
      config: {
        // æ›´æ–°é…ç½®
        updateSession: true,             // æ˜¯å¦æ›´æ–°ä¼šè¯
        tableName: "sessions",           // ç›®æ ‡è¡¨å
        // æ›´æ–°å­—æ®µåˆ—è¡¨
        updateFields: [
          "lastMessageTime",            // æœ€åæ¶ˆæ¯æ—¶é—´
          "messageCount",               // æ¶ˆæ¯è®¡æ•°
          "lastAIReply",                // æœ€åAIå›å¤
          "status"                      // çŠ¶æ€
        ],
        // æ‰¹é‡æ›´æ–°é…ç½®
        batchUpdate: true,              // æ˜¯å¦æ‰¹é‡æ›´æ–°ï¼ˆç”¨æˆ·æ¶ˆæ¯+AIå›å¤ï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "sessionUpdate"
      }
    },
    {
      actionId: "websocket_push",
      actionName: "WebSocketå®æ—¶æ¨é€",
      enabled: true,
      priority: 8,
      config: {
        // æ¨é€é…ç½®
        enablePush: true,                // æ˜¯å¦å¯ç”¨æ¨é€
        // æ¨é€ç›®æ ‡åˆ—è¡¨
        pushTargets: [
          "panel1",                     // ä¸šåŠ¡æ¶ˆæ¯ç›‘æ§é¢æ¿
          "panel2"                      // AIäº¤äº’ç›‘æ§é¢æ¿
        ],
        // æ¨é€æ•°æ®é…ç½®
        pushData: {
          messageId: "message.messageId",
          sessionId: "message.sessionId",
          senderName: "message.senderName",
          content: "message.content",
          aiReply: "aiResponse.content",
          status: "sent",
          timestamp: "currentTime()"
        },
        // WebSocketè¿æ¥é…ç½®
        wsConfig: {
          url: "ws://localhost:5001/ws", // WebSocketåœ°å€
          reconnectInterval: 3000,       // é‡è¿é—´éš”ï¼ˆæ¯«ç§’ï¼‰
          maxReconnectAttempts: 5        // æœ€å¤§é‡è¿æ¬¡æ•°
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "websocketPush"
      }
    }
  ],
  
  nodeConfig: {
    enableLogging: true,
    enableMetrics: true,
    timeout: 60000,                    // æ¶ˆæ¯å‘é€å¯èƒ½è¾ƒæ…¢
    retryCount: 3
  }
}
```

---

## ğŸ“ èŠ‚ç‚¹7: SMART_MONITORï¼ˆæ™ºèƒ½ç›‘æ§ï¼‰â­å‘˜å·¥å›å¤ç›‘æµ‹å¢å¼º

### ğŸ¨ èŠ‚ç‚¹å…ƒä¿¡æ¯
- **å›¾æ ‡**: ğŸ“Š
- **é¢œè‰²**: #06b6d4ï¼ˆé’è‰²ï¼‰
- **åˆ†ç±»**: ç›‘æ§æ£€æµ‹èŠ‚ç‚¹
- **åŠ¨ä½œæ•°é‡**: 6ä¸ª
- **â­ç‰¹æ®Šå¢å¼º**: å‘˜å·¥å›å¤ç›‘æµ‹ã€é™ä½ç›‘æµ‹é¢‘ç‡ã€ä¸å›å¤è®°å½•

### ğŸ“– èŠ‚ç‚¹æè¿°
å®æ—¶ç›‘æ§ç¾¤å†…æ¶ˆæ¯ã€æ£€æµ‹å¼‚å¸¸è¡Œä¸ºã€è®°å½•ç»Ÿè®¡æ•°æ®ã€‚

### ğŸ”— ç³»ç»Ÿè”åŠ¨
- âœ… ç›‘æ§ç³»ç»Ÿï¼ˆå®æ—¶ç›‘æ§ï¼‰
- âœ… ä¿¡æ¯ä¸­å¿ƒï¼ˆæ¶ˆæ¯ç»Ÿè®¡ï¼‰
- âœ… ååŒç³»ç»Ÿï¼ˆååŒç›‘æ§ï¼‰
- âœ… å·¥ä½œäººå‘˜è”åŠ¨ï¼ˆå‘˜å·¥å›å¤ç›‘æµ‹ï¼‰

---

### âš¡ è‡ªåŠ¨æ¨¡å¼é…ç½®ï¼ˆå¢å¼ºç‰ˆï¼‰

```javascript
// SMART_MONITOR è‡ªåŠ¨æ¨¡å¼ - å®Œæ•´é»˜è®¤é…ç½®ï¼ˆå¢å¼ºå‘˜å·¥å›å¤ç›‘æµ‹ï¼‰
{
  nodeType: "SMART_MONITOR",
  nodeId: "smart_monitor_auto",
  nodeName: "æ™ºèƒ½ç›‘æ§ï¼ˆè‡ªåŠ¨æ¨¡å¼ï¼‰",
  autoMode: true,
  description: "å®æ—¶ç›‘æ§ç¾¤å†…æ¶ˆæ¯ã€æ£€æµ‹å¼‚å¸¸è¡Œä¸ºã€è®°å½•ç»Ÿè®¡æ•°æ®ï¼Œæ”¯æŒå‘˜å·¥å›å¤ç›‘æµ‹å’Œé¢‘ç‡è°ƒæ•´",
  
  actions: [
    {
      actionId: "realtime_monitoring",
      actionName: "å®æ—¶æ¶ˆæ¯ç›‘æ§",
      enabled: true,
      priority: 1,
      config: {
        // ç›‘æ§é…ç½®
        enableMonitoring: true,          // æ˜¯å¦å¯ç”¨ç›‘æ§
        // ç›‘æ§ç›®æ ‡åˆ—è¡¨
        monitorTargets: [
          {
            targetId: "group_001",
            targetName: "å®¢æˆ·ç¾¤",
            targetType: "group",         // ç›®æ ‡ç±»å‹ï¼ˆgroup: ç¾¤ç»„, private: ç§èŠï¼‰
            monitoringEnabled: true,     // æ˜¯å¦å¯ç”¨ç›‘æ§
            staffMonitoringEnabled: true, // æ˜¯å¦å¯ç”¨å‘˜å·¥ç›‘æ§
            monitoringFrequency: 5000,   // ç›‘æ§é¢‘ç‡ï¼ˆæ¯«ç§’ï¼‰
            lastMonitoringTime: null     // æœ€åç›‘æ§æ—¶é—´
          },
          {
            targetId: "private_001",
            targetName: "é‡è¦å®¢æˆ·",
            targetType: "private",
            monitoringEnabled: true,
            staffMonitoringEnabled: true,
            monitoringFrequency: 10000,   // ç§èŠç›‘æ§é¢‘ç‡è¾ƒä½
            lastMonitoringTime: null
          }
        ],
        // ç›‘æ§ç±»å‹åˆ—è¡¨
        monitorTypes: [
          "message",                     // æ¶ˆæ¯ç›‘æ§
          "member",                      // æˆå‘˜ç›‘æ§
          "activity"                     // æ´»åŠ¨ç›‘æ§
          "staff_reply"                  // â­å‘˜å·¥å›å¤ç›‘æ§ï¼ˆæ–°å¢ï¼‰
        ],
        // ç›‘æ§é¢‘ç‡é…ç½®
        monitoringInterval: 5000,        // é»˜è®¤ç›‘æ§é—´éš”ï¼ˆæ¯«ç§’ï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "realtimeMonitoring"
      }
    },
    {
      actionId: "staff_reply_monitoring",
      actionName: "å‘˜å·¥å›å¤ç›‘æµ‹",
      enabled: true,
      priority: 2,
      config: {
        // â­å‘˜å·¥å›å¤ç›‘æµ‹é…ç½®ï¼ˆæ–°å¢ï¼‰
        enableStaffReplyMonitoring: true, // æ˜¯å¦å¯ç”¨å‘˜å·¥å›å¤ç›‘æµ‹
        // ç›‘æµ‹è§„åˆ™
        monitoringRules: [
          {
            ruleId: "staff_reply_001",
            ruleName: "å‘˜å·¥å›å¤æ£€æµ‹",
            description: "æ£€æµ‹å‘˜å·¥æ˜¯å¦å›å¤äº†ç”¨æˆ·æ¶ˆæ¯",
            conditions: {
              checkStaffReply: true,     // æ˜¯å¦æ£€æŸ¥å‘˜å·¥å›å¤
              replyTimeout: 300000,      // å›å¤è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ5åˆ†é’Ÿï¼‰
              minReplyLength: 1          // æœ€å°å›å¤é•¿åº¦ï¼ˆå­—ç¬¦ï¼‰
            },
            enabled: true
          }
        ],
        // ç›‘æµ‹é¢‘ç‡è°ƒæ•´è§„åˆ™ï¼ˆæ–°å¢ï¼‰
        frequencyAdjustmentRules: [
          {
            ruleId: "freq_adjust_001",
            ruleName: "å‘˜å·¥å›å¤åé™ä½é¢‘ç‡",
            condition: "staffReplyDetected === true", // æ¡ä»¶
            action: "decrease_frequency", // åŠ¨ä½œï¼ˆdecrease_frequency: é™ä½é¢‘ç‡ï¼‰
            adjustment: {
              newFrequency: 30000,      // æ–°é¢‘ç‡ï¼ˆæ¯«ç§’ï¼Œ30ç§’ï¼‰
              duration: 600000,         // æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ10åˆ†é’Ÿï¼‰
              reason: "å‘˜å·¥å·²å›å¤ï¼Œé™ä½ç›‘æ§é¢‘ç‡" // è°ƒæ•´åŸå› 
            },
            enabled: true
          },
          {
            ruleId: "freq_adjust_002",
            ruleName: "æ— å›å¤æ—¶æé«˜é¢‘ç‡",
            condition: "staffReplyNotDetected === true && noReplyDuration > 600000", // 10åˆ†é’Ÿæœªå›å¤
            action: "increase_frequency",
            adjustment: {
              newFrequency: 2000,       // æ–°é¢‘ç‡ï¼ˆæ¯«ç§’ï¼Œ2ç§’ï¼‰
              duration: 180000,        // æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ3åˆ†é’Ÿï¼‰
              reason: "å‘˜å·¥æœªå›å¤ï¼Œæé«˜ç›‘æ§é¢‘ç‡"
            },
            enabled: true
          },
          {
            ruleId: "freq_adjust_003",
            ruleName: "æ¢å¤é»˜è®¤é¢‘ç‡",
            condition: "adjustmentDurationExpired === true",
            action: "reset_frequency",
            adjustment: {
              newFrequency: 5000,       // æ¢å¤é»˜è®¤é¢‘ç‡
              reason: "è°ƒæ•´æ—¶é—´ç»“æŸï¼Œæ¢å¤é»˜è®¤é¢‘ç‡"
            },
            enabled: true
          }
        ],
        // ä¸å›å¤è®°å½•é…ç½®ï¼ˆæ–°å¢ï¼‰
        noReplyRecord: {
          enableRecording: true,         // æ˜¯å¦è®°å½•ä¸å›å¤
          recordThreshold: 300000,       // è®°å½•é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼Œ5åˆ†é’Ÿï¼‰
          maxRecordsPerDay: 10,         // æ¯å¤©æœ€å¤§è®°å½•æ•°
          alertThreshold: 3             // å‘Šè­¦é˜ˆå€¼ï¼ˆè¿ç»­Næ¬¡ä¸å›å¤è§¦å‘å‘Šè­¦ï¼‰
        },
        // å‘˜å·¥å›å¤ç»Ÿè®¡ï¼ˆæ–°å¢ï¼‰
        staffReplyStats: {
          enableStats: true,             // æ˜¯å¦ç»Ÿè®¡å‘˜å·¥å›å¤
          statsInterval: 86400000,      // ç»Ÿè®¡é—´éš”ï¼ˆæ¯«ç§’ï¼Œ1å¤©ï¼‰
          metrics: [
            "replyCount",               // å›å¤æ¬¡æ•°
            "averageReplyTime",         // å¹³å‡å›å¤æ—¶é—´
            "replyRate",                // å›å¤ç‡
            "noReplyCount"              // æœªå›å¤æ¬¡æ•°
          ]
        },
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "staffReplyMonitoring"
      }
    },
    {
      actionId: "anomaly_detection",
      actionName: "å¼‚å¸¸æ£€æµ‹",
      enabled: true,
      priority: 3,
      config: {
        // å¼‚å¸¸ç±»å‹åˆ—è¡¨
        anomalyTypes: [
          "spam_flood",                  // åƒåœ¾ä¿¡æ¯æ´ªæ°´
          "member_suspicious",           // æˆå‘˜å¯ç–‘è¡Œä¸º
          "unusual_pattern",             // å¼‚å¸¸æ¨¡å¼
          "system_error",                // ç³»ç»Ÿé”™è¯¯
          "staff_abnormal_behavior"      // â­å‘˜å·¥å¼‚å¸¸è¡Œä¸ºï¼ˆæ–°å¢ï¼‰
        ],
        // æ£€æµ‹è§„åˆ™åˆ—è¡¨
        detectionRules: [
          {
            ruleId: "spam_flood_001",
            ruleName: "åƒåœ¾ä¿¡æ¯æ´ªæ°´æ£€æµ‹",
            detectionMethod: "count_based", // æ£€æµ‹æ–¹æ³•ï¼ˆcount_based: åŸºäºè®¡æ•°, pattern_based: åŸºäºæ¨¡å¼ï¼‰
            condition: "messageCount > 10 && spamRatio > 0.8",
            threshold: 10,                // æ¶ˆæ¯æ•°é˜ˆå€¼
            timeWindow: 60000,            // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼Œ1åˆ†é’Ÿï¼‰
            enabled: true
          },
          {
            ruleId: "member_suspicious_001",
            ruleName: "æˆå‘˜å¯ç–‘è¡Œä¸ºæ£€æµ‹",
            detectionMethod: "pattern_based",
            condition: "newMemberCount > 5 && suspiciousActivityRatio > 0.6",
            threshold: 5,                 // æ–°æˆå‘˜æ•°é˜ˆå€¼
            timeWindow: 300000,           // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼Œ5åˆ†é’Ÿï¼‰
            enabled: true
          },
          {
            ruleId: "staff_abnormal_001", // â­å‘˜å·¥å¼‚å¸¸è¡Œä¸ºæ£€æµ‹ï¼ˆæ–°å¢ï¼‰
            ruleName: "å‘˜å·¥å¼‚å¸¸è¡Œä¸ºæ£€æµ‹",
            detectionMethod: "pattern_based",
            condition: "staffReplyRate < 0.3 && staffReplyCount > 5", // å›å¤ç‡ä½äº30%
            threshold: 0.3,                // å›å¤ç‡é˜ˆå€¼
            timeWindow: 3600000,           // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼Œ1å°æ—¶ï¼‰
            severity: "medium",           // ä¸¥é‡ç¨‹åº¦ï¼ˆlow/medium/high/criticalï¼‰
            alertEnabled: true,           // æ˜¯å¦å‘é€å‘Šè­¦
            enabled: true
          }
        ],
        // æ¨¡å‹æ£€æµ‹é…ç½®
        enableModelDetection: true,      // æ˜¯å¦å¯ç”¨æ¨¡å‹æ£€æµ‹
        modelId: "doubao-pro-4k-intent",
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "anomalyDetection"
      }
    },
    {
      actionId: "performance_monitoring",
      actionName: "æ€§èƒ½ç›‘æ§",
      enabled: true,
      priority: 4,
      config: {
        // ç›‘æ§æŒ‡æ ‡åˆ—è¡¨
        metrics: [
          {
            metricId: "response_time",
            metricName: "å“åº”æ—¶é—´",
            unit: "ms",                    // å•ä½
            threshold: 5000,              // é˜ˆå€¼
            alertLevel: "warning",        // å‘Šè­¦çº§åˆ«ï¼ˆinfo/warning/criticalï¼‰
            enabled: true
          },
          {
            metricId: "success_rate",
            metricName: "æˆåŠŸç‡",
            unit: "%",
            threshold: 95,
            alertLevel: "critical",
            enabled: true
          },
          {
            metricId: "throughput",
            metricName: "ååé‡",
            unit: "msg/min",
            threshold: 100,
            alertLevel: "info",
            enabled: true
          },
          {
            metricId: "error_rate",
            metricName: "é”™è¯¯ç‡",
            unit: "%",
            threshold: 5,
            alertLevel: "warning",
            enabled: true
          },
          {
            metricId: "staff_reply_rate",  // â­å‘˜å·¥å›å¤ç‡ï¼ˆæ–°å¢ï¼‰
            metricName: "å‘˜å·¥å›å¤ç‡",
            unit: "%",
            threshold: 70,
            alertLevel: "warning",
            enabled: true
          }
        ],
        // ç»Ÿè®¡å‘¨æœŸ
        statisticsInterval: 60000,       // ç»Ÿè®¡é—´éš”ï¼ˆæ¯«ç§’ï¼Œ1åˆ†é’Ÿï¼‰
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "performanceMonitoring"
      }
    },
    {
      actionId: "statistics_logging",
      actionName: "ç»Ÿè®¡æ•°æ®è®°å½•",
      enabled: true,
      priority: 5,
      config: {
        // ä¿å­˜é…ç½®
        saveToDatabase: true,            // æ˜¯å¦ä¿å­˜åˆ°æ•°æ®åº“
        tableName: "monitoring_statistics", // ç›®æ ‡è¡¨å
        // ç»Ÿè®¡ç»´åº¦åˆ—è¡¨
        statisticsDimensions: [
          "date",                        // æ—¥æœŸ
          "hour",                        // å°æ—¶
          "groupId",                     // ç¾¤ç»„ID
          "robotId",                     // æœºå™¨äººID
          "intent",                      // æ„å›¾
          "emotion",                     // æƒ…ç»ª
          "staffId"                      // â­å‘˜å·¥IDï¼ˆæ–°å¢ï¼‰
        ],
        // ç»Ÿè®¡æŒ‡æ ‡åˆ—è¡¨
        statisticsMetrics: [
          "messageCount",                // æ¶ˆæ¯æ•°
          "sessionCount",                // ä¼šè¯æ•°
          "userCount",                   // ç”¨æˆ·æ•°
          "aiResponseCount",             // AIå›å¤æ•°
          "humanInterventionCount",      // äººå·¥å¹²é¢„æ•°
          "averageResponseTime",         // å¹³å‡å“åº”æ—¶é—´
          "successRate",                 // æˆåŠŸç‡
          "errorRate",                   // é”™è¯¯ç‡
          "staffReplyCount",             // â­å‘˜å·¥å›å¤æ•°ï¼ˆæ–°å¢ï¼‰
          "staffNoReplyCount"            // â­å‘˜å·¥æœªå›å¤æ•°ï¼ˆæ–°å¢ï¼‰
        ],
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "statisticsLogging"
      }
    },
    {
      actionId: "monitoring_alert",
      actionName: "ç›‘æ§å‘Šè­¦",
      enabled: true,
      priority: 6,
      config: {
        // å‘Šè­¦é…ç½®
        enableAlert: true,               // æ˜¯å¦å¯ç”¨å‘Šè­¦
        // å‘Šè­¦è§„åˆ™åˆ—è¡¨
        alertRules: [
          {
            ruleId: "monitor_alert_001",
            ruleName: "å“åº”æ—¶é—´è¿‡é•¿",
            condition: "performanceMonitoring.responseTime > 5000",
            alertLevel: "warning",
            alertChannels: ["robot"],    // é€šçŸ¥æ¸ é“ï¼ˆrobot/email/sms/wechat/dingtalkï¼‰
            enabled: true
          },
          {
            ruleId: "monitor_alert_002",
            ruleName: "æˆåŠŸç‡è¿‡ä½",
            condition: "performanceMonitoring.successRate < 95",
            alertLevel: "critical",
            alertChannels: ["robot", "email"],
            enabled: true
          },
          {
            ruleId: "monitor_alert_003",
            ruleName: "æ£€æµ‹åˆ°å¼‚å¸¸è¡Œä¸º",
            condition: "anomalyDetection.detected === true",
            alertLevel: "high",
            alertChannels: ["robot", "email", "wechat"],
            enabled: true
          },
          {
            ruleId: "monitor_alert_004", // â­å‘˜å·¥å‘Šè­¦ï¼ˆæ–°å¢ï¼‰
            ruleName: "å‘˜å·¥æœªå›å¤å‘Šè­¦",
            condition: "staffReplyMonitoring.noReplyCount >= 3",
            alertLevel: "warning",
            alertChannels: ["robot", "wechat"],
            alertToStaff: true,           // æ˜¯å¦é€šçŸ¥å‘˜å·¥æœ¬äºº
            alertToManager: true,         // æ˜¯å¦é€šçŸ¥ç»ç†
            enabled: true
          },
          {
            ruleId: "monitor_alert_005", // â­ç”¨æˆ·ä¸æ»¡æ„å‘Šè­¦ï¼ˆæ–°å¢ï¼‰
            ruleName: "ç”¨æˆ·ä¸æ»¡æ„å‘Šè­¦",
            condition: "emotionResult.emotion === 'angry' || emotionResult.emotion === 'negative'",
            alertLevel: "high",
            alertChannels: ["robot", "email", "dingtalk"],
            escalateToManager: true,      // æ˜¯å¦å‡çº§é€šçŸ¥ç»ç†
            escalateToDirector: false,    // æ˜¯å¦å‡çº§é€šçŸ¥æ€»ç›‘
            enabled: true
          }
        ],
        // å‘Šè­¦å†…å®¹æ¨¡æ¿
        alertTemplate: "ã€ç›‘æ§å‘Šè­¦ã€‘${metricName}: ${metricValue}${unit}ï¼Œè¶…è¿‡é˜ˆå€¼${threshold}",
        // è¾“å‡ºé…ç½®
        saveToContext: true,
        contextKey: "monitoringAlert"
      }
    }
  ],
  
  nodeConfig: {
    enableLogging: true,
    enableMetrics: true,
    timeout: 10000,
    retryCount: 0
  }
}
```

---

ç”±äºæ–‡æ¡£å†…å®¹éå¸¸é•¿ï¼Œæˆ‘å°†ç»§ç»­åˆ›å»ºç¬¬ä¸‰éƒ¨åˆ†ï¼ŒåŒ…å«å‰©ä½™çš„èŠ‚ç‚¹ï¼ˆALERT_ESCALATIONã€HUMAN_HANDOVERã€FLOW_ENDï¼‰ä»¥åŠå®Œæ•´çš„UIé…ç½®å’Œå®æ–½æŒ‡å—...
