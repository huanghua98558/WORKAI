{
  "id": "flow_unified_message_processing",
  "name": "ç»Ÿä¸€æ¶ˆæ¯å¤„ç†æµç¨‹",
  "description": "ç»Ÿä¸€å¤„ç†æ‰€æœ‰æ¶ˆæ¯ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³ï¼‰ï¼Œæ”¯æŒæ„å›¾è¯†åˆ«ã€æƒ…ç»ªåˆ†æã€å”®åä»»åŠ¡ã€å‘Šè­¦å‡çº§ã€äººå·¥è½¬æ¥",
  "version": "5.0.0",
  "isDefault": true,
  "priority": 100,
  "category": "æ ¸å¿ƒæµç¨‹",
  "tags": ["ç»Ÿä¸€", "æ¶ˆæ¯å¤„ç†", "å®Œæ•´"],
  "triggerType": "webhook",
  "triggerConfig": {
    "webhookUrl": "/api/worktool/callback/message",
    "eventType": "message",
    "method": "POST"
  },
  "nodes": [
    {
      "id": "node_start",
      "type": "start",
      "name": "å¼€å§‹",
      "position": { "x": 50, "y": 100 },
      "data": {
        "name": "å¼€å§‹",
        "description": "æµç¨‹å¼€å§‹",
        "icon": "ğŸš€",
        "color": "#22c55e"
      }
    },
    {
      "id": "node_message_receive",
      "type": "message_receive",
      "name": "æ¶ˆæ¯æ¥æ”¶",
      "position": { "x": 200, "y": 100 },
      "data": {
        "name": "æ¶ˆæ¯æ¥æ”¶",
        "description": "æ¥æ”¶æ¶ˆæ¯ã€ä¿å­˜åˆ°æ•°æ®åº“ã€è¯†åˆ«å‘é€è€…ç±»å‹",
        "icon": "ğŸ“¥",
        "color": "#3b82f6",
        "config": {
          "saveToDatabase": true,
          "senderIdentification": true,
          "messageDeduplication": true,
          "dedupWindow": 60,
          "validateMessage": true
        }
      }
    },
    {
      "id": "node_session_create",
      "type": "session_create",
      "name": "ä¼šè¯åˆ›å»º",
      "position": { "x": 350, "y": 100 },
      "data": {
        "name": "ä¼šè¯åˆ›å»º",
        "description": "åˆ›å»ºæˆ–è·å–ä¼šè¯",
        "icon": "ğŸ’¬",
        "color": "#8b5cf6",
        "config": {
          "autoCreate": true,
          "sessionTimeout": 1800000
        }
      }
    },
    {
      "id": "node_context_enhancer",
      "type": "context_enhancer",
      "name": "ä¸Šä¸‹æ–‡æ£€ç´¢",
      "position": { "x": 500, "y": 100 },
      "data": {
        "name": "ä¸Šä¸‹æ–‡æ£€ç´¢ä¸å¢å¼º",
        "description": "æ£€ç´¢ä¼šè¯ä¸Šä¸‹æ–‡ã€ç”¨æˆ·ç”»åƒã€å”®åä»»åŠ¡å†å²",
        "icon": "ğŸ”",
        "color": "#f59e0b",
        "config": {
          "windowSize": 20,
          "includeUserProfile": true,
          "includeAfterSalesTasks": true
        }
      }
    },
    {
      "id": "node_unified_analyze",
      "type": "unified_analyze",
      "name": "ç»Ÿä¸€AIåˆ†æ",
      "position": { "x": 650, "y": 100 },
      "data": {
        "name": "ç»Ÿä¸€AIåˆ†æ",
        "description": "æ„å›¾è¯†åˆ«ã€æƒ…ç»ªåˆ†æã€å‘Šè­¦åˆ¤æ–­ã€ä»‹å…¥åˆ¤æ–­",
        "icon": "ğŸ§ ",
        "color": "#ec4899",
        "config": {
          "enableIntentRecognition": true,
          "enableSentimentAnalysis": true,
          "enableAlertDetection": true,
          "modelId": "default"
        }
      }
    },
    {
      "id": "node_message_type_decision",
      "type": "decision",
      "name": "æ¶ˆæ¯ç±»å‹åˆ¤æ–­",
      "position": { "x": 800, "y": 100 },
      "data": {
        "name": "æ¶ˆæ¯ç±»å‹åˆ¤æ–­",
        "description": "æ ¹æ®æ¶ˆæ¯ç±»å‹åˆ†æµå¤„ç†",
        "icon": "ğŸ”€",
        "color": "#06b6d4",
        "config": {
          "conditions": [
            {
              "label": "æ–‡æœ¬æ¶ˆæ¯",
              "expression": "context.messageType === 'text' || context.messageType === undefined",
              "targetNodeId": "node_ai_reply"
            },
            {
              "label": "å›¾ç‰‡æ¶ˆæ¯",
              "expression": "context.messageType === 'image'",
              "targetNodeId": "node_image_processing"
            },
            {
              "label": "è¯­éŸ³æ¶ˆæ¯",
              "expression": "context.messageType === 'voice'",
              "targetNodeId": "node_voice_processing"
            },
            {
              "label": "å…¶ä»–ç±»å‹",
              "expression": "true",
              "targetNodeId": "node_ai_reply"
            }
          ]
        }
      }
    },
    {
      "id": "node_image_processing",
      "type": "image_process",
      "name": "å›¾ç‰‡å¤„ç†",
      "position": { "x": 800, "y": 250 },
      "data": {
        "name": "å›¾ç‰‡å¤„ç†",
        "description": "ä¸‹è½½å›¾ç‰‡ã€OCRè¯†åˆ«ã€å†…å®¹åˆ†æ",
        "icon": "ğŸ–¼ï¸",
        "color": "#a855f7",
        "config": {
          "ocr": true,
          "imageAnalysis": true,
          "extractText": true
        }
      }
    },
    {
      "id": "node_ai_reply_enhanced",
      "type": "ai_reply_enhanced",
      "name": "AIå›å¤ï¼ˆå¢å¼ºï¼‰",
      "position": { "x": 950, "y": 250 },
      "data": {
        "name": "AIå›å¤ï¼ˆå¢å¼ºï¼‰",
        "description": "åŸºäºå›¾ç‰‡ä¸Šä¸‹æ–‡ç”Ÿæˆå›å¤",
        "icon": "ğŸ¤–",
        "color": "#3b82f6",
        "config": {
          "useImageContext": true,
          "maxTokens": 2000,
          "temperature": 0.7
        }
      }
    },
    {
      "id": "node_voice_processing",
      "type": "voice_process",
      "name": "è¯­éŸ³å¤„ç†",
      "position": { "x": 800, "y": 400 },
      "data": {
        "name": "è¯­éŸ³å¤„ç†",
        "description": "è¯­éŸ³è¯†åˆ«ã€è¯­éŸ³åˆ†æ",
        "icon": "ğŸ¤",
        "color": "#ef4444",
        "config": {
          "asr": true,
          "voiceAnalysis": true
        }
      }
    },
    {
      "id": "node_ai_reply",
      "type": "ai_reply",
      "name": "AIå›å¤",
      "position": { "x": 950, "y": 100 },
      "data": {
        "name": "AIå›å¤",
        "description": "ç”Ÿæˆæ™ºèƒ½å®¢æœå›å¤",
        "icon": "ğŸ¤–",
        "color": "#3b82f6",
        "config": {
          "maxTokens": 2000,
          "temperature": 0.7,
          "useTemplate": true,
          "useContext": true,
          "responseStyle": "professional"
        }
      }
    },
    {
      "id": "node_intent_decision",
      "type": "decision",
      "name": "æ„å›¾åˆ¤æ–­",
      "position": { "x": 1100, "y": 100 },
      "data": {
        "name": "æ„å›¾åˆ¤æ–­",
        "description": "æ ¹æ®æ„å›¾ã€æƒ…ç»ªã€é£é™©åˆ¤æ–­å¤„ç†æ–¹å¼",
        "icon": "ğŸ¯",
        "color": "#f59e0b",
        "config": {
          "conditions": [
            {
              "label": "å”®åéœ€æ±‚",
              "expression": "context.intent === 'after_sales' || context.intent === 'å”®å'",
              "targetNodeId": "node_after_sales_task"
            },
            {
              "label": "æŠ•è¯‰å‘Šè­¦",
              "expression": "context.needAlert === true || context.intent === 'complaint' || context.sentiment === 'negative' || context.sentiment === 'angry'",
              "targetNodeId": "node_alert_rule"
            },
            {
              "label": "éœ€è¦äººå·¥",
              "expression": "context.needIntervention === true || context.intent === 'human' || context.riskLevel >= 4",
              "targetNodeId": "node_staff_intervention"
            },
            {
              "label": "æ­£å¸¸å’¨è¯¢",
              "expression": "context.needReply === true || context.intent === 'chat' || context.intent === 'inquiry'",
              "targetNodeId": "node_robot_dispatch"
            }
          ]
        }
      }
    },
    {
      "id": "node_after_sales_task",
      "type": "task_assign",
      "name": "åˆ›å»ºå”®åä»»åŠ¡",
      "position": { "x": 1100, "y": 250 },
      "data": {
        "name": "åˆ›å»ºå”®åä»»åŠ¡",
        "description": "åˆ›å»ºå”®åä»»åŠ¡å¹¶åˆ†é…å·¥ä½œäººå‘˜",
        "icon": "ğŸ“‹",
        "color": "#8b5cf6",
        "config": {
          "taskType": "after_sales",
          "priority": "high",
          "autoAssign": true,
          "notifyChannel": "wechat"
        }
      }
    },
    {
      "id": "node_collaboration_analyze",
      "type": "collaboration_analyze",
      "name": "ååŒåˆ†æ",
      "position": { "x": 1250, "y": 250 },
      "data": {
        "name": "ååŒåˆ†æ",
        "description": "åˆ†æå·¥ä½œäººå‘˜çŠ¶æ€å’Œä»»åŠ¡ç´§æ€¥ç¨‹åº¦",
        "icon": "ğŸ“Š",
        "color": "#06b6d4",
        "config": {
          "checkStaffStatus": true,
          "evaluateUrgency": true
        }
      }
    },
    {
      "id": "node_notify_after_sales",
      "type": "notification",
      "name": "é€šçŸ¥å”®å",
      "position": { "x": 1400, "y": 250 },
      "data": {
        "name": "é€šçŸ¥å”®å",
        "description": "é€šçŸ¥å”®åå›¢é˜Ÿ",
        "icon": "ğŸ“¢",
        "color": "#f97316",
        "config": {
          "channels": ["wechat"],
          "template": "after_sales_notification"
        }
      }
    },
    {
      "id": "node_alert_rule",
      "type": "alert_rule",
      "name": "å‘Šè­¦è§„åˆ™åˆ¤æ–­",
      "position": { "x": 1100, "y": 400 },
      "data": {
        "name": "å‘Šè­¦è§„åˆ™åˆ¤æ–­",
        "description": "æ ¹æ®è§„åˆ™åˆ¤æ–­å‘Šè­¦çº§åˆ«",
        "icon": "âš ï¸",
        "color": "#ef4444",
        "config": {
          "rules": [
            {
              "level": "P1",
              "condition": "critical",
              "responseTime": "5min"
            },
            {
              "level": "P2",
              "condition": "riskScore >= 0.8",
              "responseTime": "15min"
            },
            {
              "level": "P3",
              "condition": "riskScore >= 0.5 && riskScore < 0.8",
              "responseTime": "1hour"
            }
          ]
        }
      }
    },
    {
      "id": "node_alert_save",
      "type": "alert_save",
      "name": "å‘Šè­¦å…¥åº“",
      "position": { "x": 1250, "y": 400 },
      "data": {
        "name": "å‘Šè­¦å…¥åº“",
        "description": "ä¿å­˜å‘Šè­¦åˆ°æ•°æ®åº“",
        "icon": "ğŸ’¾",
        "color": "#22c55e",
        "config": {
          "saveToDatabase": true,
          "autoEscalate": true
        }
      }
    },
    {
      "id": "node_alert_notify",
      "type": "alert_notify",
      "name": "å‘Šè­¦é€šçŸ¥",
      "position": { "x": 1400, "y": 400 },
      "data": {
        "name": "å‘Šè­¦é€šçŸ¥",
        "description": "å‘é€å‘Šè­¦é€šçŸ¥",
        "icon": "ğŸ“¢",
        "color": "#f97316",
        "config": {
          "channels": ["wechat", "email"],
          "notifyLevel": "P2"
        }
      }
    },
    {
      "id": "node_alert_escalation_check",
      "type": "decision",
      "name": "å‘Šè­¦å‡çº§åˆ¤æ–­",
      "position": { "x": 1550, "y": 400 },
      "data": {
        "name": "å‘Šè­¦å‡çº§åˆ¤æ–­",
        "description": "åˆ¤æ–­æ˜¯å¦éœ€è¦å‡çº§å‘Šè­¦",
        "icon": "ğŸ”€",
        "color": "#f59e0b",
        "config": {
          "conditions": [
            {
              "label": "éœ€è¦å‡çº§",
              "expression": "context.enableEscalation === true && context.escalationLevel < context.maxEscalation && (Date.now() - context.escalationStartTime >= context.escalationInterval)",
              "targetNodeId": "node_alert_escalate"
            },
            {
              "label": "ä¸éœ€è¦å‡çº§",
              "expression": "true",
              "targetNodeId": "node_log_save_alert"
            }
          ]
        }
      }
    },
    {
      "id": "node_alert_escalate",
      "type": "alert_escalate",
      "name": "å‘Šè­¦å‡çº§",
      "position": { "x": 1700, "y": 400 },
      "data": {
        "name": "å‘Šè­¦å‡çº§",
        "description": "å‡çº§å‘Šè­¦çº§åˆ«",
        "icon": "ğŸ””",
        "color": "#ef4444",
        "config": {
          "incrementLevel": 1,
          "updateEscalationTime": true
        }
      }
    },
    {
      "id": "node_staff_intervention",
      "type": "staff_intervention",
      "name": "äººå·¥æ¥ç®¡",
      "position": { "x": 1100, "y": 550 },
      "data": {
        "name": "äººå·¥æ¥ç®¡",
        "description": "åˆ†é…å·¥ä½œäººå‘˜å¹¶æ¥ç®¡ä¼šè¯",
        "icon": "ğŸ‘¥",
        "color": "#8b5cf6",
        "config": {
          "autoAssign": true,
          "assignStrategy": "least_busy",
          "updateSessionStatus": true,
          "notifyStaff": true
        }
      }
    },
    {
      "id": "node_notify_staff",
      "type": "notification",
      "name": "é€šçŸ¥å·¥ä½œäººå‘˜",
      "position": { "x": 1250, "y": 550 },
      "data": {
        "name": "é€šçŸ¥å·¥ä½œäººå‘˜",
        "description": "é€šçŸ¥å·¥ä½œäººå‘˜æœ‰æ–°çš„ä¼šè¯éœ€è¦å¤„ç†",
        "icon": "ğŸ“¢",
        "color": "#f97316",
        "config": {
          "channels": ["websocket", "wechat"],
          "template": "staff_intervention_notification"
        }
      }
    },
    {
      "id": "node_robot_dispatch",
      "type": "robot_dispatch",
      "name": "é€‰æ‹©æœºå™¨äºº",
      "position": { "x": 1250, "y": 100 },
      "data": {
        "name": "é€‰æ‹©æœºå™¨äºº",
        "description": "æ ¹æ®æ„å›¾å’Œä¼˜å…ˆçº§é€‰æ‹©åˆé€‚çš„æœºå™¨äºº",
        "icon": "ğŸ¤–",
        "color": "#3b82f6",
        "config": {
          "selectStrategy": "priority",
          "fallbackRobot": "default"
        }
      }
    },
    {
      "id": "node_send_command",
      "type": "send_command",
      "name": "å‘é€æŒ‡ä»¤",
      "position": { "x": 1400, "y": 100 },
      "data": {
        "name": "å‘é€æŒ‡ä»¤",
        "description": "å‘é€æ¶ˆæ¯åˆ°æœºå™¨äºº",
        "icon": "ğŸ“¤",
        "color": "#22c55e",
        "config": {
          "commandType": "message",
          "saveLog": true
        }
      }
    },
    {
      "id": "node_command_status",
      "type": "command_status",
      "name": "è®°å½•æŒ‡ä»¤çŠ¶æ€",
      "position": { "x": 1550, "y": 100 },
      "data": {
        "name": "è®°å½•æŒ‡ä»¤çŠ¶æ€",
        "description": "è®°å½•æŒ‡ä»¤æ‰§è¡ŒçŠ¶æ€åˆ°æ•°æ®åº“",
        "icon": "ğŸ“Š",
        "color": "#06b6d4",
        "config": {
          "status": "completed",
          "retryCount": 0
        }
      }
    },
    {
      "id": "node_log_save",
      "name": "è®°å½•æ—¥å¿—",
      "position": { "x": 1700, "y": 100 },
      "data": {
        "name": "è®°å½•æ—¥å¿—",
        "description": "è®°å½•æµç¨‹æ‰§è¡Œæ—¥å¿—",
        "icon": "ğŸ“",
        "color": "#6b7280",
        "config": {
          "saveToDatabase": true,
          "logLevel": "info"
        }
      }
    },
    {
      "id": "node_log_save_alert",
      "name": "è®°å½•æ—¥å¿—ï¼ˆå‘Šè­¦ï¼‰",
      "position": { "x": 1850, "y": 400 },
      "data": {
        "name": "è®°å½•æ—¥å¿—",
        "description": "è®°å½•å‘Šè­¦å¤„ç†æ—¥å¿—",
        "icon": "ğŸ“",
        "color": "#6b7280",
        "config": {
          "saveToDatabase": true,
          "logLevel": "warning"
        }
      }
    },
    {
      "id": "node_end",
      "type": "end",
      "name": "ç»“æŸ",
      "position": { "x": 1850, "y": 100 },
      "data": {
        "name": "æµç¨‹ç»“æŸ",
        "description": "æµç¨‹æ­£å¸¸ç»“æŸ",
        "icon": "âœ…",
        "color": "#22c55e"
      }
    },
    {
      "id": "node_end_alert",
      "type": "end",
      "name": "ç»“æŸï¼ˆå‘Šè­¦ï¼‰",
      "position": { "x": 2000, "y": 400 },
      "data": {
        "name": "æµç¨‹ç»“æŸ",
        "description": "å‘Šè­¦æµç¨‹ç»“æŸ",
        "icon": "âœ…",
        "color": "#22c55e"
      }
    }
  ],
  "edges": [
    {
      "id": "edge_01",
      "source": "node_start",
      "target": "node_message_receive"
    },
    {
      "id": "edge_02",
      "source": "node_message_receive",
      "target": "node_session_create"
    },
    {
      "id": "edge_03",
      "source": "node_session_create",
      "target": "node_context_enhancer"
    },
    {
      "id": "edge_04",
      "source": "node_context_enhancer",
      "target": "node_unified_analyze"
    },
    {
      "id": "edge_05",
      "source": "node_unified_analyze",
      "target": "node_message_type_decision"
    },
    {
      "id": "edge_06",
      "label": "æ–‡æœ¬",
      "source": "node_message_type_decision",
      "target": "node_ai_reply"
    },
    {
      "id": "edge_07",
      "label": "å›¾ç‰‡",
      "source": "node_message_type_decision",
      "target": "node_image_processing"
    },
    {
      "id": "edge_08",
      "label": "è¯­éŸ³",
      "source": "node_message_type_decision",
      "target": "node_voice_processing"
    },
    {
      "id": "edge_09",
      "source": "node_image_processing",
      "target": "node_ai_reply_enhanced"
    },
    {
      "id": "edge_10",
      "source": "node_voice_processing",
      "target": "node_ai_reply"
    },
    {
      "id": "edge_11",
      "source": "node_ai_reply",
      "target": "node_intent_decision"
    },
    {
      "id": "edge_12",
      "source": "node_ai_reply_enhanced",
      "target": "node_intent_decision"
    },
    {
      "id": "edge_13",
      "label": "å”®å",
      "source": "node_intent_decision",
      "target": "node_after_sales_task"
    },
    {
      "id": "edge_14",
      "label": "å‘Šè­¦",
      "source": "node_intent_decision",
      "target": "node_alert_rule"
    },
    {
      "id": "edge_15",
      "label": "äººå·¥",
      "source": "node_intent_decision",
      "target": "node_staff_intervention"
    },
    {
      "id": "edge_16",
      "label": "æ­£å¸¸",
      "source": "node_intent_decision",
      "target": "node_robot_dispatch"
    },
    {
      "id": "edge_17",
      "source": "node_after_sales_task",
      "target": "node_collaboration_analyze"
    },
    {
      "id": "edge_18",
      "source": "node_collaboration_analyze",
      "target": "node_notify_after_sales"
    },
    {
      "id": "edge_19",
      "source": "node_notify_after_sales",
      "target": "node_log_save"
    },
    {
      "id": "edge_20",
      "source": "node_alert_rule",
      "target": "node_alert_save"
    },
    {
      "id": "edge_21",
      "source": "node_alert_save",
      "target": "node_alert_notify"
    },
    {
      "id": "edge_22",
      "source": "node_alert_notify",
      "target": "node_alert_escalation_check"
    },
    {
      "id": "edge_23",
      "label": "éœ€è¦å‡çº§",
      "source": "node_alert_escalation_check",
      "target": "node_alert_escalate"
    },
    {
      "id": "edge_24",
      "label": "ä¸éœ€è¦å‡çº§",
      "source": "node_alert_escalation_check",
      "target": "node_log_save_alert"
    },
    {
      "id": "edge_25",
      "source": "node_alert_escalate",
      "target": "node_alert_notify"
    },
    {
      "id": "edge_26",
      "source": "node_staff_intervention",
      "target": "node_notify_staff"
    },
    {
      "id": "edge_27",
      "source": "node_notify_staff",
      "target": "node_log_save"
    },
    {
      "id": "edge_28",
      "source": "node_robot_dispatch",
      "target": "node_send_command"
    },
    {
      "id": "edge_29",
      "source": "node_send_command",
      "target": "node_command_status"
    },
    {
      "id": "edge_30",
      "source": "node_command_status",
      "target": "node_log_save"
    },
    {
      "id": "edge_31",
      "source": "node_log_save",
      "target": "node_end"
    },
    {
      "id": "edge_32",
      "source": "node_log_save_alert",
      "target": "node_end_alert"
    }
  ],
  "variables": {
    "message": null,
    "context": null,
    "aiResult": null,
    "decision": null,
    "command": null,
    "alert": null,
    "task": null
  },
  "timeout": 60000,
  "retryConfig": {
    "maxRetries": 3,
    "retryInterval": 1000
  },
  "createdAt": "2025-01-10T00:00:00.000Z",
  "updatedAt": "2025-01-10T00:00:00.000Z"
}
