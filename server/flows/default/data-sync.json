{
  "id": "flow_data_sync",
  "name": "数据同步流程",
  "description": "定时同步消息中心数据到流程引擎，保证数据一致性",
  "version": "1.0.0",
  "triggerType": "scheduled",
  "triggerConfig": {
    "cronExpression": "0 2 * * *",
    "description": "每天凌晨2点执行"
  },
  "nodes": [
    {
      "id": "node_01",
      "type": "start",
      "position": { "x": 100, "y": 100 },
      "data": {
        "name": "开始",
        "description": "数据同步开始",
        "config": {
          "initialVariables": {
            "syncTime": "{{now}}",
            "syncType": "full"
          }
        }
      }
    },
    {
      "id": "node_02",
      "type": "data_query",
      "position": { "x": 250, "y": 100 },
      "data": {
        "name": "查询消息中心",
        "description": "从消息中心获取数据",
        "config": {
          "source": "info_center",
          "endpoint": "/api/messages",
          "query": {
            "startDate": "{{context.lastSyncTime}}",
            "endDate": "{{context.syncTime}}",
            "limit": 10000
          }
        }
      }
    },
    {
      "id": "node_03",
      "type": "data_transform",
      "position": { "x": 400, "y": 100 },
      "data": {
        "name": "数据转换",
        "description": "转换数据格式",
        "config": {
          "transformRules": [
            {
              "rule": "rename_fields",
              "mapping": {
                "senderType": "sender_type",
                "messageType": "message_type"
              }
            },
            {
              "rule": "parse_dates",
              "fields": ["createdAt", "updatedAt"]
            }
          ]
        }
      }
    },
    {
      "id": "node_04",
      "type": "variable_set",
      "position": { "x": 550, "y": 100 },
      "data": {
        "name": "数据验证",
        "description": "验证数据完整性",
        "config": {
          "validationRules": [
            {
              "field": "id",
              "required": true,
              "type": "string"
            },
            {
              "field": "content",
              "required": true,
              "type": "string"
            },
            {
              "field": "sessionId",
              "required": true,
              "type": "string"
            }
          ],
          "errorAction": "skip"
        }
      }
    },
    {
      "id": "node_05",
      "type": "decision",
      "position": { "x": 700, "y": 100 },
      "data": {
        "name": "验证结果判断",
        "description": "判断数据验证结果",
        "config": {
          "conditions": [
            {
              "expression": "context.validationResult === 'success'",
              "label": "成功",
              "targetNodeId": "node_06"
            },
            {
              "expression": "context.validationResult === 'failed'",
              "label": "失败",
              "targetNodeId": "node_08"
            }
          ]
        }
      }
    },
    {
      "id": "node_06",
      "type": "http_request",
      "position": { "x": 850, "y": 100 },
      "data": {
        "name": "更新数据库",
        "description": "同步数据到流程引擎数据库",
        "config": {
          "url": "/api/flow-engine/sync/messages",
          "method": "POST",
          "body": {
            "messages": "{{context.transformedData}}",
            "syncTime": "{{context.syncTime}}"
          }
        }
      }
    },
    {
      "id": "node_07",
      "type": "log_save",
      "position": { "x": 1000, "y": 100 },
      "data": {
        "name": "记录日志",
        "description": "记录同步成功日志",
        "config": {
          "logLevel": "info",
          "message": "数据同步成功，共同步{{context.recordCount}}条记录"
        }
      }
    },
    {
      "id": "node_08",
      "type": "log_save",
      "position": { "x": 850, "y": 250 },
      "data": {
        "name": "记录错误",
        "description": "记录数据验证错误",
        "config": {
          "logLevel": "error",
          "message": "数据验证失败：{{context.errorMessage}}"
        }
      }
    },
    {
      "id": "node_09",
      "type": "alert_save",
      "position": { "x": 1000, "y": 250 },
      "data": {
        "name": "告警通知",
        "description": "发送告警通知",
        "config": {
          "alertLevel": "medium",
          "alertType": "data_sync",
          "message": "数据同步失败，请检查"
        }
      }
    },
    {
      "id": "node_10",
      "type": "end",
      "position": { "x": 1150, "y": 100 },
      "data": {
        "name": "结束",
        "description": "流程结束"
      }
    }
  ],
  "edges": [
    { "id": "edge_01", "source": "node_01", "target": "node_02" },
    { "id": "edge_02", "source": "node_02", "target": "node_03" },
    { "id": "edge_03", "source": "node_03", "target": "node_04" },
    { "id": "edge_04", "source": "node_04", "target": "node_05" },
    { "id": "edge_05", "source": "node_05", "target": "node_06", "label": "成功" },
    { "id": "edge_06", "source": "node_05", "target": "node_08", "label": "失败" },
    { "id": "edge_07", "source": "node_06", "target": "node_07" },
    { "id": "edge_08", "source": "node_07", "target": "node_10" },
    { "id": "edge_09", "source": "node_08", "target": "node_09" },
    { "id": "edge_10", "source": "node_09", "target": "node_10" }
  ]
}
