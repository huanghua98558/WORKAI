{
  "id": "flow_auto_scheduling_v6_1",
  "name": "è‡ªåŠ¨è°ƒåº¦ç³»ç»Ÿæµç¨‹",
  "description": "åŸºäºæ—¶æ®µå’Œæœºå™¨äººçŠ¶æ€æ™ºèƒ½åˆ†é…ä»»åŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œè‡ªåŠ¨æ‰©ç¼©å®¹",
  "version": "6.1.0",
  "isDefault": true,
  "priority": 100,
  "category": "æ ¸å¿ƒæµç¨‹",
  "tags": ["è°ƒåº¦", "è‡ªåŠ¨åŒ–", "è´Ÿè½½å‡è¡¡"],
  "triggerType": "scheduled",
  "triggerConfig": {
    "eventType": "scheduled",
    "cronExpression": "0 * * * *",
    "method": "POST"
  },
  "nodes": [
    {
      "id": "node_start",
      "type": "start",
      "name": "å¼€å§‹",
      "position": { "x": 50, "y": 100 },
      "data": {
        "name": "å¼€å§‹",
        "description": "æµç¨‹å¼€å§‹",
        "icon": "â–¶ï¸",
        "color": "bg-green-500"
      }
    },
    {
      "id": "node_time_check",
      "type": "multi_task_data",
      "name": "æ—¶é—´æ£€æµ‹å¼•æ“",
      "position": { "x": 250, "y": 100 },
      "data": {
        "name": "æ—¶é—´æ£€æµ‹å¼•æ“",
        "description": "æ£€æµ‹å½“å‰æ—¶é—´ï¼Œåˆ¤æ–­å½“å‰æ—¶æ®µï¼ˆç™½ç­/æ™šç­/é‡å æœŸï¼‰",
        "icon": "ğŸ—„ï¸",
        "color": "bg-blue-500",
        "config": {
          "executeMode": "sequential",
          "failFast": true,
          "tasks": [
            {
              "id": "task_get_current_time",
              "operation": "query",
              "config": {
                "queryType": "system_time",
                "outputField": "currentTime"
              }
            },
            {
              "id": "task_determine_shift",
              "operation": "query",
              "config": {
                "queryType": "shift_detection",
                "dayShiftStart": "09:00",
                "dayShiftEnd": "21:00",
                "overlapStart": "14:00",
                "overlapEnd": "19:00",
                "outputField": "currentShift"
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_robot_monitor",
      "type": "multi_task_robot",
      "name": "æœºå™¨äººçŠ¶æ€ç›‘æ§",
      "position": { "x": 450, "y": 100 },
      "data": {
        "name": "æœºå™¨äººçŠ¶æ€ç›‘æ§",
        "description": "å®æ—¶ç›‘æ§æœºå™¨äººåœ¨çº¿çŠ¶æ€ã€å·¥ä½œè´Ÿè·ã€å“åº”æ—¶é—´",
        "icon": "ğŸ¤–",
        "color": "bg-blue-600",
        "config": {
          "executeMode": "parallel",
          "failFast": false,
          "tasks": [
            {
              "id": "task_check_online_status",
              "operation": "status_check",
              "config": {
                "robotTypes": ["monitor", "notify", "day_reply", "night_reply"],
                "outputField": "onlineStatus"
              }
            },
            {
              "id": "task_check_workload",
              "operation": "workload_check",
              "config": {
                "robotTypes": ["monitor", "notify", "day_reply", "night_reply"],
                "outputField": "workload"
              }
            },
            {
              "id": "task_check_response_time",
              "operation": "response_time_check",
              "config": {
                "robotTypes": ["monitor", "notify", "day_reply", "night_reply"],
                "outputField": "responseTime"
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_activate_robots",
      "type": "multi_task_robot",
      "name": "æ¿€æ´»å¯¹åº”æ—¶æ®µæœºå™¨äºº",
      "position": { "x": 650, "y": 100 },
      "data": {
        "name": "æ¿€æ´»å¯¹åº”æ—¶æ®µæœºå™¨äºº",
        "description": "æ ¹æ®æ—¶æ®µæ¿€æ´»æˆ–åœç”¨æœºå™¨äºº",
        "icon": "ğŸ¤–",
        "color": "bg-blue-600",
        "config": {
          "executeMode": "sequential",
          "failFast": false,
          "tasks": [
            {
              "id": "task_activate_robots",
              "operation": "dispatch",
              "config": {
                "activateMode": "shift_based",
                "shiftField": "currentShift",
                "dayShiftRobots": ["day_reply_001", "day_reply_002"],
                "nightShiftRobots": ["night_reply_001", "night_reply_002"],
                "overlapRobots": ["day_reply_001", "night_reply_001"]
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_health_check",
      "type": "multi_task_robot",
      "name": "å¥åº·æ£€æŸ¥",
      "position": { "x": 850, "y": 100 },
      "data": {
        "name": "å¥åº·æ£€æŸ¥",
        "description": "å¯¹æ‰€æœ‰æ¿€æ´»çš„æœºå™¨äººè¿›è¡Œå¥åº·æ£€æŸ¥",
        "icon": "ğŸ¤–",
        "color": "bg-blue-600",
        "config": {
          "executeMode": "parallel",
          "failFast": false,
          "tasks": [
            {
              "id": "task_check_heartbeat",
              "operation": "status_check",
              "config": {
                "checkType": "heartbeat",
                "timeout": 30000,
                "outputField": "healthStatus"
              }
            },
            {
              "id": "task_check_api_status",
              "operation": "status_check",
              "config": {
                "checkType": "api_status",
                "timeout": 10000,
                "outputField": "apiStatus"
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_task_allocation",
      "type": "multi_task_task",
      "name": "ä»»åŠ¡åˆ†é…å¼•æ“",
      "position": { "x": 1050, "y": 100 },
      "data": {
        "name": "ä»»åŠ¡åˆ†é…å¼•æ“",
        "description": "æ™ºèƒ½åˆ†é…ä»»åŠ¡ç»™æœºå™¨äººï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åºï¼Œé€‰æ‹©å·¥ä½œè´Ÿè·æœ€å°çš„æœºå™¨äºº",
        "icon": "ğŸ“‹",
        "color": "bg-indigo-500",
        "config": {
          "executeMode": "sequential",
          "failFast": true,
          "tasks": [
            {
              "id": "task_prioritize_tasks",
              "operation": "update",
              "config": {
                "prioritizeBy": "priority",
                "priorityOrder": ["P0", "P1", "P2", "P3"],
                "outputField": "prioritizedTasks"
              }
            },
            {
              "id": "task_calculate_workload",
              "operation": "query",
              "config": {
                "calculationFormula": "(active_tasks * 2) + (active_sessions * 1) + (pending_messages * 0.5)",
                "outputField": "calculatedWorkload"
              }
            },
            {
              "id": "task_select_robot",
              "operation": "assign",
              "config": {
                "selectionCriteria": "min_workload",
                "workloadField": "calculatedWorkload",
                "outputField": "selectedRobot"
              }
            },
            {
              "id": "task_assign_tasks",
              "operation": "assign",
              "config": {
                "robotField": "selectedRobot",
                "tasksField": "prioritizedTasks",
                "batchSize": 10,
                "outputField": "assignedTasks"
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_workload_balance",
      "type": "multi_task_alert",
      "name": "è´Ÿè½½å‡è¡¡å¼•æ“",
      "position": { "x": 1250, "y": 100 },
      "data": {
        "name": "è´Ÿè½½å‡è¡¡å¼•æ“",
        "description": "å¹³è¡¡æœºå™¨äººå·¥ä½œè´Ÿè·ï¼Œå®šæœŸæ£€æŸ¥ã€é‡æ–°åˆ†é…ä»»åŠ¡ã€è‡ªåŠ¨æ‰©ç¼©å®¹",
        "icon": "ğŸ””",
        "color": "bg-red-500",
        "config": {
          "executeMode": "sequential",
          "failFast": false,
          "tasks": [
            {
              "id": "task_check_imbalance",
              "operation": "rule_evaluate",
              "config": {
                "ruleType": "workload_imbalance",
                "threshold": 3,
                "outputField": "imbalanceDetected"
              }
            },
            {
              "id": "task_rebalance_tasks",
              "operation": "dispatch",
              "config": {
                "condition": "imbalanceDetected === true",
                "rebalanceStrategy": "min_variance",
                "outputField": "rebalanced"
              }
            },
            {
              "id": "task_auto_scale",
              "operation": "dispatch",
              "config": {
                "condition": "imbalanceDetected === true",
                "scaleStrategy": "auto_scale",
                "minRobots": 2,
                "maxRobots": 10,
                "outputField": "scaled"
              }
            },
            {
              "id": "task_alert_overload",
              "operation": "notify",
              "config": {
                "condition": "context.calculatedWorkload > 10",
                "alertLevel": "critical",
                "channels": ["webhook", "email"],
                "outputField": "alertSent"
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_monitor_dashboard",
      "type": "multi_task_message",
      "name": "æ¨é€ç›‘æ§é¢æ¿",
      "position": { "x": 1450, "y": 100 },
      "data": {
        "name": "æ¨é€ç›‘æ§é¢æ¿",
        "description": "æ¨é€è°ƒåº¦çŠ¶æ€åˆ°ç›‘æ§é¢æ¿",
        "icon": "ğŸ“¨",
        "color": "bg-green-500",
        "config": {
          "executeMode": "parallel",
          "failFast": false,
          "tasks": [
            {
              "id": "task_send_to_monitor",
              "operation": "dispatch",
              "config": {
                "target": "monitor_dashboard",
                "data": {
                  "currentShift": "{{currentShift}}",
                  "robotStatus": "{{onlineStatus}}",
                  "workload": "{{calculatedWorkload}}",
                  "assignedTasks": "{{assignedTasks}}"
                }
              }
            }
          ]
        }
      }
    },
    {
      "id": "node_end",
      "type": "end",
      "name": "ç»“æŸ",
      "position": { "x": 1650, "y": 100 },
      "data": {
        "name": "ç»“æŸ",
        "description": "æµç¨‹ç»“æŸï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒåº¦ï¼ˆ1åˆ†é’Ÿåï¼‰",
        "icon": "â¹ï¸",
        "color": "bg-gray-500"
      }
    }
  ],
  "edges": [
    {
      "id": "edge_start_time_check",
      "source": "node_start",
      "target": "node_time_check",
      "type": "bezier"
    },
    {
      "id": "edge_time_check_robot_monitor",
      "source": "node_time_check",
      "target": "node_robot_monitor",
      "type": "bezier"
    },
    {
      "id": "edge_robot_monitor_activate_robots",
      "source": "node_robot_monitor",
      "target": "node_activate_robots",
      "type": "bezier"
    },
    {
      "id": "edge_activate_robots_health_check",
      "source": "node_activate_robots",
      "target": "node_health_check",
      "type": "bezier"
    },
    {
      "id": "edge_health_check_task_allocation",
      "source": "node_health_check",
      "target": "node_task_allocation",
      "type": "bezier"
    },
    {
      "id": "edge_task_allocation_workload_balance",
      "source": "node_task_allocation",
      "target": "node_workload_balance",
      "type": "bezier"
    },
    {
      "id": "edge_workload_balance_monitor_dashboard",
      "source": "node_workload_balance",
      "target": "node_monitor_dashboard",
      "type": "bezier"
    },
    {
      "id": "edge_monitor_dashboard_end",
      "source": "node_monitor_dashboard",
      "target": "node_end",
      "type": "bezier"
    }
  ],
  "variables": {
    "currentShift": "",
    "currentTime": "",
    "onlineStatus": {},
    "workload": {},
    "responseTime": {},
    "healthStatus": {},
    "apiStatus": {},
    "calculatedWorkload": 0,
    "selectedRobot": null,
    "assignedTasks": [],
    "imbalanceDetected": false,
    "rebalanced": false,
    "scaled": false,
    "alertSent": false
  },
  "timeout": 300000,
  "retryConfig": {
    "maxRetries": 3,
    "retryInterval": 5000
  }
}
