# WorkTool AI ä¸­æ¢ç³»ç»Ÿ - æƒé™ç®¡ç†å®ç°æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•

1. [æƒé™ç®¡ç†æ ¸å¿ƒåŸåˆ™](#1-æƒé™ç®¡ç†æ ¸å¿ƒåŸåˆ™)
2. [æƒé™ä½“ç³»è®¾è®¡](#2-æƒé™ä½“ç³»è®¾è®¡)
3. [æŠ€æœ¯å®ç°æ–¹æ¡ˆ](#3-æŠ€æœ¯å®ç°æ–¹æ¡ˆ)
4. [é¿å…é¡µé¢æ··ä¹±çš„æªæ–½](#4-é¿å…é¡µé¢æ··ä¹±çš„æªæ–½)
5. [æœ€ä½³å®è·µ](#5-æœ€ä½³å®è·µ)
6. [å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#6-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)

---

## 1. æƒé™ç®¡ç†æ ¸å¿ƒåŸåˆ™

### 1.1 ä¸‰å¤§æ ¸å¿ƒåŸåˆ™

#### åŸåˆ™1ï¼šæœ€å°æƒé™åŸåˆ™ï¼ˆLeast Privilegeï¼‰
- ç”¨æˆ·åªæ‹¥æœ‰å®Œæˆå·¥ä½œæ‰€éœ€çš„æœ€å°æƒé™
- æ–°ç”¨æˆ·é»˜è®¤åªèµ‹äºˆåªè¯»æƒé™
- æ•æ„Ÿæ“ä½œéœ€è¦æ˜¾å¼æˆæƒ

#### åŸåˆ™2ï¼šèŒè´£åˆ†ç¦»åŸåˆ™ï¼ˆSeparation of Dutiesï¼‰
- åˆ›å»ºç”¨æˆ·å’Œåˆ é™¤ç”¨æˆ·ç”±ä¸åŒè§’è‰²è´Ÿè´£
- å®¡æ‰¹æƒé™å’Œæ‰§è¡Œæƒé™åˆ†ç¦»
- é¿å…æƒé™è¿‡äºé›†ä¸­

#### åŸåˆ™3ï¼šæƒé™å¯è¿½æº¯åŸåˆ™ï¼ˆAudit Trailï¼‰
- æ‰€æœ‰æƒé™å˜æ›´éƒ½æœ‰è®°å½•
- æ‰€æœ‰æ“ä½œéƒ½æœ‰æ—¥å¿—
- å¯è¿½æº¯æƒé™æˆäºˆè€…å’Œæ—¶é—´

### 1.2 æƒé™ç²’åº¦è®¾è®¡

```
é¡µé¢çº§æƒé™ï¼ˆç²—ç²’åº¦ï¼‰
  â†“
åŠŸèƒ½çº§æƒé™ï¼ˆä¸­ç²’åº¦ï¼‰
  â†“
æ“ä½œçº§æƒé™ï¼ˆç»†ç²’åº¦ï¼‰
  â†“
æ•°æ®çº§æƒé™ï¼ˆæœ€ç»†ç²’åº¦ï¼‰
```

**ç¤ºä¾‹ï¼š**
- é¡µé¢çº§ï¼š`dashboard_view` - å¯ä»¥è®¿é—®ä»ªè¡¨ç›˜
- åŠŸèƒ½çº§ï¼š`session_view` - å¯ä»¥æŸ¥çœ‹ä¼šè¯åˆ—è¡¨
- æ“ä½œçº§ï¼š`session_export` - å¯ä»¥å¯¼å‡ºä¼šè¯æ•°æ®
- æ•°æ®çº§ï¼š`session_view_own_only` - åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä¼šè¯

---

## 2. æƒé™ä½“ç³»è®¾è®¡

### 2.1 æƒé™åˆ†ç±»

#### 2.1.1 æŒ‰æ¨¡å—åˆ†ç±»

| æ¨¡å— | æƒé™ä»£ç  | è¯´æ˜ |
|------|---------|------|
| ä»ªè¡¨ç›˜ | `dashboard_view` | æŸ¥çœ‹ä»ªè¡¨ç›˜ |
| æœºå™¨äººç®¡ç† | `robot_view` | æŸ¥çœ‹æœºå™¨äººåˆ—è¡¨ |
| æœºå™¨äººç®¡ç† | `robot_config` | é…ç½®æœºå™¨äºº |
| æœºå™¨äººç®¡ç† | `robot_delete` | åˆ é™¤æœºå™¨äºº |
| ä¼šè¯ç®¡ç† | `session_view` | æŸ¥çœ‹ä¼šè¯åˆ—è¡¨ |
| ä¼šè¯ç®¡ç† | `session_export` | å¯¼å‡ºä¼šè¯æ•°æ® |
| ä¼šè¯ç®¡ç† | `session_takeover` | æ¥ç®¡ä¼šè¯ |
| å‘Šè­¦ç®¡ç† | `alert_view` | æŸ¥çœ‹å‘Šè­¦åˆ—è¡¨ |
| å‘Šè­¦ç®¡ç† | `alert_handle` | å¤„ç†å‘Šè­¦ |
| å”®åä»»åŠ¡ | `after_sales_view` | æŸ¥çœ‹å”®åä»»åŠ¡ |
| å”®åä»»åŠ¡ | `after_sales_handle` | å¤„ç†å”®åä»»åŠ¡ |
| ç”¨æˆ·ç®¡ç† | `user_view` | æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ |
| ç”¨æˆ·ç®¡ç† | `user_create` | åˆ›å»ºç”¨æˆ· |
| ç”¨æˆ·ç®¡ç† | `user_update` | æ›´æ–°ç”¨æˆ· |
| ç”¨æˆ·ç®¡ç† | `user_delete` | åˆ é™¤ç”¨æˆ· |
| è§’è‰²ç®¡ç† | `role_view` | æŸ¥çœ‹è§’è‰²åˆ—è¡¨ |
| è§’è‰²ç®¡ç† | `role_create` | åˆ›å»ºè§’è‰² |
| è§’è‰²ç®¡ç† | `role_update` | æ›´æ–°è§’è‰² |
| è§’è‰²ç®¡ç† | `role_delete` | åˆ é™¤è§’è‰² |
| æƒé™ç®¡ç† | `permission_view` | æŸ¥çœ‹æƒé™åˆ—è¡¨ |
| æƒé™ç®¡ç† | `permission_config` | é…ç½®æƒé™ |
| å®¡è®¡æ—¥å¿— | `audit_log_view` | æŸ¥çœ‹å®¡è®¡æ—¥å¿— |
| ç³»ç»Ÿé…ç½® | `config_view` | æŸ¥çœ‹ç³»ç»Ÿé…ç½® |
| ç³»ç»Ÿé…ç½® | `config_update` | æ›´æ–°ç³»ç»Ÿé…ç½® |

#### 2.1.2 æŒ‰æ“ä½œç±»å‹åˆ†ç±»

| æ“ä½œç±»å‹ | æƒé™ä»£ç åç¼€ | è¯´æ˜ |
|---------|-------------|------|
| æŸ¥çœ‹ | `_view` | å¯ä»¥æŸ¥çœ‹é¡µé¢æˆ–æ•°æ® |
| åˆ›å»º | `_create` | å¯ä»¥åˆ›å»ºæ–°æ•°æ® |
| æ›´æ–° | `_update` | å¯ä»¥æ›´æ–°æ•°æ® |
| åˆ é™¤ | `_delete` | å¯ä»¥åˆ é™¤æ•°æ® |
| å¯¼å‡º | `_export` | å¯ä»¥å¯¼å‡ºæ•°æ® |
| æ‰¹é‡æ“ä½œ | `_batch` | å¯ä»¥æ‰¹é‡æ“ä½œ |
| å®¡æ‰¹ | `_approve` | å¯ä»¥å®¡æ‰¹æ“ä½œ |
| é…ç½® | `_config` | å¯ä»¥é…ç½®ç³»ç»Ÿ |

### 2.2 è§’è‰²è®¾è®¡

#### 2.2.1 é¢„ç½®è§’è‰²

| è§’è‰² | è§’è‰²ä»£ç  | è¯´æ˜ | é»˜è®¤æƒé™ |
|------|---------|------|---------|
| è¶…çº§ç®¡ç†å‘˜ | ADMIN | æ‹¥æœ‰æ‰€æœ‰æƒé™ | å…¨éƒ¨ |
| ç®¡ç†å‘˜ | MANAGER | ç®¡ç†æ™®é€šç”¨æˆ·å’Œé…ç½®ç³»ç»Ÿ | é™¤è§’è‰²åˆ é™¤å¤–çš„æ‰€æœ‰æƒé™ |
| å”®åäººå‘˜ | AFTER_SALES | å¤„ç†å”®åä»»åŠ¡ | å”®åä»»åŠ¡ç›¸å…³æƒé™ |
| ç¾¤åŠ©ç† | ASSISTANT | ç¾¤ç»„æ—¥å¸¸ç®¡ç† | ä¼šè¯æŸ¥çœ‹ã€å‘Šè­¦æŸ¥çœ‹ |
| è¿è¥äººå‘˜ | OPERATOR | è§†é¢‘å·è¿è¥ | æœºå™¨äººæŸ¥çœ‹ã€ä¼šè¯æŸ¥çœ‹ |
| åªè¯»ç”¨æˆ· | VIEWER | åªèƒ½æŸ¥çœ‹æ•°æ® | æ‰€æœ‰_viewæƒé™ |

#### 2.2.2 æƒé™åˆ†é…çŸ©é˜µ

```
æƒé™è§’è‰²çŸ©é˜µç¤ºä¾‹ï¼š

æƒé™ä»£ç                 | ADMIN | MANAGER | AFTER_SALES | ASSISTANT | OPERATOR | VIEWER
-----------------------|-------|---------|-------------|-----------|----------|--------
dashboard_view         |   âœ…   |   âœ…    |     âœ…      |    âœ…     |    âœ…     |   âœ…
robot_view             |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âœ…     |   âœ…
robot_config           |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
robot_delete           |   âœ…   |   âŒ    |     âŒ      |    âŒ     |    âŒ     |   âŒ
session_view           |   âœ…   |   âœ…    |     âœ…      |    âœ…     |    âœ…     |   âœ…
session_export         |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âœ…     |   âŒ
session_takeover       |   âœ…   |   âœ…    |     âœ…      |    âœ…     |    âŒ     |   âŒ
alert_view             |   âœ…   |   âœ…    |     âœ…      |    âœ…     |    âœ…     |   âœ…
alert_handle           |   âœ…   |   âœ…    |     âŒ      |    âœ…     |    âŒ     |   âŒ
after_sales_view       |   âœ…   |   âœ…    |     âœ…      |    âŒ     |    âŒ     |   âœ…
after_sales_handle     |   âœ…   |   âœ…    |     âœ…      |    âŒ     |    âŒ     |   âŒ
user_view              |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
user_create            |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
user_update            |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
user_delete            |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
role_view              |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
role_create            |   âœ…   |   âŒ    |     âŒ      |    âŒ     |    âŒ     |   âŒ
role_update            |   âœ…   |   âŒ    |     âŒ      |    âŒ     |    âŒ     |   âŒ
role_delete            |   âœ…   |   âŒ    |     âŒ      |    âŒ     |    âŒ     |   âŒ
audit_log_view         |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
config_view            |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
config_update          |   âœ…   |   âœ…    |     âŒ      |    âŒ     |    âŒ     |   âŒ
```

---

## 3. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 3.1 åç«¯å®ç°

#### 3.1.1 æƒé™æ£€æŸ¥ä¸­é—´ä»¶

**æ–‡ä»¶ï¼š`server/middleware/permission-middleware.js`**

```javascript
const { getUserPermissions } = require('../services/permission.service');

/**
 * æƒé™æ£€æŸ¥ä¸­é—´ä»¶
 * @param {string} permissionCode - æƒé™ä»£ç 
 * @param {boolean} requireAll - æ˜¯å¦éœ€è¦æ‰€æœ‰æƒé™ï¼ˆé»˜è®¤falseï¼Œåªéœ€ä¸€ä¸ªï¼‰
 */
function requirePermission(permissionCode, requireAll = false) {
  return async function (request, reply) {
    try {
      // å¦‚æœç”¨æˆ·æ˜¯è¶…çº§ç®¡ç†å‘˜ï¼Œç›´æ¥æ”¾è¡Œ
      if (request.user.roleCode === 'ADMIN') {
        return;
      }

      // è·å–ç”¨æˆ·æƒé™
      const userPermissions = request.userPermissions || await getUserPermissions(request.user.id);

      // æ£€æŸ¥æƒé™
      const hasPermission = requireAll
        ? Array.isArray(permissionCode)
          ? permissionCode.every(code => userPermissions.includes(code))
          : userPermissions.includes(permissionCode)
        : Array.isArray(permissionCode)
          ? permissionCode.some(code => userPermissions.includes(code))
          : userPermissions.includes(permissionCode);

      if (!hasPermission) {
        return reply.status(403).send({
          code: -1,
          message: 'æƒé™ä¸è¶³',
          requiredPermission: permissionCode,
        });
      }

      // å°†æƒé™ç¼“å­˜åˆ°requestä¸­ï¼Œé¿å…é‡å¤æŸ¥è¯¢
      request.userPermissions = userPermissions;
    } catch (error) {
      return reply.status(500).send({
        code: -1,
        message: 'æƒé™æ£€æŸ¥å¤±è´¥',
        error: error.message,
      });
    }
  };
}

module.exports = { requirePermission };
```

#### 3.1.2 è·¯ç”±æƒé™é…ç½®

**æ–‡ä»¶ï¼š`server/routes/admin.api.js`**

```javascript
const { verifyAuth } = require('../hooks/auth.hook');
const { requirePermission } = require('../middleware/permission-middleware');

// ç”¨æˆ·ç®¡ç†API
fastify.get('/users', {
  onRequest: [verifyAuth, requirePermission('user_view')],
}, async (request, reply) => {
  // å®ç°
});

fastify.post('/users', {
  onRequest: [verifyAuth, requirePermission('user_create')],
}, async (request, reply) => {
  // å®ç°
});

fastify.delete('/users/:user_id', {
  onRequest: [verifyAuth, requirePermission('user_delete')],
}, async (request, reply) => {
  // å®ç°
});

// è§’è‰²ç®¡ç†API
fastify.get('/roles', {
  onRequest: [verifyAuth, requirePermission('role_view')],
}, async (request, reply) => {
  // å®ç°
});

fastify.post('/roles', {
  onRequest: [verifyAuth, requirePermission('role_create')],
}, async (request, reply) => {
  // å®ç°
});

// å”®åä»»åŠ¡API
fastify.post('/after-sales/:task_id/complete', {
  onRequest: [verifyAuth, requirePermission('after_sales_handle')],
}, async (request, reply) => {
  // å®ç°
});

// å¤šæƒé™æ£€æŸ¥ï¼ˆä»»ä¸€æƒé™å³å¯ï¼‰
fastify.post('/sessions/:session_id/takeover', {
  onRequest: [verifyAuth, requirePermission(['session_takeover', 'after_sales_handle'], false)],
}, async (request, reply) => {
  // å®ç°
});

// å¤šæƒé™æ£€æŸ¥ï¼ˆéœ€è¦æ‰€æœ‰æƒé™ï¼‰
fastify.delete('/users/:user_id', {
  onRequest: [verifyAuth, requirePermission(['user_delete', 'audit_log_view'], true)],
}, async (request, reply) => {
  // åˆ é™¤ç”¨æˆ·éœ€è¦åŒæ—¶æ‹¥æœ‰user_deleteå’Œaudit_log_viewæƒé™
});
```

#### 3.1.3 æƒé™æœåŠ¡

**æ–‡ä»¶ï¼š`server/services/permission.service.js`**

```javascript
const { getDb } = require('coze-coding-dev-sdk');
const { userRoles, roles, rolePermissions, permissions, eq } = require('../database/schema');

class PermissionService {
  /**
   * è·å–ç”¨æˆ·æ‰€æœ‰æƒé™
   */
  async getUserPermissions(userId) {
    const db = await getDb();

    const result = await db
      .select({ permissionCode: permissions.permissionCode })
      .from(userRoles)
      .innerJoin(rolePermissions, eq(userRoles.roleId, rolePermissions.roleId))
      .innerJoin(permissions, eq(rolePermissions.permissionId, permissions.id))
      .where(eq(userRoles.userId, userId));

    return result.map(p => p.permissionCode);
  }

  /**
   * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æŒ‡å®šæƒé™
   */
  async hasPermission(userId, permissionCode) {
    const permissions = await this.getUserPermissions(userId);
    return permissions.includes(permissionCode);
  }

  /**
   * è·å–æƒé™æ ‘
   */
  async getPermissionTree() {
    const db = await getDb();

    const allPermissions = await db.select().from(permissions);

    // æŒ‰èµ„æºç±»å‹åˆ†ç»„
    const tree = {};
    allPermissions.forEach(p => {
      if (!tree[p.resourceType]) {
        tree[p.resourceType] = [];
      }
      tree[p.resourceType].push({
        id: p.id,
        name: p.permissionName,
        code: p.permissionCode,
        action: p.actionType,
      });
    });

    return tree;
  }

  /**
   * è·å–è§’è‰²çš„æ‰€æœ‰æƒé™
   */
  async getRolePermissions(roleId) {
    const db = await getDb();

    const result = await db
      .select({ permissionCode: permissions.permissionCode })
      .from(rolePermissions)
      .innerJoin(permissions, eq(rolePermissions.permissionId, permissions.id))
      .where(eq(rolePermissions.roleId, roleId));

    return result.map(p => p.permissionCode);
  }
}

module.exports = new PermissionService();
```

### 3.2 å‰ç«¯å®ç°

#### 3.2.1 æƒé™ä¸Šä¸‹æ–‡

**æ–‡ä»¶ï¼š`src/contexts/PermissionContext.tsx`**

```typescript
'use client';

import React, { createContext, useContext, useState, useEffect } from 'react';

interface PermissionContextType {
  permissions: string[];
  hasPermission: (permission: string | string[]) => boolean;
  loading: boolean;
  refreshPermissions: () => Promise<void>;
}

const PermissionContext = createContext<PermissionContextType | undefined>(undefined);

export function PermissionProvider({ children }: { children: React.ReactNode }) {
  const [permissions, setPermissions] = useState<string[]>([]);
  const [loading, setLoading] = useState(true);

  // åŠ è½½ç”¨æˆ·æƒé™
  const loadPermissions = async () => {
    try {
      const token = localStorage.getItem('access_token');
      const response = await fetch('/api/auth/permissions', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      const result = await response.json();
      if (result.code === 0) {
        setPermissions(result.data.permissions || []);
      }
    } catch (error) {
      console.error('åŠ è½½æƒé™å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  // æ£€æŸ¥æƒé™
  const hasPermission = (permission: string | string[]): boolean => {
    if (permissions.length === 0) return false;
    if (typeof permission === 'string') {
      return permissions.includes(permission);
    }
    return permission.some(p => permissions.includes(p));
  };

  // åˆ·æ–°æƒé™
  const refreshPermissions = async () => {
    setLoading(true);
    await loadPermissions();
  };

  useEffect(() => {
    loadPermissions();
  }, []);

  return (
    <PermissionContext.Provider value={{ permissions, hasPermission, loading, refreshPermissions }}>
      {children}
    </PermissionContext.Provider>
  );
}

export function usePermissions() {
  const context = useContext(PermissionContext);
  if (!context) {
    throw new Error('usePermissions must be used within PermissionProvider');
  }
  return context;
}
```

#### 3.2.2 æƒé™å®ˆå«ç»„ä»¶

**æ–‡ä»¶ï¼š`src/components/auth/PermissionGuard.tsx`**

```typescript
'use client';

import React from 'react';
import { usePermissions } from '@/contexts/PermissionContext';

interface PermissionGuardProps {
  permission: string | string[];
  requireAll?: boolean; // æ˜¯å¦éœ€è¦æ‰€æœ‰æƒé™
  fallback?: React.ReactNode;
  children: React.ReactNode;
}

export function PermissionGuard({ permission, requireAll = false, fallback, children }: PermissionGuardProps) {
  const { hasPermission, loading } = usePermissions();

  // åŠ è½½ä¸­
  if (loading) {
    return <div className="text-sm text-muted-foreground">æƒé™åŠ è½½ä¸­...</div>;
  }

  // æ£€æŸ¥æƒé™
  const hasAccess = requireAll
    ? typeof permission === 'string'
      ? hasPermission(permission)
      : (Array.isArray(permission) && permission.every(p => hasPermission(p)))
    : hasPermission(permission);

  // æ— æƒé™
  if (!hasAccess) {
    return fallback || (
      <div className="text-sm text-muted-foreground p-4 bg-muted rounded-md">
        æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤åŠŸèƒ½
      </div>
    );
  }

  return <>{children}</>;
}
```

#### 3.2.3 æƒé™æŒ‰é’®ç»„ä»¶

**æ–‡ä»¶ï¼š`src/components/auth/PermissionButton.tsx`**

```typescript
'use client';

import React from 'react';
import { Button } from '@/components/ui/button';
import { usePermissions } from '@/contexts/PermissionContext';
import { Lock } from 'lucide-react';

interface PermissionButtonProps extends React.ComponentProps<typeof Button> {
  permission: string | string[];
  requireAll?: boolean;
}

export function PermissionButton({ permission, requireAll = false, children, disabled, ...props }: PermissionButtonProps) {
  const { hasPermission } = usePermissions();

  const hasAccess = requireAll
    ? typeof permission === 'string'
      ? hasPermission(permission)
      : (Array.isArray(permission) && permission.every(p => hasPermission(p)))
    : hasPermission(permission);

  return (
    <Button
      {...props}
      disabled={disabled || !hasAccess}
      title={!hasAccess ? 'æ‚¨æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤æ“ä½œ' : props.title}
    >
      {!hasAccess && <Lock className="w-4 h-4 mr-2" />}
      {children}
    </Button>
  );
}
```

#### 3.2.4 é¡µé¢æƒé™æ§åˆ¶

**æ–‡ä»¶ï¼š`src/app/settings/users/page.tsx`**

```typescript
'use client';

import React, { useState, useEffect } from 'react';
import { usePermissions } from '@/contexts/PermissionContext';
import { PermissionGuard } from '@/components/auth/PermissionGuard';
import { PermissionButton } from '@/components/auth/PermissionButton';
import { useRouter } from 'next/navigation';

export default function UsersPage() {
  const { hasPermission } = usePermissions();
  const router = useRouter();

  // é¡µé¢çº§æƒé™æ£€æŸ¥
  useEffect(() => {
    if (!hasPermission('user_view')) {
      router.push('/dashboard');
    }
  }, [hasPermission, router]);

  return (
    <div className="container mx-auto p-6">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold">ç”¨æˆ·ç®¡ç†</h1>
        {/* åªæœ‰æ‹¥æœ‰user_createæƒé™çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°åˆ›å»ºæŒ‰é’® */}
        <PermissionGuard permission="user_create" fallback={null}>
          <PermissionButton permission="user_create">
            åˆ›å»ºç”¨æˆ·
          </PermissionButton>
        </PermissionGuard>
      </div>

      {/* ç”¨æˆ·åˆ—è¡¨ */}
      <div className="space-y-4">
        {/* ç”¨æˆ·æ•°æ®æ¸²æŸ“ */}
        {users.map(user => (
          <div key={user.id} className="p-4 border rounded-md">
            <div className="flex justify-between items-center">
              <div>
                <h3 className="font-semibold">{user.username}</h3>
                <p className="text-sm text-muted-foreground">{user.email}</p>
              </div>
              <div className="space-x-2">
                {/* åªæœ‰æ‹¥æœ‰user_updateæƒé™çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°ç¼–è¾‘æŒ‰é’® */}
                <PermissionButton permission="user_update" variant="outline" size="sm">
                  ç¼–è¾‘
                </PermissionButton>
                {/* åªæœ‰æ‹¥æœ‰user_deleteæƒé™çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°åˆ é™¤æŒ‰é’® */}
                <PermissionButton permission="user_delete" variant="destructive" size="sm">
                  åˆ é™¤
                </PermissionButton>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

#### 3.2.5 å¯¼èˆªèœå•æƒé™æ§åˆ¶

**æ–‡ä»¶ï¼š`src/components/layout/Sidebar.tsx`**

```typescript
'use client';

import React from 'react';
import { usePermissions } from '@/contexts/PermissionContext';
import {
  LayoutDashboard,
  Bot,
  MessageSquare,
  AlertTriangle,
  Users,
  Shield,
  Key,
  FileText,
  Settings,
} from 'lucide-react';

export function Sidebar() {
  const { hasPermission } = usePermissions();

  const menuItems = [
    {
      title: 'ä»ªè¡¨ç›˜',
      href: '/dashboard',
      icon: LayoutDashboard,
      permission: 'dashboard_view',
    },
    {
      title: 'æœºå™¨äººç®¡ç†',
      href: '/robots',
      icon: Bot,
      permission: 'robot_view',
    },
    {
      title: 'ä¼šè¯ç®¡ç†',
      href: '/sessions',
      icon: MessageSquare,
      permission: 'session_view',
    },
    {
      title: 'å‘Šè­¦ç®¡ç†',
      href: '/alerts',
      icon: AlertTriangle,
      permission: 'alert_view',
    },
    {
      title: 'å”®åä»»åŠ¡',
      href: '/after-sales',
      icon: Settings,
      permission: 'after_sales_view',
    },
    {
      title: 'ç³»ç»Ÿè®¾ç½®',
      icon: Settings,
      permission: 'user_view',
      items: [
        {
          title: 'ç”¨æˆ·ç®¡ç†',
          href: '/settings/users',
          icon: Users,
          permission: 'user_view',
        },
        {
          title: 'è§’è‰²ç®¡ç†',
          href: '/settings/roles',
          icon: Shield,
          permission: 'role_view',
        },
        {
          title: 'æƒé™ç®¡ç†',
          href: '/settings/permissions',
          icon: Key,
          permission: 'permission_view',
        },
        {
          title: 'å®¡è®¡æ—¥å¿—',
          href: '/settings/audit-logs',
          icon: FileText,
          permission: 'audit_log_view',
        },
      ],
    },
  ];

  return (
    <nav className="space-y-2">
      {menuItems.map((item) => {
        // æ£€æŸ¥æ˜¯å¦æœ‰æƒé™è®¿é—®æ­¤èœå•
        if (!hasPermission(item.permission)) {
          return null;
        }

        // å¦‚æœæœ‰å­èœå•
        if (item.items) {
          return (
            <div key={item.title}>
              <div className="flex items-center space-x-2 px-3 py-2 text-sm font-medium text-muted-foreground">
                <item.icon className="w-4 h-4" />
                <span>{item.title}</span>
              </div>
              <div className="ml-4 space-y-1">
                {item.items
                  .filter(subItem => hasPermission(subItem.permission))
                  .map(subItem => (
                    <a
                      key={subItem.href}
                      href={subItem.href}
                      className="flex items-center space-x-2 px-3 py-2 text-sm rounded-md hover:bg-muted"
                    >
                      <subItem.icon className="w-4 h-4" />
                      <span>{subItem.title}</span>
                    </a>
                  ))}
              </div>
            </div>
          );
        }

        // æ™®é€šèœå•
        return (
          <a
            key={item.href}
            href={item.href}
            className="flex items-center space-x-2 px-3 py-2 text-sm rounded-md hover:bg-muted"
          >
            <item.icon className="w-4 h-4" />
            <span>{item.title}</span>
          </a>
        );
      })}
    </nav>
  );
}
```

---

## 4. é¿å…é¡µé¢æ··ä¹±çš„æªæ–½

### 4.1 æƒé™åˆ†ç»„ç®¡ç†

#### 4.1.1 æƒé™æ¨¡å—åŒ–

å°†æƒé™æŒ‰æ¨¡å—åˆ†ç»„ï¼Œä¾¿äºç®¡ç†ï¼š

```javascript
// server/config/permissions.config.js
const permissionGroups = {
  // ä»ªè¡¨ç›˜æ¨¡å—
  dashboard: {
    name: 'ä»ªè¡¨ç›˜',
    permissions: ['dashboard_view'],
  },

  // æœºå™¨äººç®¡ç†æ¨¡å—
  robot: {
    name: 'æœºå™¨äººç®¡ç†',
    permissions: ['robot_view', 'robot_config', 'robot_delete'],
  },

  // ä¼šè¯ç®¡ç†æ¨¡å—
  session: {
    name: 'ä¼šè¯ç®¡ç†',
    permissions: ['session_view', 'session_export', 'session_takeover'],
  },

  // å‘Šè­¦ç®¡ç†æ¨¡å—
  alert: {
    name: 'å‘Šè­¦ç®¡ç†',
    permissions: ['alert_view', 'alert_handle'],
  },

  // å”®åä»»åŠ¡æ¨¡å—
  afterSales: {
    name: 'å”®åä»»åŠ¡',
    permissions: ['after_sales_view', 'after_sales_handle'],
  },

  // ç”¨æˆ·ç®¡ç†æ¨¡å—
  user: {
    name: 'ç”¨æˆ·ç®¡ç†',
    permissions: ['user_view', 'user_create', 'user_update', 'user_delete'],
  },

  // è§’è‰²ç®¡ç†æ¨¡å—
  role: {
    name: 'è§’è‰²ç®¡ç†',
    permissions: ['role_view', 'role_create', 'role_update', 'role_delete'],
  },

  // æƒé™ç®¡ç†æ¨¡å—
  permission: {
    name: 'æƒé™ç®¡ç†',
    permissions: ['permission_view', 'permission_config'],
  },

  // å®¡è®¡æ—¥å¿—æ¨¡å—
  auditLog: {
    name: 'å®¡è®¡æ—¥å¿—',
    permissions: ['audit_log_view'],
  },

  // ç³»ç»Ÿé…ç½®æ¨¡å—
  config: {
    name: 'ç³»ç»Ÿé…ç½®',
    permissions: ['config_view', 'config_update'],
  },
};

module.exports = permissionGroups;
```

#### 4.1.2 æƒé™æ¨¡æ¿

æä¾›é¢„è®¾çš„æƒé™æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»ºè§’è‰²ï¼š

```javascript
// server/config/role-templates.config.js
const roleTemplates = {
  // è¶…çº§ç®¡ç†å‘˜æ¨¡æ¿
  admin: {
    name: 'è¶…çº§ç®¡ç†å‘˜',
    description: 'æ‹¥æœ‰æ‰€æœ‰æƒé™',
    permissions: [], // ç©ºæ•°ç»„è¡¨ç¤ºæ‰€æœ‰æƒé™
  },

  // ç®¡ç†å‘˜æ¨¡æ¿
  manager: {
    name: 'ç®¡ç†å‘˜',
    description: 'ç®¡ç†æ™®é€šç”¨æˆ·å’Œé…ç½®ç³»ç»Ÿ',
    permissions: [
      'dashboard_view',
      'robot_view', 'robot_config',
      'session_view', 'session_export', 'session_takeover',
      'alert_view', 'alert_handle',
      'after_sales_view', 'after_sales_handle',
      'user_view', 'user_create', 'user_update',
      'role_view', 'role_create', 'role_update',
      'permission_view',
      'audit_log_view',
      'config_view', 'config_update',
    ],
  },

  // å”®åäººå‘˜æ¨¡æ¿
  afterSales: {
    name: 'å”®åäººå‘˜',
    description: 'å¤„ç†å”®åä»»åŠ¡',
    permissions: [
      'dashboard_view',
      'session_view', 'session_takeover',
      'alert_view',
      'after_sales_view', 'after_sales_handle',
    ],
  },

  // ç¾¤åŠ©ç†æ¨¡æ¿
  assistant: {
    name: 'ç¾¤åŠ©ç†',
    description: 'ç¾¤ç»„æ—¥å¸¸ç®¡ç†',
    permissions: [
      'dashboard_view',
      'session_view',
      'alert_view',
    ],
  },

  // è¿è¥äººå‘˜æ¨¡æ¿
  operator: {
    name: 'è¿è¥äººå‘˜',
    description: 'è§†é¢‘å·è¿è¥',
    permissions: [
      'dashboard_view',
      'robot_view',
      'session_view', 'session_export',
      'alert_view',
      'after_sales_view',
    ],
  },

  // åªè¯»ç”¨æˆ·æ¨¡æ¿
  viewer: {
    name: 'åªè¯»ç”¨æˆ·',
    description: 'åªèƒ½æŸ¥çœ‹æ•°æ®',
    permissions: [
      'dashboard_view',
      'robot_view',
      'session_view',
      'alert_view',
      'after_sales_view',
    ],
  },
};

module.exports = roleTemplates;
```

### 4.2 ç»Ÿä¸€çš„æƒé™ç®¡ç†é¡µé¢

#### 4.2.1 è§’è‰²æƒé™åˆ†é…é¡µé¢

æä¾›ä¸€ä¸ªæ¸…æ™°çš„æƒé™åˆ†é…ç•Œé¢ï¼š

```typescript
// src/app/settings/roles/permissions/page.tsx
'use client';

import React, { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Checkbox } from '@/components/ui/checkbox';
import { Button } from '@/components/ui/button';
import { permissionGroups } from '@/lib/config/permissions.config';

export default function RolePermissionsPage() {
  const [selectedPermissions, setSelectedPermissions] = useState<string[]>([]);

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">è§’è‰²æƒé™åˆ†é…</h1>

      {Object.entries(permissionGroups).map(([groupKey, group]) => (
        <Card key={groupKey} className="mb-6">
          <CardHeader>
            <CardTitle className="flex items-center justify-between">
              <span>{group.name}</span>
              <Checkbox
                checked={group.permissions.every(p => selectedPermissions.includes(p))}
                onCheckedChange={(checked) => {
                  if (checked) {
                    setSelectedPermissions([...selectedPermissions, ...group.permissions]);
                  } else {
                    setSelectedPermissions(selectedPermissions.filter(p => !group.permissions.includes(p)));
                  }
                }}
              />
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
              {group.permissions.map(permission => (
                <div key={permission} className="flex items-center space-x-2">
                  <Checkbox
                    id={permission}
                    checked={selectedPermissions.includes(permission)}
                    onCheckedChange={(checked) => {
                      if (checked) {
                        setSelectedPermissions([...selectedPermissions, permission]);
                      } else {
                        setSelectedPermissions(selectedPermissions.filter(p => p !== permission));
                      }
                    }}
                  />
                  <label htmlFor={permission} className="text-sm">
                    {permission}
                  </label>
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      ))}

      <div className="flex justify-end space-x-4">
        <Button variant="outline">å–æ¶ˆ</Button>
        <Button>ä¿å­˜</Button>
      </div>
    </div>
  );
}
```

### 4.3 æƒé™ç¼“å­˜æœºåˆ¶

#### 4.3.1 åç«¯æƒé™ç¼“å­˜

ä½¿ç”¨Redisç¼“å­˜ç”¨æˆ·æƒé™ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼š

```javascript
// server/services/permission.service.js
const { getDb } = require('coze-coding-dev-sdk');
const { redis } = require('../lib/redis');

class PermissionService {
  /**
   * è·å–ç”¨æˆ·æ‰€æœ‰æƒé™ï¼ˆå¸¦ç¼“å­˜ï¼‰
   */
  async getUserPermissions(userId) {
    const cacheKey = `user:permissions:${userId}`;

    // å°è¯•ä»ç¼“å­˜è·å–
    const cached = await redis.get(cacheKey);
    if (cached) {
      return JSON.parse(cached);
    }

    // ä»æ•°æ®åº“æŸ¥è¯¢
    const db = await getDb();
    const result = await db
      .select({ permissionCode: permissions.permissionCode })
      .from(userRoles)
      .innerJoin(rolePermissions, eq(userRoles.roleId, rolePermissions.roleId))
      .innerJoin(permissions, eq(rolePermissions.permissionId, permissions.id))
      .where(eq(userRoles.userId, userId));

    const permissions = result.map(p => p.permissionCode);

    // ç¼“å­˜1å°æ—¶
    await redis.set(cacheKey, JSON.stringify(permissions), 'EX', 3600);

    return permissions;
  }

  /**
   * æ¸…é™¤ç”¨æˆ·æƒé™ç¼“å­˜
   */
  async clearUserPermissionsCache(userId) {
    const cacheKey = `user:permissions:${userId}`;
    await redis.del(cacheKey);
  }

  /**
   * æ‰¹é‡æ¸…é™¤ç”¨æˆ·æƒé™ç¼“å­˜ï¼ˆè§’è‰²å˜æ›´æ—¶ï¼‰
   */
  async clearRolePermissionsCache(roleId) {
    // æŸ¥è¯¢æ‹¥æœ‰è¯¥è§’è‰²çš„æ‰€æœ‰ç”¨æˆ·
    const db = await getDb();
    const users = await db.select({ userId: userRoles.userId }).from(userRoles).where(eq(userRoles.roleId, roleId));

    // æ¸…é™¤æ‰€æœ‰ç”¨æˆ·çš„æƒé™ç¼“å­˜
    for (const user of users) {
      await this.clearUserPermissionsCache(user.userId);
    }
  }
}

module.exports = new PermissionService();
```

#### 4.3.2 å‰ç«¯æƒé™ç¼“å­˜

ä½¿ç”¨Context + localStorageç¼“å­˜ç”¨æˆ·æƒé™ï¼š

```typescript
// src/contexts/PermissionContext.tsx
'use client';

import React, { createContext, useContext, useState, useEffect } from 'react';

interface PermissionContextType {
  permissions: string[];
  hasPermission: (permission: string | string[]) => boolean;
  loading: boolean;
  refreshPermissions: () => Promise<void>;
}

const PermissionContext = createContext<PermissionContextType | undefined>(undefined);

export function PermissionProvider({ children }: { children: React.ReactNode }) {
  const [permissions, setPermissions] = useState<string[]>([]);
  const [loading, setLoading] = useState(true);

  // ä»localStorageåŠ è½½æƒé™
  const loadPermissionsFromCache = () => {
    try {
      const cached = localStorage.getItem('user_permissions');
      if (cached) {
        const data = JSON.parse(cached);
        // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ˆ30åˆ†é’Ÿï¼‰
        if (Date.now() - data.timestamp < 30 * 60 * 1000) {
          setPermissions(data.permissions);
          return true;
        }
      }
    } catch (error) {
      console.error('åŠ è½½æƒé™ç¼“å­˜å¤±è´¥:', error);
    }
    return false;
  };

  // ä¿å­˜æƒé™åˆ°ç¼“å­˜
  const savePermissionsToCache = (permissions: string[]) => {
    try {
      localStorage.setItem('user_permissions', JSON.stringify({
        permissions,
        timestamp: Date.now(),
      }));
    } catch (error) {
      console.error('ä¿å­˜æƒé™ç¼“å­˜å¤±è´¥:', error);
    }
  };

  // åŠ è½½ç”¨æˆ·æƒé™
  const loadPermissions = async () => {
    // å…ˆå°è¯•ä»ç¼“å­˜åŠ è½½
    if (loadPermissionsFromCache()) {
      setLoading(false);
      // åŒæ—¶ä»åå°åˆ·æ–°ï¼Œé¿å…è¿‡æœŸ
      refreshPermissionsFromServer();
      return;
    }

    // ä»æœåŠ¡å™¨åŠ è½½
    await refreshPermissionsFromServer();
  };

  // ä»æœåŠ¡å™¨åˆ·æ–°æƒé™
  const refreshPermissionsFromServer = async () => {
    try {
      const token = localStorage.getItem('access_token');
      const response = await fetch('/api/auth/permissions', {
        headers: {
          'Authorization': `Bearer ${token}`,
        },
      });

      const result = await response.json();
      if (result.code === 0) {
        const perms = result.data.permissions || [];
        setPermissions(perms);
        savePermissionsToCache(perms);
      }
    } catch (error) {
      console.error('åŠ è½½æƒé™å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  // æ£€æŸ¥æƒé™
  const hasPermission = (permission: string | string[]): boolean => {
    if (permissions.length === 0) return false;
    if (typeof permission === 'string') {
      return permissions.includes(permission);
    }
    return permission.some(p => permissions.includes(p));
  };

  // åˆ·æ–°æƒé™
  const refreshPermissions = async () => {
    setLoading(true);
    await refreshPermissionsFromServer();
  };

  useEffect(() => {
    loadPermissions();
  }, []);

  return (
    <PermissionContext.Provider value={{ permissions, hasPermission, loading, refreshPermissions }}>
      {children}
    </PermissionContext.Provider>
  );
}

export function usePermissions() {
  const context = useContext(PermissionContext);
  if (!context) {
    throw new Error('usePermissions must be used within PermissionProvider');
  }
  return context;
}
```

### 4.4 æƒé™å˜æ›´é€šçŸ¥

#### 4.4.1 æƒé™å˜æ›´äº‹ä»¶æ€»çº¿

å½“ç”¨æˆ·æƒé™å˜æ›´æ—¶ï¼Œé€šçŸ¥å‰ç«¯åˆ·æ–°ï¼š

```javascript
// åç«¯ï¼šserver/services/permission.service.js
const { eventBus } = require('../lib/event-bus');

class PermissionService {
  /**
   * æ›´æ–°è§’è‰²æƒé™
   */
  async updateRolePermissions(roleId, permissionIds) {
    // ... æ›´æ–°æ•°æ®åº“

    // æ¸…é™¤æƒé™ç¼“å­˜
    await this.clearRolePermissionsCache(roleId);

    // å‘å¸ƒæƒé™å˜æ›´äº‹ä»¶
    eventBus.publish('permission:changed', {
      roleId,
      timestamp: new Date(),
    });
  }
}

module.exports = new PermissionService();
```

```typescript
// å‰ç«¯ï¼šsrc/contexts/PermissionContext.tsx
import { useEventBus } from '@/hooks/use-event-bus';

export function PermissionProvider({ children }: { children: React.ReactNode }) {
  // ... ç°æœ‰ä»£ç 

  // ç›‘å¬æƒé™å˜æ›´äº‹ä»¶
  const { subscribe } = useEventBus();

  useEffect(() => {
    const unsubscribe = subscribe('permission:changed', () => {
      // æƒé™å˜æ›´ï¼Œåˆ·æ–°æƒé™
      refreshPermissions();
    });

    return unsubscribe;
  }, []);

  // ...
}
```

---

## 5. æœ€ä½³å®è·µ

### 5.1 æƒé™è®¾è®¡åŸåˆ™

1. **æƒé™å‘½åè§„èŒƒ**
   - ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼š`user_view`ã€`user_create`ã€`user_update`ã€`user_delete`
   - æ¨¡å—å‰ç¼€ï¼š`robot_view`ã€`session_view`ã€`alert_view`
   - æ“ä½œåç¼€ï¼š`_view`ã€`_create`ã€`_update`ã€`_delete`ã€`_export`

2. **æƒé™åˆ†å±‚**
   - é¡µé¢çº§ï¼š`xxx_view`
   - åŠŸèƒ½çº§ï¼š`xxx_export`ã€`xxx_import`
   - æ“ä½œçº§ï¼š`xxx_approve`ã€`xxx_reject`
   - æ•°æ®çº§ï¼š`xxx_view_own_only`

3. **è§’è‰²è®¾è®¡**
   - è§’è‰²æ•°é‡ä¸å®œè¿‡å¤šï¼ˆå»ºè®®10ä¸ªä»¥å†…ï¼‰
   - é¿å…è§’è‰²èŒè´£äº¤å‰
   - æä¾›è§’è‰²æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»º

### 5.2 å®ç°å»ºè®®

1. **åç«¯**
   - æ‰€æœ‰APIéƒ½å¿…é¡»è¿›è¡Œæƒé™æ£€æŸ¥
   - ä½¿ç”¨ä¸­é—´ä»¶ç»Ÿä¸€æƒé™æ£€æŸ¥é€»è¾‘
   - æƒé™ä¿¡æ¯ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
   - æƒé™å˜æ›´æ—¶æ¸…é™¤ç¼“å­˜

2. **å‰ç«¯**
   - ä½¿ç”¨Contextç®¡ç†æƒé™çŠ¶æ€
   - ä½¿ç”¨ç»„ä»¶å°è£…æƒé™é€»è¾‘ï¼ˆPermissionGuardã€PermissionButtonï¼‰
   - å¯¼èˆªèœå•æ ¹æ®æƒé™åŠ¨æ€æ˜¾ç¤º
   - é¡µé¢çº§æƒé™æ£€æŸ¥ï¼Œæœªæˆæƒé‡å®šå‘

3. **ç”¨æˆ·ä½“éªŒ**
   - æ— æƒé™æ—¶æ˜¾ç¤ºå‹å¥½çš„æç¤ºä¿¡æ¯
   - æŒ‰é’®ç¦ç”¨è€Œä¸æ˜¯éšè—ï¼ˆéƒ¨åˆ†åœºæ™¯ï¼‰
   - æƒé™å˜æ›´åè‡ªåŠ¨åˆ·æ–°
   - æä¾›æƒé™ç”³è¯·å…¥å£

### 5.3 æµ‹è¯•å»ºè®®

1. **å•å…ƒæµ‹è¯•**
   - æµ‹è¯•æƒé™æ£€æŸ¥é€»è¾‘
   - æµ‹è¯•æƒé™ç¼“å­˜æœºåˆ¶

2. **é›†æˆæµ‹è¯•**
   - æµ‹è¯•è§’è‰²æƒé™åˆ†é…
   - æµ‹è¯•ç”¨æˆ·æƒé™ç»§æ‰¿
   - æµ‹è¯•APIæƒé™æ§åˆ¶

3. **å®‰å…¨æµ‹è¯•**
   - æµ‹è¯•è¶Šæƒè®¿é—®
   - æµ‹è¯•æƒé™ç»•è¿‡
   - æµ‹è¯•æƒé™æå‡

---

## 6. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 6.1 é—®é¢˜ï¼šæƒé™è¿‡å¤šï¼Œç®¡ç†æ··ä¹±

**è§£å†³æ–¹æ¡ˆï¼š**
1. ä½¿ç”¨æƒé™åˆ†ç»„ï¼ŒæŒ‰æ¨¡å—ç®¡ç†
2. æä¾›æƒé™æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»ºè§’è‰²
3. å®šæœŸå®¡æŸ¥æƒé™ï¼Œåˆ é™¤å†—ä½™æƒé™

### 6.2 é—®é¢˜ï¼šæƒé™ç²’åº¦è¿‡ç»†ï¼Œéš¾ä»¥ç»´æŠ¤

**è§£å†³æ–¹æ¡ˆï¼š**
1. æƒé™ç²’åº¦é€‚ä¸­ï¼Œä¸è¦è¿‡ç»†
2. ä½¿ç”¨è§’è‰²ç»„åˆçš„æ–¹å¼å®ç°ç»†ç²’åº¦æ§åˆ¶
3. ä¼˜å…ˆä½¿ç”¨ç²—ç²’åº¦æƒé™ï¼Œå¿…è¦æ—¶æ‰ä½¿ç”¨ç»†ç²’åº¦

### 6.3 é—®é¢˜ï¼šå‰ç«¯å’Œåç«¯æƒé™ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç»Ÿä¸€æƒé™å®šä¹‰ï¼Œå‰åç«¯å…±äº«
2. åç«¯è¿”å›å®Œæ•´æƒé™åˆ—è¡¨ç»™å‰ç«¯
3. å‰ç«¯æƒé™ä¸»è¦ç”¨äºUIæ§åˆ¶ï¼Œåç«¯æƒé™æ‰æ˜¯çœŸæ­£çš„å®‰å…¨æ§åˆ¶

### 6.4 é—®é¢˜ï¼šç”¨æˆ·çœ‹ä¸åˆ°è‡ªå·±åº”è¯¥æœ‰çš„åŠŸèƒ½

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥è§’è‰²æƒé™æ˜¯å¦æ­£ç¡®åˆ†é…
3. æ£€æŸ¥æƒé™ç¼“å­˜æ˜¯å¦è¿‡æœŸ
4. æä¾›æƒé™æŸ¥çœ‹é¡µé¢ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜

### 6.5 é—®é¢˜ï¼šæƒé™å˜æ›´åä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆï¼š**
1. å®ç°æƒé™ç¼“å­˜æœºåˆ¶ï¼Œå˜æ›´æ—¶æ¸…é™¤ç¼“å­˜
2. å®ç°æƒé™å˜æ›´äº‹ä»¶ï¼Œå‰ç«¯è‡ªåŠ¨åˆ·æ–°
3. æä¾›æ‰‹åŠ¨åˆ·æ–°æƒé™çš„å…¥å£
4. æƒé™å˜æ›´æ—¶å¼ºåˆ¶ç”¨æˆ·é‡æ–°ç™»å½•

---

## é™„å½•

### A. æƒé™æ£€æŸ¥æµç¨‹å›¾

```
ç”¨æˆ·è¯·æ±‚API
  â†“
éªŒè¯JWT Token
  â†“
è·å–ç”¨æˆ·ä¿¡æ¯
  â†“
æ£€æŸ¥ç”¨æˆ·è§’è‰²ï¼ˆæ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼‰
  â†“ æ˜¯
ç›´æ¥æ”¾è¡Œ
  â†“ å¦
ä»ç¼“å­˜è·å–ç”¨æˆ·æƒé™
  â†“ ç¼“å­˜ä¸å­˜åœ¨
ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·æƒé™
  â†“
ä¿å­˜åˆ°ç¼“å­˜
  â†“
æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æ‰€éœ€æƒé™
  â†“ æ˜¯
æ”¾è¡Œ
  â†“ å¦
è¿”å›403æƒé™ä¸è¶³
```

### B. æƒé™åˆ†é…æµç¨‹å›¾

```
åˆ›å»ºè§’è‰²
  â†“
é€‰æ‹©æƒé™æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
  â†“
åˆ†é…æƒé™
  â†“
åˆ›å»ºç”¨æˆ·
  â†“
åˆ†é…è§’è‰²ç»™ç”¨æˆ·
  â†“
ç”¨æˆ·ç™»å½•
  â†“
è·å–ç”¨æˆ·æƒé™
  â†“
æ ¹æ®æƒé™æ˜¾ç¤º/éšè—åŠŸèƒ½
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0

**æœ€åæ›´æ–°**ï¼š2024-01-10

**æ–‡æ¡£ä½œè€…**ï¼šWorkTool AI å›¢é˜Ÿ
