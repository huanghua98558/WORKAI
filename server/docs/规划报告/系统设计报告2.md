# 系统设计报告更新说明

## 更新时间

2024-01-10

## 更新内容

### 1. 系统架构图更新

**更新内容：**
- 添加了"平台登录用户管理系统"模块
- 包含用户登录、权限管理、角色管理、操作审计4个子模块

**更新位置：**
- 文件：`/workspace/projects/系统设计报告.md`
- 章节：3.1 系统架构图

**更新前：**
```
系统核心层
├── 消息接收
├── 上下文系统
├── AI分析
├── 告警系统
└── 协同分析
```

**更新后：**
```
系统核心层
├── 消息接收
├── 上下文系统
├── AI分析
├── 告警系统
├── 协同分析
└── 平台登录用户管理系统（新增）
    ├── 用户登录
    ├── 权限管理
    ├── 角色管理
    └── 操作审计
```

---

### 2. 机器人角色体系更新

**更新内容：**
- 明确机器人角色（4个）：
  1. 监控机器人（24小时）
  2. 通知机器人（24小时）
  3. 白班回复机器人（9:00-21:00）
  4. 晚班回复机器人（21:00-次日9:00）
- 明确人工角色（5个）：
  1. 售后人工A（早班9:00-19:00）
  2. 售后人工B（晚班14:00-23:00）
  3. 群助理（早班9:00-19:00）
  4. 群助理（晚班14:00-23:00）
  5. 用户（号主）
- 明确第三方角色（1个）：
  1. 运营（老板）
- **重要说明**：
  1. **没有售后机器人**：目前只有2个售后人工（售后人工A、售后人工B）
  2. **售后协同任务**：全程配合售后人工完善分析，系统负责监控、提醒、协同
  3. **群里配合**：由2个回复机器人（白班+晚班）配合，辅助人工处理日常运营
  4. **售后任务流程**：AI识别售后任务 → 创建售后任务记录 → 分配给售后人工 → 系统监控售后任务进度 → 提醒售后人工跟进 → 售后人工处理任务 → 系统记录处理结果 → 系统同步到腾讯文档

**更新位置：**
- 文件：`/workspace/projects/系统设计报告.md`
- 章节：10.1 角色体系

---

### 3. 数据库设计更新

**更新内容：**
- 新增"平台登录用户管理表"（5.2章节）
- 新增6个用户管理相关表：
  1. **用户表（users）**
     - 字段：用户ID、用户名、密码哈希、邮箱、手机号、真实姓名、状态、最后登录时间、最后登录IP、失败登录次数、锁定到期时间、创建时间、更新时间、删除时间
  2. **角色表（roles）**
     - 字段：角色ID、角色名称、角色代码、角色描述、是否系统角色、创建时间、更新时间
     - 预置角色：ADMIN（超级管理员）、MANAGER（管理员）、AFTER_SALES（售后人员）、ASSISTANT（群助理）、OPERATOR（运营人员）、VIEWER（只读用户）
  3. **权限表（permissions）**
     - 字段：权限ID、权限名称、权限代码、资源类型、资源ID、操作类型、权限描述、创建时间
     - 预置权限：dashboard_view、session_view、session_export、alert_view、alert_handle、after_sales_view、after_sales_handle、robot_view、robot_config、user_view、user_create、user_update、user_delete、role_view、role_create、role_update、role_delete、config_view、config_update
  4. **用户角色关联表（user_roles）**
     - 字段：用户ID、角色ID、分配者ID、分配时间、过期时间
     - 说明：一个用户可以拥有多个角色，一个角色可以分配给多个用户（多对多关系）
  5. **角色权限关联表（role_permissions）**
     - 字段：角色ID、权限ID、分配者ID、分配时间
     - 说明：一个角色可以拥有多个权限，一个权限可以分配给多个角色（多对多关系）
  6. **操作审计日志表（audit_logs）**
     - 字段：日志ID、操作用户ID、操作用户名、操作类型、资源类型、资源ID、操作描述、IP地址、用户代理、请求数据、响应数据、状态、错误消息、创建时间
     - 说明：记录所有用户操作日志，支持操作审计和追溯

**更新位置：**
- 文件：`/workspace/projects/系统设计报告.md`
- 章节：5.2 平台登录用户管理表（新增）、5.3 ER图（更新）

**ER图更新：**
- 新增"平台登录用户管理系统"部分
- 包含用户表、角色表、权限表、用户角色关联表、角色权限关联表、操作审计日志表及其关系

---

### 4. API设计更新

**更新内容：**
- 新增"用户管理API"（6.7章节）
- 新增10个用户管理相关API：
  1. **POST /api/auth/login** - 用户登录
  2. **POST /api/auth/logout** - 用户登出
  3. **GET /api/users** - 获取用户列表
  4. **POST /api/users** - 创建用户
  5. **PUT /api/users/:user_id** - 更新用户
  6. **DELETE /api/users/:user_id** - 删除用户
  7. **GET /api/roles** - 获取角色列表
  8. **POST /api/roles** - 创建角色
  9. **GET /api/permissions** - 获取权限列表
  10. **GET /api/audit-logs** - 获取操作审计日志

**更新位置：**
- 文件：`/workspace/projects/系统设计报告.md`
- 章节：6.7 用户管理API（新增）

---

### 5. 需要确认的事项更新

**更新内容：**
- 已确认事项从8项增加到10项：
  1. ✅ 告警通知的时间间隔可以自由设置
  2. ✅ 告警等级提升策略合理
  3. ✅ 告警取消规则不需要补充
  4. ✅ 统一AI的方案可行
  5. ✅ AI Prompt需要优化，设置为可调节
  6. ✅ 上下文检索数量（10-30条）是合理的
  7. ✅ AI介入场景灵活，能依据实际情况调整
  8. ✅ 机器人角色体系合理
  9. ✅ 群里配合由2个回复机器人配合
  10. ✅ 售后协同任务，全程配合售后完善分析
- 待确认事项从7项减少到6项：
  1. ⏳ 机器人选择规则是否合理？
  2. ⏳ 回复延迟设置是否合理？
  3. ⏳ 售后任务表与腾讯文档的对接细节是否需要进一步确认？
  4. ⏳ 前端页面设计是否符合需求？
  5. ⏳ 数据库表结构是否需要调整？
  6. ⏳ 部署方案是否需要调整？

**更新位置：**
- 文件：`/workspace/projects/系统设计报告.md`
- 章节：16. 需要确认的事项

---

## 更新文件列表

1. **主报告**：`/workspace/projects/系统设计报告.md`（已更新）
2. **补充报告**：`/workspace/projects/系统设计报告_补充.md`（无需更新）
3. **更新说明**：`/workspace/projects/系统设计报告_更新说明.md`（新增）

---

## 下一步建议

1. 请阅读更新后的系统设计报告
2. 确认剩余的6个待确认事项
3. 根据反馈调整数据库表结构和部署方案
4. 开始技术实现（后端、前端）

---

**文档版本**：v1.2

**最后更新**：2024-01-10

**文档作者**：WorkTool AI 团队
