# 规划报告2 - 文档索引

> **版本**: v1.0
> **创建日期**: 2024-01-01
> **维护者**: WorkTool AI 团队

---

## 📚 文档列表

本文件夹包含系统升级的完整规划文档，共计6个文档：

### 1. 完整系统升级方案.md
**概述**: 系统升级的整体方案文档，包含所有升级内容的总览

**主要内容**:
- 系统现状分析（现有功能模块、存在问题）
- 升级目标（角色识别、流程优化、延迟控制、售后响应等）
- 核心升级内容（流程引擎、延迟策略、告警处理、售后优化等）
- 实施计划（15个任务，分P0和P1两个优先级）
- 技术架构（系统架构图、技术栈）
- 预期效果（系统能力提升、用户体验提升、运营效率提升）

**适合人群**: 项目经理、技术负责人、产品经理

---

### 2. 流程引擎详细设计.md
**概述**: 流程引擎板块的详细设计文档

**主要内容**:
- 流程引擎架构（流程定义层、流程实例层、流程执行层等）
- 统一消息处理流程（详细流程定义、执行流程）
- 节点类型详解（25种节点类型的详细配置）
- 流程执行机制（执行流程、错误处理、性能优化）
- 上下文管理（上下文结构、管理策略）
- 流程版本管理（版本管理策略、版本对比）

**适合人群**: 开发工程师、架构师、技术负责人

---

### 3. 数据库设计.md
**概述**: 数据库表结构设计文档

**主要内容**:
- 数据库概述（数据库选择、命名规范）
- 新增表设计（5个新增表的详细结构）
  - flow_definitions（流程定义表）
  - flow_instances（流程实例表）
  - flow_execution_logs（流程执行日志表）
  - track_tasks（跟踪任务表）
  - robot_command_queue（指令队列表）
- 修改表设计（2个修改表的字段添加）
  - messages表（添加7个字段）
  - session_messages表（添加6个字段）
- 索引设计（索引策略、复合索引、部分索引）
- 数据库约束（外键约束、检查约束、默认值约束）
- 数据迁移脚本（创建表、初始化数据）

**适合人群**: 数据库工程师、开发工程师、运维工程师

---

### 4. API接口设计.md
**概述**: API接口设计文档（待创建）

**主要内容**:
- 流程管理API（创建/更新/删除/激活/停用流程）
- 流程实例API（获取实例列表/详情/日志/取消）
- 跟踪任务API（创建/更新/删除/完成任务）
- 指令队列API（添加/查询/更新/检查/重试）
- 接口规范（请求格式、响应格式、错误处理）
- 接口示例（curl命令、请求示例、响应示例）

**适合人群**: 开发工程师、前端工程师、测试工程师

---

### 5. 前端页面设计.md
**概述**: 前端页面设计文档（待创建）

**主要内容**:
- 流程引擎管理页面设计
  - 流程列表页面
  - 流程详情页面
  - 流程编辑页面
- 流程可视化编辑器设计
  - 拖拽式编辑界面
  - 节点属性配置面板
  - 连接关系配置
- 售后任务配置页面设计
  - 机器人安抚配置
  - 售后人员通知配置
- UI/UX设计规范
  - 色彩规范
  - 字体规范
  - 组件规范

**适合人群**: 前端工程师、UI设计师、产品经理

---

### 6. 流程图-文字版.md
**概述**: 完整的流程图（文字版）

**主要内容**:
- 整体架构流程图（统一消息处理主流程）
- 运营消息处理流程图
- 工作人员消息处理流程图
- 售后协助流程图
- 用户消息处理流程图
- 会话管理与分析流程图
- 延迟控制策略表
- 告警级别与处理策略表
- 机器人角色配置表

**适合人群**: 所有关注流程的人员

---

## 📊 文档关系图

```
┌─────────────────────────────────────────────────────────────────┐
│                    完整系统升级方案.md                           │
│                    （总体方案文档）                               │
└───────┬──────────────┬──────────────┬──────────────┬────────────┘
        │              │              │              │
        ▼              ▼              ▼              ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│流程引擎详细   │ │  数据库设计   │ │ API接口设计   │ │前端页面设计   │
│    设计.md    │ │     .md      │ │     .md      │ │     .md      │
└──────┬───────┘ └──────────────┘ └──────────────┘ └──────────────┘
       │
       ▼
┌──────────────┐
│流程图-文字版 │
│    .md      │
└──────────────┘
```

## 🎯 文档使用指南

### 如果你是项目经理：
1. 先阅读 **完整系统升级方案.md**，了解整体升级规划
2. 查看 **实施计划** 部分，了解任务分工和时间安排
3. 参考 **预期效果** 部分，评估升级价值

### 如果你是技术负责人：
1. 先阅读 **完整系统升级方案.md**，了解整体架构
2. 详细阅读 **流程引擎详细设计.md**，了解核心逻辑
3. 详细阅读 **数据库设计.md**，了解数据结构
4. 参考 **API接口设计.md** 和 **前端页面设计.md**（待创建）

### 如果你是开发工程师：
1. 先阅读 **完整系统升级方案.md**，了解升级目标
2. 详细阅读 **流程引擎详细设计.md**，了解流程执行逻辑
3. 详细阅读 **数据库设计.md**，了解表结构设计
4. 参考 **API接口设计.md**，了解接口规范（待创建）

### 如果你是前端工程师：
1. 先阅读 **完整系统升级方案.md**，了解整体功能
2. 详细阅读 **前端页面设计.md**，了解页面设计（待创建）
3. 参考 **流程引擎详细设计.md**，了解后端逻辑
4. 参考 **API接口设计.md**，了解接口调用（待创建）

### 如果你是测试工程师：
1. 先阅读 **完整系统升级方案.md**，了解测试目标
2. 详细阅读 **流程图-文字版.md**，了解流程逻辑
3. 参考 **API接口设计.md**，了解接口测试（待创建）

---

## 🔍 核心亮点

### 1. 统一消息路由架构
- 一个主流程 + 4个分支
- 避免创建多个独立流程
- 提高复用性和可维护性

### 2. 完整的角色识别
- 支持运营（财神爷）、工作人员、用户、机器人的完整识别
- 运营消息最高优先级处理

### 3. 智能售后响应
- 用户回复"在的"、"好的"时，自动识别为售后响应
- 机器人立即安抚用户
- 同时通知售后人员

### 4. 灵活的延迟控制
- 白班/晚班/深夜的延迟策略
- 根据消息重要性动态调整
- 支持延迟队列

### 5. 完善的告警系统
- 4个告警级别（critical/error/warning/info）
- 自动告警提升和降级
- 告警取消规则（情绪好转+连续3条正面消息）

### 6. 冲突调和机制
- 自动检测运营与用户冲突
- 生成调和消息
- 通知工作人员工作群

### 7. 异步结果确认
- 机器人指令发送后1分钟自动查询结果
- 失败后自动重试（最多3次）
- 超过最大重试次数转为人工处理

---

## 📅 文档更新历史

| 版本 | 日期 | 更新内容 | 更新人 |
|------|------|---------|--------|
| v1.0 | 2024-01-01 | 初始版本创建 | WorkTool AI 团队 |

---

## 💡 反馈与建议

如果您对文档有任何疑问或建议，请联系：
- **维护者**: WorkTool AI 团队
- **邮箱**: support@worktool.ai

---

**文档结束**
